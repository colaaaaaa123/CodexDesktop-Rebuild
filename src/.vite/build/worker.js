"use strict";var d0=Object.create;var Wm=Object.defineProperty;var f0=Object.getOwnPropertyDescriptor;var _0=Object.getOwnPropertyNames;var p0=Object.getPrototypeOf,h0=Object.prototype.hasOwnProperty;var E0=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _0(t))!h0.call(e,o)&&o!==n&&Wm(e,o,{get:()=>t[o],enumerable:!(r=f0(t,o))||r.enumerable});return e};var md=(e,t,n)=>(n=e!=null?d0(p0(e)):{},E0(t||!e||!e.__esModule?Wm(n,"default",{value:e,enumerable:!0}):n,e));const Al=require("node:worker_threads"),bn=require("path"),mo=require("node:os"),ce=require("node:path"),wc=require("events"),Lc=require("child_process"),pe=require("node:fs"),Sc=require("node:crypto"),Dc=require("node:child_process"),Gn=require("node:buffer"),Km=require("node:string_decoder"),Rl=require("fs"),yl=require("os"),T0=require("assert"),S0=require("buffer"),Yh=require("stream"),ar=require("util"),jo=require("node:process"),Uc=require("node:util"),m0=require("node:net");require("crypto");const SP=require("node:fs/promises"),g0=require("perf_hooks"),Nl=require("url"),mP=require("module"),gP=require("tty"),Xp=require("worker_threads"),mn=require("node:diagnostics_channel"),A0=require("node:events"),AP=require("diagnostics_channel"),RP=require("async_hooks"),R0=require("node:readline"),y0=require("node:http"),N0=require("node:https"),O0=require("node:stream"),b0=require("node:zlib"),C0=require("node:tls");var gd=typeof document<"u"?document.currentScript:null;function dn(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const to=dn(bn),Ut=dn(mo),yP=dn(ce),I0=dn(Uc),Uo=dn(m0),P0=dn(mP),vu=dn(mn),Ad=dn(AP),wu=dn(y0),M0=dn(N0),zm=dn(C0);var sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ol(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function NP(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}var Rd={},hr={},Gi={},Vi={},Mn={},Er={},Tr={},$i={},Zm;function v0(){return Zm||(Zm=1,Object.defineProperty($i,"__esModule",{value:!0}),$i._globalThis=void 0,$i._globalThis=typeof globalThis=="object"?globalThis:sn),$i}var Xm;function w0(){return Xm||(Xm=1,(function(e){var t=Tr&&Tr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s),Object.defineProperty(r,i,{enumerable:!0,get:function(){return o[s]}})}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Tr&&Tr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(v0(),e)})(Tr)),Tr}var Qm;function L0(){return Qm||(Qm=1,(function(e){var t=Er&&Er.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s),Object.defineProperty(r,i,{enumerable:!0,get:function(){return o[s]}})}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Er&&Er.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(w0(),e)})(Er)),Er}var Bi={},Jm;function OP(){return Jm||(Jm=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.VERSION=void 0,Bi.VERSION="1.9.0"),Bi}var Sr={},eg;function D0(){if(eg)return Sr;eg=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.isCompatible=Sr._makeCompatibilityCheck=void 0;const e=OP(),t=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function n(r){const o=new Set([r]),s=new Set,i=r.match(t);if(!i)return()=>!1;const a={major:+i[1],minor:+i[2],patch:+i[3],prerelease:i[4]};if(a.prerelease!=null)return function(d){return d===r};function c(f){return s.add(f),!1}function u(f){return o.add(f),!0}return function(d){if(o.has(d))return!0;if(s.has(d))return!1;const l=d.match(t);if(!l)return c(d);const _={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return _.prerelease!=null||a.major!==_.major?c(d):a.major===0?a.minor===_.minor&&a.patch<=_.patch?u(d):c(d):a.minor<=_.minor?u(d):c(d)}}return Sr._makeCompatibilityCheck=n,Sr.isCompatible=n(e.VERSION),Sr}var tg;function as(){if(tg)return Mn;tg=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.unregisterGlobal=Mn.getGlobal=Mn.registerGlobal=void 0;const e=L0(),t=OP(),n=D0(),r=t.VERSION.split(".")[0],o=Symbol.for(`opentelemetry.js.api.${r}`),s=e._globalThis;function i(u,f,d,l=!1){var _;const p=s[o]=(_=s[o])!==null&&_!==void 0?_:{version:t.VERSION};if(!l&&p[u]){const h=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${u}`);return d.error(h.stack||h.message),!1}if(p.version!==t.VERSION){const h=new Error(`@opentelemetry/api: Registration of version v${p.version} for ${u} does not match previously registered API v${t.VERSION}`);return d.error(h.stack||h.message),!1}return p[u]=f,d.debug(`@opentelemetry/api: Registered a global for ${u} v${t.VERSION}.`),!0}Mn.registerGlobal=i;function a(u){var f,d;const l=(f=s[o])===null||f===void 0?void 0:f.version;if(!(!l||!(0,n.isCompatible)(l)))return(d=s[o])===null||d===void 0?void 0:d[u]}Mn.getGlobal=a;function c(u,f){f.debug(`@opentelemetry/api: Unregistering a global for ${u} v${t.VERSION}.`);const d=s[o];d&&delete d[u]}return Mn.unregisterGlobal=c,Mn}var ng;function U0(){if(ng)return Vi;ng=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.DiagComponentLogger=void 0;const e=as();class t{constructor(o){this._namespace=o.namespace||"DiagComponentLogger"}debug(...o){return n("debug",this._namespace,o)}error(...o){return n("error",this._namespace,o)}info(...o){return n("info",this._namespace,o)}warn(...o){return n("warn",this._namespace,o)}verbose(...o){return n("verbose",this._namespace,o)}}Vi.DiagComponentLogger=t;function n(r,o,s){const i=(0,e.getGlobal)("diag");if(i)return s.unshift(o),i[r](...s)}return Vi}var Hi={},yd={},rg;function jh(){return rg||(rg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiagLogLevel=void 0,(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(e.DiagLogLevel||(e.DiagLogLevel={}))})(yd)),yd}var og;function k0(){if(og)return Hi;og=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.createLogLevelDiagLogger=void 0;const e=jh();function t(n,r){n<e.DiagLogLevel.NONE?n=e.DiagLogLevel.NONE:n>e.DiagLogLevel.ALL&&(n=e.DiagLogLevel.ALL),r=r||{};function o(s,i){const a=r[s];return typeof a=="function"&&n>=i?a.bind(r):function(){}}return{error:o("error",e.DiagLogLevel.ERROR),warn:o("warn",e.DiagLogLevel.WARN),info:o("info",e.DiagLogLevel.INFO),debug:o("debug",e.DiagLogLevel.DEBUG),verbose:o("verbose",e.DiagLogLevel.VERBOSE)}}return Hi.createLogLevelDiagLogger=t,Hi}var sg;function cs(){if(sg)return Gi;sg=1,Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.DiagAPI=void 0;const e=U0(),t=k0(),n=jh(),r=as(),o="diag";class s{constructor(){function a(f){return function(...d){const l=(0,r.getGlobal)("diag");if(l)return l[f](...d)}}const c=this,u=(f,d={logLevel:n.DiagLogLevel.INFO})=>{var l,_,p;if(f===c){const T=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return c.error((l=T.stack)!==null&&l!==void 0?l:T.message),!1}typeof d=="number"&&(d={logLevel:d});const h=(0,r.getGlobal)("diag"),E=(0,t.createLogLevelDiagLogger)((_=d.logLevel)!==null&&_!==void 0?_:n.DiagLogLevel.INFO,f);if(h&&!d.suppressOverrideMessage){const T=(p=new Error().stack)!==null&&p!==void 0?p:"<failed to generate stacktrace>";h.warn(`Current logger will be overwritten from ${T}`),E.warn(`Current logger will overwrite one already registered from ${T}`)}return(0,r.registerGlobal)("diag",E,c,!0)};c.setLogger=u,c.disable=()=>{(0,r.unregisterGlobal)(o,c)},c.createComponentLogger=f=>new e.DiagComponentLogger(f),c.verbose=a("verbose"),c.debug=a("debug"),c.info=a("info"),c.warn=a("warn"),c.error=a("error")}static instance(){return this._instance||(this._instance=new s),this._instance}}return Gi.DiagAPI=s,Gi}var Fi={},ig;function x0(){if(ig)return Fi;ig=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.BaggageImpl=void 0;class e{constructor(n){this._entries=n?new Map(n):new Map}getEntry(n){const r=this._entries.get(n);if(r)return Object.assign({},r)}getAllEntries(){return Array.from(this._entries.entries()).map(([n,r])=>[n,r])}setEntry(n,r){const o=new e(this._entries);return o._entries.set(n,r),o}removeEntry(n){const r=new e(this._entries);return r._entries.delete(n),r}removeEntries(...n){const r=new e(this._entries);for(const o of n)r._entries.delete(o);return r}clear(){return new e}}return Fi.BaggageImpl=e,Fi}var Yi={},ag;function G0(){return ag||(ag=1,Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.baggageEntryMetadataSymbol=void 0,Yi.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")),Yi}var cg;function bP(){if(cg)return hr;cg=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.baggageEntryMetadataFromString=hr.createBaggage=void 0;const e=cs(),t=x0(),n=G0(),r=e.DiagAPI.instance();function o(i={}){return new t.BaggageImpl(new Map(Object.entries(i)))}hr.createBaggage=o;function s(i){return typeof i!="string"&&(r.error(`Cannot create baggage metadata from unknown type: ${typeof i}`),i=""),{__TYPE__:n.baggageEntryMetadataSymbol,toString(){return i}}}return hr.baggageEntryMetadataFromString=s,hr}var mr={},ug;function bl(){if(ug)return mr;ug=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.ROOT_CONTEXT=mr.createContextKey=void 0;function e(n){return Symbol.for(n)}mr.createContextKey=e;class t{constructor(r){const o=this;o._currentContext=r?new Map(r):new Map,o.getValue=s=>o._currentContext.get(s),o.setValue=(s,i)=>{const a=new t(o._currentContext);return a._currentContext.set(s,i),a},o.deleteValue=s=>{const i=new t(o._currentContext);return i._currentContext.delete(s),i}}}return mr.ROOT_CONTEXT=new t,mr}var ji={},lg;function V0(){if(lg)return ji;lg=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.DiagConsoleLogger=void 0;const e=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class t{constructor(){function r(o){return function(...s){if(console){let i=console[o];if(typeof i!="function"&&(i=console.log),typeof i=="function")return i.apply(console,s)}}}for(let o=0;o<e.length;o++)this[e[o].n]=r(e[o].c)}}return ji.DiagConsoleLogger=t,ji}var Nd={},dg;function CP(){return dg||(dg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createNoopMeter=e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=e.NOOP_OBSERVABLE_GAUGE_METRIC=e.NOOP_OBSERVABLE_COUNTER_METRIC=e.NOOP_UP_DOWN_COUNTER_METRIC=e.NOOP_HISTOGRAM_METRIC=e.NOOP_GAUGE_METRIC=e.NOOP_COUNTER_METRIC=e.NOOP_METER=e.NoopObservableUpDownCounterMetric=e.NoopObservableGaugeMetric=e.NoopObservableCounterMetric=e.NoopObservableMetric=e.NoopHistogramMetric=e.NoopGaugeMetric=e.NoopUpDownCounterMetric=e.NoopCounterMetric=e.NoopMetric=e.NoopMeter=void 0;class t{constructor(){}createGauge(_,p){return e.NOOP_GAUGE_METRIC}createHistogram(_,p){return e.NOOP_HISTOGRAM_METRIC}createCounter(_,p){return e.NOOP_COUNTER_METRIC}createUpDownCounter(_,p){return e.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(_,p){return e.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(_,p){return e.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(_,p){return e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(_,p){}removeBatchObservableCallback(_){}}e.NoopMeter=t;class n{}e.NoopMetric=n;class r extends n{add(_,p){}}e.NoopCounterMetric=r;class o extends n{add(_,p){}}e.NoopUpDownCounterMetric=o;class s extends n{record(_,p){}}e.NoopGaugeMetric=s;class i extends n{record(_,p){}}e.NoopHistogramMetric=i;class a{addCallback(_){}removeCallback(_){}}e.NoopObservableMetric=a;class c extends a{}e.NoopObservableCounterMetric=c;class u extends a{}e.NoopObservableGaugeMetric=u;class f extends a{}e.NoopObservableUpDownCounterMetric=f,e.NOOP_METER=new t,e.NOOP_COUNTER_METRIC=new r,e.NOOP_GAUGE_METRIC=new s,e.NOOP_HISTOGRAM_METRIC=new i,e.NOOP_UP_DOWN_COUNTER_METRIC=new o,e.NOOP_OBSERVABLE_COUNTER_METRIC=new c,e.NOOP_OBSERVABLE_GAUGE_METRIC=new u,e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new f;function d(){return e.NOOP_METER}e.createNoopMeter=d})(Nd)),Nd}var Od={},fg;function $0(){return fg||(fg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueType=void 0,(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(e.ValueType||(e.ValueType={}))})(Od)),Od}var gr={},_g;function IP(){return _g||(_g=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.defaultTextMapSetter=gr.defaultTextMapGetter=void 0,gr.defaultTextMapGetter={get(e,t){if(e!=null)return e[t]},keys(e){return e==null?[]:Object.keys(e)}},gr.defaultTextMapSetter={set(e,t,n){e!=null&&(e[t]=n)}}),gr}var qi={},Wi={},Ki={},zi={},pg;function B0(){if(pg)return zi;pg=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.NoopContextManager=void 0;const e=bl();let t=class{active(){return e.ROOT_CONTEXT}with(r,o,s,...i){return o.call(s,...i)}bind(r,o){return o}enable(){return this}disable(){return this}};return zi.NoopContextManager=t,zi}var hg;function Cl(){if(hg)return Ki;hg=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.ContextAPI=void 0;const e=B0(),t=as(),n=cs(),r="context",o=new e.NoopContextManager;class s{constructor(){}static getInstance(){return this._instance||(this._instance=new s),this._instance}setGlobalContextManager(a){return(0,t.registerGlobal)(r,a,n.DiagAPI.instance())}active(){return this._getContextManager().active()}with(a,c,u,...f){return this._getContextManager().with(a,c,u,...f)}bind(a,c){return this._getContextManager().bind(a,c)}_getContextManager(){return(0,t.getGlobal)(r)||o}disable(){this._getContextManager().disable(),(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return Ki.ContextAPI=s,Ki}var ht={},Zi={},bd={},Cd={},Eg;function PP(){return Eg||(Eg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TraceFlags=void 0,(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(e.TraceFlags||(e.TraceFlags={}))})(Cd)),Cd}var Tg;function qh(){return Tg||(Tg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=void 0;const t=PP();e.INVALID_SPANID="0000000000000000",e.INVALID_TRACEID="00000000000000000000000000000000",e.INVALID_SPAN_CONTEXT={traceId:e.INVALID_TRACEID,spanId:e.INVALID_SPANID,traceFlags:t.TraceFlags.NONE}})(bd)),bd}var Sg;function Wh(){if(Sg)return Zi;Sg=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.NonRecordingSpan=void 0;const e=qh();let t=class{constructor(r=e.INVALID_SPAN_CONTEXT){this._spanContext=r}spanContext(){return this._spanContext}setAttribute(r,o){return this}setAttributes(r){return this}addEvent(r,o){return this}addLink(r){return this}addLinks(r){return this}setStatus(r){return this}updateName(r){return this}end(r){}isRecording(){return!1}recordException(r,o){}};return Zi.NonRecordingSpan=t,Zi}var mg;function MP(){if(mg)return ht;mg=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.getSpanContext=ht.setSpanContext=ht.deleteSpan=ht.setSpan=ht.getActiveSpan=ht.getSpan=void 0;const e=bl(),t=Wh(),n=Cl(),r=(0,e.createContextKey)("OpenTelemetry Context Key SPAN");function o(f){return f.getValue(r)||void 0}ht.getSpan=o;function s(){return o(n.ContextAPI.getInstance().active())}ht.getActiveSpan=s;function i(f,d){return f.setValue(r,d)}ht.setSpan=i;function a(f){return f.deleteValue(r)}ht.deleteSpan=a;function c(f,d){return i(f,new t.NonRecordingSpan(d))}ht.setSpanContext=c;function u(f){var d;return(d=o(f))===null||d===void 0?void 0:d.spanContext()}return ht.getSpanContext=u,ht}var Jt={},gg;function Kh(){if(gg)return Jt;gg=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.wrapSpanContext=Jt.isSpanContextValid=Jt.isValidSpanId=Jt.isValidTraceId=void 0;const e=qh(),t=Wh(),n=/^([0-9a-f]{32})$/i,r=/^[0-9a-f]{16}$/i;function o(c){return n.test(c)&&c!==e.INVALID_TRACEID}Jt.isValidTraceId=o;function s(c){return r.test(c)&&c!==e.INVALID_SPANID}Jt.isValidSpanId=s;function i(c){return o(c.traceId)&&s(c.spanId)}Jt.isSpanContextValid=i;function a(c){return new t.NonRecordingSpan(c)}return Jt.wrapSpanContext=a,Jt}var Ag;function vP(){if(Ag)return Wi;Ag=1,Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.NoopTracer=void 0;const e=Cl(),t=MP(),n=Wh(),r=Kh(),o=e.ContextAPI.getInstance();let s=class{startSpan(c,u,f=o.active()){if(!!u?.root)return new n.NonRecordingSpan;const l=f&&(0,t.getSpanContext)(f);return i(l)&&(0,r.isSpanContextValid)(l)?new n.NonRecordingSpan(l):new n.NonRecordingSpan}startActiveSpan(c,u,f,d){let l,_,p;if(arguments.length<2)return;arguments.length===2?p=u:arguments.length===3?(l=u,p=f):(l=u,_=f,p=d);const h=_??o.active(),E=this.startSpan(c,l,h),T=(0,t.setSpan)(h,E);return o.with(T,p,void 0,E)}};Wi.NoopTracer=s;function i(a){return typeof a=="object"&&typeof a.spanId=="string"&&typeof a.traceId=="string"&&typeof a.traceFlags=="number"}return Wi}var Rg;function wP(){if(Rg)return qi;Rg=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.ProxyTracer=void 0;const e=vP(),t=new e.NoopTracer;let n=class{constructor(o,s,i,a){this._provider=o,this.name=s,this.version=i,this.options=a}startSpan(o,s,i){return this._getTracer().startSpan(o,s,i)}startActiveSpan(o,s,i,a){const c=this._getTracer();return Reflect.apply(c.startActiveSpan,c,arguments)}_getTracer(){if(this._delegate)return this._delegate;const o=this._provider.getDelegateTracer(this.name,this.version,this.options);return o?(this._delegate=o,this._delegate):t}};return qi.ProxyTracer=n,qi}var Xi={},Qi={},yg;function H0(){if(yg)return Qi;yg=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.NoopTracerProvider=void 0;const e=vP();let t=class{getTracer(r,o,s){return new e.NoopTracer}};return Qi.NoopTracerProvider=t,Qi}var Ng;function LP(){if(Ng)return Xi;Ng=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.ProxyTracerProvider=void 0;const e=wP(),t=H0(),n=new t.NoopTracerProvider;let r=class{getTracer(s,i,a){var c;return(c=this.getDelegateTracer(s,i,a))!==null&&c!==void 0?c:new e.ProxyTracer(this,s,i,a)}getDelegate(){var s;return(s=this._delegate)!==null&&s!==void 0?s:n}setDelegate(s){this._delegate=s}getDelegateTracer(s,i,a){var c;return(c=this._delegate)===null||c===void 0?void 0:c.getTracer(s,i,a)}};return Xi.ProxyTracerProvider=r,Xi}var Id={},Og;function F0(){return Og||(Og=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SamplingDecision=void 0,(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(e.SamplingDecision||(e.SamplingDecision={}))})(Id)),Id}var Pd={},bg;function Y0(){return bg||(bg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanKind=void 0,(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(e.SpanKind||(e.SpanKind={}))})(Pd)),Pd}var Md={},Cg;function j0(){return Cg||(Cg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanStatusCode=void 0,(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(e.SpanStatusCode||(e.SpanStatusCode={}))})(Md)),Md}var Ji={},ea={},Ar={},Ig;function q0(){if(Ig)return Ar;Ig=1,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.validateValue=Ar.validateKey=void 0;const e="[_0-9a-z-*/]",t=`[a-z]${e}{0,255}`,n=`[a-z0-9]${e}{0,240}@[a-z]${e}{0,13}`,r=new RegExp(`^(?:${t}|${n})$`),o=/^[ -~]{0,255}[!-~]$/,s=/,|=/;function i(c){return r.test(c)}Ar.validateKey=i;function a(c){return o.test(c)&&!s.test(c)}return Ar.validateValue=a,Ar}var Pg;function W0(){if(Pg)return ea;Pg=1,Object.defineProperty(ea,"__esModule",{value:!0}),ea.TraceStateImpl=void 0;const e=q0(),t=32,n=512,r=",",o="=";class s{constructor(a){this._internalState=new Map,a&&this._parse(a)}set(a,c){const u=this._clone();return u._internalState.has(a)&&u._internalState.delete(a),u._internalState.set(a,c),u}unset(a){const c=this._clone();return c._internalState.delete(a),c}get(a){return this._internalState.get(a)}serialize(){return this._keys().reduce((a,c)=>(a.push(c+o+this.get(c)),a),[]).join(r)}_parse(a){a.length>n||(this._internalState=a.split(r).reverse().reduce((c,u)=>{const f=u.trim(),d=f.indexOf(o);if(d!==-1){const l=f.slice(0,d),_=f.slice(d+1,u.length);(0,e.validateKey)(l)&&(0,e.validateValue)(_)&&c.set(l,_)}return c},new Map),this._internalState.size>t&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,t))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const a=new s;return a._internalState=new Map(this._internalState),a}}return ea.TraceStateImpl=s,ea}var Mg;function K0(){if(Mg)return Ji;Mg=1,Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.createTraceState=void 0;const e=W0();function t(n){return new e.TraceStateImpl(n)}return Ji.createTraceState=t,Ji}var ta={},vg;function z0(){if(vg)return ta;vg=1,Object.defineProperty(ta,"__esModule",{value:!0}),ta.context=void 0;const e=Cl();return ta.context=e.ContextAPI.getInstance(),ta}var na={},wg;function Z0(){if(wg)return na;wg=1,Object.defineProperty(na,"__esModule",{value:!0}),na.diag=void 0;const e=cs();return na.diag=e.DiagAPI.instance(),na}var ra={},oa={},Rr={},Lg;function X0(){if(Lg)return Rr;Lg=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.NOOP_METER_PROVIDER=Rr.NoopMeterProvider=void 0;const e=CP();let t=class{getMeter(r,o,s){return e.NOOP_METER}};return Rr.NoopMeterProvider=t,Rr.NOOP_METER_PROVIDER=new t,Rr}var Dg;function Q0(){if(Dg)return oa;Dg=1,Object.defineProperty(oa,"__esModule",{value:!0}),oa.MetricsAPI=void 0;const e=X0(),t=as(),n=cs(),r="metrics";class o{constructor(){}static getInstance(){return this._instance||(this._instance=new o),this._instance}setGlobalMeterProvider(i){return(0,t.registerGlobal)(r,i,n.DiagAPI.instance())}getMeterProvider(){return(0,t.getGlobal)(r)||e.NOOP_METER_PROVIDER}getMeter(i,a,c){return this.getMeterProvider().getMeter(i,a,c)}disable(){(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return oa.MetricsAPI=o,oa}var Ug;function J0(){if(Ug)return ra;Ug=1,Object.defineProperty(ra,"__esModule",{value:!0}),ra.metrics=void 0;const e=Q0();return ra.metrics=e.MetricsAPI.getInstance(),ra}var sa={},ia={},aa={},kg;function eU(){if(kg)return aa;kg=1,Object.defineProperty(aa,"__esModule",{value:!0}),aa.NoopTextMapPropagator=void 0;let e=class{inject(n,r){}extract(n,r){return n}fields(){return[]}};return aa.NoopTextMapPropagator=e,aa}var en={},xg;function tU(){if(xg)return en;xg=1,Object.defineProperty(en,"__esModule",{value:!0}),en.deleteBaggage=en.setBaggage=en.getActiveBaggage=en.getBaggage=void 0;const e=Cl(),n=(0,bl().createContextKey)("OpenTelemetry Baggage Key");function r(a){return a.getValue(n)||void 0}en.getBaggage=r;function o(){return r(e.ContextAPI.getInstance().active())}en.getActiveBaggage=o;function s(a,c){return a.setValue(n,c)}en.setBaggage=s;function i(a){return a.deleteValue(n)}return en.deleteBaggage=i,en}var Gg;function nU(){if(Gg)return ia;Gg=1,Object.defineProperty(ia,"__esModule",{value:!0}),ia.PropagationAPI=void 0;const e=as(),t=eU(),n=IP(),r=tU(),o=bP(),s=cs(),i="propagation",a=new t.NoopTextMapPropagator;class c{constructor(){this.createBaggage=o.createBaggage,this.getBaggage=r.getBaggage,this.getActiveBaggage=r.getActiveBaggage,this.setBaggage=r.setBaggage,this.deleteBaggage=r.deleteBaggage}static getInstance(){return this._instance||(this._instance=new c),this._instance}setGlobalPropagator(f){return(0,e.registerGlobal)(i,f,s.DiagAPI.instance())}inject(f,d,l=n.defaultTextMapSetter){return this._getGlobalPropagator().inject(f,d,l)}extract(f,d,l=n.defaultTextMapGetter){return this._getGlobalPropagator().extract(f,d,l)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,e.unregisterGlobal)(i,s.DiagAPI.instance())}_getGlobalPropagator(){return(0,e.getGlobal)(i)||a}}return ia.PropagationAPI=c,ia}var Vg;function rU(){if(Vg)return sa;Vg=1,Object.defineProperty(sa,"__esModule",{value:!0}),sa.propagation=void 0;const e=nU();return sa.propagation=e.PropagationAPI.getInstance(),sa}var ca={},ua={},$g;function oU(){if($g)return ua;$g=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.TraceAPI=void 0;const e=as(),t=LP(),n=Kh(),r=MP(),o=cs(),s="trace";class i{constructor(){this._proxyTracerProvider=new t.ProxyTracerProvider,this.wrapSpanContext=n.wrapSpanContext,this.isSpanContextValid=n.isSpanContextValid,this.deleteSpan=r.deleteSpan,this.getSpan=r.getSpan,this.getActiveSpan=r.getActiveSpan,this.getSpanContext=r.getSpanContext,this.setSpan=r.setSpan,this.setSpanContext=r.setSpanContext}static getInstance(){return this._instance||(this._instance=new i),this._instance}setGlobalTracerProvider(c){const u=(0,e.registerGlobal)(s,this._proxyTracerProvider,o.DiagAPI.instance());return u&&this._proxyTracerProvider.setDelegate(c),u}getTracerProvider(){return(0,e.getGlobal)(s)||this._proxyTracerProvider}getTracer(c,u){return this.getTracerProvider().getTracer(c,u)}disable(){(0,e.unregisterGlobal)(s,o.DiagAPI.instance()),this._proxyTracerProvider=new t.ProxyTracerProvider}}return ua.TraceAPI=i,ua}var Bg;function sU(){if(Bg)return ca;Bg=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.trace=void 0;const e=oU();return ca.trace=e.TraceAPI.getInstance(),ca}var Hg;function Pe(){return Hg||(Hg=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.trace=e.propagation=e.metrics=e.diag=e.context=e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=e.isValidSpanId=e.isValidTraceId=e.isSpanContextValid=e.createTraceState=e.TraceFlags=e.SpanStatusCode=e.SpanKind=e.SamplingDecision=e.ProxyTracerProvider=e.ProxyTracer=e.defaultTextMapSetter=e.defaultTextMapGetter=e.ValueType=e.createNoopMeter=e.DiagLogLevel=e.DiagConsoleLogger=e.ROOT_CONTEXT=e.createContextKey=e.baggageEntryMetadataFromString=void 0;var t=bP();Object.defineProperty(e,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return t.baggageEntryMetadataFromString}});var n=bl();Object.defineProperty(e,"createContextKey",{enumerable:!0,get:function(){return n.createContextKey}}),Object.defineProperty(e,"ROOT_CONTEXT",{enumerable:!0,get:function(){return n.ROOT_CONTEXT}});var r=V0();Object.defineProperty(e,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var o=jh();Object.defineProperty(e,"DiagLogLevel",{enumerable:!0,get:function(){return o.DiagLogLevel}});var s=CP();Object.defineProperty(e,"createNoopMeter",{enumerable:!0,get:function(){return s.createNoopMeter}});var i=$0();Object.defineProperty(e,"ValueType",{enumerable:!0,get:function(){return i.ValueType}});var a=IP();Object.defineProperty(e,"defaultTextMapGetter",{enumerable:!0,get:function(){return a.defaultTextMapGetter}}),Object.defineProperty(e,"defaultTextMapSetter",{enumerable:!0,get:function(){return a.defaultTextMapSetter}});var c=wP();Object.defineProperty(e,"ProxyTracer",{enumerable:!0,get:function(){return c.ProxyTracer}});var u=LP();Object.defineProperty(e,"ProxyTracerProvider",{enumerable:!0,get:function(){return u.ProxyTracerProvider}});var f=F0();Object.defineProperty(e,"SamplingDecision",{enumerable:!0,get:function(){return f.SamplingDecision}});var d=Y0();Object.defineProperty(e,"SpanKind",{enumerable:!0,get:function(){return d.SpanKind}});var l=j0();Object.defineProperty(e,"SpanStatusCode",{enumerable:!0,get:function(){return l.SpanStatusCode}});var _=PP();Object.defineProperty(e,"TraceFlags",{enumerable:!0,get:function(){return _.TraceFlags}});var p=K0();Object.defineProperty(e,"createTraceState",{enumerable:!0,get:function(){return p.createTraceState}});var h=Kh();Object.defineProperty(e,"isSpanContextValid",{enumerable:!0,get:function(){return h.isSpanContextValid}}),Object.defineProperty(e,"isValidTraceId",{enumerable:!0,get:function(){return h.isValidTraceId}}),Object.defineProperty(e,"isValidSpanId",{enumerable:!0,get:function(){return h.isValidSpanId}});var E=qh();Object.defineProperty(e,"INVALID_SPANID",{enumerable:!0,get:function(){return E.INVALID_SPANID}}),Object.defineProperty(e,"INVALID_TRACEID",{enumerable:!0,get:function(){return E.INVALID_TRACEID}}),Object.defineProperty(e,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return E.INVALID_SPAN_CONTEXT}});const T=z0();Object.defineProperty(e,"context",{enumerable:!0,get:function(){return T.context}});const S=Z0();Object.defineProperty(e,"diag",{enumerable:!0,get:function(){return S.diag}});const g=J0();Object.defineProperty(e,"metrics",{enumerable:!0,get:function(){return g.metrics}});const A=rU();Object.defineProperty(e,"propagation",{enumerable:!0,get:function(){return A.propagation}});const R=sU();Object.defineProperty(e,"trace",{enumerable:!0,get:function(){return R.trace}}),e.default={context:T.context,diag:S.diag,metrics:g.metrics,propagation:A.propagation,trace:R.trace}})(Rd)),Rd}var b=Pe(),vd={},la={};const zh=b.createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function io(e){return e.setValue(zh,!0)}function iU(e){return e.deleteValue(zh)}function Cn(e){return e.getValue(zh)===!0}const aU="=",Qp=";",Lu=",",wd="baggage",cU=180,uU=4096,lU=8192;function dU(e){return e.reduce((t,n)=>{const r=`${t}${t!==""?Lu:""}${n}`;return r.length>lU?t:r},"")}function fU(e){return e.getAllEntries().map(([t,n])=>{let r=`${encodeURIComponent(t)}=${encodeURIComponent(n.value)}`;return n.metadata!==void 0&&(r+=Qp+n.metadata.toString()),r})}function DP(e){const t=e.split(Qp);if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf(aU);if(r<=0)return;const o=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim());let i;return t.length>0&&(i=b.baggageEntryMetadataFromString(t.join(Qp))),{key:o,value:s,metadata:i}}function _U(e){const t={};return typeof e=="string"&&e.length>0&&e.split(Lu).forEach(n=>{const r=DP(n);r!==void 0&&r.value.length>0&&(t[r.key]=r.value)}),t}class UP{inject(t,n,r){const o=b.propagation.getBaggage(t);if(!o||Cn(t))return;const s=fU(o).filter(a=>a.length<=uU).slice(0,cU),i=dU(s);i.length>0&&r.set(n,wd,i)}extract(t,n,r){const o=r.get(n,wd),s=Array.isArray(o)?o.join(Lu):o;if(!s)return t;const i={};return s.length===0||(s.split(Lu).forEach(c=>{const u=DP(c);if(u){const f={value:u.value};u.metadata&&(f.metadata=u.metadata),i[u.key]=f}}),Object.entries(i).length===0)?t:b.propagation.setBaggage(t,b.propagation.createBaggage(i))}fields(){return[wd]}}class pU{_monotonicClock;_epochMillis;_performanceMillis;constructor(t,n){this._monotonicClock=n,this._epochMillis=t.now(),this._performanceMillis=n.now()}now(){const t=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+t}}function uc(e){const t={};if(typeof e!="object"||e==null)return t;for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;if(!hU(n)){b.diag.warn(`Invalid attribute key: ${n}`);continue}const r=e[n];if(!Zh(r)){b.diag.warn(`Invalid attribute value set for key: ${n}`);continue}Array.isArray(r)?t[n]=r.slice():t[n]=r}return t}function hU(e){return typeof e=="string"&&e!==""}function Zh(e){return e==null?!0:Array.isArray(e)?EU(e):kP(typeof e)}function EU(e){let t;for(const n of e){if(n==null)continue;const r=typeof n;if(r!==t){if(!t){if(kP(r)){t=r;continue}return!1}return!1}}return!0}function kP(e){switch(e){case"number":case"boolean":case"string":return!0}return!1}function xP(){return e=>{b.diag.error(TU(e))}}function TU(e){return typeof e=="string"?e:JSON.stringify(SU(e))}function SU(e){const t={};let n=e;for(;n!==null;)Object.getOwnPropertyNames(n).forEach(r=>{if(t[r])return;const o=n[r];o&&(t[r]=String(o))}),n=Object.getPrototypeOf(n);return t}let GP=xP();function mU(e){GP=e}function Xh(e){try{GP(e)}catch{}}function Pt(e){const t=process.env[e];if(t==null||t.trim()==="")return;const n=Number(t);if(isNaN(n)){b.diag.warn(`Unknown value ${ar.inspect(t)} for ${e}, expected a number, using defaults`);return}return n}function Qh(e){const t=process.env[e];if(!(t==null||t.trim()===""))return t}function gU(e){const t=process.env[e]?.trim().toLowerCase();return t==null||t===""?!1:t==="true"?!0:(t==="false"||b.diag.warn(`Unknown value ${ar.inspect(t)} for ${e}, expected 'true' or 'false', falling back to 'false' (default)`),!1)}function AU(e){return Qh(e)?.split(",").map(t=>t.trim()).filter(t=>t!=="")}const RU=typeof globalThis=="object"?globalThis:global,oo=g0.performance,yU="2.2.0";var yr={},Nr={},m={},da={},Fg;function VP(){if(Fg)return da;Fg=1,Object.defineProperty(da,"__esModule",{value:!0}),da.createConstMap=void 0;function e(t){let n={};const r=t.length;for(let o=0;o<r;o++){const s=t[o];s&&(n[String(s).toUpperCase().replace(/[-.]/g,"_")]=s)}return n}return da.createConstMap=e,da}var Yg;function NU(){if(Yg)return m;Yg=1,Object.defineProperty(m,"__esModule",{value:!0}),m.SEMATTRS_NET_HOST_CARRIER_ICC=m.SEMATTRS_NET_HOST_CARRIER_MNC=m.SEMATTRS_NET_HOST_CARRIER_MCC=m.SEMATTRS_NET_HOST_CARRIER_NAME=m.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=m.SEMATTRS_NET_HOST_CONNECTION_TYPE=m.SEMATTRS_NET_HOST_NAME=m.SEMATTRS_NET_HOST_PORT=m.SEMATTRS_NET_HOST_IP=m.SEMATTRS_NET_PEER_NAME=m.SEMATTRS_NET_PEER_PORT=m.SEMATTRS_NET_PEER_IP=m.SEMATTRS_NET_TRANSPORT=m.SEMATTRS_FAAS_INVOKED_REGION=m.SEMATTRS_FAAS_INVOKED_PROVIDER=m.SEMATTRS_FAAS_INVOKED_NAME=m.SEMATTRS_FAAS_COLDSTART=m.SEMATTRS_FAAS_CRON=m.SEMATTRS_FAAS_TIME=m.SEMATTRS_FAAS_DOCUMENT_NAME=m.SEMATTRS_FAAS_DOCUMENT_TIME=m.SEMATTRS_FAAS_DOCUMENT_OPERATION=m.SEMATTRS_FAAS_DOCUMENT_COLLECTION=m.SEMATTRS_FAAS_EXECUTION=m.SEMATTRS_FAAS_TRIGGER=m.SEMATTRS_EXCEPTION_ESCAPED=m.SEMATTRS_EXCEPTION_STACKTRACE=m.SEMATTRS_EXCEPTION_MESSAGE=m.SEMATTRS_EXCEPTION_TYPE=m.SEMATTRS_DB_SQL_TABLE=m.SEMATTRS_DB_MONGODB_COLLECTION=m.SEMATTRS_DB_REDIS_DATABASE_INDEX=m.SEMATTRS_DB_HBASE_NAMESPACE=m.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=m.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=m.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=m.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=m.SEMATTRS_DB_CASSANDRA_TABLE=m.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=m.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=m.SEMATTRS_DB_CASSANDRA_KEYSPACE=m.SEMATTRS_DB_MSSQL_INSTANCE_NAME=m.SEMATTRS_DB_OPERATION=m.SEMATTRS_DB_STATEMENT=m.SEMATTRS_DB_NAME=m.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=m.SEMATTRS_DB_USER=m.SEMATTRS_DB_CONNECTION_STRING=m.SEMATTRS_DB_SYSTEM=m.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=void 0,m.SEMATTRS_MESSAGING_DESTINATION_KIND=m.SEMATTRS_MESSAGING_DESTINATION=m.SEMATTRS_MESSAGING_SYSTEM=m.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=m.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=m.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=m.SEMATTRS_AWS_DYNAMODB_COUNT=m.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=m.SEMATTRS_AWS_DYNAMODB_SEGMENT=m.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=m.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=m.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=m.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=m.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=m.SEMATTRS_AWS_DYNAMODB_SELECT=m.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=m.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=m.SEMATTRS_AWS_DYNAMODB_LIMIT=m.SEMATTRS_AWS_DYNAMODB_PROJECTION=m.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=m.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=m.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=m.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=m.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=m.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=m.SEMATTRS_HTTP_CLIENT_IP=m.SEMATTRS_HTTP_ROUTE=m.SEMATTRS_HTTP_SERVER_NAME=m.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=m.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=m.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=m.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=m.SEMATTRS_HTTP_USER_AGENT=m.SEMATTRS_HTTP_FLAVOR=m.SEMATTRS_HTTP_STATUS_CODE=m.SEMATTRS_HTTP_SCHEME=m.SEMATTRS_HTTP_HOST=m.SEMATTRS_HTTP_TARGET=m.SEMATTRS_HTTP_URL=m.SEMATTRS_HTTP_METHOD=m.SEMATTRS_CODE_LINENO=m.SEMATTRS_CODE_FILEPATH=m.SEMATTRS_CODE_NAMESPACE=m.SEMATTRS_CODE_FUNCTION=m.SEMATTRS_THREAD_NAME=m.SEMATTRS_THREAD_ID=m.SEMATTRS_ENDUSER_SCOPE=m.SEMATTRS_ENDUSER_ROLE=m.SEMATTRS_ENDUSER_ID=m.SEMATTRS_PEER_SERVICE=void 0,m.DBSYSTEMVALUES_FILEMAKER=m.DBSYSTEMVALUES_DERBY=m.DBSYSTEMVALUES_FIREBIRD=m.DBSYSTEMVALUES_ADABAS=m.DBSYSTEMVALUES_CACHE=m.DBSYSTEMVALUES_EDB=m.DBSYSTEMVALUES_FIRSTSQL=m.DBSYSTEMVALUES_INGRES=m.DBSYSTEMVALUES_HANADB=m.DBSYSTEMVALUES_MAXDB=m.DBSYSTEMVALUES_PROGRESS=m.DBSYSTEMVALUES_HSQLDB=m.DBSYSTEMVALUES_CLOUDSCAPE=m.DBSYSTEMVALUES_HIVE=m.DBSYSTEMVALUES_REDSHIFT=m.DBSYSTEMVALUES_POSTGRESQL=m.DBSYSTEMVALUES_DB2=m.DBSYSTEMVALUES_ORACLE=m.DBSYSTEMVALUES_MYSQL=m.DBSYSTEMVALUES_MSSQL=m.DBSYSTEMVALUES_OTHER_SQL=m.SemanticAttributes=m.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=m.SEMATTRS_MESSAGE_COMPRESSED_SIZE=m.SEMATTRS_MESSAGE_ID=m.SEMATTRS_MESSAGE_TYPE=m.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=m.SEMATTRS_RPC_JSONRPC_ERROR_CODE=m.SEMATTRS_RPC_JSONRPC_REQUEST_ID=m.SEMATTRS_RPC_JSONRPC_VERSION=m.SEMATTRS_RPC_GRPC_STATUS_CODE=m.SEMATTRS_RPC_METHOD=m.SEMATTRS_RPC_SERVICE=m.SEMATTRS_RPC_SYSTEM=m.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=m.SEMATTRS_MESSAGING_KAFKA_PARTITION=m.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=m.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=m.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=m.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=m.SEMATTRS_MESSAGING_CONSUMER_ID=m.SEMATTRS_MESSAGING_OPERATION=m.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=m.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=m.SEMATTRS_MESSAGING_CONVERSATION_ID=m.SEMATTRS_MESSAGING_MESSAGE_ID=m.SEMATTRS_MESSAGING_URL=m.SEMATTRS_MESSAGING_PROTOCOL_VERSION=m.SEMATTRS_MESSAGING_PROTOCOL=m.SEMATTRS_MESSAGING_TEMP_DESTINATION=void 0,m.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=m.FaasDocumentOperationValues=m.FAASDOCUMENTOPERATIONVALUES_DELETE=m.FAASDOCUMENTOPERATIONVALUES_EDIT=m.FAASDOCUMENTOPERATIONVALUES_INSERT=m.FaasTriggerValues=m.FAASTRIGGERVALUES_OTHER=m.FAASTRIGGERVALUES_TIMER=m.FAASTRIGGERVALUES_PUBSUB=m.FAASTRIGGERVALUES_HTTP=m.FAASTRIGGERVALUES_DATASOURCE=m.DbCassandraConsistencyLevelValues=m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=m.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=m.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=m.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=m.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=m.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=m.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=m.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=m.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=m.DbSystemValues=m.DBSYSTEMVALUES_COCKROACHDB=m.DBSYSTEMVALUES_MEMCACHED=m.DBSYSTEMVALUES_ELASTICSEARCH=m.DBSYSTEMVALUES_GEODE=m.DBSYSTEMVALUES_NEO4J=m.DBSYSTEMVALUES_DYNAMODB=m.DBSYSTEMVALUES_COSMOSDB=m.DBSYSTEMVALUES_COUCHDB=m.DBSYSTEMVALUES_COUCHBASE=m.DBSYSTEMVALUES_REDIS=m.DBSYSTEMVALUES_MONGODB=m.DBSYSTEMVALUES_HBASE=m.DBSYSTEMVALUES_CASSANDRA=m.DBSYSTEMVALUES_COLDFUSION=m.DBSYSTEMVALUES_H2=m.DBSYSTEMVALUES_VERTICA=m.DBSYSTEMVALUES_TERADATA=m.DBSYSTEMVALUES_SYBASE=m.DBSYSTEMVALUES_SQLITE=m.DBSYSTEMVALUES_POINTBASE=m.DBSYSTEMVALUES_PERVASIVE=m.DBSYSTEMVALUES_NETEZZA=m.DBSYSTEMVALUES_MARIADB=m.DBSYSTEMVALUES_INTERBASE=m.DBSYSTEMVALUES_INSTANTDB=m.DBSYSTEMVALUES_INFORMIX=void 0,m.MESSAGINGOPERATIONVALUES_RECEIVE=m.MessagingDestinationKindValues=m.MESSAGINGDESTINATIONKINDVALUES_TOPIC=m.MESSAGINGDESTINATIONKINDVALUES_QUEUE=m.HttpFlavorValues=m.HTTPFLAVORVALUES_QUIC=m.HTTPFLAVORVALUES_SPDY=m.HTTPFLAVORVALUES_HTTP_2_0=m.HTTPFLAVORVALUES_HTTP_1_1=m.HTTPFLAVORVALUES_HTTP_1_0=m.NetHostConnectionSubtypeValues=m.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=m.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=m.NETHOSTCONNECTIONSUBTYPEVALUES_NR=m.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=m.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=m.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=m.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=m.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=m.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=m.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=m.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=m.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=m.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=m.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=m.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=m.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=m.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=m.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=m.NetHostConnectionTypeValues=m.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=m.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=m.NETHOSTCONNECTIONTYPEVALUES_CELL=m.NETHOSTCONNECTIONTYPEVALUES_WIRED=m.NETHOSTCONNECTIONTYPEVALUES_WIFI=m.NetTransportValues=m.NETTRANSPORTVALUES_OTHER=m.NETTRANSPORTVALUES_INPROC=m.NETTRANSPORTVALUES_PIPE=m.NETTRANSPORTVALUES_UNIX=m.NETTRANSPORTVALUES_IP=m.NETTRANSPORTVALUES_IP_UDP=m.NETTRANSPORTVALUES_IP_TCP=m.FaasInvokedProviderValues=m.FAASINVOKEDPROVIDERVALUES_GCP=m.FAASINVOKEDPROVIDERVALUES_AZURE=m.FAASINVOKEDPROVIDERVALUES_AWS=void 0,m.MessageTypeValues=m.MESSAGETYPEVALUES_RECEIVED=m.MESSAGETYPEVALUES_SENT=m.RpcGrpcStatusCodeValues=m.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=m.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=m.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=m.RPCGRPCSTATUSCODEVALUES_INTERNAL=m.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=m.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=m.RPCGRPCSTATUSCODEVALUES_ABORTED=m.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=m.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=m.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=m.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=m.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=m.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=m.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=m.RPCGRPCSTATUSCODEVALUES_UNKNOWN=m.RPCGRPCSTATUSCODEVALUES_CANCELLED=m.RPCGRPCSTATUSCODEVALUES_OK=m.MessagingOperationValues=m.MESSAGINGOPERATIONVALUES_PROCESS=void 0;const e=VP(),t="aws.lambda.invoked_arn",n="db.system",r="db.connection_string",o="db.user",s="db.jdbc.driver_classname",i="db.name",a="db.statement",c="db.operation",u="db.mssql.instance_name",f="db.cassandra.keyspace",d="db.cassandra.page_size",l="db.cassandra.consistency_level",_="db.cassandra.table",p="db.cassandra.idempotence",h="db.cassandra.speculative_execution_count",E="db.cassandra.coordinator.id",T="db.cassandra.coordinator.dc",S="db.hbase.namespace",g="db.redis.database_index",A="db.mongodb.collection",R="db.sql.table",O="exception.type",C="exception.message",I="exception.stacktrace",w="exception.escaped",U="faas.trigger",B="faas.execution",F="faas.document.collection",G="faas.document.operation",x="faas.document.time",Y="faas.document.name",v="faas.time",P="faas.cron",H="faas.coldstart",J="faas.invoked_name",se="faas.invoked_provider",ne="faas.invoked_region",M="net.transport",L="net.peer.ip",V="net.peer.port",$="net.peer.name",K="net.host.ip",X="net.host.port",D="net.host.name",k="net.host.connection.type",z="net.host.connection.subtype",q="net.host.carrier.name",ee="net.host.carrier.mcc",re="net.host.carrier.mnc",_e="net.host.carrier.icc",ie="peer.service",le="enduser.id",Se="enduser.role",ve="enduser.scope",De="thread.id",qe="thread.name",wt="code.function",at="code.namespace",ct="code.filepath",rt="code.lineno",gs="http.method",As="http.url",Rs="http.target",ys="http.host",Ns="http.scheme",Os="http.status_code",bs="http.flavor",Cs="http.user_agent",Is="http.request_content_length",Ps="http.request_content_length_uncompressed",Ms="http.response_content_length",vs="http.response_content_length_uncompressed",ws="http.server_name",Ls="http.route",Ds="http.client_ip",Us="aws.dynamodb.table_names",ks="aws.dynamodb.consumed_capacity",xs="aws.dynamodb.item_collection_metrics",Gs="aws.dynamodb.provisioned_read_capacity",Vs="aws.dynamodb.provisioned_write_capacity",$s="aws.dynamodb.consistent_read",Bs="aws.dynamodb.projection",Hs="aws.dynamodb.limit",Fs="aws.dynamodb.attributes_to_get",Ys="aws.dynamodb.index_name",js="aws.dynamodb.select",qs="aws.dynamodb.global_secondary_indexes",Ws="aws.dynamodb.local_secondary_indexes",Ks="aws.dynamodb.exclusive_start_table",zs="aws.dynamodb.table_count",Zs="aws.dynamodb.scan_forward",Xs="aws.dynamodb.segment",Qs="aws.dynamodb.total_segments",Js="aws.dynamodb.count",ei="aws.dynamodb.scanned_count",ti="aws.dynamodb.attribute_definitions",ni="aws.dynamodb.global_secondary_index_updates",ri="messaging.system",oi="messaging.destination",si="messaging.destination_kind",ii="messaging.temp_destination",ai="messaging.protocol",ci="messaging.protocol_version",ui="messaging.url",li="messaging.message_id",di="messaging.conversation_id",fi="messaging.message_payload_size_bytes",_i="messaging.message_payload_compressed_size_bytes",pi="messaging.operation",hi="messaging.consumer_id",Ei="messaging.rabbitmq.routing_key",Ti="messaging.kafka.message_key",Si="messaging.kafka.consumer_group",mi="messaging.kafka.client_id",gi="messaging.kafka.partition",Ai="messaging.kafka.tombstone",Ri="rpc.system",yi="rpc.service",Ni="rpc.method",Oi="rpc.grpc.status_code",bi="rpc.jsonrpc.version",Ci="rpc.jsonrpc.request_id",Ii="rpc.jsonrpc.error_code",Pi="rpc.jsonrpc.error_message",Mi="message.type",vi="message.id",wi="message.compressed_size",Li="message.uncompressed_size";m.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=t,m.SEMATTRS_DB_SYSTEM=n,m.SEMATTRS_DB_CONNECTION_STRING=r,m.SEMATTRS_DB_USER=o,m.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=s,m.SEMATTRS_DB_NAME=i,m.SEMATTRS_DB_STATEMENT=a,m.SEMATTRS_DB_OPERATION=c,m.SEMATTRS_DB_MSSQL_INSTANCE_NAME=u,m.SEMATTRS_DB_CASSANDRA_KEYSPACE=f,m.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=d,m.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=l,m.SEMATTRS_DB_CASSANDRA_TABLE=_,m.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=p,m.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=h,m.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=E,m.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=T,m.SEMATTRS_DB_HBASE_NAMESPACE=S,m.SEMATTRS_DB_REDIS_DATABASE_INDEX=g,m.SEMATTRS_DB_MONGODB_COLLECTION=A,m.SEMATTRS_DB_SQL_TABLE=R,m.SEMATTRS_EXCEPTION_TYPE=O,m.SEMATTRS_EXCEPTION_MESSAGE=C,m.SEMATTRS_EXCEPTION_STACKTRACE=I,m.SEMATTRS_EXCEPTION_ESCAPED=w,m.SEMATTRS_FAAS_TRIGGER=U,m.SEMATTRS_FAAS_EXECUTION=B,m.SEMATTRS_FAAS_DOCUMENT_COLLECTION=F,m.SEMATTRS_FAAS_DOCUMENT_OPERATION=G,m.SEMATTRS_FAAS_DOCUMENT_TIME=x,m.SEMATTRS_FAAS_DOCUMENT_NAME=Y,m.SEMATTRS_FAAS_TIME=v,m.SEMATTRS_FAAS_CRON=P,m.SEMATTRS_FAAS_COLDSTART=H,m.SEMATTRS_FAAS_INVOKED_NAME=J,m.SEMATTRS_FAAS_INVOKED_PROVIDER=se,m.SEMATTRS_FAAS_INVOKED_REGION=ne,m.SEMATTRS_NET_TRANSPORT=M,m.SEMATTRS_NET_PEER_IP=L,m.SEMATTRS_NET_PEER_PORT=V,m.SEMATTRS_NET_PEER_NAME=$,m.SEMATTRS_NET_HOST_IP=K,m.SEMATTRS_NET_HOST_PORT=X,m.SEMATTRS_NET_HOST_NAME=D,m.SEMATTRS_NET_HOST_CONNECTION_TYPE=k,m.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=z,m.SEMATTRS_NET_HOST_CARRIER_NAME=q,m.SEMATTRS_NET_HOST_CARRIER_MCC=ee,m.SEMATTRS_NET_HOST_CARRIER_MNC=re,m.SEMATTRS_NET_HOST_CARRIER_ICC=_e,m.SEMATTRS_PEER_SERVICE=ie,m.SEMATTRS_ENDUSER_ID=le,m.SEMATTRS_ENDUSER_ROLE=Se,m.SEMATTRS_ENDUSER_SCOPE=ve,m.SEMATTRS_THREAD_ID=De,m.SEMATTRS_THREAD_NAME=qe,m.SEMATTRS_CODE_FUNCTION=wt,m.SEMATTRS_CODE_NAMESPACE=at,m.SEMATTRS_CODE_FILEPATH=ct,m.SEMATTRS_CODE_LINENO=rt,m.SEMATTRS_HTTP_METHOD=gs,m.SEMATTRS_HTTP_URL=As,m.SEMATTRS_HTTP_TARGET=Rs,m.SEMATTRS_HTTP_HOST=ys,m.SEMATTRS_HTTP_SCHEME=Ns,m.SEMATTRS_HTTP_STATUS_CODE=Os,m.SEMATTRS_HTTP_FLAVOR=bs,m.SEMATTRS_HTTP_USER_AGENT=Cs,m.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=Is,m.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=Ps,m.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=Ms,m.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=vs,m.SEMATTRS_HTTP_SERVER_NAME=ws,m.SEMATTRS_HTTP_ROUTE=Ls,m.SEMATTRS_HTTP_CLIENT_IP=Ds,m.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=Us,m.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=ks,m.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=xs,m.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=Gs,m.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=Vs,m.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=$s,m.SEMATTRS_AWS_DYNAMODB_PROJECTION=Bs,m.SEMATTRS_AWS_DYNAMODB_LIMIT=Hs,m.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=Fs,m.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=Ys,m.SEMATTRS_AWS_DYNAMODB_SELECT=js,m.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=qs,m.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=Ws,m.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=Ks,m.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=zs,m.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=Zs,m.SEMATTRS_AWS_DYNAMODB_SEGMENT=Xs,m.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=Qs,m.SEMATTRS_AWS_DYNAMODB_COUNT=Js,m.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=ei,m.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=ti,m.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=ni,m.SEMATTRS_MESSAGING_SYSTEM=ri,m.SEMATTRS_MESSAGING_DESTINATION=oi,m.SEMATTRS_MESSAGING_DESTINATION_KIND=si,m.SEMATTRS_MESSAGING_TEMP_DESTINATION=ii,m.SEMATTRS_MESSAGING_PROTOCOL=ai,m.SEMATTRS_MESSAGING_PROTOCOL_VERSION=ci,m.SEMATTRS_MESSAGING_URL=ui,m.SEMATTRS_MESSAGING_MESSAGE_ID=li,m.SEMATTRS_MESSAGING_CONVERSATION_ID=di,m.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=fi,m.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=_i,m.SEMATTRS_MESSAGING_OPERATION=pi,m.SEMATTRS_MESSAGING_CONSUMER_ID=hi,m.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=Ei,m.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=Ti,m.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=Si,m.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=mi,m.SEMATTRS_MESSAGING_KAFKA_PARTITION=gi,m.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=Ai,m.SEMATTRS_RPC_SYSTEM=Ri,m.SEMATTRS_RPC_SERVICE=yi,m.SEMATTRS_RPC_METHOD=Ni,m.SEMATTRS_RPC_GRPC_STATUS_CODE=Oi,m.SEMATTRS_RPC_JSONRPC_VERSION=bi,m.SEMATTRS_RPC_JSONRPC_REQUEST_ID=Ci,m.SEMATTRS_RPC_JSONRPC_ERROR_CODE=Ii,m.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=Pi,m.SEMATTRS_MESSAGE_TYPE=Mi,m.SEMATTRS_MESSAGE_ID=vi,m.SEMATTRS_MESSAGE_COMPRESSED_SIZE=wi,m.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=Li,m.SemanticAttributes=(0,e.createConstMap)([t,n,r,o,s,i,a,c,u,f,d,l,_,p,h,E,T,S,g,A,R,O,C,I,w,U,B,F,G,x,Y,v,P,H,J,se,ne,M,L,V,$,K,X,D,k,z,q,ee,re,_e,ie,le,Se,ve,De,qe,wt,at,ct,rt,gs,As,Rs,ys,Ns,Os,bs,Cs,Is,Ps,Ms,vs,ws,Ls,Ds,Us,ks,xs,Gs,Vs,$s,Bs,Hs,Fs,Ys,js,qs,Ws,Ks,zs,Zs,Xs,Qs,Js,ei,ti,ni,ri,oi,si,ii,ai,ci,ui,li,di,fi,_i,pi,hi,Ei,Ti,Si,mi,gi,Ai,Ri,yi,Ni,Oi,bi,Ci,Ii,Pi,Mi,vi,wi,Li]);const Di="other_sql",Ui="mssql",ki="mysql",xi="oracle",IT="db2",PT="postgresql",MT="redshift",vT="hive",wT="cloudscape",LT="hsqldb",DT="progress",UT="maxdb",kT="hanadb",xT="ingres",GT="firstsql",VT="edb",$T="cache",BT="adabas",HT="firebird",FT="derby",YT="filemaker",jT="informix",qT="instantdb",WT="interbase",KT="mariadb",zT="netezza",ZT="pervasive",XT="pointbase",QT="sqlite",JT="sybase",eS="teradata",tS="vertica",nS="h2",rS="coldfusion",oS="cassandra",sS="hbase",iS="mongodb",aS="redis",cS="couchbase",uS="couchdb",lS="cosmosdb",dS="dynamodb",fS="neo4j",_S="geode",pS="elasticsearch",hS="memcached",ES="cockroachdb";m.DBSYSTEMVALUES_OTHER_SQL=Di,m.DBSYSTEMVALUES_MSSQL=Ui,m.DBSYSTEMVALUES_MYSQL=ki,m.DBSYSTEMVALUES_ORACLE=xi,m.DBSYSTEMVALUES_DB2=IT,m.DBSYSTEMVALUES_POSTGRESQL=PT,m.DBSYSTEMVALUES_REDSHIFT=MT,m.DBSYSTEMVALUES_HIVE=vT,m.DBSYSTEMVALUES_CLOUDSCAPE=wT,m.DBSYSTEMVALUES_HSQLDB=LT,m.DBSYSTEMVALUES_PROGRESS=DT,m.DBSYSTEMVALUES_MAXDB=UT,m.DBSYSTEMVALUES_HANADB=kT,m.DBSYSTEMVALUES_INGRES=xT,m.DBSYSTEMVALUES_FIRSTSQL=GT,m.DBSYSTEMVALUES_EDB=VT,m.DBSYSTEMVALUES_CACHE=$T,m.DBSYSTEMVALUES_ADABAS=BT,m.DBSYSTEMVALUES_FIREBIRD=HT,m.DBSYSTEMVALUES_DERBY=FT,m.DBSYSTEMVALUES_FILEMAKER=YT,m.DBSYSTEMVALUES_INFORMIX=jT,m.DBSYSTEMVALUES_INSTANTDB=qT,m.DBSYSTEMVALUES_INTERBASE=WT,m.DBSYSTEMVALUES_MARIADB=KT,m.DBSYSTEMVALUES_NETEZZA=zT,m.DBSYSTEMVALUES_PERVASIVE=ZT,m.DBSYSTEMVALUES_POINTBASE=XT,m.DBSYSTEMVALUES_SQLITE=QT,m.DBSYSTEMVALUES_SYBASE=JT,m.DBSYSTEMVALUES_TERADATA=eS,m.DBSYSTEMVALUES_VERTICA=tS,m.DBSYSTEMVALUES_H2=nS,m.DBSYSTEMVALUES_COLDFUSION=rS,m.DBSYSTEMVALUES_CASSANDRA=oS,m.DBSYSTEMVALUES_HBASE=sS,m.DBSYSTEMVALUES_MONGODB=iS,m.DBSYSTEMVALUES_REDIS=aS,m.DBSYSTEMVALUES_COUCHBASE=cS,m.DBSYSTEMVALUES_COUCHDB=uS,m.DBSYSTEMVALUES_COSMOSDB=lS,m.DBSYSTEMVALUES_DYNAMODB=dS,m.DBSYSTEMVALUES_NEO4J=fS,m.DBSYSTEMVALUES_GEODE=_S,m.DBSYSTEMVALUES_ELASTICSEARCH=pS,m.DBSYSTEMVALUES_MEMCACHED=hS,m.DBSYSTEMVALUES_COCKROACHDB=ES,m.DbSystemValues=(0,e.createConstMap)([Di,Ui,ki,xi,IT,PT,MT,vT,wT,LT,DT,UT,kT,xT,GT,VT,$T,BT,HT,FT,YT,jT,qT,WT,KT,zT,ZT,XT,QT,JT,eS,tS,nS,rS,oS,sS,iS,aS,cS,uS,lS,dS,fS,_S,pS,hS,ES]);const TS="all",SS="each_quorum",mS="quorum",gS="local_quorum",AS="one",RS="two",yS="three",NS="local_one",OS="any",bS="serial",CS="local_serial";m.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=TS,m.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=SS,m.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=mS,m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=gS,m.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=AS,m.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=RS,m.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=yS,m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=NS,m.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=OS,m.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=bS,m.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=CS,m.DbCassandraConsistencyLevelValues=(0,e.createConstMap)([TS,SS,mS,gS,AS,RS,yS,NS,OS,bS,CS]);const IS="datasource",PS="http",MS="pubsub",vS="timer",wS="other";m.FAASTRIGGERVALUES_DATASOURCE=IS,m.FAASTRIGGERVALUES_HTTP=PS,m.FAASTRIGGERVALUES_PUBSUB=MS,m.FAASTRIGGERVALUES_TIMER=vS,m.FAASTRIGGERVALUES_OTHER=wS,m.FaasTriggerValues=(0,e.createConstMap)([IS,PS,MS,vS,wS]);const LS="insert",DS="edit",US="delete";m.FAASDOCUMENTOPERATIONVALUES_INSERT=LS,m.FAASDOCUMENTOPERATIONVALUES_EDIT=DS,m.FAASDOCUMENTOPERATIONVALUES_DELETE=US,m.FaasDocumentOperationValues=(0,e.createConstMap)([LS,DS,US]);const kS="alibaba_cloud",xS="aws",GS="azure",VS="gcp";m.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=kS,m.FAASINVOKEDPROVIDERVALUES_AWS=xS,m.FAASINVOKEDPROVIDERVALUES_AZURE=GS,m.FAASINVOKEDPROVIDERVALUES_GCP=VS,m.FaasInvokedProviderValues=(0,e.createConstMap)([kS,xS,GS,VS]);const $S="ip_tcp",BS="ip_udp",HS="ip",FS="unix",YS="pipe",jS="inproc",qS="other";m.NETTRANSPORTVALUES_IP_TCP=$S,m.NETTRANSPORTVALUES_IP_UDP=BS,m.NETTRANSPORTVALUES_IP=HS,m.NETTRANSPORTVALUES_UNIX=FS,m.NETTRANSPORTVALUES_PIPE=YS,m.NETTRANSPORTVALUES_INPROC=jS,m.NETTRANSPORTVALUES_OTHER=qS,m.NetTransportValues=(0,e.createConstMap)([$S,BS,HS,FS,YS,jS,qS]);const WS="wifi",KS="wired",zS="cell",ZS="unavailable",XS="unknown";m.NETHOSTCONNECTIONTYPEVALUES_WIFI=WS,m.NETHOSTCONNECTIONTYPEVALUES_WIRED=KS,m.NETHOSTCONNECTIONTYPEVALUES_CELL=zS,m.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=ZS,m.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=XS,m.NetHostConnectionTypeValues=(0,e.createConstMap)([WS,KS,zS,ZS,XS]);const QS="gprs",JS="edge",em="umts",tm="cdma",nm="evdo_0",rm="evdo_a",om="cdma2000_1xrtt",sm="hsdpa",im="hsupa",am="hspa",cm="iden",um="evdo_b",lm="lte",dm="ehrpd",fm="hspap",_m="gsm",pm="td_scdma",hm="iwlan",Em="nr",Tm="nrnsa",Sm="lte_ca";m.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=QS,m.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=JS,m.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=em,m.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=tm,m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=nm,m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=rm,m.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=om,m.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=sm,m.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=im,m.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=am,m.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=cm,m.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=um,m.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=lm,m.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=dm,m.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=fm,m.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=_m,m.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=pm,m.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=hm,m.NETHOSTCONNECTIONSUBTYPEVALUES_NR=Em,m.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=Tm,m.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=Sm,m.NetHostConnectionSubtypeValues=(0,e.createConstMap)([QS,JS,em,tm,nm,rm,om,sm,im,am,cm,um,lm,dm,fm,_m,pm,hm,Em,Tm,Sm]);const mm="1.0",gm="1.1",Am="2.0",Rm="SPDY",ym="QUIC";m.HTTPFLAVORVALUES_HTTP_1_0=mm,m.HTTPFLAVORVALUES_HTTP_1_1=gm,m.HTTPFLAVORVALUES_HTTP_2_0=Am,m.HTTPFLAVORVALUES_SPDY=Rm,m.HTTPFLAVORVALUES_QUIC=ym,m.HttpFlavorValues={HTTP_1_0:mm,HTTP_1_1:gm,HTTP_2_0:Am,SPDY:Rm,QUIC:ym};const Nm="queue",Om="topic";m.MESSAGINGDESTINATIONKINDVALUES_QUEUE=Nm,m.MESSAGINGDESTINATIONKINDVALUES_TOPIC=Om,m.MessagingDestinationKindValues=(0,e.createConstMap)([Nm,Om]);const bm="receive",Cm="process";m.MESSAGINGOPERATIONVALUES_RECEIVE=bm,m.MESSAGINGOPERATIONVALUES_PROCESS=Cm,m.MessagingOperationValues=(0,e.createConstMap)([bm,Cm]);const Im=0,Pm=1,Mm=2,vm=3,wm=4,Lm=5,Dm=6,Um=7,km=8,xm=9,Gm=10,Vm=11,$m=12,Bm=13,Hm=14,Fm=15,Ym=16;m.RPCGRPCSTATUSCODEVALUES_OK=Im,m.RPCGRPCSTATUSCODEVALUES_CANCELLED=Pm,m.RPCGRPCSTATUSCODEVALUES_UNKNOWN=Mm,m.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=vm,m.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=wm,m.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=Lm,m.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=Dm,m.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=Um,m.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=km,m.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=xm,m.RPCGRPCSTATUSCODEVALUES_ABORTED=Gm,m.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=Vm,m.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=$m,m.RPCGRPCSTATUSCODEVALUES_INTERNAL=Bm,m.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=Hm,m.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=Fm,m.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=Ym,m.RpcGrpcStatusCodeValues={OK:Im,CANCELLED:Pm,UNKNOWN:Mm,INVALID_ARGUMENT:vm,DEADLINE_EXCEEDED:wm,NOT_FOUND:Lm,ALREADY_EXISTS:Dm,PERMISSION_DENIED:Um,RESOURCE_EXHAUSTED:km,FAILED_PRECONDITION:xm,ABORTED:Gm,OUT_OF_RANGE:Vm,UNIMPLEMENTED:$m,INTERNAL:Bm,UNAVAILABLE:Hm,DATA_LOSS:Fm,UNAUTHENTICATED:Ym};const jm="SENT",qm="RECEIVED";return m.MESSAGETYPEVALUES_SENT=jm,m.MESSAGETYPEVALUES_RECEIVED=qm,m.MessageTypeValues=(0,e.createConstMap)([jm,qm]),m}var jg;function OU(){return jg||(jg=1,(function(e){var t=Nr&&Nr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Nr&&Nr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(NU(),e)})(Nr)),Nr}var Or={},y={},qg;function bU(){if(qg)return y;qg=1,Object.defineProperty(y,"__esModule",{value:!0}),y.SEMRESATTRS_K8S_STATEFULSET_NAME=y.SEMRESATTRS_K8S_STATEFULSET_UID=y.SEMRESATTRS_K8S_DEPLOYMENT_NAME=y.SEMRESATTRS_K8S_DEPLOYMENT_UID=y.SEMRESATTRS_K8S_REPLICASET_NAME=y.SEMRESATTRS_K8S_REPLICASET_UID=y.SEMRESATTRS_K8S_CONTAINER_NAME=y.SEMRESATTRS_K8S_POD_NAME=y.SEMRESATTRS_K8S_POD_UID=y.SEMRESATTRS_K8S_NAMESPACE_NAME=y.SEMRESATTRS_K8S_NODE_UID=y.SEMRESATTRS_K8S_NODE_NAME=y.SEMRESATTRS_K8S_CLUSTER_NAME=y.SEMRESATTRS_HOST_IMAGE_VERSION=y.SEMRESATTRS_HOST_IMAGE_ID=y.SEMRESATTRS_HOST_IMAGE_NAME=y.SEMRESATTRS_HOST_ARCH=y.SEMRESATTRS_HOST_TYPE=y.SEMRESATTRS_HOST_NAME=y.SEMRESATTRS_HOST_ID=y.SEMRESATTRS_FAAS_MAX_MEMORY=y.SEMRESATTRS_FAAS_INSTANCE=y.SEMRESATTRS_FAAS_VERSION=y.SEMRESATTRS_FAAS_ID=y.SEMRESATTRS_FAAS_NAME=y.SEMRESATTRS_DEVICE_MODEL_NAME=y.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=y.SEMRESATTRS_DEVICE_ID=y.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=y.SEMRESATTRS_CONTAINER_IMAGE_TAG=y.SEMRESATTRS_CONTAINER_IMAGE_NAME=y.SEMRESATTRS_CONTAINER_RUNTIME=y.SEMRESATTRS_CONTAINER_ID=y.SEMRESATTRS_CONTAINER_NAME=y.SEMRESATTRS_AWS_LOG_STREAM_ARNS=y.SEMRESATTRS_AWS_LOG_STREAM_NAMES=y.SEMRESATTRS_AWS_LOG_GROUP_ARNS=y.SEMRESATTRS_AWS_LOG_GROUP_NAMES=y.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=y.SEMRESATTRS_AWS_ECS_TASK_REVISION=y.SEMRESATTRS_AWS_ECS_TASK_FAMILY=y.SEMRESATTRS_AWS_ECS_TASK_ARN=y.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=y.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=y.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=y.SEMRESATTRS_CLOUD_PLATFORM=y.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=y.SEMRESATTRS_CLOUD_REGION=y.SEMRESATTRS_CLOUD_ACCOUNT_ID=y.SEMRESATTRS_CLOUD_PROVIDER=void 0,y.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=y.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=y.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=y.CLOUDPLATFORMVALUES_AZURE_AKS=y.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=y.CLOUDPLATFORMVALUES_AZURE_VM=y.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=y.CLOUDPLATFORMVALUES_AWS_LAMBDA=y.CLOUDPLATFORMVALUES_AWS_EKS=y.CLOUDPLATFORMVALUES_AWS_ECS=y.CLOUDPLATFORMVALUES_AWS_EC2=y.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=y.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=y.CloudProviderValues=y.CLOUDPROVIDERVALUES_GCP=y.CLOUDPROVIDERVALUES_AZURE=y.CLOUDPROVIDERVALUES_AWS=y.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=y.SemanticResourceAttributes=y.SEMRESATTRS_WEBENGINE_DESCRIPTION=y.SEMRESATTRS_WEBENGINE_VERSION=y.SEMRESATTRS_WEBENGINE_NAME=y.SEMRESATTRS_TELEMETRY_AUTO_VERSION=y.SEMRESATTRS_TELEMETRY_SDK_VERSION=y.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=y.SEMRESATTRS_TELEMETRY_SDK_NAME=y.SEMRESATTRS_SERVICE_VERSION=y.SEMRESATTRS_SERVICE_INSTANCE_ID=y.SEMRESATTRS_SERVICE_NAMESPACE=y.SEMRESATTRS_SERVICE_NAME=y.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=y.SEMRESATTRS_PROCESS_RUNTIME_VERSION=y.SEMRESATTRS_PROCESS_RUNTIME_NAME=y.SEMRESATTRS_PROCESS_OWNER=y.SEMRESATTRS_PROCESS_COMMAND_ARGS=y.SEMRESATTRS_PROCESS_COMMAND_LINE=y.SEMRESATTRS_PROCESS_COMMAND=y.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=y.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=y.SEMRESATTRS_PROCESS_PID=y.SEMRESATTRS_OS_VERSION=y.SEMRESATTRS_OS_NAME=y.SEMRESATTRS_OS_DESCRIPTION=y.SEMRESATTRS_OS_TYPE=y.SEMRESATTRS_K8S_CRONJOB_NAME=y.SEMRESATTRS_K8S_CRONJOB_UID=y.SEMRESATTRS_K8S_JOB_NAME=y.SEMRESATTRS_K8S_JOB_UID=y.SEMRESATTRS_K8S_DAEMONSET_NAME=y.SEMRESATTRS_K8S_DAEMONSET_UID=void 0,y.TelemetrySdkLanguageValues=y.TELEMETRYSDKLANGUAGEVALUES_WEBJS=y.TELEMETRYSDKLANGUAGEVALUES_RUBY=y.TELEMETRYSDKLANGUAGEVALUES_PYTHON=y.TELEMETRYSDKLANGUAGEVALUES_PHP=y.TELEMETRYSDKLANGUAGEVALUES_NODEJS=y.TELEMETRYSDKLANGUAGEVALUES_JAVA=y.TELEMETRYSDKLANGUAGEVALUES_GO=y.TELEMETRYSDKLANGUAGEVALUES_ERLANG=y.TELEMETRYSDKLANGUAGEVALUES_DOTNET=y.TELEMETRYSDKLANGUAGEVALUES_CPP=y.OsTypeValues=y.OSTYPEVALUES_Z_OS=y.OSTYPEVALUES_SOLARIS=y.OSTYPEVALUES_AIX=y.OSTYPEVALUES_HPUX=y.OSTYPEVALUES_DRAGONFLYBSD=y.OSTYPEVALUES_OPENBSD=y.OSTYPEVALUES_NETBSD=y.OSTYPEVALUES_FREEBSD=y.OSTYPEVALUES_DARWIN=y.OSTYPEVALUES_LINUX=y.OSTYPEVALUES_WINDOWS=y.HostArchValues=y.HOSTARCHVALUES_X86=y.HOSTARCHVALUES_PPC64=y.HOSTARCHVALUES_PPC32=y.HOSTARCHVALUES_IA64=y.HOSTARCHVALUES_ARM64=y.HOSTARCHVALUES_ARM32=y.HOSTARCHVALUES_AMD64=y.AwsEcsLaunchtypeValues=y.AWSECSLAUNCHTYPEVALUES_FARGATE=y.AWSECSLAUNCHTYPEVALUES_EC2=y.CloudPlatformValues=y.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=y.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=y.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=y.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=void 0;const e=VP(),t="cloud.provider",n="cloud.account.id",r="cloud.region",o="cloud.availability_zone",s="cloud.platform",i="aws.ecs.container.arn",a="aws.ecs.cluster.arn",c="aws.ecs.launchtype",u="aws.ecs.task.arn",f="aws.ecs.task.family",d="aws.ecs.task.revision",l="aws.eks.cluster.arn",_="aws.log.group.names",p="aws.log.group.arns",h="aws.log.stream.names",E="aws.log.stream.arns",T="container.name",S="container.id",g="container.runtime",A="container.image.name",R="container.image.tag",O="deployment.environment",C="device.id",I="device.model.identifier",w="device.model.name",U="faas.name",B="faas.id",F="faas.version",G="faas.instance",x="faas.max_memory",Y="host.id",v="host.name",P="host.type",H="host.arch",J="host.image.name",se="host.image.id",ne="host.image.version",M="k8s.cluster.name",L="k8s.node.name",V="k8s.node.uid",$="k8s.namespace.name",K="k8s.pod.uid",X="k8s.pod.name",D="k8s.container.name",k="k8s.replicaset.uid",z="k8s.replicaset.name",q="k8s.deployment.uid",ee="k8s.deployment.name",re="k8s.statefulset.uid",_e="k8s.statefulset.name",ie="k8s.daemonset.uid",le="k8s.daemonset.name",Se="k8s.job.uid",ve="k8s.job.name",De="k8s.cronjob.uid",qe="k8s.cronjob.name",wt="os.type",at="os.description",ct="os.name",rt="os.version",gs="process.pid",As="process.executable.name",Rs="process.executable.path",ys="process.command",Ns="process.command_line",Os="process.command_args",bs="process.owner",Cs="process.runtime.name",Is="process.runtime.version",Ps="process.runtime.description",Ms="service.name",vs="service.namespace",ws="service.instance.id",Ls="service.version",Ds="telemetry.sdk.name",Us="telemetry.sdk.language",ks="telemetry.sdk.version",xs="telemetry.auto.version",Gs="webengine.name",Vs="webengine.version",$s="webengine.description";y.SEMRESATTRS_CLOUD_PROVIDER=t,y.SEMRESATTRS_CLOUD_ACCOUNT_ID=n,y.SEMRESATTRS_CLOUD_REGION=r,y.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=o,y.SEMRESATTRS_CLOUD_PLATFORM=s,y.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=i,y.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=a,y.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=c,y.SEMRESATTRS_AWS_ECS_TASK_ARN=u,y.SEMRESATTRS_AWS_ECS_TASK_FAMILY=f,y.SEMRESATTRS_AWS_ECS_TASK_REVISION=d,y.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=l,y.SEMRESATTRS_AWS_LOG_GROUP_NAMES=_,y.SEMRESATTRS_AWS_LOG_GROUP_ARNS=p,y.SEMRESATTRS_AWS_LOG_STREAM_NAMES=h,y.SEMRESATTRS_AWS_LOG_STREAM_ARNS=E,y.SEMRESATTRS_CONTAINER_NAME=T,y.SEMRESATTRS_CONTAINER_ID=S,y.SEMRESATTRS_CONTAINER_RUNTIME=g,y.SEMRESATTRS_CONTAINER_IMAGE_NAME=A,y.SEMRESATTRS_CONTAINER_IMAGE_TAG=R,y.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=O,y.SEMRESATTRS_DEVICE_ID=C,y.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=I,y.SEMRESATTRS_DEVICE_MODEL_NAME=w,y.SEMRESATTRS_FAAS_NAME=U,y.SEMRESATTRS_FAAS_ID=B,y.SEMRESATTRS_FAAS_VERSION=F,y.SEMRESATTRS_FAAS_INSTANCE=G,y.SEMRESATTRS_FAAS_MAX_MEMORY=x,y.SEMRESATTRS_HOST_ID=Y,y.SEMRESATTRS_HOST_NAME=v,y.SEMRESATTRS_HOST_TYPE=P,y.SEMRESATTRS_HOST_ARCH=H,y.SEMRESATTRS_HOST_IMAGE_NAME=J,y.SEMRESATTRS_HOST_IMAGE_ID=se,y.SEMRESATTRS_HOST_IMAGE_VERSION=ne,y.SEMRESATTRS_K8S_CLUSTER_NAME=M,y.SEMRESATTRS_K8S_NODE_NAME=L,y.SEMRESATTRS_K8S_NODE_UID=V,y.SEMRESATTRS_K8S_NAMESPACE_NAME=$,y.SEMRESATTRS_K8S_POD_UID=K,y.SEMRESATTRS_K8S_POD_NAME=X,y.SEMRESATTRS_K8S_CONTAINER_NAME=D,y.SEMRESATTRS_K8S_REPLICASET_UID=k,y.SEMRESATTRS_K8S_REPLICASET_NAME=z,y.SEMRESATTRS_K8S_DEPLOYMENT_UID=q,y.SEMRESATTRS_K8S_DEPLOYMENT_NAME=ee,y.SEMRESATTRS_K8S_STATEFULSET_UID=re,y.SEMRESATTRS_K8S_STATEFULSET_NAME=_e,y.SEMRESATTRS_K8S_DAEMONSET_UID=ie,y.SEMRESATTRS_K8S_DAEMONSET_NAME=le,y.SEMRESATTRS_K8S_JOB_UID=Se,y.SEMRESATTRS_K8S_JOB_NAME=ve,y.SEMRESATTRS_K8S_CRONJOB_UID=De,y.SEMRESATTRS_K8S_CRONJOB_NAME=qe,y.SEMRESATTRS_OS_TYPE=wt,y.SEMRESATTRS_OS_DESCRIPTION=at,y.SEMRESATTRS_OS_NAME=ct,y.SEMRESATTRS_OS_VERSION=rt,y.SEMRESATTRS_PROCESS_PID=gs,y.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=As,y.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=Rs,y.SEMRESATTRS_PROCESS_COMMAND=ys,y.SEMRESATTRS_PROCESS_COMMAND_LINE=Ns,y.SEMRESATTRS_PROCESS_COMMAND_ARGS=Os,y.SEMRESATTRS_PROCESS_OWNER=bs,y.SEMRESATTRS_PROCESS_RUNTIME_NAME=Cs,y.SEMRESATTRS_PROCESS_RUNTIME_VERSION=Is,y.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=Ps,y.SEMRESATTRS_SERVICE_NAME=Ms,y.SEMRESATTRS_SERVICE_NAMESPACE=vs,y.SEMRESATTRS_SERVICE_INSTANCE_ID=ws,y.SEMRESATTRS_SERVICE_VERSION=Ls,y.SEMRESATTRS_TELEMETRY_SDK_NAME=Ds,y.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=Us,y.SEMRESATTRS_TELEMETRY_SDK_VERSION=ks,y.SEMRESATTRS_TELEMETRY_AUTO_VERSION=xs,y.SEMRESATTRS_WEBENGINE_NAME=Gs,y.SEMRESATTRS_WEBENGINE_VERSION=Vs,y.SEMRESATTRS_WEBENGINE_DESCRIPTION=$s,y.SemanticResourceAttributes=(0,e.createConstMap)([t,n,r,o,s,i,a,c,u,f,d,l,_,p,h,E,T,S,g,A,R,O,C,I,w,U,B,F,G,x,Y,v,P,H,J,se,ne,M,L,V,$,K,X,D,k,z,q,ee,re,_e,ie,le,Se,ve,De,qe,wt,at,ct,rt,gs,As,Rs,ys,Ns,Os,bs,Cs,Is,Ps,Ms,vs,ws,Ls,Ds,Us,ks,xs,Gs,Vs,$s]);const Bs="alibaba_cloud",Hs="aws",Fs="azure",Ys="gcp";y.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=Bs,y.CLOUDPROVIDERVALUES_AWS=Hs,y.CLOUDPROVIDERVALUES_AZURE=Fs,y.CLOUDPROVIDERVALUES_GCP=Ys,y.CloudProviderValues=(0,e.createConstMap)([Bs,Hs,Fs,Ys]);const js="alibaba_cloud_ecs",qs="alibaba_cloud_fc",Ws="aws_ec2",Ks="aws_ecs",zs="aws_eks",Zs="aws_lambda",Xs="aws_elastic_beanstalk",Qs="azure_vm",Js="azure_container_instances",ei="azure_aks",ti="azure_functions",ni="azure_app_service",ri="gcp_compute_engine",oi="gcp_cloud_run",si="gcp_kubernetes_engine",ii="gcp_cloud_functions",ai="gcp_app_engine";y.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=js,y.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=qs,y.CLOUDPLATFORMVALUES_AWS_EC2=Ws,y.CLOUDPLATFORMVALUES_AWS_ECS=Ks,y.CLOUDPLATFORMVALUES_AWS_EKS=zs,y.CLOUDPLATFORMVALUES_AWS_LAMBDA=Zs,y.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=Xs,y.CLOUDPLATFORMVALUES_AZURE_VM=Qs,y.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=Js,y.CLOUDPLATFORMVALUES_AZURE_AKS=ei,y.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=ti,y.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=ni,y.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=ri,y.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=oi,y.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=si,y.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=ii,y.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=ai,y.CloudPlatformValues=(0,e.createConstMap)([js,qs,Ws,Ks,zs,Zs,Xs,Qs,Js,ei,ti,ni,ri,oi,si,ii,ai]);const ci="ec2",ui="fargate";y.AWSECSLAUNCHTYPEVALUES_EC2=ci,y.AWSECSLAUNCHTYPEVALUES_FARGATE=ui,y.AwsEcsLaunchtypeValues=(0,e.createConstMap)([ci,ui]);const li="amd64",di="arm32",fi="arm64",_i="ia64",pi="ppc32",hi="ppc64",Ei="x86";y.HOSTARCHVALUES_AMD64=li,y.HOSTARCHVALUES_ARM32=di,y.HOSTARCHVALUES_ARM64=fi,y.HOSTARCHVALUES_IA64=_i,y.HOSTARCHVALUES_PPC32=pi,y.HOSTARCHVALUES_PPC64=hi,y.HOSTARCHVALUES_X86=Ei,y.HostArchValues=(0,e.createConstMap)([li,di,fi,_i,pi,hi,Ei]);const Ti="windows",Si="linux",mi="darwin",gi="freebsd",Ai="netbsd",Ri="openbsd",yi="dragonflybsd",Ni="hpux",Oi="aix",bi="solaris",Ci="z_os";y.OSTYPEVALUES_WINDOWS=Ti,y.OSTYPEVALUES_LINUX=Si,y.OSTYPEVALUES_DARWIN=mi,y.OSTYPEVALUES_FREEBSD=gi,y.OSTYPEVALUES_NETBSD=Ai,y.OSTYPEVALUES_OPENBSD=Ri,y.OSTYPEVALUES_DRAGONFLYBSD=yi,y.OSTYPEVALUES_HPUX=Ni,y.OSTYPEVALUES_AIX=Oi,y.OSTYPEVALUES_SOLARIS=bi,y.OSTYPEVALUES_Z_OS=Ci,y.OsTypeValues=(0,e.createConstMap)([Ti,Si,mi,gi,Ai,Ri,yi,Ni,Oi,bi,Ci]);const Ii="cpp",Pi="dotnet",Mi="erlang",vi="go",wi="java",Li="nodejs",Di="php",Ui="python",ki="ruby",xi="webjs";return y.TELEMETRYSDKLANGUAGEVALUES_CPP=Ii,y.TELEMETRYSDKLANGUAGEVALUES_DOTNET=Pi,y.TELEMETRYSDKLANGUAGEVALUES_ERLANG=Mi,y.TELEMETRYSDKLANGUAGEVALUES_GO=vi,y.TELEMETRYSDKLANGUAGEVALUES_JAVA=wi,y.TELEMETRYSDKLANGUAGEVALUES_NODEJS=Li,y.TELEMETRYSDKLANGUAGEVALUES_PHP=Di,y.TELEMETRYSDKLANGUAGEVALUES_PYTHON=Ui,y.TELEMETRYSDKLANGUAGEVALUES_RUBY=ki,y.TELEMETRYSDKLANGUAGEVALUES_WEBJS=xi,y.TelemetrySdkLanguageValues=(0,e.createConstMap)([Ii,Pi,Mi,vi,wi,Li,Di,Ui,ki,xi]),y}var Wg;function CU(){return Wg||(Wg=1,(function(e){var t=Or&&Or.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Or&&Or.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(bU(),e)})(Or)),Or}var N={},Kg;function IU(){if(Kg)return N;Kg=1,Object.defineProperty(N,"__esModule",{value:!0}),N.ATTR_EXCEPTION_TYPE=N.ATTR_EXCEPTION_STACKTRACE=N.ATTR_EXCEPTION_MESSAGE=N.ATTR_EXCEPTION_ESCAPED=N.ERROR_TYPE_VALUE_OTHER=N.ATTR_ERROR_TYPE=N.DOTNET_GC_HEAP_GENERATION_VALUE_POH=N.DOTNET_GC_HEAP_GENERATION_VALUE_LOH=N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2=N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1=N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0=N.ATTR_DOTNET_GC_HEAP_GENERATION=N.DB_SYSTEM_NAME_VALUE_POSTGRESQL=N.DB_SYSTEM_NAME_VALUE_MYSQL=N.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER=N.DB_SYSTEM_NAME_VALUE_MARIADB=N.ATTR_DB_SYSTEM_NAME=N.ATTR_DB_STORED_PROCEDURE_NAME=N.ATTR_DB_RESPONSE_STATUS_CODE=N.ATTR_DB_QUERY_TEXT=N.ATTR_DB_QUERY_SUMMARY=N.ATTR_DB_OPERATION_NAME=N.ATTR_DB_OPERATION_BATCH_SIZE=N.ATTR_DB_NAMESPACE=N.ATTR_DB_COLLECTION_NAME=N.ATTR_CODE_STACKTRACE=N.ATTR_CODE_LINE_NUMBER=N.ATTR_CODE_FUNCTION_NAME=N.ATTR_CODE_FILE_PATH=N.ATTR_CODE_COLUMN_NUMBER=N.ATTR_CLIENT_PORT=N.ATTR_CLIENT_ADDRESS=N.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED=N.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS=N.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE=N.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS=N.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK=N.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED=N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED=N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER=N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER=N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED=N.ATTR_ASPNETCORE_RATE_LIMITING_RESULT=N.ATTR_ASPNETCORE_RATE_LIMITING_POLICY=N.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE=N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED=N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED=N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED=N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED=N.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT=void 0,N.OTEL_STATUS_CODE_VALUE_ERROR=N.ATTR_OTEL_STATUS_CODE=N.ATTR_OTEL_SCOPE_VERSION=N.ATTR_OTEL_SCOPE_NAME=N.NETWORK_TYPE_VALUE_IPV6=N.NETWORK_TYPE_VALUE_IPV4=N.ATTR_NETWORK_TYPE=N.NETWORK_TRANSPORT_VALUE_UNIX=N.NETWORK_TRANSPORT_VALUE_UDP=N.NETWORK_TRANSPORT_VALUE_TCP=N.NETWORK_TRANSPORT_VALUE_QUIC=N.NETWORK_TRANSPORT_VALUE_PIPE=N.ATTR_NETWORK_TRANSPORT=N.ATTR_NETWORK_PROTOCOL_VERSION=N.ATTR_NETWORK_PROTOCOL_NAME=N.ATTR_NETWORK_PEER_PORT=N.ATTR_NETWORK_PEER_ADDRESS=N.ATTR_NETWORK_LOCAL_PORT=N.ATTR_NETWORK_LOCAL_ADDRESS=N.JVM_THREAD_STATE_VALUE_WAITING=N.JVM_THREAD_STATE_VALUE_TIMED_WAITING=N.JVM_THREAD_STATE_VALUE_TERMINATED=N.JVM_THREAD_STATE_VALUE_RUNNABLE=N.JVM_THREAD_STATE_VALUE_NEW=N.JVM_THREAD_STATE_VALUE_BLOCKED=N.ATTR_JVM_THREAD_STATE=N.ATTR_JVM_THREAD_DAEMON=N.JVM_MEMORY_TYPE_VALUE_NON_HEAP=N.JVM_MEMORY_TYPE_VALUE_HEAP=N.ATTR_JVM_MEMORY_TYPE=N.ATTR_JVM_MEMORY_POOL_NAME=N.ATTR_JVM_GC_NAME=N.ATTR_JVM_GC_ACTION=N.ATTR_HTTP_ROUTE=N.ATTR_HTTP_RESPONSE_STATUS_CODE=N.ATTR_HTTP_RESPONSE_HEADER=N.ATTR_HTTP_REQUEST_RESEND_COUNT=N.ATTR_HTTP_REQUEST_METHOD_ORIGINAL=N.HTTP_REQUEST_METHOD_VALUE_TRACE=N.HTTP_REQUEST_METHOD_VALUE_PUT=N.HTTP_REQUEST_METHOD_VALUE_POST=N.HTTP_REQUEST_METHOD_VALUE_PATCH=N.HTTP_REQUEST_METHOD_VALUE_OPTIONS=N.HTTP_REQUEST_METHOD_VALUE_HEAD=N.HTTP_REQUEST_METHOD_VALUE_GET=N.HTTP_REQUEST_METHOD_VALUE_DELETE=N.HTTP_REQUEST_METHOD_VALUE_CONNECT=N.HTTP_REQUEST_METHOD_VALUE_OTHER=N.ATTR_HTTP_REQUEST_METHOD=N.ATTR_HTTP_REQUEST_HEADER=void 0,N.ATTR_USER_AGENT_ORIGINAL=N.ATTR_URL_SCHEME=N.ATTR_URL_QUERY=N.ATTR_URL_PATH=N.ATTR_URL_FULL=N.ATTR_URL_FRAGMENT=N.ATTR_TELEMETRY_SDK_VERSION=N.ATTR_TELEMETRY_SDK_NAME=N.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS=N.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT=N.TELEMETRY_SDK_LANGUAGE_VALUE_RUST=N.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY=N.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON=N.TELEMETRY_SDK_LANGUAGE_VALUE_PHP=N.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS=N.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA=N.TELEMETRY_SDK_LANGUAGE_VALUE_GO=N.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG=N.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET=N.TELEMETRY_SDK_LANGUAGE_VALUE_CPP=N.ATTR_TELEMETRY_SDK_LANGUAGE=N.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS=N.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS=N.SIGNALR_TRANSPORT_VALUE_LONG_POLLING=N.ATTR_SIGNALR_TRANSPORT=N.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT=N.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE=N.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN=N.ATTR_SIGNALR_CONNECTION_STATUS=N.ATTR_SERVICE_VERSION=N.ATTR_SERVICE_NAME=N.ATTR_SERVER_PORT=N.ATTR_SERVER_ADDRESS=N.ATTR_OTEL_STATUS_DESCRIPTION=N.OTEL_STATUS_CODE_VALUE_OK=void 0,N.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT="aspnetcore.diagnostics.exception.result",N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED="aborted",N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED="handled",N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED="skipped",N.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED="unhandled",N.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE="aspnetcore.diagnostics.handler.type",N.ATTR_ASPNETCORE_RATE_LIMITING_POLICY="aspnetcore.rate_limiting.policy",N.ATTR_ASPNETCORE_RATE_LIMITING_RESULT="aspnetcore.rate_limiting.result",N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED="acquired",N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER="endpoint_limiter",N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER="global_limiter",N.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED="request_canceled",N.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED="aspnetcore.request.is_unhandled",N.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK="aspnetcore.routing.is_fallback",N.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS="aspnetcore.routing.match_status",N.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE="failure",N.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS="success",N.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED="aspnetcore.user.is_authenticated",N.ATTR_CLIENT_ADDRESS="client.address",N.ATTR_CLIENT_PORT="client.port",N.ATTR_CODE_COLUMN_NUMBER="code.column.number",N.ATTR_CODE_FILE_PATH="code.file.path",N.ATTR_CODE_FUNCTION_NAME="code.function.name",N.ATTR_CODE_LINE_NUMBER="code.line.number",N.ATTR_CODE_STACKTRACE="code.stacktrace",N.ATTR_DB_COLLECTION_NAME="db.collection.name",N.ATTR_DB_NAMESPACE="db.namespace",N.ATTR_DB_OPERATION_BATCH_SIZE="db.operation.batch.size",N.ATTR_DB_OPERATION_NAME="db.operation.name",N.ATTR_DB_QUERY_SUMMARY="db.query.summary",N.ATTR_DB_QUERY_TEXT="db.query.text",N.ATTR_DB_RESPONSE_STATUS_CODE="db.response.status_code",N.ATTR_DB_STORED_PROCEDURE_NAME="db.stored_procedure.name",N.ATTR_DB_SYSTEM_NAME="db.system.name",N.DB_SYSTEM_NAME_VALUE_MARIADB="mariadb",N.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER="microsoft.sql_server",N.DB_SYSTEM_NAME_VALUE_MYSQL="mysql",N.DB_SYSTEM_NAME_VALUE_POSTGRESQL="postgresql",N.ATTR_DOTNET_GC_HEAP_GENERATION="dotnet.gc.heap.generation",N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0="gen0",N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1="gen1",N.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2="gen2",N.DOTNET_GC_HEAP_GENERATION_VALUE_LOH="loh",N.DOTNET_GC_HEAP_GENERATION_VALUE_POH="poh",N.ATTR_ERROR_TYPE="error.type",N.ERROR_TYPE_VALUE_OTHER="_OTHER",N.ATTR_EXCEPTION_ESCAPED="exception.escaped",N.ATTR_EXCEPTION_MESSAGE="exception.message",N.ATTR_EXCEPTION_STACKTRACE="exception.stacktrace",N.ATTR_EXCEPTION_TYPE="exception.type";const e=n=>`http.request.header.${n}`;N.ATTR_HTTP_REQUEST_HEADER=e,N.ATTR_HTTP_REQUEST_METHOD="http.request.method",N.HTTP_REQUEST_METHOD_VALUE_OTHER="_OTHER",N.HTTP_REQUEST_METHOD_VALUE_CONNECT="CONNECT",N.HTTP_REQUEST_METHOD_VALUE_DELETE="DELETE",N.HTTP_REQUEST_METHOD_VALUE_GET="GET",N.HTTP_REQUEST_METHOD_VALUE_HEAD="HEAD",N.HTTP_REQUEST_METHOD_VALUE_OPTIONS="OPTIONS",N.HTTP_REQUEST_METHOD_VALUE_PATCH="PATCH",N.HTTP_REQUEST_METHOD_VALUE_POST="POST",N.HTTP_REQUEST_METHOD_VALUE_PUT="PUT",N.HTTP_REQUEST_METHOD_VALUE_TRACE="TRACE",N.ATTR_HTTP_REQUEST_METHOD_ORIGINAL="http.request.method_original",N.ATTR_HTTP_REQUEST_RESEND_COUNT="http.request.resend_count";const t=n=>`http.response.header.${n}`;return N.ATTR_HTTP_RESPONSE_HEADER=t,N.ATTR_HTTP_RESPONSE_STATUS_CODE="http.response.status_code",N.ATTR_HTTP_ROUTE="http.route",N.ATTR_JVM_GC_ACTION="jvm.gc.action",N.ATTR_JVM_GC_NAME="jvm.gc.name",N.ATTR_JVM_MEMORY_POOL_NAME="jvm.memory.pool.name",N.ATTR_JVM_MEMORY_TYPE="jvm.memory.type",N.JVM_MEMORY_TYPE_VALUE_HEAP="heap",N.JVM_MEMORY_TYPE_VALUE_NON_HEAP="non_heap",N.ATTR_JVM_THREAD_DAEMON="jvm.thread.daemon",N.ATTR_JVM_THREAD_STATE="jvm.thread.state",N.JVM_THREAD_STATE_VALUE_BLOCKED="blocked",N.JVM_THREAD_STATE_VALUE_NEW="new",N.JVM_THREAD_STATE_VALUE_RUNNABLE="runnable",N.JVM_THREAD_STATE_VALUE_TERMINATED="terminated",N.JVM_THREAD_STATE_VALUE_TIMED_WAITING="timed_waiting",N.JVM_THREAD_STATE_VALUE_WAITING="waiting",N.ATTR_NETWORK_LOCAL_ADDRESS="network.local.address",N.ATTR_NETWORK_LOCAL_PORT="network.local.port",N.ATTR_NETWORK_PEER_ADDRESS="network.peer.address",N.ATTR_NETWORK_PEER_PORT="network.peer.port",N.ATTR_NETWORK_PROTOCOL_NAME="network.protocol.name",N.ATTR_NETWORK_PROTOCOL_VERSION="network.protocol.version",N.ATTR_NETWORK_TRANSPORT="network.transport",N.NETWORK_TRANSPORT_VALUE_PIPE="pipe",N.NETWORK_TRANSPORT_VALUE_QUIC="quic",N.NETWORK_TRANSPORT_VALUE_TCP="tcp",N.NETWORK_TRANSPORT_VALUE_UDP="udp",N.NETWORK_TRANSPORT_VALUE_UNIX="unix",N.ATTR_NETWORK_TYPE="network.type",N.NETWORK_TYPE_VALUE_IPV4="ipv4",N.NETWORK_TYPE_VALUE_IPV6="ipv6",N.ATTR_OTEL_SCOPE_NAME="otel.scope.name",N.ATTR_OTEL_SCOPE_VERSION="otel.scope.version",N.ATTR_OTEL_STATUS_CODE="otel.status_code",N.OTEL_STATUS_CODE_VALUE_ERROR="ERROR",N.OTEL_STATUS_CODE_VALUE_OK="OK",N.ATTR_OTEL_STATUS_DESCRIPTION="otel.status_description",N.ATTR_SERVER_ADDRESS="server.address",N.ATTR_SERVER_PORT="server.port",N.ATTR_SERVICE_NAME="service.name",N.ATTR_SERVICE_VERSION="service.version",N.ATTR_SIGNALR_CONNECTION_STATUS="signalr.connection.status",N.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN="app_shutdown",N.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE="normal_closure",N.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT="timeout",N.ATTR_SIGNALR_TRANSPORT="signalr.transport",N.SIGNALR_TRANSPORT_VALUE_LONG_POLLING="long_polling",N.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS="server_sent_events",N.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS="web_sockets",N.ATTR_TELEMETRY_SDK_LANGUAGE="telemetry.sdk.language",N.TELEMETRY_SDK_LANGUAGE_VALUE_CPP="cpp",N.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET="dotnet",N.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG="erlang",N.TELEMETRY_SDK_LANGUAGE_VALUE_GO="go",N.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA="java",N.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS="nodejs",N.TELEMETRY_SDK_LANGUAGE_VALUE_PHP="php",N.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON="python",N.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY="ruby",N.TELEMETRY_SDK_LANGUAGE_VALUE_RUST="rust",N.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT="swift",N.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS="webjs",N.ATTR_TELEMETRY_SDK_NAME="telemetry.sdk.name",N.ATTR_TELEMETRY_SDK_VERSION="telemetry.sdk.version",N.ATTR_URL_FRAGMENT="url.fragment",N.ATTR_URL_FULL="url.full",N.ATTR_URL_PATH="url.path",N.ATTR_URL_QUERY="url.query",N.ATTR_URL_SCHEME="url.scheme",N.ATTR_USER_AGENT_ORIGINAL="user_agent.original",N}var Z={},zg;function PU(){return zg||(zg=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS=Z.METRIC_KESTREL_UPGRADED_CONNECTIONS=Z.METRIC_KESTREL_TLS_HANDSHAKE_DURATION=Z.METRIC_KESTREL_REJECTED_CONNECTIONS=Z.METRIC_KESTREL_QUEUED_REQUESTS=Z.METRIC_KESTREL_QUEUED_CONNECTIONS=Z.METRIC_KESTREL_CONNECTION_DURATION=Z.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES=Z.METRIC_KESTREL_ACTIVE_CONNECTIONS=Z.METRIC_JVM_THREAD_COUNT=Z.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC=Z.METRIC_JVM_MEMORY_USED=Z.METRIC_JVM_MEMORY_LIMIT=Z.METRIC_JVM_MEMORY_COMMITTED=Z.METRIC_JVM_GC_DURATION=Z.METRIC_JVM_CPU_TIME=Z.METRIC_JVM_CPU_RECENT_UTILIZATION=Z.METRIC_JVM_CPU_COUNT=Z.METRIC_JVM_CLASS_UNLOADED=Z.METRIC_JVM_CLASS_LOADED=Z.METRIC_JVM_CLASS_COUNT=Z.METRIC_HTTP_SERVER_REQUEST_DURATION=Z.METRIC_HTTP_CLIENT_REQUEST_DURATION=Z.METRIC_DOTNET_TIMER_COUNT=Z.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT=Z.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT=Z.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH=Z.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET=Z.METRIC_DOTNET_PROCESS_CPU_TIME=Z.METRIC_DOTNET_PROCESS_CPU_COUNT=Z.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS=Z.METRIC_DOTNET_JIT_COMPILED_METHODS=Z.METRIC_DOTNET_JIT_COMPILED_IL_SIZE=Z.METRIC_DOTNET_JIT_COMPILATION_TIME=Z.METRIC_DOTNET_GC_PAUSE_TIME=Z.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE=Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE=Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE=Z.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED=Z.METRIC_DOTNET_GC_COLLECTIONS=Z.METRIC_DOTNET_EXCEPTIONS=Z.METRIC_DOTNET_ASSEMBLY_COUNT=Z.METRIC_DB_CLIENT_OPERATION_DURATION=Z.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE=Z.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES=Z.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS=void 0,Z.METRIC_SIGNALR_SERVER_CONNECTION_DURATION=void 0,Z.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS="aspnetcore.diagnostics.exceptions",Z.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES="aspnetcore.rate_limiting.active_request_leases",Z.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS="aspnetcore.rate_limiting.queued_requests",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE="aspnetcore.rate_limiting.request.time_in_queue",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION="aspnetcore.rate_limiting.request_lease.duration",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS="aspnetcore.rate_limiting.requests",Z.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS="aspnetcore.routing.match_attempts",Z.METRIC_DB_CLIENT_OPERATION_DURATION="db.client.operation.duration",Z.METRIC_DOTNET_ASSEMBLY_COUNT="dotnet.assembly.count",Z.METRIC_DOTNET_EXCEPTIONS="dotnet.exceptions",Z.METRIC_DOTNET_GC_COLLECTIONS="dotnet.gc.collections",Z.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED="dotnet.gc.heap.total_allocated",Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE="dotnet.gc.last_collection.heap.fragmentation.size",Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE="dotnet.gc.last_collection.heap.size",Z.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE="dotnet.gc.last_collection.memory.committed_size",Z.METRIC_DOTNET_GC_PAUSE_TIME="dotnet.gc.pause.time",Z.METRIC_DOTNET_JIT_COMPILATION_TIME="dotnet.jit.compilation.time",Z.METRIC_DOTNET_JIT_COMPILED_IL_SIZE="dotnet.jit.compiled_il.size",Z.METRIC_DOTNET_JIT_COMPILED_METHODS="dotnet.jit.compiled_methods",Z.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS="dotnet.monitor.lock_contentions",Z.METRIC_DOTNET_PROCESS_CPU_COUNT="dotnet.process.cpu.count",Z.METRIC_DOTNET_PROCESS_CPU_TIME="dotnet.process.cpu.time",Z.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET="dotnet.process.memory.working_set",Z.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH="dotnet.thread_pool.queue.length",Z.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT="dotnet.thread_pool.thread.count",Z.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT="dotnet.thread_pool.work_item.count",Z.METRIC_DOTNET_TIMER_COUNT="dotnet.timer.count",Z.METRIC_HTTP_CLIENT_REQUEST_DURATION="http.client.request.duration",Z.METRIC_HTTP_SERVER_REQUEST_DURATION="http.server.request.duration",Z.METRIC_JVM_CLASS_COUNT="jvm.class.count",Z.METRIC_JVM_CLASS_LOADED="jvm.class.loaded",Z.METRIC_JVM_CLASS_UNLOADED="jvm.class.unloaded",Z.METRIC_JVM_CPU_COUNT="jvm.cpu.count",Z.METRIC_JVM_CPU_RECENT_UTILIZATION="jvm.cpu.recent_utilization",Z.METRIC_JVM_CPU_TIME="jvm.cpu.time",Z.METRIC_JVM_GC_DURATION="jvm.gc.duration",Z.METRIC_JVM_MEMORY_COMMITTED="jvm.memory.committed",Z.METRIC_JVM_MEMORY_LIMIT="jvm.memory.limit",Z.METRIC_JVM_MEMORY_USED="jvm.memory.used",Z.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC="jvm.memory.used_after_last_gc",Z.METRIC_JVM_THREAD_COUNT="jvm.thread.count",Z.METRIC_KESTREL_ACTIVE_CONNECTIONS="kestrel.active_connections",Z.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES="kestrel.active_tls_handshakes",Z.METRIC_KESTREL_CONNECTION_DURATION="kestrel.connection.duration",Z.METRIC_KESTREL_QUEUED_CONNECTIONS="kestrel.queued_connections",Z.METRIC_KESTREL_QUEUED_REQUESTS="kestrel.queued_requests",Z.METRIC_KESTREL_REJECTED_CONNECTIONS="kestrel.rejected_connections",Z.METRIC_KESTREL_TLS_HANDSHAKE_DURATION="kestrel.tls_handshake.duration",Z.METRIC_KESTREL_UPGRADED_CONNECTIONS="kestrel.upgraded_connections",Z.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS="signalr.server.active_connections",Z.METRIC_SIGNALR_SERVER_CONNECTION_DURATION="signalr.server.connection.duration"),Z}var fa={},Zg;function MU(){return Zg||(Zg=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.EVENT_EXCEPTION=void 0,fa.EVENT_EXCEPTION="exception"),fa}var Xg;function pt(){return Xg||(Xg=1,(function(e){var t=yr&&yr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=yr&&yr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(OU(),e),n(CU(),e),n(IU(),e),n(PU(),e),n(MU(),e)})(yr)),yr}var Q=pt();const vU="process.runtime.name",Ru={[Q.ATTR_TELEMETRY_SDK_NAME]:"opentelemetry",[vU]:"node",[Q.ATTR_TELEMETRY_SDK_LANGUAGE]:Q.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS,[Q.ATTR_TELEMETRY_SDK_VERSION]:yU},$P=9,wU=6,LU=Math.pow(10,wU),Du=Math.pow(10,$P);function Bn(e){const t=e/1e3,n=Math.trunc(t),r=Math.round(e%1e3*LU);return[n,r]}function Il(){let e=oo.timeOrigin;if(typeof e!="number"){const t=oo;e=t.timing&&t.timing.fetchStart}return e}function Jh(e){const t=Bn(Il()),n=Bn(typeof e=="number"?e:oo.now());return eE(t,n)}function DU(e){if(Pl(e))return e;if(typeof e=="number")return e<Il()?Jh(e):Bn(e);if(e instanceof Date)return Bn(e.getTime());throw TypeError("Invalid input type")}function BP(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=Du),[n,r]}function UU(e){const t=$P,n=`${"0".repeat(t)}${e[1]}Z`,r=n.substring(n.length-t-1);return new Date(e[0]*1e3).toISOString().replace("000Z",r)}function kU(e){return e[0]*Du+e[1]}function xU(e){return e[0]*1e3+e[1]/1e6}function GU(e){return e[0]*1e6+e[1]/1e3}function Pl(e){return Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"}function Jp(e){return Pl(e)||typeof e=="number"||e instanceof Date}function eE(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=Du&&(n[1]-=Du,n[0]+=1),n}function VU(e){typeof e!="number"&&e.unref()}var eh;(function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"})(eh||(eh={}));class $U{_propagators;_fields;constructor(t={}){this._propagators=t.propagators??[],this._fields=Array.from(new Set(this._propagators.map(n=>typeof n.fields=="function"?n.fields():[]).reduce((n,r)=>n.concat(r),[])))}inject(t,n,r){for(const o of this._propagators)try{o.inject(t,n,r)}catch(s){b.diag.warn(`Failed to inject with ${o.constructor.name}. Err: ${s.message}`)}}extract(t,n,r){return this._propagators.reduce((o,s)=>{try{return s.extract(o,n,r)}catch(i){b.diag.warn(`Failed to extract with ${s.constructor.name}. Err: ${i.message}`)}return o},t)}fields(){return this._fields.slice()}}const th="[_0-9a-z-*/]",BU=`[a-z]${th}{0,255}`,HU=`[a-z0-9]${th}{0,240}@[a-z]${th}{0,13}`,FU=new RegExp(`^(?:${BU}|${HU})$`),YU=/^[ -~]{0,255}[!-~]$/,jU=/,|=/;function qU(e){return FU.test(e)}function WU(e){return YU.test(e)&&!jU.test(e)}const Qg=32,KU=512,Jg=",",eA="=";class us{_internalState=new Map;constructor(t){t&&this._parse(t)}set(t,n){const r=this._clone();return r._internalState.has(t)&&r._internalState.delete(t),r._internalState.set(t,n),r}unset(t){const n=this._clone();return n._internalState.delete(t),n}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,n)=>(t.push(n+eA+this.get(n)),t),[]).join(Jg)}_parse(t){t.length>KU||(this._internalState=t.split(Jg).reverse().reduce((n,r)=>{const o=r.trim(),s=o.indexOf(eA);if(s!==-1){const i=o.slice(0,s),a=o.slice(s+1,r.length);qU(i)&&WU(a)&&n.set(i,a)}return n},new Map),this._internalState.size>Qg&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Qg))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new us;return t._internalState=new Map(this._internalState),t}}const yu="traceparent",Nu="tracestate",zU="00",ZU="(?!ff)[\\da-f]{2}",XU="(?![0]{32})[\\da-f]{32}",QU="(?![0]{16})[\\da-f]{16}",JU="[\\da-f]{2}",ek=new RegExp(`^\\s?(${ZU})-(${XU})-(${QU})-(${JU})(-.*)?\\s?$`);function HP(e){const t=ek.exec(e);return!t||t[1]==="00"&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}}class tk{inject(t,n,r){const o=b.trace.getSpanContext(t);if(!o||Cn(t)||!b.isSpanContextValid(o))return;const s=`${zU}-${o.traceId}-${o.spanId}-0${Number(o.traceFlags||b.TraceFlags.NONE).toString(16)}`;r.set(n,yu,s),o.traceState&&r.set(n,Nu,o.traceState.serialize())}extract(t,n,r){const o=r.get(n,yu);if(!o)return t;const s=Array.isArray(o)?o[0]:o;if(typeof s!="string")return t;const i=HP(s);if(!i)return t;i.isRemote=!0;const a=r.get(n,Nu);if(a){const c=Array.isArray(a)?a.join(","):a;i.traceState=new us(typeof c=="string"?c:void 0)}return b.trace.setSpanContext(t,i)}fields(){return[yu,Nu]}}const tE=b.createContextKey("OpenTelemetry SDK Context Key RPC_METADATA");var ao;(function(e){e.HTTP="http"})(ao||(ao={}));function FP(e,t){return e.setValue(tE,t)}function nk(e){return e.deleteValue(tE)}function Ml(e){return e.getValue(tE)}const rk="[object Object]",ok="[object Null]",sk="[object Undefined]",ik=Function.prototype,YP=ik.toString,ak=YP.call(Object),ck=Object.getPrototypeOf,jP=Object.prototype,qP=jP.hasOwnProperty,no=Symbol?Symbol.toStringTag:void 0,WP=jP.toString;function tA(e){if(!uk(e)||lk(e)!==rk)return!1;const t=ck(e);if(t===null)return!0;const n=qP.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&YP.call(n)===ak}function uk(e){return e!=null&&typeof e=="object"}function lk(e){return e==null?e===void 0?sk:ok:no&&no in Object(e)?dk(e):fk(e)}function dk(e){const t=qP.call(e,no),n=e[no];let r=!1;try{e[no]=void 0,r=!0}catch{}const o=WP.call(e);return r&&(t?e[no]=n:delete e[no]),o}function fk(e){return WP.call(e)}const _k=20;function KP(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=zP(t,e.shift(),0,n);return t}function Ld(e){return Uu(e)?e.slice():e}function zP(e,t,n=0,r){let o;if(!(n>_k)){if(n++,Ou(e)||Ou(t)||ZP(t))o=Ld(t);else if(Uu(e)){if(o=e.slice(),Uu(t))for(let s=0,i=t.length;s<i;s++)o.push(Ld(t[s]));else if(_a(t)){const s=Object.keys(t);for(let i=0,a=s.length;i<a;i++){const c=s[i];o[c]=Ld(t[c])}}}else if(_a(e))if(_a(t)){if(!pk(e,t))return t;o=Object.assign({},e);const s=Object.keys(t);for(let i=0,a=s.length;i<a;i++){const c=s[i],u=t[c];if(Ou(u))typeof u>"u"?delete o[c]:o[c]=u;else{const f=o[c],d=u;if(nA(e,c,r)||nA(t,c,r))delete o[c];else{if(_a(f)&&_a(d)){const l=r.get(f)||[],_=r.get(d)||[];l.push({obj:e,key:c}),_.push({obj:t,key:c}),r.set(f,l),r.set(d,_)}o[c]=zP(o[c],u,n,r)}}}}else o=t;return o}}function nA(e,t,n){const r=n.get(e[t])||[];for(let o=0,s=r.length;o<s;o++){const i=r[o];if(i.key===t&&i.obj===e)return!0}return!1}function Uu(e){return Array.isArray(e)}function ZP(e){return typeof e=="function"}function _a(e){return!Ou(e)&&!Uu(e)&&!ZP(e)&&typeof e=="object"}function Ou(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e>"u"||e instanceof Date||e instanceof RegExp||e===null}function pk(e,t){return!(!tA(e)||!tA(t))}class vl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vl.prototype)}}function hk(e,t){let n;const r=new Promise(function(s,i){n=setTimeout(function(){i(new vl("Operation timed out."))},t)});return Promise.race([e,r]).then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}function XP(e,t){return typeof t=="string"?e===t:!!e.match(t)}function Ek(e,t){if(!t)return!1;for(const n of t)if(XP(e,n))return!0;return!1}class Tk{_promise;_resolve;_reject;constructor(){this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class Sk{_callback;_that;_isCalled=!1;_deferred=new Tk;constructor(t,n){this._callback=t,this._that=n}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(n=>this._deferred.resolve(n),n=>this._deferred.reject(n))}catch(n){this._deferred.reject(n)}}return this._deferred.promise}}const rA={ALL:b.DiagLogLevel.ALL,VERBOSE:b.DiagLogLevel.VERBOSE,DEBUG:b.DiagLogLevel.DEBUG,INFO:b.DiagLogLevel.INFO,WARN:b.DiagLogLevel.WARN,ERROR:b.DiagLogLevel.ERROR,NONE:b.DiagLogLevel.NONE};function mk(e){if(e==null)return;const t=rA[e.toUpperCase()];return t??(b.diag.warn(`Unknown log level "${e}", expected one of ${Object.keys(rA)}, using default`),b.DiagLogLevel.INFO)}function gk(e,t){return new Promise(n=>{b.context.with(io(b.context.active()),()=>{e.export(t,r=>{n(r)})})})}const Ak={_export:gk},Rk=Object.freeze(Object.defineProperty({__proto__:null,AnchoredClock:pU,BindOnceFuture:Sk,CompositePropagator:$U,get ExportResultCode(){return eh},get RPCType(){return ao},SDK_INFO:Ru,TRACE_PARENT_HEADER:yu,TRACE_STATE_HEADER:Nu,TimeoutError:vl,TraceState:us,W3CBaggagePropagator:UP,W3CTraceContextPropagator:tk,_globalThis:RU,addHrTimes:eE,callWithTimeout:hk,deleteRPCMetadata:nk,diagLogLevelFromString:mk,getBooleanFromEnv:gU,getNumberFromEnv:Pt,getRPCMetadata:Ml,getStringFromEnv:Qh,getStringListFromEnv:AU,getTimeOrigin:Il,globalErrorHandler:Xh,hrTime:Jh,hrTimeDuration:BP,hrTimeToMicroseconds:GU,hrTimeToMilliseconds:xU,hrTimeToNanoseconds:kU,hrTimeToTimeStamp:UU,internal:Ak,isAttributeValue:Zh,isTimeInput:Jp,isTimeInputHrTime:Pl,isTracingSuppressed:Cn,isUrlIgnored:Ek,loggingErrorHandler:xP,merge:KP,millisToHrTime:Bn,otperformance:oo,parseKeyPairsIntoRecord:_U,parseTraceParent:HP,sanitizeAttributes:uc,setGlobalErrorHandler:mU,setRPCMetadata:FP,suppressTracing:io,timeInputToHrTime:DU,unrefTimer:VU,unsuppressTracing:iU,urlMatches:XP},Symbol.toStringTag,{value:"Module"})),fn=NP(Rk);var pa={},oA;function yk(){return oA||(oA=1,Object.defineProperty(pa,"__esModule",{value:!0}),pa.VERSION=void 0,pa.VERSION="0.208.0"),pa}class QP{emit(t){}}const Nk=new QP;class Ok{getLogger(t,n,r){return new QP}}const JP=new Ok;class bk{constructor(t,n,r,o){this._provider=t,this.name=n,this.version=r,this.options=o}emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider._getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):Nk}}class sA{getLogger(t,n,r){var o;return(o=this._getDelegateLogger(t,n,r))!==null&&o!==void 0?o:new bk(this,t,n,r)}_getDelegate(){var t;return(t=this._delegate)!==null&&t!==void 0?t:JP}_setDelegate(t){this._delegate=t}_getDelegateLogger(t,n,r){var o;return(o=this._delegate)===null||o===void 0?void 0:o.getLogger(t,n,r)}}const Ck=typeof globalThis=="object"?globalThis:global,jc=Symbol.for("io.opentelemetry.js.api.logs"),ha=Ck;function Ik(e,t,n){return r=>r===e?t:n}const iA=1;class nE{constructor(){this._proxyLoggerProvider=new sA}static getInstance(){return this._instance||(this._instance=new nE),this._instance}setGlobalLoggerProvider(t){return ha[jc]?this.getLoggerProvider():(ha[jc]=Ik(iA,t,JP),this._proxyLoggerProvider._setDelegate(t),t)}getLoggerProvider(){var t,n;return(n=(t=ha[jc])===null||t===void 0?void 0:t.call(ha,iA))!==null&&n!==void 0?n:this._proxyLoggerProvider}getLogger(t,n,r){return this.getLoggerProvider().getLogger(t,n,r)}disable(){delete ha[jc],this._proxyLoggerProvider=new sA}}const eM=nE.getInstance();function Pk(e,t,n,r){for(let o=0,s=e.length;o<s;o++){const i=e[o];t&&i.setTracerProvider(t),n&&i.setMeterProvider(n),r&&i.setLoggerProvider&&i.setLoggerProvider(r),i.getConfig().enabled||i.enable()}}function Mk(e){e.forEach(t=>t.disable())}function wl(e){const t=e.tracerProvider||b.trace.getTracerProvider(),n=e.meterProvider||b.metrics.getMeterProvider(),r=e.loggerProvider||eM.getLoggerProvider(),o=e.instrumentations?.flat()??[];return Pk(o,t,n,r),()=>{Mk(o)}}const tM=/^(?:v)?(?<version>(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*))(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,vk=/^(?<op><|>|=|==|<=|>=|~|\^|~>)?\s*(?:v)?(?<version>(?<major>x|X|\*|0|[1-9]\d*)(?:\.(?<minor>x|X|\*|0|[1-9]\d*))?(?:\.(?<patch>x|X|\*|0|[1-9]\d*))?)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,wk={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]};function Lk(e,t,n){if(!Dk(e))return b.diag.error(`Invalid version: ${e}`),!1;if(!t)return!0;t=t.replace(/([<>=~^]+)\s+/g,"$1");const r=Gk(e);if(!r)return!1;const o=[],s=nM(r,t,o,n);return s&&!n?.includePrerelease?kk(r,o):s}function Dk(e){return typeof e=="string"&&tM.test(e)}function nM(e,t,n,r){if(t.includes("||")){const o=t.trim().split("||");for(const s of o)if(Dd(e,s,n,r))return!0;return!1}else if(t.includes(" - "))t=s1(t,r);else if(t.includes(" ")){const o=t.trim().replace(/\s{2,}/g," ").split(" ");for(const s of o)if(!Dd(e,s,n,r))return!1;return!0}return Dd(e,t,n,r)}function Dd(e,t,n,r){if(t=xk(t,r),t.includes(" "))return nM(e,t,n,r);{const o=Vk(t);return n.push(o),Uk(e,o)}}function Uk(e,t){if(t.invalid)return!1;if(!t.version||nh(t.version))return!0;let n=cA(e.versionSegments||[],t.versionSegments||[]);if(n===0){const r=e.prereleaseSegments||[],o=t.prereleaseSegments||[];!r.length&&!o.length?n=0:!r.length&&o.length?n=1:r.length&&!o.length?n=-1:n=cA(r,o)}return wk[t.op]?.includes(n)}function kk(e,t){return e.prerelease?t.some(n=>n.prerelease&&n.version===e.version):!0}function xk(e,t){return e=e.trim(),e=r1(e,t),e=n1(e),e=o1(e,t),e=e.trim(),e}function Rt(e){return!e||e.toLowerCase()==="x"||e==="*"}function Gk(e){const t=e.match(tM);if(!t){b.diag.error(`Invalid version: ${e}`);return}const n=t.groups.version,r=t.groups.prerelease,o=t.groups.build,s=n.split("."),i=r?.split(".");return{op:void 0,version:n,versionSegments:s,versionSegmentCount:s.length,prerelease:r,prereleaseSegments:i,prereleaseSegmentCount:i?i.length:0,build:o}}function Vk(e){if(!e)return{};const t=e.match(vk);if(!t)return b.diag.error(`Invalid range: ${e}`),{invalid:!0};let n=t.groups.op;const r=t.groups.version,o=t.groups.prerelease,s=t.groups.build,i=r.split("."),a=o?.split(".");return n==="=="&&(n="="),{op:n||"=",version:r,versionSegments:i,versionSegmentCount:i.length,prerelease:o,prereleaseSegments:a,prereleaseSegmentCount:a?a.length:0,build:s}}function nh(e){return e==="*"||e==="x"||e==="X"}function aA(e){const t=parseInt(e,10);return isNaN(t)?e:t}function $k(e,t){if(typeof e==typeof t){if(typeof e=="number")return[e,t];if(typeof e=="string")return[e,t];throw new Error("Version segments can only be strings or numbers")}else return[String(e),String(t)]}function Bk(e,t){if(nh(e)||nh(t))return 0;const[n,r]=$k(aA(e),aA(t));return n>r?1:n<r?-1:0}function cA(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const r=Bk(e[n]||"0",t[n]||"0");if(r!==0)return r}return 0}const rM="[a-zA-Z0-9-]",oM="0|[1-9]\\d*",Hk=`\\d*[a-zA-Z-]${rM}*`,Fk="((?:<|>)?=?)",uA=`(?:${oM}|${Hk})`,Yk=`(?:-(${uA}(?:\\.${uA})*))`,lA=`${rM}+`,jk=`(?:\\+(${lA}(?:\\.${lA})*))`,Ud=`${oM}|x|X|\\*`,mc=`[v=\\s]*(${Ud})(?:\\.(${Ud})(?:\\.(${Ud})(?:${Yk})?${jk}?)?)?`,qk=`^${Fk}\\s*${mc}$`,Wk=new RegExp(qk),Kk=`^\\s*(${mc})\\s+-\\s+(${mc})\\s*$`,zk=new RegExp(Kk),Zk="(?:~>?)",Xk=`^${Zk}${mc}$`,Qk=new RegExp(Xk),Jk="(?:\\^)",e1=`^${Jk}${mc}$`,t1=new RegExp(e1);function n1(e){const t=Qk;return e.replace(t,(n,r,o,s,i)=>{let a;return Rt(r)?a="":Rt(o)?a=`>=${r}.0.0 <${+r+1}.0.0-0`:Rt(s)?a=`>=${r}.${o}.0 <${r}.${+o+1}.0-0`:i?a=`>=${r}.${o}.${s}-${i} <${r}.${+o+1}.0-0`:a=`>=${r}.${o}.${s} <${r}.${+o+1}.0-0`,a})}function r1(e,t){const n=t1,r=t?.includePrerelease?"-0":"";return e.replace(n,(o,s,i,a,c)=>{let u;return Rt(s)?u="":Rt(i)?u=`>=${s}.0.0${r} <${+s+1}.0.0-0`:Rt(a)?s==="0"?u=`>=${s}.${i}.0${r} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.0${r} <${+s+1}.0.0-0`:c?s==="0"?i==="0"?u=`>=${s}.${i}.${a}-${c} <${s}.${i}.${+a+1}-0`:u=`>=${s}.${i}.${a}-${c} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.${a}-${c} <${+s+1}.0.0-0`:s==="0"?i==="0"?u=`>=${s}.${i}.${a}${r} <${s}.${i}.${+a+1}-0`:u=`>=${s}.${i}.${a}${r} <${s}.${+i+1}.0-0`:u=`>=${s}.${i}.${a} <${+s+1}.0.0-0`,u})}function o1(e,t){const n=Wk;return e.replace(n,(r,o,s,i,a,c)=>{const u=Rt(s),f=u||Rt(i),d=f||Rt(a),l=d;return o==="="&&l&&(o=""),c=t?.includePrerelease?"-0":"",u?o===">"||o==="<"?r="<0.0.0-0":r="*":o&&l?(f&&(i=0),a=0,o===">"?(o=">=",f?(s=+s+1,i=0,a=0):(i=+i+1,a=0)):o==="<="&&(o="<",f?s=+s+1:i=+i+1),o==="<"&&(c="-0"),r=`${o+s}.${i}.${a}${c}`):f?r=`>=${s}.0.0${c} <${+s+1}.0.0-0`:d&&(r=`>=${s}.${i}.0${c} <${s}.${+i+1}.0-0`),r})}function s1(e,t){const n=zk;return e.replace(n,(r,o,s,i,a,c,u,f,d,l,_,p)=>(Rt(s)?o="":Rt(i)?o=`>=${s}.0.0${t?.includePrerelease?"-0":""}`:Rt(a)?o=`>=${s}.${i}.0${t?.includePrerelease?"-0":""}`:c?o=`>=${o}`:o=`>=${o}${t?.includePrerelease?"-0":""}`,Rt(d)?f="":Rt(l)?f=`<${+d+1}.0.0-0`:Rt(_)?f=`<${d}.${+l+1}.0-0`:p?f=`<=${d}.${l}.${_}-${p}`:t?.includePrerelease?f=`<${d}.${l}.${+_+1}-0`:f=`<=${f}`,`${o} ${f}`.trim()))}let xt=console.error.bind(console);function Ea(e,t,n){const r=!!e[t]&&Object.prototype.propertyIsEnumerable.call(e,t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}const ku=(e,t,n)=>{if(!e||!e[t]){xt("no original function "+String(t)+" to wrap");return}if(!n){xt("no wrapper function"),xt(new Error().stack);return}const r=e[t];if(typeof r!="function"||typeof n!="function"){xt("original object and wrapper must be functions");return}const o=n(r,t);return Ea(o,"__original",r),Ea(o,"__unwrap",()=>{e[t]===o&&Ea(e,t,r)}),Ea(o,"__wrapped",!0),Ea(e,t,o),o},i1=(e,t,n)=>{if(e)Array.isArray(e)||(e=[e]);else{xt("must provide one or more modules to patch"),xt(new Error().stack);return}if(!(t&&Array.isArray(t))){xt("must provide one or more functions to wrap on modules");return}e.forEach(r=>{t.forEach(o=>{ku(r,o,n)})})},rE=(e,t)=>{if(!e||!e[t]){xt("no function to unwrap."),xt(new Error().stack);return}const n=e[t];if(!n.__unwrap)xt("no original to unwrap to -- has "+String(t)+" already been unwrapped?");else{n.__unwrap();return}},a1=(e,t)=>{if(e)Array.isArray(e)||(e=[e]);else{xt("must provide one or more modules to patch"),xt(new Error().stack);return}if(!(t&&Array.isArray(t))){xt("must provide one or more functions to unwrap on modules");return}e.forEach(n=>{t.forEach(r=>{rE(n,r)})})};class c1{instrumentationName;instrumentationVersion;_config={};_tracer;_meter;_logger;_diag;constructor(t,n,r){this.instrumentationName=t,this.instrumentationVersion=n,this.setConfig(r),this._diag=b.diag.createComponentLogger({namespace:t}),this._tracer=b.trace.getTracer(t,n),this._meter=b.metrics.getMeter(t,n),this._logger=eM.getLogger(t,n),this._updateMetricInstruments()}_wrap=ku;_unwrap=rE;_massWrap=i1;_massUnwrap=a1;get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){const t=this.init()??[];return Array.isArray(t)?t:[t]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config={enabled:!0,...t}}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,n,r,o){if(t)try{t(r,o)}catch(s){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:n},s)}}}var qc={exports:{}},Wc={exports:{}},Kc={exports:{}},kd,dA;function u1(){if(dA)return kd;dA=1;var e=1e3,t=e*60,n=t*60,r=n*24,o=r*7,s=r*365.25;kd=function(f,d){d=d||{};var l=typeof f;if(l==="string"&&f.length>0)return i(f);if(l==="number"&&isFinite(f))return d.long?c(f):a(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function i(f){if(f=String(f),!(f.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(d){var l=parseFloat(d[1]),_=(d[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*r;case"hours":case"hour":case"hrs":case"hr":case"h":return l*n;case"minutes":case"minute":case"mins":case"min":case"m":return l*t;case"seconds":case"second":case"secs":case"sec":case"s":return l*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}function a(f){var d=Math.abs(f);return d>=r?Math.round(f/r)+"d":d>=n?Math.round(f/n)+"h":d>=t?Math.round(f/t)+"m":d>=e?Math.round(f/e)+"s":f+"ms"}function c(f){var d=Math.abs(f);return d>=r?u(f,d,r,"day"):d>=n?u(f,d,n,"hour"):d>=t?u(f,d,t,"minute"):d>=e?u(f,d,e,"second"):f+" ms"}function u(f,d,l,_){var p=d>=l*1.5;return Math.round(f/l)+" "+_+(p?"s":"")}return kd}var xd,fA;function sM(){if(fA)return xd;fA=1;function e(t){r.debug=r,r.default=r,r.coerce=u,r.disable=a,r.enable=s,r.enabled=c,r.humanize=u1(),r.destroy=f,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function n(d){let l=0;for(let _=0;_<d.length;_++)l=(l<<5)-l+d.charCodeAt(_),l|=0;return r.colors[Math.abs(l)%r.colors.length]}r.selectColor=n;function r(d){let l,_=null,p,h;function E(...T){if(!E.enabled)return;const S=E,g=Number(new Date),A=g-(l||g);S.diff=A,S.prev=l,S.curr=g,l=g,T[0]=r.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let R=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(C,I)=>{if(C==="%%")return"%";R++;const w=r.formatters[I];if(typeof w=="function"){const U=T[R];C=w.call(S,U),T.splice(R,1),R--}return C}),r.formatArgs.call(S,T),(S.log||r.log).apply(S,T)}return E.namespace=d,E.useColors=r.useColors(),E.color=r.selectColor(d),E.extend=o,E.destroy=r.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(p!==r.namespaces&&(p=r.namespaces,h=r.enabled(d)),h),set:T=>{_=T}}),typeof r.init=="function"&&r.init(E),E}function o(d,l){const _=r(this.namespace+(typeof l>"u"?":":l)+d);return _.log=this.log,_}function s(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];const l=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const _ of l)_[0]==="-"?r.skips.push(_.slice(1)):r.names.push(_)}function i(d,l){let _=0,p=0,h=-1,E=0;for(;_<d.length;)if(p<l.length&&(l[p]===d[_]||l[p]==="*"))l[p]==="*"?(h=p,E=_,p++):(_++,p++);else if(h!==-1)p=h+1,E++,_=E;else return!1;for(;p<l.length&&l[p]==="*";)p++;return p===l.length}function a(){const d=[...r.names,...r.skips.map(l=>"-"+l)].join(",");return r.enable(""),d}function c(d){for(const l of r.skips)if(i(d,l))return!1;for(const l of r.names)if(i(d,l))return!0;return!1}function u(d){return d instanceof Error?d.stack||d.message:d}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return xd=e,xd}var _A;function l1(){return _A||(_A=1,(function(e,t){t.formatArgs=r,t.save=o,t.load=s,t.useColors=n,t.storage=i(),t.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let f=0,d=0;c[0].replace(/%[a-zA-Z%]/g,l=>{l!=="%%"&&(f++,l==="%c"&&(d=f))}),c.splice(d,0,u)}t.log=console.debug||console.log||(()=>{});function o(c){try{c?t.storage.setItem("debug",c):t.storage.removeItem("debug")}catch{}}function s(){let c;try{c=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function i(){try{return localStorage}catch{}}e.exports=sM()(t);const{formatters:a}=e.exports;a.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Kc,Kc.exports)),Kc.exports}var zc={exports:{}},Gd,pA;function d1(){return pA||(pA=1,Gd=(e,t=process.argv)=>{const n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),o=t.indexOf("--");return r!==-1&&(o===-1||r<o)}),Gd}var Vd,hA;function f1(){if(hA)return Vd;hA=1;const e=yl,t=gP,n=d1(),{env:r}=process;let o;n("no-color")||n("no-colors")||n("color=false")||n("color=never")?o=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(o=1);function s(){if("FORCE_COLOR"in r)return r.FORCE_COLOR==="true"?1:r.FORCE_COLOR==="false"?0:r.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(r.FORCE_COLOR,10),3)}function i(u){return u===0?!1:{level:u,hasBasic:!0,has256:u>=2,has16m:u>=3}}function a(u,{streamIsTTY:f,sniffFlags:d=!0}={}){const l=s();l!==void 0&&(o=l);const _=d?o:l;if(_===0)return 0;if(d){if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2}if(u&&!f&&_===void 0)return 0;const p=_||0;if(r.TERM==="dumb")return p;if(process.platform==="win32"){const h=e.release().split(".");return Number(h[0])>=10&&Number(h[2])>=10586?Number(h[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(h=>h in r)||r.CI_NAME==="codeship"?1:p;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const h=Number.parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return h>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:p}function c(u,f={}){const d=a(u,{streamIsTTY:u&&u.isTTY,...f});return i(d)}return Vd={supportsColor:c,stdout:c({isTTY:t.isatty(1)}),stderr:c({isTTY:t.isatty(2)})},Vd}var EA;function _1(){return EA||(EA=1,(function(e,t){const n=gP,r=ar;t.init=f,t.log=a,t.formatArgs=s,t.save=c,t.load=u,t.useColors=o,t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const l=f1();l&&(l.stderr||l).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}t.inspectOpts=Object.keys(process.env).filter(l=>/^debug_/i.test(l)).reduce((l,_)=>{const p=_.substring(6).toLowerCase().replace(/_([a-z])/g,(E,T)=>T.toUpperCase());let h=process.env[_];return/^(yes|on|true|enabled)$/i.test(h)?h=!0:/^(no|off|false|disabled)$/i.test(h)?h=!1:h==="null"?h=null:h=Number(h),l[p]=h,l},{});function o(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)}function s(l){const{namespace:_,useColors:p}=this;if(p){const h=this.color,E="\x1B[3"+(h<8?h:"8;5;"+h),T=`  ${E};1m${_} \x1B[0m`;l[0]=T+l[0].split(`
`).join(`
`+T),l.push(E+"m+"+e.exports.humanize(this.diff)+"\x1B[0m")}else l[0]=i()+_+" "+l[0]}function i(){return t.inspectOpts.hideDate?"":new Date().toISOString()+" "}function a(...l){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...l)+`
`)}function c(l){l?process.env.DEBUG=l:delete process.env.DEBUG}function u(){return process.env.DEBUG}function f(l){l.inspectOpts={};const _=Object.keys(t.inspectOpts);for(let p=0;p<_.length;p++)l.inspectOpts[_[p]]=t.inspectOpts[_[p]]}e.exports=sM()(t);const{formatters:d}=e.exports;d.o=function(l){return this.inspectOpts.colors=this.useColors,r.inspect(l,this.inspectOpts).split(`
`).map(_=>_.trim()).join(" ")},d.O=function(l){return this.inspectOpts.colors=this.useColors,r.inspect(l,this.inspectOpts)}})(zc,zc.exports)),zc.exports}var TA;function p1(){return TA||(TA=1,typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Wc.exports=l1():Wc.exports=_1()),Wc.exports}var $d,SA;function iM(){if(SA)return $d;SA=1;var e=bn.sep;return $d=function(t){var n=t.split(e),r=n.lastIndexOf("node_modules");if(r!==-1&&n[r+1]){for(var o=n[r+1][0]==="@",s=o?n[r+1]+"/"+n[r+2]:n[r+1],i=o?3:2,a="",c=r+i-1,u=0;u<=c;u++)u===c?a+=n[u]:a+=n[u]+e;for(var f="",d=n.length-1,l=r+i;l<=d;l++)l===d?f+=n[l]:f+=n[l]+e;return{name:s,basedir:a,path:f}}},$d}var mA;function h1(){if(mA)return qc.exports;mA=1;const e=bn,t=mP,n=p1()("require-in-the-middle"),r=iM();qc.exports=c,qc.exports.Hook=c;let o,s;if(t.isBuiltin)s=t.isBuiltin;else if(t.builtinModules)s=f=>f.startsWith("node:")?!0:(o===void 0&&(o=new Set(t.builtinModules)),o.has(f));else throw new Error("'require-in-the-middle' requires Node.js >=v9.3.0 or >=v8.10.0");const i=/([/\\]index)?(\.js)?$/;class a{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(d,l){if(this._localCache.has(d))return!0;if(l)return!1;{const _=require.cache[d];return!!(_&&this._kRitmExports in _)}}get(d,l){const _=this._localCache.get(d);if(_!==void 0)return _;if(!l){const p=require.cache[d];return p&&p[this._kRitmExports]}}set(d,l,_){_?this._localCache.set(d,l):d in require.cache?require.cache[d][this._kRitmExports]=l:(n('non-core module is unexpectedly not in require.cache: "%s"',d),this._localCache.set(d,l))}}function c(f,d,l){if(!(this instanceof c))return new c(f,d,l);if(typeof f=="function"?(l=f,f=null,d=null):typeof d=="function"&&(l=d,d=null),typeof t._resolveFilename!="function"){console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof t._resolveFilename),console.error("Please report this error as an issue related to Node.js %s at https://github.com/nodejs/require-in-the-middle/issues",process.version);return}this._cache=new a,this._unhooked=!1,this._origRequire=t.prototype.require;const _=this,p=new Set,h=d?d.internals===!0:!1,E=Array.isArray(f);n("registering require hook"),this._require=t.prototype.require=function(S){return _._unhooked===!0?(n("ignoring require call - module is soft-unhooked"),_._origRequire.apply(this,arguments)):T.call(this,arguments,!1)},typeof process.getBuiltinModule=="function"&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(S){return _._unhooked===!0?(n("ignoring process.getBuiltinModule call - module is soft-unhooked"),_._origGetBuiltinModule.apply(this,arguments)):T.call(this,arguments,!0)});function T(S,g){const A=S[0],R=s(A);let O;if(R){if(O=A,A.startsWith("node:")){const F=A.slice(5);s(F)&&(O=F)}}else{if(g)return n("call to process.getBuiltinModule with unknown built-in id"),_._origGetBuiltinModule.apply(this,S);try{O=t._resolveFilename(A,this)}catch(F){return n('Module._resolveFilename("%s") threw %j, calling original Module.require',A,F.message),_._origRequire.apply(this,S)}}let C,I;if(n("processing %s module require('%s'): %s",R===!0?"core":"non-core",A,O),_._cache.has(O,R)===!0)return n("returning already patched cached module: %s",O),_._cache.get(O,R);const w=p.has(O);w===!1&&p.add(O);const U=g?_._origGetBuiltinModule.apply(this,S):_._origRequire.apply(this,S);if(w===!0)return n("module is in the process of being patched already - ignoring: %s",O),U;if(p.delete(O),R===!0){if(E===!0&&f.includes(O)===!1)return n("ignoring core module not on whitelist: %s",O),U;C=O}else if(E===!0&&f.includes(O)){const F=e.parse(O);C=F.name,I=F.dir}else{const F=r(O);if(F===void 0)return n("could not parse filename: %s",O),U;C=F.name,I=F.basedir;const G=u(F);n("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",C,A,G,I);let x=!1;if(E){if(!A.startsWith(".")&&f.includes(A)&&(C=A,x=!0),!f.includes(C)&&!f.includes(G))return U;f.includes(G)&&G!==C&&(C=G,x=!0)}if(!x){let Y;try{Y=require.resolve(C,{paths:[I]})}catch{return n("could not resolve module: %s",C),_._cache.set(O,U,R),U}if(Y!==O)if(h===!0)C=C+e.sep+e.relative(I,O),n("preparing to process require of internal file: %s",C);else return n("ignoring require of non-main module file: %s",Y),_._cache.set(O,U,R),U}}_._cache.set(O,U,R),n("calling require hook: %s",C);const B=l(U,C,I);return _._cache.set(O,B,R),n("returning module: %s",C),B}}c.prototype.unhook=function(){this._unhooked=!0,this._require===t.prototype.require?(t.prototype.require=this._origRequire,n("require unhook successful")):n("require unhook unsuccessful"),process.getBuiltinModule!==void 0&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,n("process.getBuiltinModule unhook successful")):n("process.getBuiltinModule unhook unsuccessful"))};function u(f){const d=e.sep!=="/"?f.path.split(e.sep).join("/"):f.path;return e.posix.join(f.name,d).replace(i,"")}return qc.exports}var aM=h1();const xu="/";class gA{hooks=[];children=new Map}class E1{_trie=new gA;_counter=0;insert(t){let n=this._trie;for(const r of t.moduleName.split(xu)){let o=n.children.get(r);o||(o=new gA,n.children.set(r,o)),n=o}n.hooks.push({hook:t,insertedId:this._counter++})}search(t,{maintainInsertionOrder:n,fullOnly:r}={}){let o=this._trie;const s=[];let i=!0;for(const a of t.split(xu)){const c=o.children.get(a);if(!c){i=!1;break}r||s.push(...c.hooks),o=c}return r&&i&&s.push(...o.hooks),s.length===0?[]:s.length===1?[s[0].hook]:(n&&s.sort((a,c)=>a.insertedId-c.insertedId),s.map(({hook:a})=>a))}}const T1=["afterEach","after","beforeEach","before","describe","it"].every(e=>typeof global[e]=="function");class Gu{_moduleNameTrie=new E1;static _instance;constructor(){this._initialize()}_initialize(){new aM.Hook(null,{internals:!0},(t,n,r)=>{const o=S1(n),s=this._moduleNameTrie.search(o,{maintainInsertionOrder:!0,fullOnly:r===void 0});for(const{onRequire:i}of s)t=i(t,n,r);return t})}register(t,n){const r={moduleName:t,onRequire:n};return this._moduleNameTrie.insert(r),r}static getInstance(){return T1?new Gu:this._instance=this._instance??new Gu}}function S1(e){return to.sep!==xu?e.split(to.sep).join(xu):e}var br={exports:{}},Xn={},AA;function m1(){if(AA)return Xn;AA=1;const e=[],t=new WeakMap,n=new WeakMap,r=new Map,o=[],s={set(f,d,l){return t.get(f)[d](l)},get(f,d){if(d===Symbol.toStringTag)return"Module";const l=n.get(f)[d];if(typeof l=="function")return l()},defineProperty(f,d,l){if(!("value"in l))throw new Error("Getters/setters are not supported for exports property descriptors.");return t.get(f)[d](l.value)}};function i(f,d,l,_,p){r.set(f,p),t.set(d,l),n.set(d,_);const h=new Proxy(d,s);e.forEach(E=>E(f,h)),o.push([f,h])}let a=!1;function c(){return a}function u(f){a=f}return Xn.register=i,Xn.importHooks=e,Xn.specifiers=r,Xn.toHook=o,Xn.getExperimentalPatchInternals=c,Xn.setExperimentalPatchInternals=u,Xn}var RA;function g1(){if(RA)return br.exports;RA=1;const e=bn,t=iM(),{fileURLToPath:n}=Nl,{MessageChannel:r}=Xp,{importHooks:o,specifiers:s,toHook:i,getExperimentalPatchInternals:a}=m1();function c(p){o.push(p),i.forEach(([h,E])=>p(h,E))}function u(p){const h=o.indexOf(p);h>-1&&o.splice(h,1)}function f(p,h,E,T){const S=p(h,E,T);S&&S!==h&&(h.default=S)}let d;function l(){const{port1:p,port2:h}=new r;let E=0,T;d=R=>{E++,p.postMessage(R)},p.on("message",()=>{E--,T&&E<=0&&T()}).unref();function S(){const R=setInterval(()=>{},1e3),O=new Promise(C=>{T=C}).then(()=>{clearInterval(R)});return E===0&&T(),O}const g=h;return{registerOptions:{data:{addHookMessagePort:g,include:[]},transferList:[g]},addHookMessagePort:g,waitForAllMessagesAcknowledged:S}}function _(p,h,E){if(!(this instanceof _))return new _(p,h,E);typeof p=="function"?(E=p,p=null,h=null):typeof h=="function"&&(E=h,h=null);const T=h?h.internals===!0:!1;d&&Array.isArray(p)&&d(p),this._iitmHook=(S,g)=>{const A=S,R=S.startsWith("node:");let O;if(R)S=S.replace(/^node:/,"");else{if(S.startsWith("file://"))try{S=n(S)}catch{}const C=t(S);C&&(S=C.name,O=C.basedir)}if(p){for(const C of p)if(C===S){if(O){if(T)S=S+e.sep+e.relative(O,n(A));else if(!a()&&!O.endsWith(s.get(A)))continue}f(E,g,S,O)}}else f(E,g,S,O)},c(this._iitmHook)}return _.prototype.unhook=function(){u(this._iitmHook)},br.exports=_,br.exports.Hook=_,br.exports.addHook=c,br.exports.removeHook=u,br.exports.createAddHookMessageChannel=l,br.exports}var cM=g1();function cr(e,t,n){let r,o;try{o=e()}catch(s){r=s}finally{if(t(r,o),r&&!n)throw r;return o}}async function A1(e,t,n){let r,o;try{o=await e()}catch(s){r=s}finally{if(await t(r,o),r&&!n)throw r;return o}}function Ll(e){return typeof e=="function"&&typeof e.__original=="function"&&typeof e.__unwrap=="function"&&e.__wrapped===!0}class bt extends c1{_modules;_hooks=[];_requireInTheMiddleSingleton=Gu.getInstance();_enabled=!1;constructor(t,n,r){super(t,n,r);let o=this.init();o&&!Array.isArray(o)&&(o=[o]),this._modules=o||[],this._config.enabled&&this.enable()}_wrap=(t,n,r)=>{if(Ll(t[n])&&this._unwrap(t,n),ar.types.isProxy(t)){const o=ku(Object.assign({},t),n,r);return Object.defineProperty(t,n,{value:o}),o}else return ku(t,n,r)};_unwrap=(t,n)=>ar.types.isProxy(t)?Object.defineProperty(t,n,{value:t[n]}):rE(t,n);_massWrap=(t,n,r)=>{if(t)Array.isArray(t)||(t=[t]);else{b.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){b.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(o=>{n.forEach(s=>{this._wrap(o,s,r)})})};_massUnwrap=(t,n)=>{if(t)Array.isArray(t)||(t=[t]);else{b.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){b.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(r=>{n.forEach(o=>{this._unwrap(r,o)})})};_warnOnPreloadedModules(){this._modules.forEach(t=>{const{name:n}=t;try{const r=require.resolve(n);require.cache[r]&&this._diag.warn(`Module ${n} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${n}`)}catch{}})}_extractPackageVersion(t){try{const n=Rl.readFileSync(to.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return typeof r=="string"?r:void 0}catch{b.diag.warn("Failed extracting version",t)}}_onRequire(t,n,r,o){if(!o)return typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:t.name}),t.patch(n)):n;const s=this._extractPackageVersion(o);if(t.moduleVersion=s,t.name===r)return yA(t.supportedVersions,s,t.includePrerelease)&&typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:t.name,version:t.moduleVersion,baseDir:o}),t.patch(n,t.moduleVersion)):n;const i=t.files??[],a=to.normalize(r);return i.filter(u=>u.name===a).filter(u=>yA(u.supportedVersions,s,t.includePrerelease)).reduce((u,f)=>(f.moduleExports=u,this._enabled?(this._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:t.name,version:t.moduleVersion,fileName:f.name,baseDir:o}),f.patch(u,t.moduleVersion)):u),n)}enable(){if(!this._enabled){if(this._enabled=!0,this._hooks.length>0){for(const t of this._modules){typeof t.patch=="function"&&t.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:t.name,version:t.moduleVersion}),t.patch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.patch(n.moduleExports,t.moduleVersion))}return}this._warnOnPreloadedModules();for(const t of this._modules){const n=(i,a,c)=>{if(!c&&to.isAbsolute(a)){const u=to.parse(a);a=u.name,c=u.dir}return this._onRequire(t,i,a,c)},r=(i,a,c)=>this._onRequire(t,i,a,c),o=to.isAbsolute(t.name)?new aM.Hook([t.name],{internals:!0},r):this._requireInTheMiddleSingleton.register(t.name,r);this._hooks.push(o);const s=new cM.Hook([t.name],{internals:!1},n);this._hooks.push(s)}}}disable(){if(this._enabled){this._enabled=!1;for(const t of this._modules){typeof t.unpatch=="function"&&t.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:t.name,version:t.moduleVersion}),t.unpatch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.unpatch(n.moduleExports,t.moduleVersion))}}}isEnabled(){return this._enabled}}function yA(e,t,n){return typeof t>"u"?e.includes("*"):e.some(r=>Lk(t,r,{includePrerelease:n}))}class ft{name;supportedVersions;patch;unpatch;files;constructor(t,n,r,o,s){this.name=t,this.supportedVersions=n,this.patch=r,this.unpatch=o,this.files=s||[]}}class qn{supportedVersions;patch;unpatch;name;constructor(t,n,r,o){this.supportedVersions=n,this.patch=r,this.unpatch=o,this.name=bn.normalize(t)}}var qo;(function(e){e[e.STABLE=1]="STABLE",e[e.OLD=2]="OLD",e[e.DUPLICATE=3]="DUPLICATE"})(qo||(qo={}));function R1(e,t){let n=qo.OLD;const r=t?.split(",").map(o=>o.trim()).filter(o=>o!=="");for(const o of r??[])if(o.toLowerCase()===e+"/dup"){n=qo.DUPLICATE;break}else o.toLowerCase()===e&&(n=qo.STABLE);return n}const y1=Object.freeze(Object.defineProperty({__proto__:null,InstrumentationBase:bt,InstrumentationNodeModuleDefinition:ft,InstrumentationNodeModuleFile:qn,get SemconvStability(){return qo},isWrapped:Ll,registerInstrumentations:wl,safeExecuteInTheMiddle:cr,safeExecuteInTheMiddleAsync:A1,semconvStabilityFromStr:R1},Symbol.toStringTag,{value:"Module"})),Le=NP(y1);var Bd={},ae={},NA;function N1(){return NA||(NA=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.HTTP_FLAVOR_VALUE_HTTP_1_1=ae.NET_TRANSPORT_VALUE_IP_UDP=ae.NET_TRANSPORT_VALUE_IP_TCP=ae.ATTR_NET_TRANSPORT=ae.ATTR_NET_PEER_PORT=ae.ATTR_NET_PEER_NAME=ae.ATTR_NET_PEER_IP=ae.ATTR_NET_HOST_PORT=ae.ATTR_NET_HOST_NAME=ae.ATTR_NET_HOST_IP=ae.ATTR_HTTP_USER_AGENT=ae.ATTR_HTTP_URL=ae.ATTR_HTTP_TARGET=ae.ATTR_HTTP_STATUS_CODE=ae.ATTR_HTTP_SERVER_NAME=ae.ATTR_HTTP_SCHEME=ae.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=ae.ATTR_HTTP_RESPONSE_CONTENT_LENGTH=ae.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=ae.ATTR_HTTP_REQUEST_CONTENT_LENGTH=ae.ATTR_HTTP_METHOD=ae.ATTR_HTTP_HOST=ae.ATTR_HTTP_FLAVOR=ae.ATTR_HTTP_CLIENT_IP=ae.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST=ae.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT=ae.ATTR_USER_AGENT_SYNTHETIC_TYPE=void 0,ae.ATTR_USER_AGENT_SYNTHETIC_TYPE="user_agent.synthetic.type",ae.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT="bot",ae.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST="test",ae.ATTR_HTTP_CLIENT_IP="http.client_ip",ae.ATTR_HTTP_FLAVOR="http.flavor",ae.ATTR_HTTP_HOST="http.host",ae.ATTR_HTTP_METHOD="http.method",ae.ATTR_HTTP_REQUEST_CONTENT_LENGTH="http.request_content_length",ae.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED="http.request_content_length_uncompressed",ae.ATTR_HTTP_RESPONSE_CONTENT_LENGTH="http.response_content_length",ae.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED="http.response_content_length_uncompressed",ae.ATTR_HTTP_SCHEME="http.scheme",ae.ATTR_HTTP_SERVER_NAME="http.server_name",ae.ATTR_HTTP_STATUS_CODE="http.status_code",ae.ATTR_HTTP_TARGET="http.target",ae.ATTR_HTTP_URL="http.url",ae.ATTR_HTTP_USER_AGENT="http.user_agent",ae.ATTR_NET_HOST_IP="net.host.ip",ae.ATTR_NET_HOST_NAME="net.host.name",ae.ATTR_NET_HOST_PORT="net.host.port",ae.ATTR_NET_PEER_IP="net.peer.ip",ae.ATTR_NET_PEER_NAME="net.peer.name",ae.ATTR_NET_PEER_PORT="net.peer.port",ae.ATTR_NET_TRANSPORT="net.transport",ae.NET_TRANSPORT_VALUE_IP_TCP="ip_tcp",ae.NET_TRANSPORT_VALUE_IP_UDP="ip_udp",ae.HTTP_FLAVOR_VALUE_HTTP_1_1="1.1"),ae}var Hd={},OA;function O1(){return OA||(OA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HTTP_ERROR_NAME="http.error_name",t.HTTP_ERROR_MESSAGE="http.error_message",t.HTTP_STATUS_TEXT="http.status_text"})(e.AttributeNames||(e.AttributeNames={}))})(Hd)),Hd}var tn={},bA;function CA(){return bA||(bA=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.DEFAULT_QUERY_STRINGS_TO_REDACT=tn.STR_REDACTED=tn.SYNTHETIC_BOT_NAMES=tn.SYNTHETIC_TEST_NAMES=void 0,tn.SYNTHETIC_TEST_NAMES=["alwayson"],tn.SYNTHETIC_BOT_NAMES=["googlebot","bingbot"],tn.STR_REDACTED="REDACTED",tn.DEFAULT_QUERY_STRINGS_TO_REDACT=["sig","Signature","AWSAccessKeyId","X-Goog-Signature"]),tn}var Fd,IA;function b1(){if(IA)return Fd;IA=1;var e=ar;function t(n,r){Error.captureStackTrace(this,t),this.name=this.constructor.name,this.message=n,this.input=r}return e.inherits(t,Error),Fd=t,Fd}var Yd,PA;function C1(){if(PA)return Yd;PA=1;function e(o){return o===34||o===40||o===41||o===44||o===47||o>=58&&o<=64||o>=91&&o<=93||o===123||o===125}function t(o){return o===33||o>=35&&o<=39||o===42||o===43||o===45||o===46||o>=48&&o<=57||o>=65&&o<=90||o>=94&&o<=122||o===124||o===126}function n(o){return o>=32&&o<=126}function r(o){return o>=128&&o<=255}return Yd={isDelimiter:e,isTokenChar:t,isExtended:r,isPrint:n},Yd}var jd,MA;function I1(){if(MA)return jd;MA=1;var e=ar,t=b1(),n=C1(),r=n.isDelimiter,o=n.isTokenChar,s=n.isExtended,i=n.isPrint;function a(f){return f.replace(/\\(.)/g,"$1")}function c(f,d){return e.format("Unexpected character '%s' at index %d",f.charAt(d),d)}function u(f){for(var d=!1,l=!1,_=!1,p={},h=[],E=-1,T=-1,S,g,A=0;A<f.length;A++)if(g=f.charCodeAt(A),S===void 0){if(A!==0&&E===-1&&(g===32||g===9))continue;if(o(g))E===-1&&(E=A);else if(g===61&&E!==-1)S=f.slice(E,A).toLowerCase(),E=-1;else throw new t(c(f,A),f)}else if(l&&(g===9||i(g)||s(g)))l=!1;else if(o(g)){if(T!==-1)throw new t(c(f,A),f);E===-1&&(E=A)}else if(r(g)||s(g))if(_)g===34?(_=!1,T=A):g===92?(E===-1&&(E=A),l=d=!0):E===-1&&(E=A);else if(g===34&&f.charCodeAt(A-1)===61)_=!0;else if((g===44||g===59)&&(E!==-1||T!==-1))E!==-1?(T===-1&&(T=A),p[S]=d?a(f.slice(E,T)):f.slice(E,T)):p[S]="",g===44&&(h.push(p),p={}),S=void 0,E=T=-1;else throw new t(c(f,A),f);else if(g===32||g===9){if(T!==-1)continue;if(_)E===-1&&(E=A);else if(E!==-1)T=A;else throw new t(c(f,A),f)}else throw new t(c(f,A),f);if(S===void 0||_||E===-1&&T===-1||g===32||g===9)throw new t("Unexpected end of input",f);return E!==-1?(T===-1&&(T=A),p[S]=d?a(f.slice(E,T)):f.slice(E,T)):p[S]="",h.push(p),h}return jd=u,jd}var vA;function P1(){return vA||(vA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.headerCapture=e.getIncomingStableRequestMetricAttributesOnResponse=e.getIncomingRequestMetricAttributesOnResponse=e.getIncomingRequestAttributesOnResponse=e.getIncomingRequestMetricAttributes=e.getIncomingRequestAttributes=e.getRemoteClientAddress=e.getOutgoingStableRequestMetricAttributesOnResponse=e.getOutgoingRequestMetricAttributesOnResponse=e.getOutgoingRequestAttributesOnResponse=e.setAttributesFromHttpKind=e.getOutgoingRequestMetricAttributes=e.getOutgoingRequestAttributes=e.extractHostnameAndPort=e.isValidOptionsType=e.getRequestInfo=e.isCompressed=e.setResponseContentLengthAttribute=e.setRequestContentLengthAttribute=e.setSpanWithError=e.satisfiesPattern=e.parseResponseStatus=e.getAbsoluteUrl=void 0;const t=Pe(),n=pt(),r=N1(),o=fn,s=Le,i=Nl,a=O1(),c=CA(),u=CA(),f=I1(),d=(D,k,z="http:",q=Array.from(u.DEFAULT_QUERY_STRINGS_TO_REDACT))=>{const ee=D||{},re=ee.protocol||z,_e=(ee.port||"").toString();let ie=ee.path||"/",le=ee.host||ee.hostname||k.host||"localhost";if(le.indexOf(":")===-1&&_e&&_e!=="80"&&_e!=="443"&&(le+=`:${_e}`),ie.includes("?")){const ve=i.parse(ie),De=ve.pathname||"",qe=ve.query||"",wt=new URLSearchParams(qe),at=q||[];for(const rt of at)wt.has(rt)&&wt.get(rt)!==""&&wt.set(rt,u.STR_REDACTED);const ct=wt.toString();ie=`${De}?${ct}`}const Se=ee.auth?`${u.STR_REDACTED}:${u.STR_REDACTED}@`:"";return`${re}//${Se}${le}${ie}`};e.getAbsoluteUrl=d;const l=(D,k)=>{const z=D===t.SpanKind.CLIENT?400:500;return k&&k>=100&&k<z?t.SpanStatusCode.UNSET:t.SpanStatusCode.ERROR};e.parseResponseStatus=l;const _=(D,k)=>{if(typeof k=="string")return k===D;if(k instanceof RegExp)return k.test(D);if(typeof k=="function")return k(D);throw new TypeError("Pattern is in unsupported datatype")};e.satisfiesPattern=_;const p=(D,k,z)=>{const q=k.message;z&s.SemconvStability.OLD&&(D.setAttribute(a.AttributeNames.HTTP_ERROR_NAME,k.name),D.setAttribute(a.AttributeNames.HTTP_ERROR_MESSAGE,q)),z&s.SemconvStability.STABLE&&D.setAttribute(n.ATTR_ERROR_TYPE,k.name),D.setStatus({code:t.SpanStatusCode.ERROR,message:q}),D.recordException(k)};e.setSpanWithError=p;const h=(D,k)=>{const z=T(D.headers);z!==null&&((0,e.isCompressed)(D.headers)?k[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH]=z:k[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED]=z)};e.setRequestContentLengthAttribute=h;const E=(D,k)=>{const z=T(D.headers);z!==null&&((0,e.isCompressed)(D.headers)?k[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH]=z:k[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED]=z)};e.setResponseContentLengthAttribute=E;function T(D){const k=D["content-length"];if(k===void 0)return null;const z=parseInt(k,10);return isNaN(z)?null:z}const S=D=>{const k=D["content-encoding"];return!!k&&k!=="identity"};e.isCompressed=S;function g(D){const{hostname:k,pathname:z,port:q,username:ee,password:re,search:_e,protocol:ie,hash:le,href:Se,origin:ve,host:De}=new URL(D),qe={protocol:ie,hostname:k&&k[0]==="["?k.slice(1,-1):k,hash:le,search:_e,pathname:z,path:`${z||""}${_e||""}`,href:Se,origin:ve,host:De};return q!==""&&(qe.port=Number(q)),(ee||re)&&(qe.auth=`${decodeURIComponent(ee)}:${decodeURIComponent(re)}`),qe}const A=(D,k,z)=>{let q,ee,re,_e=!1;if(typeof k=="string"){try{const le=g(k);re=le,q=le.pathname||"/"}catch(le){_e=!0,D.verbose("Unable to parse URL provided to HTTP request, using fallback to determine path. Original error:",le),re={path:k},q=re.path||"/"}ee=`${re.protocol||"http:"}//${re.host}`,z!==void 0&&Object.assign(re,z)}else if(k instanceof i.URL)re={protocol:k.protocol,hostname:typeof k.hostname=="string"&&k.hostname.startsWith("[")?k.hostname.slice(1,-1):k.hostname,path:`${k.pathname||""}${k.search||""}`},k.port!==""&&(re.port=Number(k.port)),(k.username||k.password)&&(re.auth=`${k.username}:${k.password}`),q=k.pathname,ee=k.origin,z!==void 0&&Object.assign(re,z);else{re=Object.assign({protocol:k.host?"http:":void 0},k);const le=re.host||(re.port!=null?`${re.hostname}${re.port}`:re.hostname);if(ee=`${re.protocol||"http:"}//${le}`,q=k.pathname,!q&&re.path)try{q=new URL(re.path,ee).pathname||"/"}catch{q="/"}}const ie=re.method?re.method.toUpperCase():"GET";return{origin:ee,pathname:q,method:ie,optionsParsed:re,invalidUrl:_e}};e.getRequestInfo=A;const R=D=>{if(!D)return!1;const k=typeof D;return k==="string"||k==="object"&&!Array.isArray(D)};e.isValidOptionsType=R;const O=D=>{if(D.hostname&&D.port)return{hostname:D.hostname,port:D.port};const k=D.host?.match(/^([^:/ ]+)(:\d{1,5})?/)||null,z=D.hostname||(k===null?"localhost":k[1]);let q=D.port;return q||(k&&k[2]?q=k[2].substring(1):q=D.protocol==="https:"?"443":"80"),{hostname:z,port:q}};e.extractHostnameAndPort=O;const C=(D,k,z,q)=>{const ee=k.hostname,re=k.port,_e=D.method??"GET",ie=K(_e),le=D.headers||{},Se=le["user-agent"],ve=(0,e.getAbsoluteUrl)(D,le,`${k.component}:`,k.redactedQueryParams),De={[r.ATTR_HTTP_URL]:ve,[r.ATTR_HTTP_METHOD]:_e,[r.ATTR_HTTP_TARGET]:D.path||"/",[r.ATTR_NET_PEER_NAME]:ee,[r.ATTR_HTTP_HOST]:le.host??`${ee}:${re}`},qe={[n.ATTR_HTTP_REQUEST_METHOD]:ie,[n.ATTR_SERVER_ADDRESS]:ee,[n.ATTR_SERVER_PORT]:Number(re),[n.ATTR_URL_FULL]:ve,[n.ATTR_USER_AGENT_ORIGINAL]:Se};switch(_e!==ie&&(qe[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=_e),q&&Se&&(qe[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=U(Se)),Se!==void 0&&(De[r.ATTR_HTTP_USER_AGENT]=Se),z){case s.SemconvStability.STABLE:return Object.assign(qe,k.hookAttributes);case s.SemconvStability.OLD:return Object.assign(De,k.hookAttributes)}return Object.assign(De,qe,k.hookAttributes)};e.getOutgoingRequestAttributes=C;const I=D=>{const k={};return k[r.ATTR_HTTP_METHOD]=D[r.ATTR_HTTP_METHOD],k[r.ATTR_NET_PEER_NAME]=D[r.ATTR_NET_PEER_NAME],k};e.getOutgoingRequestMetricAttributes=I;const w=(D,k)=>{D&&(k[r.ATTR_HTTP_FLAVOR]=D,D.toUpperCase()!=="QUIC"?k[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_TCP:k[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_UDP)};e.setAttributesFromHttpKind=w;const U=D=>{const k=String(D).toLowerCase();for(const z of c.SYNTHETIC_TEST_NAMES)if(k.includes(z))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST;for(const z of c.SYNTHETIC_BOT_NAMES)if(k.includes(z))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT},B=(D,k)=>{const{statusCode:z,statusMessage:q,httpVersion:ee,socket:re}=D,_e={},ie={};if(z!=null&&(ie[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=z),re){const{remoteAddress:le,remotePort:Se}=re;_e[r.ATTR_NET_PEER_IP]=le,_e[r.ATTR_NET_PEER_PORT]=Se,ie[n.ATTR_NETWORK_PEER_ADDRESS]=le,ie[n.ATTR_NETWORK_PEER_PORT]=Se,ie[n.ATTR_NETWORK_PROTOCOL_VERSION]=D.httpVersion}switch((0,e.setResponseContentLengthAttribute)(D,_e),z&&(_e[r.ATTR_HTTP_STATUS_CODE]=z,_e[a.AttributeNames.HTTP_STATUS_TEXT]=(q||"").toUpperCase()),(0,e.setAttributesFromHttpKind)(ee,_e),k){case s.SemconvStability.STABLE:return ie;case s.SemconvStability.OLD:return _e}return Object.assign(_e,ie)};e.getOutgoingRequestAttributesOnResponse=B;const F=D=>{const k={};return k[r.ATTR_NET_PEER_PORT]=D[r.ATTR_NET_PEER_PORT],k[r.ATTR_HTTP_STATUS_CODE]=D[r.ATTR_HTTP_STATUS_CODE],k[r.ATTR_HTTP_FLAVOR]=D[r.ATTR_HTTP_FLAVOR],k};e.getOutgoingRequestMetricAttributesOnResponse=F;const G=D=>{const k={};return D[n.ATTR_NETWORK_PROTOCOL_VERSION]&&(k[n.ATTR_NETWORK_PROTOCOL_VERSION]=D[n.ATTR_NETWORK_PROTOCOL_VERSION]),D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(k[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),k};e.getOutgoingStableRequestMetricAttributesOnResponse=G;function x(D,k){const z=D.split(":");if(z.length===1)return k==="http"?{host:z[0],port:"80"}:k==="https"?{host:z[0],port:"443"}:{host:z[0]};if(z.length===2)return{host:z[0],port:z[1]};if(z[0].startsWith("[")){if(z[z.length-1].endsWith("]")){if(k==="http")return{host:D,port:"80"};if(k==="https")return{host:D,port:"443"}}else if(z[z.length-2].endsWith("]"))return{host:z.slice(0,-1).join(":"),port:z[z.length-1]}}return{host:D}}function Y(D,k){const z=D.headers.forwarded;if(z){for(const re of X(z))if(re.host)return x(re.host,re.proto)}const q=D.headers["x-forwarded-host"];if(typeof q=="string")return typeof D.headers["x-forwarded-proto"]=="string"?x(q,D.headers["x-forwarded-proto"]):Array.isArray(D.headers["x-forwarded-proto"])?x(q,D.headers["x-forwarded-proto"][0]):x(q);if(Array.isArray(q)&&typeof q[0]=="string"&&q[0].length>0)return typeof D.headers["x-forwarded-proto"]=="string"?x(q[0],D.headers["x-forwarded-proto"]):Array.isArray(D.headers["x-forwarded-proto"])?x(q[0],D.headers["x-forwarded-proto"][0]):x(q[0]);const ee=D.headers.host;return typeof ee=="string"&&ee.length>0?x(ee,k):null}function v(D){const k=D.headers.forwarded;if(k){for(const ee of X(k))if(ee.for)return P(ee.for)}const z=D.headers["x-forwarded-for"];if(z){let ee;if(typeof z=="string"?ee=z:Array.isArray(z)&&(ee=z[0]),typeof ee=="string")return ee=ee.split(",")[0].trim(),P(ee)}const q=D.socket.remoteAddress;return q||null}e.getRemoteClientAddress=v;function P(D){try{const{hostname:k}=new URL(`http://${D}`);return k.startsWith("[")&&k.endsWith("]")?k.slice(1,-1):k}catch{return D}}function H(D,k,z){try{if(k.headers.host)return new URL(k.url??"/",`${D}://${k.headers.host}`);{const q=new URL(k.url??"/",`${D}://localhost`);return{pathname:q.pathname,search:q.search,toString:function(){return q.pathname+q.search}}}}catch(q){return z.verbose("Unable to get URL from request",q),{}}}const J=(D,k,z)=>{const q=D.headers,ee=q["user-agent"],re=q["x-forwarded-for"],_e=D.httpVersion,ie=q.host,le=ie?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",Se=D.method,ve=K(Se),De=Y(D,k.component),qe=k.serverName,wt=v(D),at={[n.ATTR_HTTP_REQUEST_METHOD]:ve,[n.ATTR_URL_SCHEME]:k.component,[n.ATTR_SERVER_ADDRESS]:De?.host,[n.ATTR_NETWORK_PEER_ADDRESS]:D.socket.remoteAddress,[n.ATTR_NETWORK_PEER_PORT]:D.socket.remotePort,[n.ATTR_NETWORK_PROTOCOL_VERSION]:D.httpVersion,[n.ATTR_USER_AGENT_ORIGINAL]:ee},ct=H(k.component,D,z);ct?.pathname!=null&&(at[n.ATTR_URL_PATH]=ct.pathname),ct.search&&(at[n.ATTR_URL_QUERY]=ct.search.slice(1)),wt!=null&&(at[n.ATTR_CLIENT_ADDRESS]=wt),De?.port!=null&&(at[n.ATTR_SERVER_PORT]=Number(De.port)),Se!==ve&&(at[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=Se),k.enableSyntheticSourceDetection&&ee&&(at[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=U(ee));const rt={[r.ATTR_HTTP_URL]:ct.toString(),[r.ATTR_HTTP_HOST]:ie,[r.ATTR_NET_HOST_NAME]:le,[r.ATTR_HTTP_METHOD]:Se,[r.ATTR_HTTP_SCHEME]:k.component};switch(typeof re=="string"&&(rt[r.ATTR_HTTP_CLIENT_IP]=re.split(",")[0]),typeof qe=="string"&&(rt[r.ATTR_HTTP_SERVER_NAME]=qe),ct?.pathname&&(rt[r.ATTR_HTTP_TARGET]=ct?.pathname+ct?.search||"/"),ee!==void 0&&(rt[r.ATTR_HTTP_USER_AGENT]=ee),(0,e.setRequestContentLengthAttribute)(D,rt),(0,e.setAttributesFromHttpKind)(_e,rt),k.semconvStability){case s.SemconvStability.STABLE:return Object.assign(at,k.hookAttributes);case s.SemconvStability.OLD:return Object.assign(rt,k.hookAttributes)}return Object.assign(rt,at,k.hookAttributes)};e.getIncomingRequestAttributes=J;const se=D=>{const k={};return k[r.ATTR_HTTP_SCHEME]=D[r.ATTR_HTTP_SCHEME],k[r.ATTR_HTTP_METHOD]=D[r.ATTR_HTTP_METHOD],k[r.ATTR_NET_HOST_NAME]=D[r.ATTR_NET_HOST_NAME],k[r.ATTR_HTTP_FLAVOR]=D[r.ATTR_HTTP_FLAVOR],k};e.getIncomingRequestMetricAttributes=se;const ne=(D,k,z)=>{const{socket:q}=D,{statusCode:ee,statusMessage:re}=k,_e={[n.ATTR_HTTP_RESPONSE_STATUS_CODE]:ee},ie=(0,o.getRPCMetadata)(t.context.active()),le={};if(q){const{localAddress:Se,localPort:ve,remoteAddress:De,remotePort:qe}=q;le[r.ATTR_NET_HOST_IP]=Se,le[r.ATTR_NET_HOST_PORT]=ve,le[r.ATTR_NET_PEER_IP]=De,le[r.ATTR_NET_PEER_PORT]=qe}switch(le[r.ATTR_HTTP_STATUS_CODE]=ee,le[a.AttributeNames.HTTP_STATUS_TEXT]=(re||"").toUpperCase(),ie?.type===o.RPCType.HTTP&&ie.route!==void 0&&(le[n.ATTR_HTTP_ROUTE]=ie.route,_e[n.ATTR_HTTP_ROUTE]=ie.route),z){case s.SemconvStability.STABLE:return _e;case s.SemconvStability.OLD:return le}return Object.assign(le,_e)};e.getIncomingRequestAttributesOnResponse=ne;const M=D=>{const k={};return k[r.ATTR_HTTP_STATUS_CODE]=D[r.ATTR_HTTP_STATUS_CODE],k[r.ATTR_NET_HOST_PORT]=D[r.ATTR_NET_HOST_PORT],D[n.ATTR_HTTP_ROUTE]!==void 0&&(k[n.ATTR_HTTP_ROUTE]=D[n.ATTR_HTTP_ROUTE]),k};e.getIncomingRequestMetricAttributesOnResponse=M;const L=D=>{const k={};return D[n.ATTR_HTTP_ROUTE]!==void 0&&(k[n.ATTR_HTTP_ROUTE]=D[n.ATTR_HTTP_ROUTE]),D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(k[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),k};e.getIncomingStableRequestMetricAttributesOnResponse=L;function V(D,k){const z=new Map;for(let q=0,ee=k.length;q<ee;q++){const re=k[q].toLowerCase();z.set(re,re.replace(/-/g,"_"))}return(q,ee)=>{for(const re of z.keys()){const _e=ee(re);if(_e===void 0)continue;const ie=z.get(re),le=`http.${D}.header.${ie}`;typeof _e=="string"?q.setAttribute(le,[_e]):Array.isArray(_e)?q.setAttribute(le,_e):q.setAttribute(le,[_e])}}}e.headerCapture=V;const $=new Set(["GET","HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","TRACE","PATCH"]);function K(D){if(D==null)return"GET";const k=D.toUpperCase();return $.has(k)?k:"_OTHER"}function X(D){try{return f(D)}catch{return[]}}})(Bd)),Bd}var wA;function M1(){if(wA)return la;wA=1,Object.defineProperty(la,"__esModule",{value:!0}),la.HttpInstrumentation=void 0;const e=Pe(),t=fn,n=Nl,r=yk(),o=Le,s=wc,i=pt(),a=P1();class c extends o.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=o.SemconvStability.OLD;constructor(f={}){super("@opentelemetry/instrumentation-http",r.VERSION,f),this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,o.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(i.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(i.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}_recordServerDuration(f,d,l){this._semconvStability&o.SemconvStability.OLD&&this._oldHttpServerDurationHistogram.record(f,d),this._semconvStability&o.SemconvStability.STABLE&&this._stableHttpServerDurationHistogram.record(f/1e3,l)}_recordClientDuration(f,d,l){this._semconvStability&o.SemconvStability.OLD&&this._oldHttpClientDurationHistogram.record(f,d),this._semconvStability&o.SemconvStability.STABLE&&this._stableHttpClientDurationHistogram.record(f/1e3,l)}setConfig(f={}){super.setConfig(f),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new o.InstrumentationNodeModuleDefinition("http",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const l=this._wrap(f,"request",this._getPatchOutgoingRequestFunction("http")),_=this._wrap(f,"get",this._getPatchOutgoingGetFunction(l));d&&(f.default.request=l,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getHttpsInstrumentation(){return new o.InstrumentationNodeModuleDefinition("https",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const l=this._wrap(f,"request",this._getPatchHttpsOutgoingRequestFunction("https")),_=this._wrap(f,"get",this._getPatchHttpsOutgoingGetFunction(l));d&&(f.default.request=l,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getPatchIncomingRequestFunction(f){return d=>this._incomingRequestFunction(f,d)}_getPatchOutgoingRequestFunction(f){return d=>this._outgoingRequestFunction(f,d)}_getPatchOutgoingGetFunction(f){return d=>function(_,...p){const h=f(_,...p);return h.end(),h}}_getPatchHttpsOutgoingRequestFunction(f){return d=>{const l=this;return function(p,...h){return f==="https"&&typeof p=="object"&&p?.constructor?.name!=="URL"&&(p=Object.assign({},p),l._setDefaultOptions(p)),l._getPatchOutgoingRequestFunction(f)(d)(p,...h)}}}_setDefaultOptions(f){f.protocol=f.protocol||"https:",f.port=f.port||443}_getPatchHttpsOutgoingGetFunction(f){return d=>{const l=this;return function(p,...h){return l._getPatchOutgoingGetFunction(f)(d)(p,...h)}}}_traceClientRequest(f,d,l,_,p){this.getConfig().requestHook&&this._callRequestHook(d,f);let h=!1;return f.prependListener("response",E=>{this._diag.debug("outgoingRequest on response()"),f.listenerCount("response")<=1&&E.resume();const T=(0,a.getOutgoingRequestAttributesOnResponse)(E,this._semconvStability);d.setAttributes(T),_=Object.assign(_,(0,a.getOutgoingRequestMetricAttributesOnResponse)(T)),p=Object.assign(p,(0,a.getOutgoingStableRequestMetricAttributesOnResponse)(T)),this.getConfig().responseHook&&this._callResponseHook(d,E),this._headerCapture.client.captureRequestHeaders(d,g=>f.getHeader(g)),this._headerCapture.client.captureResponseHeaders(d,g=>E.headers[g]),e.context.bind(e.context.active(),E);const S=()=>{if(this._diag.debug("outgoingRequest on end()"),h)return;h=!0;let g;E.aborted&&!E.complete?g={code:e.SpanStatusCode.ERROR}:g={code:(0,a.parseResponseStatus)(e.SpanKind.CLIENT,E.statusCode)},d.setStatus(g),this.getConfig().applyCustomAttributesOnSpan&&(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(d,f,E),()=>{},!0),this._closeHttpSpan(d,e.SpanKind.CLIENT,l,_,p)};E.on("end",S),E.on(s.errorMonitor,g=>{this._diag.debug("outgoingRequest on error()",g),!h&&(h=!0,this._onOutgoingRequestError(d,_,p,l,g))})}),f.on("close",()=>{this._diag.debug("outgoingRequest on request close()"),!(f.aborted||h)&&(h=!0,this._closeHttpSpan(d,e.SpanKind.CLIENT,l,_,p))}),f.on(s.errorMonitor,E=>{this._diag.debug("outgoingRequest on request error()",E),!h&&(h=!0,this._onOutgoingRequestError(d,_,p,l,E))}),this._diag.debug("http.ClientRequest return request"),f}_incomingRequestFunction(f,d){const l=this;return function(p,...h){if(p!=="request")return d.apply(this,[p,...h]);const E=h[0],T=h[1],S=E.method||"GET";if(l._diag.debug(`${f} instrumentation incomingRequest`),(0,o.safeExecuteInTheMiddle)(()=>l.getConfig().ignoreIncomingRequestHook?.(E),F=>{F!=null&&l._diag.error("caught ignoreIncomingRequestHook error: ",F)},!0))return e.context.with((0,t.suppressTracing)(e.context.active()),()=>(e.context.bind(e.context.active(),E),e.context.bind(e.context.active(),T),d.apply(this,[p,...h])));const g=E.headers,A=(0,a.getIncomingRequestAttributes)(E,{component:f,serverName:l.getConfig().serverName,hookAttributes:l._callStartSpanHook(E,l.getConfig().startIncomingSpanHook),semconvStability:l._semconvStability,enableSyntheticSourceDetection:l.getConfig().enableSyntheticSourceDetection||!1},l._diag),R={kind:e.SpanKind.SERVER,attributes:A},O=(0,t.hrTime)(),C=(0,a.getIncomingRequestMetricAttributes)(A),I={[i.ATTR_HTTP_REQUEST_METHOD]:A[i.ATTR_HTTP_REQUEST_METHOD],[i.ATTR_URL_SCHEME]:A[i.ATTR_URL_SCHEME]};A[i.ATTR_NETWORK_PROTOCOL_VERSION]&&(I[i.ATTR_NETWORK_PROTOCOL_VERSION]=A[i.ATTR_NETWORK_PROTOCOL_VERSION]);const w=e.propagation.extract(e.ROOT_CONTEXT,g),U=l._startHttpSpan(S,R,w),B={type:t.RPCType.HTTP,span:U};return e.context.with((0,t.setRPCMetadata)(e.trace.setSpan(w,U),B),()=>{e.context.bind(e.context.active(),E),e.context.bind(e.context.active(),T),l.getConfig().requestHook&&l._callRequestHook(U,E),l.getConfig().responseHook&&l._callResponseHook(U,T),l._headerCapture.server.captureRequestHeaders(U,G=>E.headers[G]);let F=!1;return T.on("close",()=>{F||l._onServerResponseFinish(E,T,U,C,I,O)}),T.on(s.errorMonitor,G=>{F=!0,l._onServerResponseError(U,C,I,O,G)}),(0,o.safeExecuteInTheMiddle)(()=>d.apply(this,[p,...h]),G=>{if(G)throw l._onServerResponseError(U,C,I,O,G),G})})}}_outgoingRequestFunction(f,d){const l=this;return function(p,...h){if(!(0,a.isValidOptionsType)(p))return d.apply(this,[p,...h]);const E=typeof h[0]=="object"&&(typeof p=="string"||p instanceof n.URL)?h.shift():void 0,{method:T,invalidUrl:S,optionsParsed:g}=(0,a.getRequestInfo)(l._diag,p,E);if((0,o.safeExecuteInTheMiddle)(()=>l.getConfig().ignoreOutgoingRequestHook?.(g),x=>{x!=null&&l._diag.error("caught ignoreOutgoingRequestHook error: ",x)},!0))return d.apply(this,[g,...h]);const{hostname:A,port:R}=(0,a.extractHostnameAndPort)(g),O=(0,a.getOutgoingRequestAttributes)(g,{component:f,port:R,hostname:A,hookAttributes:l._callStartSpanHook(g,l.getConfig().startOutgoingSpanHook),redactedQueryParams:l.getConfig().redactedQueryParams},l._semconvStability,l.getConfig().enableSyntheticSourceDetection||!1),C=(0,t.hrTime)(),I=(0,a.getOutgoingRequestMetricAttributes)(O),w={[i.ATTR_HTTP_REQUEST_METHOD]:O[i.ATTR_HTTP_REQUEST_METHOD],[i.ATTR_SERVER_ADDRESS]:O[i.ATTR_SERVER_ADDRESS],[i.ATTR_SERVER_PORT]:O[i.ATTR_SERVER_PORT]};O[i.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(w[i.ATTR_HTTP_RESPONSE_STATUS_CODE]=O[i.ATTR_HTTP_RESPONSE_STATUS_CODE]),O[i.ATTR_NETWORK_PROTOCOL_VERSION]&&(w[i.ATTR_NETWORK_PROTOCOL_VERSION]=O[i.ATTR_NETWORK_PROTOCOL_VERSION]);const U={kind:e.SpanKind.CLIENT,attributes:O},B=l._startHttpSpan(T,U),F=e.context.active(),G=e.trace.setSpan(F,B);return g.headers?g.headers=Object.assign({},g.headers):g.headers={},e.propagation.inject(G,g.headers),e.context.with(G,()=>{const x=h[h.length-1];typeof x=="function"&&(h[h.length-1]=e.context.bind(F,x));const Y=(0,o.safeExecuteInTheMiddle)(()=>S?d.apply(this,[p,...h]):d.apply(this,[g,...h]),v=>{if(v)throw l._onOutgoingRequestError(B,I,w,C,v),v});return l._diag.debug(`${f} instrumentation outgoingRequest`),e.context.bind(F,Y),l._traceClientRequest(Y,B,C,I,w)})}}_onServerResponseFinish(f,d,l,_,p,h){const E=(0,a.getIncomingRequestAttributesOnResponse)(f,d,this._semconvStability);_=Object.assign(_,(0,a.getIncomingRequestMetricAttributesOnResponse)(E)),p=Object.assign(p,(0,a.getIncomingStableRequestMetricAttributesOnResponse)(E)),this._headerCapture.server.captureResponseHeaders(l,S=>d.getHeader(S)),l.setAttributes(E).setStatus({code:(0,a.parseResponseStatus)(e.SpanKind.SERVER,d.statusCode)});const T=E[i.ATTR_HTTP_ROUTE];T&&l.updateName(`${f.method||"GET"} ${T}`),this.getConfig().applyCustomAttributesOnSpan&&(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(l,f,d),()=>{},!0),this._closeHttpSpan(l,e.SpanKind.SERVER,h,_,p)}_onOutgoingRequestError(f,d,l,_,p){(0,a.setSpanWithError)(f,p,this._semconvStability),l[i.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.CLIENT,_,d,l)}_onServerResponseError(f,d,l,_,p){(0,a.setSpanWithError)(f,p,this._semconvStability),l[i.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.SERVER,_,d,l)}_startHttpSpan(f,d,l=e.context.active()){const _=d.kind===e.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans;let p;const h=e.trace.getSpan(l);return _===!0&&(!h||!e.trace.isSpanContextValid(h.spanContext()))?p=e.trace.wrapSpanContext(e.INVALID_SPAN_CONTEXT):_===!0&&h?.spanContext().isRemote?p=h:p=this.tracer.startSpan(f,d,l),this._spanNotEnded.add(p),p}_closeHttpSpan(f,d,l,_,p){if(!this._spanNotEnded.has(f))return;f.end(),this._spanNotEnded.delete(f);const h=(0,t.hrTimeToMilliseconds)((0,t.hrTimeDuration)(l,(0,t.hrTime)()));d===e.SpanKind.SERVER?this._recordServerDuration(h,_,p):d===e.SpanKind.CLIENT&&this._recordClientDuration(h,_,p)}_callResponseHook(f,d){(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(f,d),()=>{},!0)}_callRequestHook(f,d){(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(f,d),()=>{},!0)}_callStartSpanHook(f,d){if(typeof d=="function")return(0,o.safeExecuteInTheMiddle)(()=>d(f),()=>{},!0)}_createHeaderCapture(){const f=this.getConfig();return{client:{captureRequestHeaders:(0,a.headerCapture)("request",f.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,a.headerCapture)("response",f.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,a.headerCapture)("request",f.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,a.headerCapture)("response",f.headersToSpanAttributes?.server?.responseHeaders??[])}}}}return la.HttpInstrumentation=c,la}var LA;function v1(){return LA||(LA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpInstrumentation=void 0;var t=M1();Object.defineProperty(e,"HttpInstrumentation",{enumerable:!0,get:function(){return t.HttpInstrumentation}})})(vd)),vd}var w1=v1();const de=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Oe=globalThis,Qe="10.29.0";function Kn(){return kc(Oe),Oe}function kc(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||Qe,t[Qe]=t[Qe]||{}}function ls(e,t,n=Oe){const r=n.__SENTRY__=n.__SENTRY__||{},o=r[Qe]=r[Qe]||{};return o[e]||(o[e]=t())}const uM=["debug","info","warn","error","log","assert","trace"],L1="Sentry Logger ",Vu={};function cn(e){if(!("console"in Oe))return e();const t=Oe.console,n={},r=Object.keys(Vu);r.forEach(o=>{const s=Vu[o];n[o]=t[o],t[o]=s});try{return e()}finally{r.forEach(o=>{t[o]=n[o]})}}function D1(){sE().enabled=!0}function U1(){sE().enabled=!1}function lM(){return sE().enabled}function k1(...e){oE("log",...e)}function x1(...e){oE("warn",...e)}function G1(...e){oE("error",...e)}function oE(e,...t){de&&lM()&&cn(()=>{Oe.console[e](`${L1}[${e}]:`,...t)})}function sE(){return de?ls("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const j={enable:D1,disable:U1,isEnabled:lM,log:k1,warn:x1,error:G1},dM=50,fM="?",DA=/\(error: (.*)\)/,UA=/captureMessage|captureException/;function _M(...e){const t=e.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,o=0)=>{const s=[],i=n.split(`
`);for(let a=r;a<i.length;a++){let c=i[a];c.length>1024&&(c=c.slice(0,1024));const u=DA.test(c)?c.replace(DA,"$1"):c;if(!u.match(/\S*Error: /)){for(const f of t){const d=f(u);if(d){s.push(d);break}}if(s.length>=dM+o)break}}return $1(s.slice(o))}}function V1(e){return Array.isArray(e)?_M(...e):e}function $1(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(Zc(t).function||"")&&t.pop(),t.reverse(),UA.test(Zc(t).function||"")&&(t.pop(),UA.test(Zc(t).function||"")&&t.pop()),t.slice(0,dM).map(n=>({...n,filename:n.filename||Zc(t).filename,function:n.function||fM}))}function Zc(e){return e[e.length-1]||{}}const qd="<anonymous>";function pM(e){try{return!e||typeof e!="function"?qd:e.name||qd}catch{return qd}}function hM(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const bu={},kA={};function iE(e,t){bu[e]=bu[e]||[],bu[e].push(t)}function aE(e,t){if(!kA[e]){kA[e]=!0;try{t()}catch(n){de&&j.error(`Error while instrumenting ${e}`,n)}}}function cE(e,t){const n=e&&bu[e];if(n)for(const r of n)try{r(t)}catch(o){de&&j.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${pM(r)}
Error:`,o)}}let Wd=null;function B1(e){const t="error";iE(t,e),aE(t,H1)}function H1(){Wd=Oe.onerror,Oe.onerror=function(e,t,n,r,o){return cE("error",{column:r,error:o,line:n,msg:e,url:t}),Wd?Wd.apply(this,arguments):!1},Oe.onerror.__SENTRY_INSTRUMENTED__=!0}let Kd=null;function F1(e){const t="unhandledrejection";iE(t,e),aE(t,Y1)}function Y1(){Kd=Oe.onunhandledrejection,Oe.onunhandledrejection=function(e){return cE("unhandledrejection",e),Kd?Kd.apply(this,arguments):!0},Oe.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const EM=Object.prototype.toString;function $u(e){switch(EM.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return co(e,Error)}}function Dl(e,t){return EM.call(e)===`[object ${t}]`}function j1(e){return Dl(e,"ErrorEvent")}function Bu(e){return Dl(e,"String")}function uE(e){return typeof e=="object"&&e!==null&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function TM(e){return e===null||uE(e)||typeof e!="object"&&typeof e!="function"}function gc(e){return Dl(e,"Object")}function q1(e){return typeof Event<"u"&&co(e,Event)}function W1(e){return typeof Element<"u"&&co(e,Element)}function K1(e){return Dl(e,"RegExp")}function ur(e){return!!(e?.then&&typeof e.then=="function")}function z1(e){return gc(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function co(e,t){try{return e instanceof t}catch{return!1}}function SM(e){return!!(typeof e=="object"&&e!==null&&(e.__isVue||e._isVue||e.__v_isVNode))}const Z1=Oe,X1=80;function Q1(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let s=0,i=0;const a=" > ",c=a.length;let u;const f=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||X1;for(;n&&s++<r&&(u=J1(n,f),!(u==="html"||s>1&&i+o.length*c+u.length>=d));)o.push(u),i+=u.length,n=n.parentNode;return o.reverse().join(a)}catch{return"<unknown>"}}function J1(e,t){const n=e,r=[];if(!n?.tagName)return"";if(Z1.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const o=t?.length?t.filter(i=>n.getAttribute(i)).map(i=>[i,n.getAttribute(i)]):null;if(o?.length)o.forEach(i=>{r.push(`[${i[0]}="${i[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const i=n.className;if(i&&Bu(i)){const a=i.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const i of s){const a=n.getAttribute(i);a&&r.push(`[${i}="${a}"]`)}return r.join("")}function ex(e,t,n){if(!(t in e))return;const r=e[t];if(typeof r!="function")return;const o=n(r);typeof o=="function"&&tx(o,r);try{e[t]=o}catch{de&&j.log(`Failed to replace method "${t}" in object`,e)}}function un(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{de&&j.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function tx(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,un(e,"__sentry_original__",t)}catch{}}function nx(e){return e.__sentry_original__}function mM(e){if($u(e))return{message:e.message,name:e.name,stack:e.stack,...GA(e)};if(q1(e)){const t={type:e.type,target:xA(e.target),currentTarget:xA(e.currentTarget),...GA(e)};return typeof CustomEvent<"u"&&co(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function xA(e){try{return W1(e)?Q1(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function GA(e){if(typeof e=="object"&&e!==null){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}else return{}}function rx(e){const t=Object.keys(mM(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}function Hu(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function ox(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let o=Math.max(t-60,0);o<5&&(o=0);let s=Math.min(o+140,r);return s>r-5&&(s=r),s===r&&(o=Math.max(s-140,0)),n=n.slice(o,s),o>0&&(n=`'{snip} ${n}`),s<r&&(n+=" {snip}"),n}function sx(e,t){if(!Array.isArray(e))return"";const n=[];for(let r=0;r<e.length;r++){const o=e[r];try{SM(o)?n.push(hM(o)):n.push(String(o))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function Wo(e,t,n=!1){return Bu(e)?K1(t)?t.test(e):Bu(t)?n?e===t:e.includes(t):!1:!1}function xc(e,t=[],n=!1){return t.some(r=>Wo(e,r,n))}function ix(){const e=Oe;return e.crypto||e.msCrypto}let zd;function ax(){return Math.random()*16}function jt(e=ix()){try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"")}catch{}return zd||(zd="10000000100040008000"+1e11),zd.replace(/[018]/g,t=>(t^(ax()&15)>>t/4).toString(16))}function gM(e){return e.exception?.values?.[0]}function ko(e){const{message:t,event_id:n}=e;if(t)return t;const r=gM(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function cx(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],s=o[0]=o[0]||{};s.value||(s.value=""),s.type||(s.type="Error")}function lE(e,t){const n=gM(e);if(!n)return;const r={type:"generic",handled:!0},o=n.mechanism;if(n.mechanism={...r,...o,...t},t&&"data"in t){const s={...o?.data,...t.data};n.mechanism.data=s}}const ux=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function Zd(e){return parseInt(e||"",10)}function lx(e){const t=e.match(ux)||[],n=Zd(t[1]),r=Zd(t[2]),o=Zd(t[3]);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(o)?void 0:o,prerelease:t[4]}}function VA(e){if(dx(e))return!0;try{un(e,"__sentry_captured__",!0)}catch{}return!1}function dx(e){try{return e.__sentry_captured__}catch{}}const AM=1e3;function Gc(){return Date.now()/AM}function fx(){const{performance:e}=Oe;if(!e?.now||!e.timeOrigin)return Gc;const t=e.timeOrigin;return()=>(t+e.now())/AM}let $A;function Ac(){return($A??($A=fx()))()}function _x(e){const t=Ac(),n={sid:jt(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>hx(n)};return e&&Qo(n,e),n}function Qo(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Ac(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:jt()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const n=e.timestamp-e.started;e.duration=n>=0?n:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function px(e,t){let n={};e.status==="ok"&&(n={status:"exited"}),Qo(e,n)}function hx(e){return{sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}function Vc(e,t,n=2){if(!t||typeof t!="object"||n<=0)return t;if(e&&Object.keys(t).length===0)return e;const r={...e};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=Vc(r[o],t[o],n-1));return r}function uo(){return jt()}function go(){return jt().substring(16)}const rh="_sentrySpan";function Rc(e,t){t?un(e,rh,t):delete e[rh]}function Fu(e){return e[rh]}const Ex=100;class Rn{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:uo(),sampleRand:Math.random()}}clone(){const t=new Rn;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._attributes={...this._attributes},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,Rc(t,Fu(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Qo(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,n){return this.setTags({[t]:n})}setAttributes(t){return this._attributes={...this._attributes,...t},this._notifyScopeListeners(),this}setAttribute(t,n){return this.setAttributes({[t]:n})}removeAttribute(t){return t in this._attributes&&(delete this._attributes[t],this._notifyScopeListeners()),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,n){return this._extra={...this._extra,[t]:n},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,n){return n===null?delete this._contexts[t]:this._contexts[t]=n,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const n=typeof t=="function"?t(this):t,r=n instanceof Rn?n.getScopeData():gc(n)?t:void 0,{tags:o,attributes:s,extra:i,user:a,contexts:c,level:u,fingerprint:f=[],propagationContext:d}=r||{};return this._tags={...this._tags,...o},this._attributes={...this._attributes,...s},this._extra={...this._extra,...i},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),u&&(this._level=u),f.length&&(this._fingerprint=f),d&&(this._propagationContext=d),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,Rc(this,void 0),this._attachments=[],this.setPropagationContext({traceId:uo(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(t,n){const r=typeof n=="number"?n:Ex;if(r<=0)return this;const o={timestamp:Gc(),...t,message:t.message?Hu(t.message,2048):t.message};return this._breadcrumbs.push(o),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Fu(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=Vc(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,n){const r=n?.event_id||jt();if(!this._client)return de&&j.warn("No client configured on scope - will not capture exception!"),r;const o=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:o,...n,event_id:r},this),r}captureMessage(t,n,r){const o=r?.event_id||jt();if(!this._client)return de&&j.warn("No client configured on scope - will not capture message!"),o;const s=r?.syntheticException??new Error(t);return this._client.captureMessage(t,n,{originalException:t,syntheticException:s,...r,event_id:o},this),o}captureEvent(t,n){const r=n?.event_id||jt();return this._client?(this._client.captureEvent(t,{...n,event_id:r},this),r):(de&&j.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function dE(){return ls("defaultCurrentScope",()=>new Rn)}function ds(){return ls("defaultIsolationScope",()=>new Rn)}class Tx{constructor(t,n){let r;t?r=t:r=new Rn;let o;n?o=n:o=new Rn,this._stack=[{scope:r}],this._isolationScope=o}withScope(t){const n=this._pushScope();let r;try{r=t(n)}catch(o){throw this._popScope(),o}return ur(r)?r.then(o=>(this._popScope(),o),o=>{throw this._popScope(),o}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Jo(){const e=Kn(),t=kc(e);return t.stack=t.stack||new Tx(dE(),ds())}function Sx(e){return Jo().withScope(e)}function mx(e,t){const n=Jo();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function BA(e){return Jo().withScope(()=>e(Jo().getIsolationScope()))}function gx(){return{withIsolationScope:BA,withScope:Sx,withSetScope:mx,withSetIsolationScope:(e,t)=>BA(t),getCurrentScope:()=>Jo().getScope(),getIsolationScope:()=>Jo().getIsolationScope()}}function Ax(e){const t=Kn(),n=kc(t);n.acs=e}function Ao(e){const t=kc(e);return t.acs?t.acs:gx()}function ze(){const e=Kn();return Ao(e).getCurrentScope()}function je(){const e=Kn();return Ao(e).getIsolationScope()}function Rx(){return ls("globalScope",()=>new Rn)}function lo(...e){const t=Kn(),n=Ao(t);if(e.length===2){const[r,o]=e;return r?n.withSetScope(r,o):n.withScope(o)}return n.withScope(e[0])}function yx(...e){const t=Kn(),n=Ao(t);if(e.length===2){const[r,o]=e;return r?n.withSetIsolationScope(r,o):n.withIsolationScope(o)}return n.withIsolationScope(e[0])}function Te(){return ze().getClient()}function fE(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:o}=t,s={trace_id:n,span_id:o||go()};return r&&(s.parent_span_id=r),s}const Zt="sentry.source",es="sentry.sample_rate",Nx="sentry.previous_trace_sample_rate",Ee="sentry.op",xe="sentry.origin",Ox="sentry.measurement_unit",bx="sentry.measurement_value",ts="sentry.custom_span_name",_E="sentry.profile_id",pE="sentry.exclusive_time",Cx="cache.hit",Ix="cache.key",Px="cache.item_size",Mx=0,Yu=1,Ae=2;function oh(e){if(e<400&&e>=100)return{code:Yu};if(e>=400&&e<500)switch(e){case 401:return{code:Ae,message:"unauthenticated"};case 403:return{code:Ae,message:"permission_denied"};case 404:return{code:Ae,message:"not_found"};case 409:return{code:Ae,message:"already_exists"};case 413:return{code:Ae,message:"failed_precondition"};case 429:return{code:Ae,message:"resource_exhausted"};case 499:return{code:Ae,message:"cancelled"};default:return{code:Ae,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:Ae,message:"unimplemented"};case 503:return{code:Ae,message:"unavailable"};case 504:return{code:Ae,message:"deadline_exceeded"};default:return{code:Ae,message:"internal_error"}}return{code:Ae,message:"internal_error"}}const RM="_sentryScope",yM="_sentryIsolationScope";function vx(e){try{const t=Oe.WeakRef;if(typeof t=="function")return new t(e)}catch{}return e}function wx(e){if(e){if(typeof e=="object"&&"deref"in e&&typeof e.deref=="function")try{return e.deref()}catch{return}return e}}function NM(e,t,n){e&&(un(e,yM,vx(n)),un(e,RM,t))}function ns(e){const t=e;return{scope:t[RM],isolationScope:wx(t[yM])}}const hE="sentry-",Lx=/^sentry-/,Dx=8192;function $c(e){const t=ju(e);if(!t)return;const n=Object.entries(t).reduce((r,[o,s])=>{if(o.match(Lx)){const i=o.slice(hE.length);r[i]=s}return r},{});if(Object.keys(n).length>0)return n}function EE(e){if(!e)return;const t=Object.entries(e).reduce((n,[r,o])=>(o&&(n[`${hE}${r}`]=o),n),{});return OM(t)}function ju(e){if(!(!e||!Bu(e)&&!Array.isArray(e)))return Array.isArray(e)?e.reduce((t,n)=>{const r=HA(n);return Object.entries(r).forEach(([o,s])=>{t[o]=s}),t},{}):HA(e)}function HA(e){return e.split(",").map(t=>{const n=t.indexOf("=");if(n===-1)return[];const r=t.slice(0,n),o=t.slice(n+1);return[r,o].map(s=>{try{return decodeURIComponent(s.trim())}catch{return}})}).reduce((t,[n,r])=>(n&&r&&(t[n]=r),t),{})}function OM(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[n,r],o)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,i=o===0?s:`${t},${s}`;return i.length>Dx?(de&&j.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),t):i},"")}const Ux=/^o(\d+)\./,kx=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function xx(e){return e==="http"||e==="https"}function Ro(e,t=!1){const{host:n,path:r,pass:o,port:s,projectId:i,protocol:a,publicKey:c}=e;return`${a}://${c}${t&&o?`:${o}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${i}`}function Gx(e){const t=kx.exec(e);if(!t){cn(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});return}const[n,r,o="",s="",i="",a=""]=t.slice(1);let c="",u=a;const f=u.split("/");if(f.length>1&&(c=f.slice(0,-1).join("/"),u=f.pop()),u){const d=u.match(/^\d+/);d&&(u=d[0])}return bM({host:s,pass:o,path:c,projectId:u,port:i,protocol:n,publicKey:r})}function bM(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function Vx(e){if(!de)return!0;const{port:t,projectId:n,protocol:r}=e;return["protocol","publicKey","host","projectId"].find(i=>e[i]?!1:(j.error(`Invalid Sentry Dsn: ${i} missing`),!0))?!1:n.match(/^\d+$/)?xx(r)?t&&isNaN(parseInt(t,10))?(j.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(j.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(j.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function $x(e){return e.match(Ux)?.[1]}function CM(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=$x(n)),r}function Bx(e){const t=typeof e=="string"?Gx(e):bM(e);if(!(!t||!Vx(t)))return t}function fo(e){if(typeof e=="boolean")return Number(e);const t=typeof e=="string"?parseFloat(e):e;if(!(typeof t!="number"||isNaN(t)||t<0||t>1))return t}const IM=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function Hx(e){if(!e)return;const t=e.match(IM);if(!t)return;let n;return t[3]==="1"?n=!0:t[3]==="0"&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function PM(e,t){const n=Hx(e),r=$c(t);if(!n?.traceId)return{traceId:uo(),sampleRand:Math.random()};const o=Fx(n,r);r&&(r.sample_rand=o.toString());const{traceId:s,parentSpanId:i,parentSampled:a}=n;return{traceId:s,parentSpanId:i,sampled:a,dsc:r||{},sampleRand:o}}function Ul(e=uo(),t=go(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function MM(e=uo(),t=go(),n){return`00-${e}-${t}-${n?"01":"00"}`}function Fx(e,t){const n=fo(t?.sample_rand);if(n!==void 0)return n;const r=fo(t?.sample_rate);return r&&e?.parentSampled!==void 0?e.parentSampled?Math.random()*r:r+Math.random()*(1-r):Math.random()}function Yx(e,t){const n=CM(e);return t&&n&&t!==n?(j.log(`Won't continue trace because org IDs don't match (incoming baggage: ${t}, SDK options: ${n})`),!1):(e.getOptions().strictTraceContinuation||!1)&&(t&&!n||!t&&n)?(j.log(`Starting a new trace because strict trace continuation is enabled but one org ID is missing (incoming baggage: ${t}, Sentry client: ${n})`),!1):!0}const vM=0,TE=1;let FA=!1;function jx(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:s,status:i,origin:a,links:c}=ye(e);return{parent_span_id:s,span_id:t,trace_id:n,data:r,op:o,status:i,origin:a,links:c}}function kl(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),o=r?t:ye(e).parent_span_id,s=ns(e).scope,i=r?s?.getPropagationContext().propagationSpanId||go():t;return{parent_span_id:o,span_id:i,trace_id:n}}function qx(e){const{traceId:t,spanId:n}=e.spanContext(),r=yo(e);return Ul(t,n,r)}function Wx(e){const{traceId:t,spanId:n}=e.spanContext(),r=yo(e);return MM(t,n,r)}function xl(e){if(e&&e.length>0)return e.map(({context:{spanId:t,traceId:n,traceFlags:r,...o},attributes:s})=>({span_id:t,trace_id:n,sampled:r===TE,attributes:s,...o}))}function An(e){return typeof e=="number"?YA(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?YA(e.getTime()):Ac()}function YA(e){return e>9999999999?e/1e3:e}function ye(e){if(zx(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(Kx(e)){const{attributes:r,startTime:o,name:s,endTime:i,status:a,links:c}=e,u="parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0;return{span_id:t,trace_id:n,data:r,description:s,parent_span_id:u,start_timestamp:An(o),timestamp:An(i)||void 0,status:Gl(a),op:r[Ee],origin:r[xe],links:xl(c)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function Kx(e){const t=e;return!!t.attributes&&!!t.startTime&&!!t.name&&!!t.endTime&&!!t.status}function zx(e){return typeof e.getSpanJSON=="function"}function yo(e){const{traceFlags:t}=e.spanContext();return t===TE}function Gl(e){if(!(!e||e.code===Mx))return e.code===Yu?"ok":e.message||"internal_error"}const lc="_sentryChildSpans",sh="_sentryRootSpan";function SE(e,t){const n=e[sh]||e;un(t,sh,n),e[lc]?e[lc].add(t):un(e,lc,new Set([t]))}function Zx(e){const t=new Set;function n(r){if(!t.has(r)&&yo(r)){t.add(r);const o=r[lc]?Array.from(r[lc]):[];for(const s of o)n(s)}}return n(e),Array.from(t)}function qt(e){return e[sh]||e}function Vl(){const e=Kn(),t=Ao(e);return t.getActiveSpan?t.getActiveSpan():Fu(ze())}function ih(){FA||(cn(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly or use `ignoreSpans`.")}),FA=!0)}let jA=!1;function Xx(){if(jA)return;function e(){const t=Vl(),n=t&&qt(t);if(n){const r="internal_error";de&&j.log(`[Tracing] Root span: ${r} -> Global error occurred`),n.setStatus({code:Ae,message:r})}}e.tag="sentry_tracingErrorCallback",jA=!0,B1(e),F1(e)}function Xt(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=e||Te()?.getOptions();return!!t&&(t.tracesSampleRate!=null||!!t.tracesSampler)}function qA(e){j.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function ah(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(Jx(n)){if(Wo(e.description,n))return de&&qA(e),!0;continue}if(!n.name&&!n.op)continue;const r=n.name?Wo(e.description,n.name):!0,o=n.op?e.op&&Wo(e.op,n.op):!0;if(r&&o)return de&&qA(e),!0}return!1}function Qx(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const o of e)o.parent_span_id===r&&(o.parent_span_id=n)}function Jx(e){return typeof e=="string"||e instanceof RegExp}const mE="production",wM="_frozenDsc";function Xd(e,t){un(e,wM,t)}function LM(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},o={environment:n.environment||mE,release:n.release,public_key:r,trace_id:e,org_id:CM(t)};return t.emit("createDsc",o),o}function Bc(e,t){const n=t.getPropagationContext();return n.dsc||LM(n.traceId,e)}function $t(e){const t=Te();if(!t)return{};const n=qt(e),r=ye(n),o=r.data,s=n.spanContext().traceState,i=s?.get("sentry.sample_rate")??o[es]??o[Nx];function a(p){return(typeof i=="number"||typeof i=="string")&&(p.sample_rate=`${i}`),p}const c=n[wM];if(c)return a(c);const u=s?.get("sentry.dsc"),f=u&&$c(u);if(f)return a(f);const d=LM(e.spanContext().traceId,t),l=o[Zt],_=r.description;return l!=="url"&&_&&(d.transaction=_),Xt()&&(d.sampled=String(yo(n)),d.sample_rand=s?.get("sentry.sample_rand")??ns(n).scope?.getPropagationContext().sampleRand.toString()),a(d),t.emit("createDsc",d,n),d}class $l{constructor(t={}){this._traceId=t.traceId||uo(),this._spanId=t.spanId||go()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:vM}}end(t){}setAttribute(t,n){return this}setAttributes(t){return this}setStatus(t){return this}updateName(t){return this}isRecording(){return!1}addEvent(t,n,r){return this}addLink(t){return this}addLinks(t){return this}recordException(t,n){}}function Vn(e,t=100,n=1/0){try{return ch("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function DM(e,t=3,n=100*1024){const r=Vn(e,t);return rG(r)>n?DM(e,t-1,n):r}function ch(e,t,n=1/0,r=1/0,o=oG()){const[s,i]=o;if(t==null||["boolean","string"].includes(typeof t)||typeof t=="number"&&Number.isFinite(t))return t;const a=eG(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const c=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(s(t))return"[Circular ~]";const u=t;if(u&&typeof u.toJSON=="function")try{const _=u.toJSON();return ch("",_,c-1,r,o)}catch{}const f=Array.isArray(t)?[]:{};let d=0;const l=mM(t);for(const _ in l){if(!Object.prototype.hasOwnProperty.call(l,_))continue;if(d>=r){f[_]="[MaxProperties ~]";break}const p=l[_];f[_]=ch(_,p,c-1,r,o),d++}return i(t),f}function eG(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(SM(t))return hM(t);if(z1(t))return"[SyntheticEvent]";if(typeof t=="number"&&!Number.isFinite(t))return`[${t}]`;if(typeof t=="function")return`[Function: ${pM(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const n=tG(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function tG(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}function nG(e){return~-encodeURI(e).split(/%..|./).length}function rG(e){return nG(JSON.stringify(e))}function oG(){const e=new WeakSet;function t(r){return e.has(r)?!0:(e.add(r),!1)}function n(r){e.delete(r)}return[t,n]}function lr(e,t=[]){return[e,t]}function sG(e,t){const[n,r]=e;return[n,[...r,t]]}function WA(e,t){const n=e[1];for(const r of n){const o=r[0].type;if(t(r,o))return!0}return!1}function uh(e){const t=kc(Oe);return t.encodePolyfill?t.encodePolyfill(e):new TextEncoder().encode(e)}function UM(e){const[t,n]=e;let r=JSON.stringify(t);function o(s){typeof r=="string"?r=typeof s=="string"?r+s:[uh(r),s]:r.push(typeof s=="string"?uh(s):s)}for(const s of n){const[i,a]=s;if(o(`
${JSON.stringify(i)}
`),typeof a=="string"||a instanceof Uint8Array)o(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(Vn(a))}o(c)}}return typeof r=="string"?r:iG(r)}function iG(e){const t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return n}function aG(e){return[{type:"span"},e]}function cG(e){const t=typeof e.data=="string"?uh(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const uG={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function KA(e){return uG[e]}function kM(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function lG(e,t,n,r){const o=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:Ro(r)},...o&&{trace:o}}}function dG(e,t){if(!t)return e;const n=e.sdk||{};return e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0},e}function fG(e,t,n,r){const o=kM(n),s={sent_at:new Date().toISOString(),...o&&{sdk:o},...!!r&&t&&{dsn:Ro(t)}},i="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return lr(s,[i])}function _G(e,t,n,r){const o=kM(n),s=e.type&&e.type!=="replay_event"?e.type:"event";dG(e,n?.sdk);const i=lG(e,o,r,t);return delete e.sdkProcessingMetadata,lr(i,[[{type:s},e]])}function pG(e,t){function n(_){return!!_.trace_id&&!!_.public_key}const r=$t(e[0]),o=t?.getDsn(),s=t?.getOptions().tunnel,i={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&o&&{dsn:Ro(o)}},{beforeSendSpan:a,ignoreSpans:c}=t?.getOptions()||{},u=c?.length?e.filter(_=>!ah(ye(_),c)):e,f=e.length-u.length;f&&t?.recordDroppedEvent("before_send","span",f);const d=a?_=>{const p=ye(_),h=a(p);return h||(ih(),p)}:ye,l=[];for(const _ of u){const p=d(_);p&&l.push(aG(p))}return lr(i,l)}function xM(e){if(!de)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=ye(e),{spanId:o}=e.spanContext(),s=yo(e),i=qt(e),a=i===e,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,u=[`op: ${n}`,`name: ${t}`,`ID: ${o}`];if(r&&u.push(`parent ID: ${r}`),!a){const{op:f,description:d}=ye(i);u.push(`root ID: ${i.spanContext().spanId}`),f&&u.push(`root op: ${f}`),d&&u.push(`root description: ${d}`)}j.log(`${c}
  ${u.join(`
  `)}`)}function GM(e){if(!de)return;const{description:t="< unknown name >",op:n="< unknown op >"}=ye(e),{spanId:r}=e.spanContext(),s=qt(e)===e,i=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${t}" with ID ${r}`;j.log(i)}function qu(e){if(!e||e.length===0)return;const t={};return e.forEach(n=>{const r=n.attributes||{},o=r[Ox],s=r[bx];typeof o=="string"&&typeof s=="number"&&(t[n.name]={value:s,unit:o})}),t}const zA=1e3;class gE{constructor(t={}){this._traceId=t.traceId||uo(),this._spanId=t.spanId||go(),this._startTime=t.startTimestamp||Ac(),this._links=t.links,this._attributes={},this.setAttributes({[xe]:"manual",[Ee]:t.op,...t.attributes}),this._name=t.name,t.parentSpanId&&(this._parentSpanId=t.parentSpanId),"sampled"in t&&(this._sampled=t.sampled),t.endTimestamp&&(this._endTime=t.endTimestamp),this._events=[],this._isStandaloneSpan=t.isStandalone,this._endTime&&this._onSpanEnded()}addLink(t){return this._links?this._links.push(t):this._links=[t],this}addLinks(t){return this._links?this._links.push(...t):this._links=t,this}recordException(t,n){}spanContext(){const{_spanId:t,_traceId:n,_sampled:r}=this;return{spanId:t,traceId:n,traceFlags:r?TE:vM}}setAttribute(t,n){return n===void 0?delete this._attributes[t]:this._attributes[t]=n,this}setAttributes(t){return Object.keys(t).forEach(n=>this.setAttribute(n,t[n])),this}updateStartTime(t){this._startTime=An(t)}setStatus(t){return this._status=t,this}updateName(t){return this._name=t,this.setAttribute(Zt,"custom"),this}end(t){this._endTime||(this._endTime=An(t),GM(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[Ee],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:Gl(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[xe],profile_id:this._attributes[_E],exclusive_time:this._attributes[pE],measurements:qu(this._events),is_segment:this._isStandaloneSpan&&qt(this)===this||void 0,segment_id:this._isStandaloneSpan?qt(this).spanContext().spanId:void 0,links:xl(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(t,n,r){de&&j.log("[Tracing] Adding an event to span:",t);const o=ZA(n)?n:r||Ac(),s=ZA(n)?{}:n||{},i={name:t,time:An(o),attributes:s};return this._events.push(i),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const t=Te();if(t&&t.emit("spanEnd",this),!(this._isStandaloneSpan||this===qt(this)))return;if(this._isStandaloneSpan){this._sampled?EG(pG([this],t)):(de&&j.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),t&&t.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(ns(this).scope||ze()).captureEvent(r)}_convertSpanToTransaction(){if(!XA(ye(this)))return;this._name||(de&&j.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:t,isolationScope:n}=ns(this),r=t?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(this._sampled!==!0)return;const s=Zx(this).filter(f=>f!==this&&!hG(f)).map(f=>ye(f)).filter(XA),i=this._attributes[Zt];delete this._attributes[ts],s.forEach(f=>{delete f.data[ts]});const a={contexts:{trace:jx(this)},spans:s.length>zA?s.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,zA):s,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:t,capturedSpanIsolationScope:n,dynamicSamplingContext:$t(this)},request:r,...i&&{transaction_info:{source:i}}},c=qu(this._events);return c&&Object.keys(c).length&&(de&&j.log("[Measurements] Adding measurements to transaction event",JSON.stringify(c,void 0,2)),a.measurements=c),a}}function ZA(e){return e&&typeof e=="number"||e instanceof Date||Array.isArray(e)}function XA(e){return!!e.start_timestamp&&!!e.timestamp&&!!e.span_id&&!!e.trace_id}function hG(e){return e instanceof gE&&e.isStandaloneSpan()}function EG(e){const t=Te();if(!t)return;const n=e[1];if(!n||n.length===0){t.recordDroppedEvent("before_send","span");return}t.sendEnvelope(e)}function _o(e,t,n=()=>{},r=()=>{}){let o;try{o=e()}catch(s){throw t(s),n(),s}return TG(o,t,n,r)}function TG(e,t,n,r){return ur(e)?e.then(o=>(n(),r(o),o),o=>{throw t(o),n(),o}):(n(),r(e),e)}function VM(e,t,n){if(!Xt(e))return[!1];let r,o;typeof e.tracesSampler=="function"?(o=e.tracesSampler({...t,inheritOrSampleWith:a=>typeof t.parentSampleRate=="number"?t.parentSampleRate:typeof t.parentSampled=="boolean"?Number(t.parentSampled):a}),r=!0):t.parentSampled!==void 0?o=t.parentSampled:typeof e.tracesSampleRate<"u"&&(o=e.tracesSampleRate,r=!0);const s=fo(o);if(s===void 0)return de&&j.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(o)} of type ${JSON.stringify(typeof o)}.`),[!1];if(!s)return de&&j.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s,r];const i=n<s;return i||de&&j.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(o)})`),[i,s,r]}const Wu="__SENTRY_SUPPRESS_TRACING__";function fs(e,t){const n=Bl();if(n.startSpan)return n.startSpan(e,t);const r=FM(e),{forceTransaction:o,parentSpan:s,scope:i}=e,a=i?.clone();return lo(a,()=>jM(s)(()=>{const u=ze(),f=YM(u,s),l=e.onlyIfParent&&!f?new $l:HM({parentSpan:f,spanArguments:r,forceTransaction:o,scope:u});return Rc(u,l),_o(()=>t(l),()=>{const{status:_}=ye(l);l.isRecording()&&(!_||_==="ok")&&l.setStatus({code:Ae,message:"internal_error"})},()=>{l.end()})}))}function Hn(e,t){const n=Bl();if(n.startSpanManual)return n.startSpanManual(e,t);const r=FM(e),{forceTransaction:o,parentSpan:s,scope:i}=e,a=i?.clone();return lo(a,()=>jM(s)(()=>{const u=ze(),f=YM(u,s),l=e.onlyIfParent&&!f?new $l:HM({parentSpan:f,spanArguments:r,forceTransaction:o,scope:u});return Rc(u,l),_o(()=>t(l,()=>l.end()),()=>{const{status:_}=ye(l);l.isRecording()&&(!_||_==="ok")&&l.setStatus({code:Ae,message:"internal_error"})})}))}function $M(e,t){const n=Bl();return n.withActiveSpan?n.withActiveSpan(e,t):lo(r=>(Rc(r,e||void 0),t(r)))}function BM(e){const t=Bl();return t.suppressTracing?t.suppressTracing(e):lo(n=>{n.setSDKProcessingMetadata({[Wu]:!0});const r=e();return n.setSDKProcessingMetadata({[Wu]:void 0}),r})}function HM({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!Xt()){const i=new $l;if(n||!e){const a={sampled:"false",sample_rate:"0",transaction:t.name,...$t(i)};Xd(i,a)}return i}const o=je();let s;if(e&&!n)s=SG(e,r,t),SE(e,s);else if(e){const i=$t(e),{traceId:a,spanId:c}=e.spanContext(),u=yo(e);s=QA({traceId:a,parentSpanId:c,...t},r,u),Xd(s,i)}else{const{traceId:i,dsc:a,parentSpanId:c,sampled:u}={...o.getPropagationContext(),...r.getPropagationContext()};s=QA({traceId:i,parentSpanId:c,...t},r,u),a&&Xd(s,a)}return xM(s),NM(s,r,o),s}function FM(e){const n={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const r={...n};return r.startTimestamp=An(e.startTime),delete r.startTime,r}return n}function Bl(){const e=Kn();return Ao(e)}function QA(e,t,n){const r=Te(),o=r?.getOptions()||{},{name:s=""}=e,i={spanAttributes:{...e.attributes},spanName:s,parentSampled:n};r?.emit("beforeSampling",i,{decision:!1});const a=i.parentSampled??n,c=i.spanAttributes,u=t.getPropagationContext(),[f,d,l]=t.getScopeData().sdkProcessingMetadata[Wu]?[!1]:VM(o,{name:s,parentSampled:a,attributes:c,parentSampleRate:fo(u.dsc?.sample_rate)},u.sampleRand),_=new gE({...e,attributes:{[Zt]:"custom",[es]:d!==void 0&&l?d:void 0,...c},sampled:f});return!f&&r&&(de&&j.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",_),_}function SG(e,t,n){const{spanId:r,traceId:o}=e.spanContext(),s=t.getScopeData().sdkProcessingMetadata[Wu]?!1:yo(e),i=s?new gE({...n,parentSpanId:r,traceId:o,sampled:s}):new $l({traceId:o});SE(e,i);const a=Te();return a&&(a.emit("spanStart",i),n.endTimestamp&&a.emit("spanEnd",i)),i}function YM(e,t){if(t)return t;if(t===null)return;const n=Fu(e);if(!n)return;const r=Te();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?qt(n):n}function jM(e){return e!==void 0?t=>$M(e,t):t=>t()}const Qd=0,JA=1,eR=2;function Ku(e){return new yc(t=>{t(e)})}function AE(e){return new yc((t,n)=>{n(e)})}class yc{constructor(t){this._state=Qd,this._handlers=[],this._runExecutor(t)}then(t,n){return new yc((r,o)=>{this._handlers.push([!1,s=>{if(!t)r(s);else try{r(t(s))}catch(i){o(i)}},s=>{if(!n)o(s);else try{r(n(s))}catch(i){o(i)}}]),this._executeHandlers()})}catch(t){return this.then(n=>n,t)}finally(t){return new yc((n,r)=>{let o,s;return this.then(i=>{s=!1,o=i,t&&t()},i=>{s=!0,o=i,t&&t()}).then(()=>{if(s){r(o);return}n(o)})})}_executeHandlers(){if(this._state===Qd)return;const t=this._handlers.slice();this._handlers=[],t.forEach(n=>{n[0]||(this._state===JA&&n[1](this._value),this._state===eR&&n[2](this._value),n[0]=!0)})}_runExecutor(t){const n=(s,i)=>{if(this._state===Qd){if(ur(i)){i.then(r,o);return}this._state=s,this._value=i,this._executeHandlers()}},r=s=>{n(JA,s)},o=s=>{n(eR,s)};try{t(r,o)}catch(s){o(s)}}}function mG(e,t,n,r=0){try{const o=lh(t,n,e,r);return ur(o)?o:Ku(o)}catch(o){return AE(o)}}function lh(e,t,n,r){const o=n[r];if(!e||!o)return e;const s=o({...e},t);return de&&s===null&&j.log(`Event processor "${o.id||"?"}" dropped event`),ur(s)?s.then(i=>lh(i,t,n,r+1)):lh(s,t,n,r+1)}function gG(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:s}=t;AG(e,t),r&&NG(e,r),OG(e,n),RG(e,o),yG(e,s)}function tR(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:u,eventProcessors:f,attachments:d,propagationContext:l,transactionName:_,span:p}=t;Xc(e,"extra",n),Xc(e,"tags",r),Xc(e,"user",o),Xc(e,"contexts",s),e.sdkProcessingMetadata=Vc(e.sdkProcessingMetadata,a,2),i&&(e.level=i),_&&(e.transactionName=_),p&&(e.span=p),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),u.length&&(e.fingerprint=[...e.fingerprint,...u]),f.length&&(e.eventProcessors=[...e.eventProcessors,...f]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...l}}function Xc(e,t,n){e[t]=Vc(e[t],n,1)}function AG(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,transactionName:a}=t;Object.keys(n).length&&(e.extra={...n,...e.extra}),Object.keys(r).length&&(e.tags={...r,...e.tags}),Object.keys(o).length&&(e.user={...o,...e.user}),Object.keys(s).length&&(e.contexts={...s,...e.contexts}),i&&(e.level=i),a&&e.type!=="transaction"&&(e.transaction=a)}function RG(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function yG(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function NG(e,t){e.contexts={trace:kl(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:$t(t),...e.sdkProcessingMetadata};const n=qt(t),r=ye(n).description;r&&!e.transaction&&e.type==="transaction"&&(e.transaction=r)}function OG(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint.length||delete e.fingerprint}let Cr,nR,rR,Qn;function bG(e){const t=Oe._sentryDebugIds,n=Oe._debugIds;if(!t&&!n)return{};const r=t?Object.keys(t):[],o=n?Object.keys(n):[];if(Qn&&r.length===nR&&o.length===rR)return Qn;nR=r.length,rR=o.length,Qn={},Cr||(Cr={});const s=(i,a)=>{for(const c of i){const u=a[c],f=Cr?.[c];if(f&&Qn&&u)Qn[f[0]]=u,Cr&&(Cr[c]=[f[0],u]);else if(u){const d=e(c);for(let l=d.length-1;l>=0;l--){const p=d[l]?.filename;if(p&&Qn&&Cr){Qn[p]=u,Cr[c]=[p,u];break}}}}};return t&&s(r,t),n&&s(o,n),Qn}function CG(e,t,n,r,o,s){const{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=e,c={...t,event_id:t.event_id||n.event_id||jt(),timestamp:t.timestamp||Gc()},u=n.integrations||e.integrations.map(E=>E.name);IG(c,e),vG(c,u),o&&o.emit("applyFrameMetadata",t),t.type===void 0&&PG(c,e.stackParser);const f=LG(r,n.captureContext);n.mechanism&&lE(c,n.mechanism);const d=o?o.getEventProcessors():[],l=Rx().getScopeData();if(s){const E=s.getScopeData();tR(l,E)}if(f){const E=f.getScopeData();tR(l,E)}const _=[...n.attachments||[],...l.attachments];_.length&&(n.attachments=_),gG(c,l);const p=[...d,...l.eventProcessors];return mG(p,c,n).then(E=>(E&&MG(E),typeof i=="number"&&i>0?wG(E,i,a):E))}function IG(e,t){const{environment:n,release:r,dist:o,maxValueLength:s}=t;e.environment=e.environment||n||mE,!e.release&&r&&(e.release=r),!e.dist&&o&&(e.dist=o);const i=e.request;i?.url&&s&&(i.url=Hu(i.url,s)),s&&e.exception?.values?.forEach(a=>{a.value&&(a.value=Hu(a.value,s))})}function PG(e,t){const n=bG(t);e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(o=>{o.filename&&(o.debug_id=n[o.filename])})})}function MG(e){const t={};if(e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(o=>{o.debug_id&&(o.abs_path?t[o.abs_path]=o.debug_id:o.filename&&(t[o.filename]=o.debug_id),delete o.debug_id)})}),Object.keys(t).length===0)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([r,o])=>{n.push({type:"sourcemap",code_file:r,debug_id:o})})}function vG(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function wG(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(o=>({...o,...o.data&&{data:Vn(o.data,t,n)}}))},...e.user&&{user:Vn(e.user,t,n)},...e.contexts&&{contexts:Vn(e.contexts,t,n)},...e.extra&&{extra:Vn(e.extra,t,n)}};return e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Vn(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(o=>({...o,...o.data&&{data:Vn(o.data,t,n)}}))),e.contexts?.flags&&r.contexts&&(r.contexts.flags=Vn(e.contexts.flags,3,n)),r}function LG(e,t){if(!t)return e;const n=e?e.clone():new Rn;return n.update(t),n}function DG(e){if(e)return UG(e)?{captureContext:e}:xG(e)?{captureContext:e}:e}function UG(e){return e instanceof Rn||typeof e=="function"}const kG=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function xG(e){return Object.keys(e).some(t=>kG.includes(t))}function Ve(e,t){return ze().captureException(e,DG(t))}function GG(e,t){return ze().captureEvent(e,t)}function VG(e,t){je().setTag(e,t)}function oR(e){je().setUser(e)}async function $G(e){const t=Te();return t?t.flush(e):(de&&j.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}function BG(){const e=Te();return e?.getOptions().enabled!==!1&&!!e?.getTransport()}function HG(e){const t=je(),n=ze(),{userAgent:r}=Oe.navigator||{},o=_x({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),s=t.getSession();return s?.status==="ok"&&Qo(s,{status:"exited"}),qM(),t.setSession(o),o}function qM(){const e=je(),n=ze().getSession()||e.getSession();n&&px(n),FG(),e.setSession()}function FG(){const e=je(),t=Te(),n=e.getSession();n&&t&&t.captureSession(n)}const YG="7";function jG(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function qG(e){return`${jG(e)}${e.projectId}/envelope/`}function WG(e,t){const n={sentry_version:YG};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function KG(e,t,n){return t||`${qG(e)}?${WG(e,n)}`}const sR=[];function zG(e){const t={};return e.forEach(n=>{const{name:r}=n,o=t[r];o&&!o.isDefaultInstance&&n.isDefaultInstance||(t[r]=n)}),Object.values(t)}function ZG(e){const t=e.defaultIntegrations||[],n=e.integrations;t.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...t,...n];else if(typeof n=="function"){const o=n(t);r=Array.isArray(o)?o:[o]}else r=t;return zG(r)}function XG(e,t){const n={};return t.forEach(r=>{r&&WM(e,r,n)}),n}function iR(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function WM(e,t,n){if(n[t.name]){de&&j.log(`Integration skipped because it was already installed: ${t.name}`);return}if(n[t.name]=t,!sR.includes(t.name)&&typeof t.setupOnce=="function"&&(t.setupOnce(),sR.push(t.name)),t.setup&&typeof t.setup=="function"&&t.setup(e),typeof t.preprocessEvent=="function"){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(o,s)=>r(o,s,e))}if(typeof t.processEvent=="function"){const r=t.processEvent.bind(t),o=Object.assign((s,i)=>r(s,i,e),{id:t.name});e.addEventProcessor(o)}de&&j.log(`Integration installed: ${t.name}`)}function QG(e,t){return t?lo(t,()=>{const n=Vl(),r=n?kl(n):fE(t);return[n?$t(n):Bc(e,t),r]}):[void 0,void 0]}function JG(e){return[{type:"log",item_count:e.length,content_type:"application/vnd.sentry.items.log+json"},{items:e}]}function eV(e,t,n,r){const o={};return t?.sdk&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=Ro(r)),lr(o,[JG(e)])}function KM(e,t){const n=t??tV(e)??[];if(n.length===0)return;const r=e.getOptions(),o=eV(n,r._metadata,r.tunnel,e.getDsn());zM().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(o)}function tV(e){return zM().get(e)}function zM(){return ls("clientToLogBufferMap",()=>new WeakMap)}function nV(e){return[{type:"trace_metric",item_count:e.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:e}]}function rV(e,t,n,r){const o={};return t?.sdk&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=Ro(r)),lr(o,[nV(e)])}function oV(e,t){const n=t??sV(e)??[];if(n.length===0)return;const r=e.getOptions(),o=rV(n,r._metadata,r.tunnel,e.getDsn());ZM().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(o)}function sV(e){return ZM().get(e)}function ZM(){return ls("clientToMetricBufferMap",()=>new WeakMap)}const RE=Symbol.for("SentryBufferFullError");function XM(e=100){const t=new Set;function n(){return t.size<e}function r(i){t.delete(i)}function o(i){if(!n())return AE(RE);const a=i();return t.add(a),a.then(()=>r(a),()=>r(a)),a}function s(i){if(!t.size)return Ku(!0);const a=Promise.allSettled(Array.from(t)).then(()=>!0);if(!i)return a;const c=[a,new Promise(u=>setTimeout(()=>u(!1),i))];return Promise.race(c)}return{get $(){return Array.from(t)},add:o,drain:s}}const iV=60*1e3;function aV(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${e}`);return isNaN(r)?iV:r-t}function cV(e,t){return e[t]||e.all||0}function uV(e,t,n=Date.now()){return cV(e,t)>n}function lV(e,{statusCode:t,headers:n},r=Date.now()){const o={...e},s=n?.["x-sentry-rate-limits"],i=n?.["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,u,,,f]=a.split(":",5),d=parseInt(c,10),l=(isNaN(d)?60:d)*1e3;if(!u)o.all=r+l;else for(const _ of u.split(";"))_==="metric_bucket"?(!f||f.split(";").includes("custom"))&&(o[_]=r+l):o[_]=r+l}else i?o.all=r+aV(i,r):t===429&&(o.all=r+60*1e3);return o}const QM=64;function aR(e,t,n=XM(e.bufferSize||QM)){let r={};const o=i=>n.drain(i);function s(i){const a=[];if(WA(i,(d,l)=>{const _=KA(l);uV(r,_)?e.recordDroppedEvent("ratelimit_backoff",_):a.push(d)}),a.length===0)return Promise.resolve({});const c=lr(i[0],a),u=d=>{WA(c,(l,_)=>{e.recordDroppedEvent(d,KA(_))})},f=()=>t({body:UM(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&de&&j.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=lV(r,d),d),d=>{throw u("network_error"),de&&j.error("Encountered error running transport request:",d),d});return n.add(f).then(d=>d,d=>{if(d===RE)return de&&j.error("Skipped sending event because buffer is full."),u("queue_overflow"),Promise.resolve({});throw d})}return{send:s,flush:o}}function dV(e,t,n){const r=[{type:"client_report"},{timestamp:Gc(),discarded_events:e}];return lr(t?{dsn:t}:{},[r])}function JM(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}function fV(e){const{trace_id:t,parent_span_id:n,span_id:r,status:o,origin:s,data:i,op:a}=e.contexts?.trace??{};return{data:i??{},description:e.transaction,op:a,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:o,timestamp:e.timestamp,trace_id:t??"",origin:s,profile_id:i?.[_E],exclusive_time:i?.[pE],measurements:e.measurements,is_segment:!0}}function _V(e){return{type:"transaction",timestamp:e.timestamp,start_timestamp:e.start_timestamp,transaction:e.description,contexts:{trace:{trace_id:e.trace_id,span_id:e.span_id,parent_span_id:e.parent_span_id,op:e.op,status:e.status,origin:e.origin,data:{...e.data,...e.profile_id&&{[_E]:e.profile_id},...e.exclusive_time&&{[pE]:e.exclusive_time}}}},measurements:e.measurements}}const cR="Not capturing exception because it's already been captured.",uR="Discarded session because of missing or non-string release",ev=Symbol.for("SentryInternalError"),tv=Symbol.for("SentryDoNotSendEventError"),pV=5e3;function Cu(e){return{message:e,[ev]:!0}}function Jd(e){return{message:e,[tv]:!0}}function lR(e){return!!e&&typeof e=="object"&&ev in e}function dR(e){return!!e&&typeof e=="object"&&tv in e}function fR(e,t,n,r,o){let s=0,i,a=!1;e.on(n,()=>{s=0,clearTimeout(i),a=!1}),e.on(t,c=>{s+=r(c),s>=8e5?o(e):a||(a=!0,i=setTimeout(()=>{o(e)},pV))}),e.on("flush",()=>{o(e)})}class hV{constructor(t){if(this._options=t,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=XM(t.transportOptions?.bufferSize??QM),t.dsn?this._dsn=Bx(t.dsn):de&&j.warn("No DSN provided, client will not send events."),this._dsn){const r=KG(this._dsn,t.tunnel,t._metadata?t._metadata.sdk:void 0);this._transport=t.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:r})}this._options.enableLogs=this._options.enableLogs??this._options._experiments?.enableLogs,this._options.enableLogs&&fR(this,"afterCaptureLog","flushLogs",mV,KM),(this._options.enableMetrics??this._options._experiments?.enableMetrics??!0)&&fR(this,"afterCaptureMetric","flushMetrics",SV,oV)}captureException(t,n,r){const o=jt();if(VA(t))return de&&j.log(cR),o;const s={event_id:o,...n};return this._process(()=>this.eventFromException(t,s).then(i=>this._captureEvent(i,s,r)).then(i=>i),"error"),s.event_id}captureMessage(t,n,r,o){const s={event_id:jt(),...r},i=uE(t)?t:String(t),a=TM(t),c=a?this.eventFromMessage(i,n,s):this.eventFromException(t,s);return this._process(()=>c.then(u=>this._captureEvent(u,s,o)),a?"unknown":"error"),s.event_id}captureEvent(t,n,r){const o=jt();if(n?.originalException&&VA(n.originalException))return de&&j.log(cR),o;const s={event_id:o,...n},i=t.sdkProcessingMetadata||{},a=i.capturedSpanScope,c=i.capturedSpanIsolationScope,u=_R(t.type);return this._process(()=>this._captureEvent(t,s,a||r,c),u),s.event_id}captureSession(t){this.sendSession(t),Qo(t,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}async flush(t){const n=this._transport;if(!n)return!0;this.emit("flush");const r=await this._isClientDoneProcessing(t),o=await n.flush(t);return r&&o}async close(t){const n=await this.flush(t);return this.getOptions().enabled=!1,this.emit("close"),n}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}init(){(this._isEnabled()||this._options.integrations.some(({name:t})=>t.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(t){return this._integrations[t]}addIntegration(t){const n=this._integrations[t.name];WM(this,t,this._integrations),n||iR(this,[t])}sendEvent(t,n={}){this.emit("beforeSendEvent",t,n);let r=_G(t,this._dsn,this._options._metadata,this._options.tunnel);for(const o of n.attachments||[])r=sG(r,cG(o));this.sendEnvelope(r).then(o=>this.emit("afterSendEvent",t,o))}sendSession(t){const{release:n,environment:r=mE}=this._options;if("aggregates"in t){const s=t.attrs||{};if(!s.release&&!n){de&&j.warn(uR);return}s.release=s.release||n,s.environment=s.environment||r,t.attrs=s}else{if(!t.release&&!n){de&&j.warn(uR);return}t.release=t.release||n,t.environment=t.environment||r}this.emit("beforeSendSession",t);const o=fG(t,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(o)}recordDroppedEvent(t,n,r=1){if(this._options.sendClientReports){const o=`${t}:${n}`;de&&j.log(`Recording outcome: "${o}"${r>1?` (${r} times)`:""}`),this._outcomes[o]=(this._outcomes[o]||0)+r}}on(t,n){const r=this._hooks[t]=this._hooks[t]||new Set,o=(...s)=>n(...s);return r.add(o),()=>{r.delete(o)}}emit(t,...n){const r=this._hooks[t];r&&r.forEach(o=>o(...n))}async sendEnvelope(t){if(this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport)try{return await this._transport.send(t)}catch(n){return de&&j.error("Error while sending envelope:",n),{}}return de&&j.error("Transport disabled"),{}}_setupIntegrations(){const{integrations:t}=this._options;this._integrations=XG(this,t),iR(this,t)}_updateSessionFromEvent(t,n){let r=n.level==="fatal",o=!1;const s=n.exception?.values;if(s){o=!0,r=!1;for(const c of s)if(c.mechanism?.handled===!1){r=!0;break}}const i=t.status==="ok";(i&&t.errors===0||i&&r)&&(Qo(t,{...r&&{status:"crashed"},errors:t.errors||Number(o||r)}),this.captureSession(t))}async _isClientDoneProcessing(t){let n=0;for(;!t||n<t;){if(await new Promise(r=>setTimeout(r,1)),!this._numProcessing)return!0;n++}return!1}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(t,n,r,o){const s=this.getOptions(),i=Object.keys(this._integrations);return!n.integrations&&i?.length&&(n.integrations=i),this.emit("preprocessEvent",t,n),t.type||o.setLastEventId(t.event_id||n.event_id),CG(s,t,n,r,this,o).then(a=>{if(a===null)return a;this.emit("postprocessEvent",a,n),a.contexts={trace:fE(r),...a.contexts};const c=Bc(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:c,...a.sdkProcessingMetadata},a})}_captureEvent(t,n={},r=ze(),o=je()){return de&&dh(t)&&j.log(`Captured error event \`${JM(t)[0]||"<unknown>"}\``),this._processEvent(t,n,r,o).then(s=>s.event_id,s=>{de&&(dR(s)?j.log(s.message):lR(s)?j.warn(s.message):j.warn(s))})}_processEvent(t,n,r,o){const s=this.getOptions(),{sampleRate:i}=s,a=nv(t),c=dh(t),f=`before send for type \`${t.type||"error"}\``,d=typeof i>"u"?void 0:fo(i);if(c&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error"),AE(Jd(`Discarding event because it's not included in the random sample (sampling rate = ${i})`));const l=_R(t.type);return this._prepareEvent(t,n,r,o).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",l),Jd("An event processor returned `null`, will not send event.");if(n.data&&n.data.__sentry__===!0)return _;const h=TV(this,s,_,n);return EV(h,f)}).then(_=>{if(_===null){if(this.recordDroppedEvent("before_send",l),a){const T=1+(t.spans||[]).length;this.recordDroppedEvent("before_send","span",T)}throw Jd(`${f} returned \`null\`, will not send event.`)}const p=r.getSession()||o.getSession();if(c&&p&&this._updateSessionFromEvent(p,_),a){const E=_.sdkProcessingMetadata?.spanCountBeforeProcessing||0,T=_.spans?_.spans.length:0,S=E-T;S>0&&this.recordDroppedEvent("before_send","span",S)}const h=_.transaction_info;if(a&&h&&_.transaction!==t.transaction){const E="custom";_.transaction_info={...h,source:E}}return this.sendEvent(_,n),_}).then(null,_=>{throw dR(_)||lR(_)?_:(this.captureException(_,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:_}),Cu(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(t,n){this._numProcessing++,this._promiseBuffer.add(t).then(r=>(this._numProcessing--,r),r=>(this._numProcessing--,r===RE&&this.recordDroppedEvent("queue_overflow",n),r))}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.entries(t).map(([n,r])=>{const[o,s]=n.split(":");return{reason:o,category:s,quantity:r}})}_flushOutcomes(){de&&j.log("Flushing outcomes...");const t=this._clearOutcomes();if(t.length===0){de&&j.log("No outcomes to send");return}if(!this._dsn){de&&j.log("No dsn provided, will not send outcomes");return}de&&j.log("Sending outcomes:",t);const n=dV(t,this._options.tunnel&&Ro(this._dsn));this.sendEnvelope(n)}}function _R(e){return e==="replay_event"?"replay":e||"error"}function EV(e,t){const n=`${t} must return \`null\` or a valid event.`;if(ur(e))return e.then(r=>{if(!gc(r)&&r!==null)throw Cu(n);return r},r=>{throw Cu(`${t} rejected with ${r}`)});if(!gc(e)&&e!==null)throw Cu(n);return e}function TV(e,t,n,r){const{beforeSend:o,beforeSendTransaction:s,beforeSendSpan:i,ignoreSpans:a}=t;let c=n;if(dh(c)&&o)return o(c,r);if(nv(c)){if(i||a){const u=fV(c);if(a?.length&&ah(u,a))return null;if(i){const f=i(u);f?c=Vc(n,_V(f)):ih()}if(c.spans){const f=[],d=c.spans;for(const _ of d){if(a?.length&&ah(_,a)){Qx(d,_);continue}if(i){const p=i(_);p?f.push(p):(ih(),f.push(_))}else f.push(_)}const l=c.spans.length-f.length;l&&e.recordDroppedEvent("before_send","span",l),c.spans=f}}if(s){if(c.spans){const u=c.spans.length;c.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:u}}return s(c,r)}}return c}function dh(e){return e.type===void 0}function nv(e){return e.type==="transaction"}function SV(e){let t=0;return e.name&&(t+=e.name.length*2),t+=8,t+rv(e.attributes)}function mV(e){let t=0;return e.message&&(t+=e.message.length*2),t+rv(e.attributes)}function rv(e){if(!e)return 0;let t=0;return Object.values(e).forEach(n=>{Array.isArray(n)?t+=n.length*pR(n[0]):TM(n)?t+=pR(n):t+=100}),t}function pR(e){return typeof e=="string"?e.length*2:typeof e=="number"?8:typeof e=="boolean"?4:0}function gV(e,t,n,r,o){const s={sent_at:new Date().toISOString()};n?.sdk&&(s.sdk={name:n.sdk.name,version:n.sdk.version}),r&&o&&(s.dsn=Ro(o)),t&&(s.trace=t);const i=AV(e);return lr(s,[i])}function AV(e){return[{type:"check_in"},e]}function RV(e){const t=e._metadata?.sdk,n=t?.name&&t?.version?`${t?.name}/${t?.version}`:void 0;e.transportOptions={...e.transportOptions,headers:{...n&&{"user-agent":n},...e.transportOptions?.headers}}}function ov(e,t){return e(t.stack||"",1)}function sv(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=ov(e,t);return r.length&&(n.stacktrace={frames:r}),n}function yV(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function NV(e){if("name"in e&&typeof e.name=="string"){let r=`'${e.name}' captured as exception`;return"message"in e&&typeof e.message=="string"&&(r+=` with message '${e.message}'`),r}else if("message"in e&&typeof e.message=="string")return e.message;const t=rx(e);if(j1(e))return`Event \`ErrorEvent\` captured as exception with message \`${e.message}\``;const n=OV(e);return`${n&&n!=="Object"?`'${n}'`:"Object"} captured as exception with keys: ${t}`}function OV(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function bV(e,t,n,r){if($u(n))return[n,void 0];if(t.synthetic=!0,gc(n)){const s=e?.getOptions().normalizeDepth,i={__serialized__:DM(n,s)},a=yV(n);if(a)return[a,i];const c=NV(n),u=r?.syntheticException||new Error(c);return u.message=c,[u,i]}const o=r?.syntheticException||new Error(n);return o.message=`${n}`,[o,void 0]}function CV(e,t,n,r){const s=r?.data&&r.data.mechanism||{handled:!0,type:"generic"},[i,a]=bV(e,s,n,r),c={exception:{values:[sv(t,i)]}};return a&&(c.extra=a),cx(c),lE(c,s),{...c,event_id:r?.event_id}}function IV(e,t,n="info",r,o){const s={event_id:r?.event_id,level:n};if(o&&r?.syntheticException){const i=ov(e,r.syntheticException);i.length&&(s.exception={values:[{value:t,stacktrace:{frames:i}}]},lE(s,{synthetic:!0}))}if(uE(t)){const{__sentry_template_string__:i,__sentry_template_values__:a}=t;return s.logentry={message:i,params:a},s}return s.message=t,s}class PV extends hV{constructor(t){Xx(),RV(t),super(t),this._setUpMetricsProcessing()}eventFromException(t,n){const r=CV(this,this._options.stackParser,t,n);return r.level="error",Ku(r)}eventFromMessage(t,n="info",r){return Ku(IV(this._options.stackParser,t,n,r,this._options.attachStacktrace))}captureException(t,n,r){return hR(n),super.captureException(t,n,r)}captureEvent(t,n,r){return!t.type&&t.exception?.values&&t.exception.values.length>0&&hR(n),super.captureEvent(t,n,r)}captureCheckIn(t,n,r){const o="checkInId"in t&&t.checkInId?t.checkInId:jt();if(!this._isEnabled())return de&&j.warn("SDK not enabled, will not capture check-in."),o;const s=this.getOptions(),{release:i,environment:a,tunnel:c}=s,u={check_in_id:o,monitor_slug:t.monitorSlug,status:t.status,release:i,environment:a};"duration"in t&&(u.duration=t.duration),n&&(u.monitor_config={schedule:n.schedule,checkin_margin:n.checkinMargin,max_runtime:n.maxRuntime,timezone:n.timezone,failure_issue_threshold:n.failureIssueThreshold,recovery_threshold:n.recoveryThreshold});const[f,d]=QG(this,r);d&&(u.contexts={trace:d});const l=gV(u,f,this.getSdkMetadata(),c,this.getDsn());return de&&j.log("Sending checkin:",t.monitorSlug,t.status),this.sendEnvelope(l),o}_prepareEvent(t,n,r,o){return this._options.platform&&(t.platform=t.platform||this._options.platform),this._options.runtime&&(t.contexts={...t.contexts,runtime:t.contexts?.runtime||this._options.runtime}),this._options.serverName&&(t.server_name=t.server_name||this._options.serverName),super._prepareEvent(t,n,r,o)}_setUpMetricsProcessing(){this.on("processMetric",t=>{this._options.serverName&&(t.attributes={"server.address":this._options.serverName,...t.attributes})})}}function hR(e){const t=je().getScopeData().sdkProcessingMetadata.requestSession;if(t){const n=e?.mechanism?.handled??!0;n&&t.status!=="crashed"?t.status="errored":n||(t.status="crashed")}}const yE=new Set;function MV(e){e.forEach(t=>{yE.add(t),de&&j.log(`AI provider "${t}" wrapping will be skipped`)})}function NE(e){return yE.has(e)}function vV(){yE.clear(),de&&j.log("Cleared AI provider skip registrations")}const wV="thismessage:/";function LV(e,t){const n=e.indexOf("://")<=0&&e.indexOf("//")!==0,r=n?wV:void 0;try{if("canParse"in URL&&!URL.canParse(e,r))return;const o=new URL(e,r);return n?{isRelative:n,pathname:o.pathname,search:o.search,hash:o.hash}:o}catch{}}function Hl(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function Nc(e){return e.split(/[?#]/,1)[0]}function Fl(e){const{protocol:t,host:n,path:r}=e,o=n?.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${t?`${t}://`:""}${o}${r}`}function OE(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:Qe})),version:Qe}),e._metadata=o}function iv(e={}){const t=e.client||Te();if(!BG()||!t)return{};const n=Kn(),r=Ao(n);if(r.getTraceData)return r.getTraceData(e);const o=e.scope||ze(),s=e.span||Vl(),i=s?qx(s):DV(o),a=s?$t(s):Bc(t,o),c=EE(a);if(!IM.test(i))return j.warn("Invalid sentry-trace data. Cannot generate trace data"),{};const f={"sentry-trace":i,baggage:c};if(e.propagateTraceparent){const d=s?Wx(s):UV(o);d&&(f.traceparent=d)}return f}function DV(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return Ul(t,r,n)}function UV(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return MM(t,r,n)}function kV(e,t,n){let r,o,s;const i=Math.max(n.maxWait,t),a=n?.setTimeoutImpl||setTimeout;function c(){return u(),r=e(),r}function u(){o!==void 0&&clearTimeout(o),s!==void 0&&clearTimeout(s),o=s=void 0}function f(){return o!==void 0||s!==void 0?c():r}function d(){return o&&clearTimeout(o),o=a(c,t),i&&s===void 0&&(s=a(c,i)),r}return d.cancel=u,d.flush=f,d}function xV(e){const t=Object.create(null);try{Object.entries(e).forEach(([n,r])=>{typeof r=="string"&&(t[n]=r)})}catch{}return t}function GV(e){const t=e.headers||{},r=(typeof t["x-forwarded-host"]=="string"?t["x-forwarded-host"]:void 0)||(typeof t.host=="string"?t.host:void 0),s=(typeof t["x-forwarded-proto"]=="string"?t["x-forwarded-proto"]:void 0)||e.protocol||(e.socket?.encrypted?"https":"http"),i=e.url||"",a=VV({url:i,host:r,protocol:s}),c=e.body||void 0,u=e.cookies;return{url:a,method:e.method,query_string:HV(i),headers:xV(t),cookies:u,data:c}}function VV({url:e,protocol:t,host:n}){if(e?.startsWith("http"))return e;if(e&&n)return`${t}://${n}${e}`}const $V=["auth","token","secret","cookie","-user","password","key","jwt","bearer","sso","saml"];function BV(e){const t={};try{Object.entries(e).forEach(([n,r])=>{if(r==null)return;const o=n.toLowerCase(),s=$V.some(a=>o.includes(a)),i=`http.request.header.${o.replace(/-/g,"_")}`;s?t[i]="[Filtered]":Array.isArray(r)?t[i]=r.map(a=>a!=null?String(a):a).join(";"):typeof r=="string"&&(t[i]=r)})}catch{}return t}function HV(e){if(e)try{const t=new URL(e,"http://s.io").search.slice(1);return t.length?t:void 0}catch{return}}const FV=100;function rs(e,t){const n=Te(),r=je();if(!n)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:s=FV}=n.getOptions();if(s<=0)return;const a={timestamp:Gc(),...e},c=o?cn(()=>o(a,t)):a;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,t),r.addBreadcrumb(c,s))}let ER;const YV="FunctionToString",TR=new WeakMap,jV=(()=>({name:YV,setupOnce(){ER=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=nx(this),n=TR.has(Te())&&t!==void 0?t:this;return ER.apply(n,e)}}catch{}},setup(e){TR.set(e,!0)}})),qV=jV,WV=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],KV="EventFilters",zV=(e={})=>{let t;return{name:KV,setup(n){const r=n.getOptions();t=SR(e,r)},processEvent(n,r,o){if(!t){const s=o.getOptions();t=SR(e,s)}return XV(n,t)?null:n}}},ZV=((e={})=>({...zV(e),name:"InboundFilters"}));function SR(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:WV],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function XV(e,t){if(e.type){if(e.type==="transaction"&&JV(e,t.ignoreTransactions))return de&&j.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${ko(e)}`),!0}else{if(QV(e,t.ignoreErrors))return de&&j.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ko(e)}`),!0;if(r$(e))return de&&j.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${ko(e)}`),!0;if(e$(e,t.denyUrls))return de&&j.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ko(e)}.
Url: ${zu(e)}`),!0;if(!t$(e,t.allowUrls))return de&&j.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ko(e)}.
Url: ${zu(e)}`),!0}return!1}function QV(e,t){return t?.length?JM(e).some(n=>xc(n,t)):!1}function JV(e,t){if(!t?.length)return!1;const n=e.transaction;return n?xc(n,t):!1}function e$(e,t){if(!t?.length)return!1;const n=zu(e);return n?xc(n,t):!1}function t$(e,t){if(!t?.length)return!0;const n=zu(e);return n?xc(n,t):!0}function n$(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function zu(e){try{const n=[...e.exception?.values??[]].reverse().find(r=>r.mechanism?.parent_id===void 0&&r.stacktrace?.frames?.length)?.stacktrace?.frames;return n?n$(n):null}catch{return de&&j.error(`Cannot extract url for event ${ko(e)}`),null}}function r$(e){return e.exception?.values?.length?!e.message&&!e.exception.values.some(t=>t.stacktrace||t.type&&t.type!=="Error"||t.value):!1}function o$(e,t,n,r,o,s){if(!o.exception?.values||!s||!co(s.originalException,Error))return;const i=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;i&&(o.exception.values=fh(e,t,r,s.originalException,n,o.exception.values,i,0))}function fh(e,t,n,r,o,s,i,a){if(s.length>=n+1)return s;let c=[...s];if(co(r[o],Error)){mR(i,a);const u=e(t,r[o]),f=c.length;gR(u,o,f,a),c=fh(e,t,n,r[o],o,[u,...c],u,f)}return Array.isArray(r.errors)&&r.errors.forEach((u,f)=>{if(co(u,Error)){mR(i,a);const d=e(t,u),l=c.length;gR(d,`errors[${f}]`,l,a),c=fh(e,t,n,u,o,[d,...c],d,l)}}),c}function mR(e,t){e.mechanism={handled:!0,type:"auto.core.linked_errors",...e.mechanism,...e.type==="AggregateError"&&{is_exception_group:!0},exception_id:t}}function gR(e,t,n,r){e.mechanism={handled:!0,...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const s$="cause",i$=5,a$="LinkedErrors",c$=((e={})=>{const t=e.limit||i$,n=e.key||s$;return{name:a$,preprocessEvent(r,o,s){const i=s.getOptions();o$(sv,i.stackParser,n,t,r,o)}}}),u$=c$;function l$(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(r===-1)break;let o=e.indexOf(";",n);if(o===-1)o=e.length;else if(o<r){n=e.lastIndexOf(";",r-1)+1;continue}const s=e.slice(n,r).trim();if(t[s]===void 0){let i=e.slice(r+1,o).trim();i.charCodeAt(0)===34&&(i=i.slice(1,-1));try{t[s]=i.indexOf("%")!==-1?decodeURIComponent(i):i}catch{t[s]=i}}n=o+1}return t}const av=["X-Client-IP","X-Forwarded-For","Fly-Client-IP","CF-Connecting-IP","Fastly-Client-Ip","True-Client-Ip","X-Real-IP","X-Cluster-Client-IP","X-Forwarded","Forwarded-For","Forwarded","X-Vercel-Forwarded-For"];function d$(e){return av.map(o=>{const s=e[o],i=Array.isArray(s)?s.join(";"):s;return o==="Forwarded"?f$(i):i?.split(",").map(a=>a.trim())}).reduce((o,s)=>s?o.concat(s):o,[]).find(o=>o!==null&&_$(o))||null}function f$(e){if(!e)return null;for(const t of e.split(";"))if(t.startsWith("for="))return t.slice(4);return null}function _$(e){return/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/.test(e)}const p$={cookies:!0,data:!0,headers:!0,query_string:!0,url:!0},h$="RequestData",E$=((e={})=>{const t={...p$,...e.include};return{name:h$,processEvent(n,r,o){const{sdkProcessingMetadata:s={}}=n,{normalizedRequest:i,ipAddress:a}=s,c={...t,ip:t.ip??o.getOptions().sendDefaultPii};return i&&S$(n,i,{ipAddress:a},c),n}}}),T$=E$;function S$(e,t,n,r){if(e.request={...e.request,...m$(t,r)},r.ip){const o=t.headers&&d$(t.headers)||n.ipAddress;o&&(e.user={...e.user,ip_address:o})}}function m$(e,t){const n={},r={...e.headers};if(t.headers&&(n.headers=r,t.cookies||delete r.cookie,t.ip||av.forEach(o=>{delete r[o]})),n.method=e.method,t.url&&(n.url=e.url),t.cookies){const o=e.cookies||(r?.cookie?l$(r.cookie):void 0);n.cookies=o||{}}return t.query_string&&(n.query_string=e.query_string),t.data&&(n.data=e.data),n}function g$(e){const t="console";iE(t,e),aE(t,A$)}function A$(){"console"in Oe&&uM.forEach(function(e){e in Oe.console&&ex(Oe.console,e,function(t){return Vu[e]=t,function(...n){cE("console",{args:n,level:e}),Vu[e]?.apply(Oe.console,n)}})})}function R$(e){return e==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}function y$(e,t){let n=0;for(let r=e.length-1;r>=0;r--){const o=e[r];o==="."?e.splice(r,1):o===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}const N$=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function cv(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=N$.exec(t);return n?n.slice(1):[]}function AR(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const o=r>=0?e[r]:"/";o&&(t=`${o}/${t}`,n=o.charAt(0)==="/")}return t=y$(t.split("/").filter(r=>!!r),!n).join("/"),(n?"/":"")+t||"."}function RR(e){let t=0;for(;t<e.length&&e[t]==="";t++);let n=e.length-1;for(;n>=0&&e[n]==="";n--);return t>n?[]:e.slice(t,n-t+1)}function O$(e,t){e=AR(e).slice(1),t=AR(t).slice(1);const n=RR(e.split("/")),r=RR(t.split("/")),o=Math.min(n.length,r.length);let s=o;for(let a=0;a<o;a++)if(n[a]!==r[a]){s=a;break}let i=[];for(let a=s;a<n.length;a++)i.push("..");return i=i.concat(r.slice(s)),i.join("/")}function b$(e){const t=cv(e),n=t[0]||"";let r=t[1];return!n&&!r?".":(r&&(r=r.slice(0,r.length-1)),n+r)}function C$(e,t){return cv(e)[2]||""}const I$="RewriteFrames",P$=(e={})=>{const t=e.root,n=e.prefix||"app:///",r="window"in Oe&&!!Oe.window,o=e.iteratee||M$({isBrowser:r,root:t,prefix:n});function s(a){try{return{...a,exception:{...a.exception,values:a.exception.values.map(c=>({...c,...c.stacktrace&&{stacktrace:i(c.stacktrace)}}))}}}catch{return a}}function i(a){return{...a,frames:a?.frames?.map(c=>o(c))}}return{name:I$,processEvent(a){let c=a;return a.exception&&Array.isArray(a.exception.values)&&(c=s(c)),c}}};function M$({isBrowser:e,root:t,prefix:n}){return r=>{if(!r.filename)return r;const o=/^[a-zA-Z]:\\/.test(r.filename)||r.filename.includes("\\")&&!r.filename.includes("/"),s=/^\//.test(r.filename);if(e){if(t){const i=r.filename;i.indexOf(t)===0&&(r.filename=i.replace(t,n))}}else if(o||s){const i=o?r.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):r.filename,a=t?O$(t,i):C$(i);r.filename=`${n}${a}`}return r}}const v$="Console",w$=(e={})=>{const t=new Set(e.levels||uM);return{name:v$,setup(n){g$(({args:r,level:o})=>{Te()!==n||!t.has(o)||L$(o,r)})}}};function L$(e,t){const n={category:"console",data:{arguments:t,logger:"console"},level:R$(e),message:yR(t)};if(e==="assert")if(t[0]===!1){const r=t.slice(1);n.message=r.length>0?`Assertion failed: ${yR(r)}`:"Assertion failed",n.data.arguments=r}else return;rs(n,{input:t,level:e})}function yR(e){return"util"in Oe&&typeof Oe.util.format=="function"?Oe.util.format(...e):sx(e," ")}const D$="gen_ai.prompt",Yl="gen_ai.system",yt="gen_ai.request.model",bE="gen_ai.request.stream",jl="gen_ai.request.temperature",CE="gen_ai.request.max_tokens",ql="gen_ai.request.frequency_penalty",IE="gen_ai.request.presence_penalty",Wl="gen_ai.request.top_p",uv="gen_ai.request.top_k",U$="gen_ai.request.encoding_format",k$="gen_ai.request.dimensions",dr="gen_ai.response.finish_reasons",yn="gen_ai.response.model",_s="gen_ai.response.id",x$="gen_ai.response.stop_reason",Wt="gen_ai.usage.input_tokens",Kt="gen_ai.usage.output_tokens",po="gen_ai.usage.total_tokens",Wn="gen_ai.operation.name",Vt="gen_ai.request.messages",zt="gen_ai.response.text",Kl="gen_ai.request.available_tools",zl="gen_ai.response.streaming",In="gen_ai.response.tool_calls",lv="gen_ai.agent.name",G$="gen_ai.pipeline.name",V$="gen_ai.usage.cache_creation_input_tokens",$$="gen_ai.usage.cache_read_input_tokens",NR="gen_ai.usage.input_tokens.cache_write",nc="gen_ai.usage.input_tokens.cached",B$="gen_ai.invoke_agent",H$="openai.response.id",dv="openai.response.model",F$="openai.response.timestamp",Y$="openai.usage.completion_tokens",j$="openai.usage.prompt_tokens",ef={CHAT:"chat",RESPONSES:"responses",EMBEDDINGS:"embeddings"},OR="anthropic.response.timestamp",PE=new Map,fv=2e4,Zu=e=>new TextEncoder().encode(e).length,Xu=e=>Zu(JSON.stringify(e));function ME(e,t){if(Zu(e)<=t)return e;let n=0,r=e.length,o="";for(;n<=r;){const s=Math.floor((n+r)/2),i=e.slice(0,s);Zu(i)<=t?(o=i,n=s+1):r=s-1}return o}function q$(e){return typeof e=="string"?e:e.text}function bR(e,t){return typeof e=="string"?t:{...e,text:t}}function W$(e){return e!==null&&typeof e=="object"&&"content"in e&&typeof e.content=="string"}function K$(e){return e!==null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)&&e.parts.length>0}function z$(e,t){const n={...e,content:""},r=Xu(n),o=t-r;if(o<=0)return[];const s=ME(e.content,o);return[{...e,content:s}]}function Z$(e,t){const{parts:n}=e,r=n.map(a=>bR(a,"")),o=Xu({...e,parts:r});let s=t-o;if(s<=0)return[];const i=[];for(const a of n){const c=q$(a),u=Zu(c);if(u<=s)i.push(a),s-=u;else if(i.length===0){const f=ME(c,s);f&&i.push(bR(a,f));break}else break}return i.length>0?[{...e,parts:i}]:[]}function X$(e,t){return!e||typeof e!="object"?[]:W$(e)?z$(e,t):K$(e)?Z$(e,t):[]}function Q$(e,t){if(!Array.isArray(e)||e.length===0||Xu(e)<=t)return e;const r=e.map(Xu);let o=0,s=e.length;for(let i=e.length-1;i>=0;i--){const a=r[i];if(a&&o+a>t)break;a&&(o+=a),s=i}if(s===e.length){const i=e[e.length-1];return X$(i,t)}return e.slice(s)}function vE(e){return Q$(e,fv)}function J$(e){return ME(e,fv)}function Hc(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.includes("chat")?"chat":e.split(".").pop()||"unknown"}function Qu(e){return`gen_ai.${Hc(e)}`}function _v(e,t){return e?`${e}.${t}`:t}function wE(e,t,n,r,o){if(t!==void 0&&e.setAttributes({[Wt]:t}),n!==void 0&&e.setAttributes({[Kt]:n}),t!==void 0||n!==void 0||r!==void 0||o!==void 0){const s=(t??0)+(n??0)+(r??0)+(o??0);e.setAttributes({[po]:s})}}function Fn(e){if(typeof e=="string")return J$(e);if(Array.isArray(e)){const t=vE(e);return JSON.stringify(t)}return JSON.stringify(e)}const eB="operation.name",tf="ai.prompt",tB="ai.schema",nB="ai.response.object",rB="ai.response.text",oB="ai.response.toolCalls",pv="ai.prompt.messages",Ta="ai.prompt.tools",pn="ai.model.id",sB="ai.model.provider",iB="ai.response.providerMetadata",aB="ai.usage.cachedInputTokens",cB="ai.telemetry.functionId",uB="ai.usage.completionTokens",lB="ai.usage.promptTokens",hv="ai.toolCall.name",Ev="ai.toolCall.id",dB="ai.toolCall.args",fB="ai.toolCall.result";function _B(e,t){const n=e.parent_span_id;if(!n)return;const r=e.data[Wt],o=e.data[Kt];if(typeof r=="number"||typeof o=="number"){const s=t.get(n)||{inputTokens:0,outputTokens:0};typeof r=="number"&&(s.inputTokens+=r),typeof o=="number"&&(s.outputTokens+=o),t.set(n,s)}}function CR(e,t){const n=t.get(e.span_id);!n||!e.data||(n.inputTokens>0&&(e.data[Wt]=n.inputTokens),n.outputTokens>0&&(e.data[Kt]=n.outputTokens),(n.inputTokens>0||n.outputTokens>0)&&(e.data["gen_ai.usage.total_tokens"]=n.inputTokens+n.outputTokens))}function pB(e){return PE.get(e)}function hB(e){PE.delete(e)}function EB(e){const t=e.map(n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n});return JSON.stringify(t)}function TB(e){try{const t=JSON.parse(e);if(t&&typeof t=="object"){const{prompt:n,system:r}=t;if(typeof n=="string"||typeof r=="string"){const o=[];return typeof r=="string"&&o.push({role:"system",content:r}),typeof n=="string"&&o.push({role:"user",content:n}),o}}}catch{}return[]}function SB(e,t){if(t[tf]){const r=Fn(t[tf]);e.setAttribute("gen_ai.prompt",r)}const n=t[tf];if(typeof n=="string"&&!t[Vt]&&!t[pv]){const r=TB(n);r.length&&e.setAttribute(Vt,Fn(r))}}function Tv(e,t){e.setAttribute(xe,t)}function mB(e){const{data:t,description:n}=ye(e);if(!n)return;if(t[hv]&&t[Ev]&&n==="ai.toolCall"){RB(e,t);return}const r=t[pn],o=t[sB];typeof r!="string"||typeof o!="string"||!r||!o||yB(e,n,t)}function gB(e){if(e.type==="transaction"&&e.spans){const t=new Map;for(const r of e.spans)AB(r),_B(r,t);for(const r of e.spans)r.op==="gen_ai.invoke_agent"&&CR(r,t);const n=e.contexts?.trace;n&&n.op==="gen_ai.invoke_agent"&&CR(n,t)}return e}function AB(e){const{data:t,origin:n}=e;if(n==="auto.vercelai.otel"){ut(t,uB,Kt),ut(t,lB,Wt),ut(t,aB,nc),typeof t[Kt]=="number"&&typeof t[Wt]=="number"&&(t["gen_ai.usage.total_tokens"]=t[Kt]+t[Wt]),t[Ta]&&Array.isArray(t[Ta])&&(t[Ta]=EB(t[Ta])),ut(t,eB,Wn),ut(t,pv,Vt),ut(t,rB,"gen_ai.response.text"),ut(t,oB,"gen_ai.response.tool_calls"),ut(t,nB,"gen_ai.response.object"),ut(t,Ta,"gen_ai.request.available_tools"),ut(t,dB,"gen_ai.tool.input"),ut(t,fB,"gen_ai.tool.output"),ut(t,tB,"gen_ai.request.schema"),ut(t,pn,yt),NB(t);for(const r of Object.keys(t))r.startsWith("ai.")&&ut(t,r,`vercel.${r}`)}}function ut(e,t,n){e[t]!=null&&(e[n]=e[t],delete e[t])}function RB(e,t){Tv(e,"auto.vercelai.otel"),e.setAttribute(Ee,"gen_ai.execute_tool"),ut(t,hv,"gen_ai.tool.name"),ut(t,Ev,"gen_ai.tool.call.id");const n=t["gen_ai.tool.call.id"];typeof n=="string"&&PE.set(n,e),t["gen_ai.tool.type"]||e.setAttribute("gen_ai.tool.type","function");const r=t["gen_ai.tool.name"];r&&e.updateName(`execute_tool ${r}`)}function yB(e,t,n){Tv(e,"auto.vercelai.otel");const r=t.replace("ai.","");e.setAttribute("ai.pipeline.name",r),e.updateName(r);const o=n[cB];if(o&&typeof o=="string"&&(e.updateName(`${r} ${o}`),e.setAttribute("gen_ai.function_id",o)),SB(e,n),n[pn]&&!n[yn]&&e.setAttribute(yn,n[pn]),e.setAttribute("ai.streaming",t.includes("stream")),t==="ai.generateText"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.generateText.doGenerate"){e.setAttribute(Ee,"gen_ai.generate_text"),e.updateName(`generate_text ${n[pn]}`);return}if(t==="ai.streamText"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.streamText.doStream"){e.setAttribute(Ee,"gen_ai.stream_text"),e.updateName(`stream_text ${n[pn]}`);return}if(t==="ai.generateObject"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.generateObject.doGenerate"){e.setAttribute(Ee,"gen_ai.generate_object"),e.updateName(`generate_object ${n[pn]}`);return}if(t==="ai.streamObject"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.streamObject.doStream"){e.setAttribute(Ee,"gen_ai.stream_object"),e.updateName(`stream_object ${n[pn]}`);return}if(t==="ai.embed"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.embed.doEmbed"){e.setAttribute(Ee,"gen_ai.embed"),e.updateName(`embed ${n[pn]}`);return}if(t==="ai.embedMany"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.embedMany.doEmbed"){e.setAttribute(Ee,"gen_ai.embed_many"),e.updateName(`embed_many ${n[pn]}`);return}if(t.startsWith("ai.stream")){e.setAttribute(Ee,"ai.run");return}}function IR(e){e.on("spanStart",mB),e.addEventProcessor(Object.assign(gB,{id:"VercelAiEventProcessor"}))}function NB(e){const t=e[iB];if(t)try{const n=JSON.parse(t);if(n.openai&&(nn(e,nc,n.openai.cachedPromptTokens),nn(e,"gen_ai.usage.output_tokens.reasoning",n.openai.reasoningTokens),nn(e,"gen_ai.usage.output_tokens.prediction_accepted",n.openai.acceptedPredictionTokens),nn(e,"gen_ai.usage.output_tokens.prediction_rejected",n.openai.rejectedPredictionTokens),nn(e,"gen_ai.conversation.id",n.openai.responseId)),n.anthropic){const r=n.anthropic.usage?.cache_read_input_tokens??n.anthropic.cacheReadInputTokens;nn(e,nc,r);const o=n.anthropic.usage?.cache_creation_input_tokens??n.anthropic.cacheCreationInputTokens;nn(e,NR,o)}n.bedrock?.usage&&(nn(e,nc,n.bedrock.usage.cacheReadInputTokens),nn(e,NR,n.bedrock.usage.cacheWriteInputTokens)),n.deepseek&&(nn(e,nc,n.deepseek.promptCacheHitTokens),nn(e,"gen_ai.usage.input_tokens.cache_miss",n.deepseek.promptCacheMissTokens))}catch{}}function nn(e,t,n){n!=null&&(e[t]=n)}const Zl="OpenAI",OB=["responses.create","chat.completions.create","embeddings.create"],bB=["response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"],CB=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta",...bB];function LE(e){return e.includes("chat.completions")?ef.CHAT:e.includes("responses")?ef.RESPONSES:e.includes("embeddings")?ef.EMBEDDINGS:e.split(".").pop()||"unknown"}function PR(e){return`gen_ai.${LE(e)}`}function IB(e){return OB.includes(e)}function PB(e,t){return e?`${e}.${t}`:t}function MB(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion"}function vB(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="response"}function wB(e){if(e===null||typeof e!="object"||!("object"in e))return!1;const t=e;return t.object==="list"&&typeof t.model=="string"&&t.model.toLowerCase().includes("embedding")}function LB(e){return e!==null&&typeof e=="object"&&"type"in e&&typeof e.type=="string"&&e.type.startsWith("response.")}function DB(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion.chunk"}function UB(e,t,n){if(DE(e,t.id,t.model,t.created),t.usage&&Xl(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map(o=>o.finish_reason).filter(o=>o!==null);if(r.length>0&&e.setAttributes({[dr]:JSON.stringify(r)}),n){const o=t.choices.map(s=>s.message?.tool_calls).filter(s=>Array.isArray(s)&&s.length>0).flat();o.length>0&&e.setAttributes({[In]:JSON.stringify(o)})}}}function kB(e,t,n){if(DE(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[dr]:JSON.stringify([t.status])}),t.usage&&Xl(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const r=t;if(Array.isArray(r.output)&&r.output.length>0){const o=r.output.filter(s=>typeof s=="object"&&s!==null&&s.type==="function_call");o.length>0&&e.setAttributes({[In]:JSON.stringify(o)})}}}function xB(e,t){e.setAttributes({[dv]:t.model,[yn]:t.model}),t.usage&&Xl(e,t.usage.prompt_tokens,void 0,t.usage.total_tokens)}function Xl(e,t,n,r){t!==void 0&&e.setAttributes({[j$]:t,[Wt]:t}),n!==void 0&&e.setAttributes({[Y$]:n,[Kt]:n}),r!==void 0&&e.setAttributes({[po]:r})}function DE(e,t,n,r){e.setAttributes({[H$]:t,[_s]:t}),e.setAttributes({[dv]:n,[yn]:n}),e.setAttributes({[F$]:new Date(r*1e3).toISOString()})}function GB(e,t){for(const n of e){const r=n.index;if(!(r===void 0||!n.function))if(!(r in t.chatCompletionToolCalls))t.chatCompletionToolCalls[r]={...n,function:{name:n.function.name,arguments:n.function.arguments||""}};else{const o=t.chatCompletionToolCalls[r];n.function.arguments&&o?.function&&(o.function.arguments+=n.function.arguments)}}}function VB(e,t,n){t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const r of e.choices??[])n&&(r.delta?.content&&t.responseTexts.push(r.delta.content),r.delta?.tool_calls&&GB(r.delta.tool_calls,t)),r.finish_reason&&t.finishReasons.push(r.finish_reason)}function $B(e,t,n,r){if(!(e&&typeof e=="object")){t.eventTypes.push("unknown:non-object");return}if(e instanceof Error){r.setStatus({code:Ae,message:"internal_error"}),Ve(e,{mechanism:{handled:!1,type:"auto.ai.openai.stream-response"}});return}if(!("type"in e))return;const o=e;if(!CB.includes(o.type)){t.eventTypes.push(o.type);return}if(n&&(o.type==="response.output_item.done"&&"item"in o&&t.responsesApiToolCalls.push(o.item),o.type==="response.output_text.delta"&&"delta"in o&&o.delta)){t.responseTexts.push(o.delta);return}if("response"in o){const{response:s}=o;t.responseId=s.id??t.responseId,t.responseModel=s.model??t.responseModel,t.responseTimestamp=s.created_at??t.responseTimestamp,s.usage&&(t.promptTokens=s.usage.input_tokens,t.completionTokens=s.usage.output_tokens,t.totalTokens=s.usage.total_tokens),s.status&&t.finishReasons.push(s.status),n&&s.output_text&&t.responseTexts.push(s.output_text)}}async function*BB(e,t,n){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{for await(const o of e)DB(o)?VB(o,r,n):LB(o)&&$B(o,r,n,t),yield o}finally{DE(t,r.responseId,r.responseModel,r.responseTimestamp),Xl(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[zl]:!0}),r.finishReasons.length&&t.setAttributes({[dr]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[zt]:r.responseTexts.join("")});const s=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];s.length>0&&t.setAttributes({[In]:JSON.stringify(s)}),t.end()}}function HB(e,t){const n={[Yl]:"openai",[Wn]:LE(t),[xe]:"auto.ai.openai"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0],o=Array.isArray(r.tools)?r.tools:[],i=r.web_search_options&&typeof r.web_search_options=="object"?[{type:"web_search_options",...r.web_search_options}]:[],a=[...o,...i];a.length>0&&(n[Kl]=JSON.stringify(a))}if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];n[yt]=r.model??"unknown","temperature"in r&&(n[jl]=r.temperature),"top_p"in r&&(n[Wl]=r.top_p),"frequency_penalty"in r&&(n[ql]=r.frequency_penalty),"presence_penalty"in r&&(n[IE]=r.presence_penalty),"stream"in r&&(n[bE]=r.stream),"encoding_format"in r&&(n[U$]=r.encoding_format),"dimensions"in r&&(n[k$]=r.dimensions)}else n[yt]="unknown";return n}function FB(e,t,n){if(!t||typeof t!="object")return;const r=t;if(MB(r)){if(UB(e,r,n),n&&r.choices?.length){const o=r.choices.map(s=>s.message?.content||"");e.setAttributes({[zt]:JSON.stringify(o)})}}else vB(r)?(kB(e,r,n),n&&r.output_text&&e.setAttributes({[zt]:r.output_text})):wB(r)&&xB(e,r)}function MR(e,t){if("messages"in t){const n=Fn(t.messages);e.setAttributes({[Vt]:n})}if("input"in t){const n=Fn(t.input);e.setAttributes({[Vt]:n})}}function YB(e,t,n,r){return async function(...s){const i=HB(s,t),a=i[yt]||"unknown",c=LE(t),u=s[0];return u&&typeof u=="object"&&u.stream===!0?Hn({name:`${c} ${a} stream-response`,op:PR(t),attributes:i},async d=>{try{r.recordInputs&&u&&MR(d,u);const l=await e.apply(n,s);return BB(l,d,r.recordOutputs??!1)}catch(l){throw d.setStatus({code:Ae,message:"internal_error"}),Ve(l,{mechanism:{handled:!1,type:"auto.ai.openai.stream",data:{function:t}}}),d.end(),l}}):fs({name:`${c} ${a}`,op:PR(t),attributes:i},async d=>{try{r.recordInputs&&u&&MR(d,u);const l=await e.apply(n,s);return FB(d,l,r.recordOutputs),l}catch(l){throw Ve(l,{mechanism:{handled:!1,type:"auto.ai.openai",data:{function:t}}}),l}})}}function Sv(e,t="",n){return new Proxy(e,{get(r,o){const s=r[o],i=PB(t,String(o));return typeof s=="function"&&IB(i)?YB(s,i,r,n):typeof s=="function"?s.bind(r):s&&typeof s=="object"?Sv(s,i,n):s}})}function jB(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return Sv(e,"",r)}function qB(e,t){return"type"in e&&typeof e.type=="string"&&e.type==="error"?(t.setStatus({code:Ae,message:e.error?.type??"internal_error"}),Ve(e.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}),!0):!1}function WB(e,t){if(e.type==="message_delta"&&e.usage&&"output_tokens"in e.usage&&typeof e.usage.output_tokens=="number"&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&(typeof n.usage.input_tokens=="number"&&(t.promptTokens=n.usage.input_tokens),typeof n.usage.cache_creation_input_tokens=="number"&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),typeof n.usage.cache_read_input_tokens=="number"&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}function KB(e,t){e.type!=="content_block_start"||typeof e.index!="number"||!e.content_block||(e.content_block.type==="tool_use"||e.content_block.type==="server_tool_use")&&(t.activeToolBlocks[e.index]={id:e.content_block.id,name:e.content_block.name,inputJsonParts:[]})}function zB(e,t,n){if(!(e.type!=="content_block_delta"||!e.delta)){if(typeof e.index=="number"&&"partial_json"in e.delta&&typeof e.delta.partial_json=="string"){const r=t.activeToolBlocks[e.index];r&&r.inputJsonParts.push(e.delta.partial_json)}n&&typeof e.delta.text=="string"&&t.responseTexts.push(e.delta.text)}}function ZB(e,t){if(e.type!=="content_block_stop"||typeof e.index!="number")return;const n=t.activeToolBlocks[e.index];if(!n)return;const r=n.inputJsonParts.join("");let o;try{o=r?JSON.parse(r):{}}catch{o={__unparsed:r}}t.toolCalls.push({type:"tool_use",id:n.id,name:n.name,input:o}),delete t.activeToolBlocks[e.index]}function mv(e,t,n,r){!(e&&typeof e=="object")||qB(e,r)||(WB(e,t),KB(e,t),zB(e,t,n),ZB(e,t))}function XB(e,t,n){t.isRecording()&&(e.responseId&&t.setAttributes({[_s]:e.responseId}),e.responseModel&&t.setAttributes({[yn]:e.responseModel}),wE(t,e.promptTokens,e.completionTokens,e.cacheCreationInputTokens,e.cacheReadInputTokens),t.setAttributes({[zl]:!0}),e.finishReasons.length>0&&t.setAttributes({[dr]:JSON.stringify(e.finishReasons)}),n&&e.responseTexts.length>0&&t.setAttributes({[zt]:e.responseTexts.join("")}),n&&e.toolCalls.length>0&&t.setAttributes({[In]:JSON.stringify(e.toolCalls)}),t.end())}async function*QB(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};try{for await(const o of e)mv(o,r,n,t),yield o}finally{r.responseId&&t.setAttributes({[_s]:r.responseId}),r.responseModel&&t.setAttributes({[yn]:r.responseModel}),wE(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[zl]:!0}),r.finishReasons.length>0&&t.setAttributes({[dr]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[zt]:r.responseTexts.join("")}),n&&r.toolCalls.length>0&&t.setAttributes({[In]:JSON.stringify(r.toolCalls)}),t.end()}}function JB(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};return e.on("streamEvent",o=>{mv(o,r,n,t)}),e.on("message",()=>{XB(r,t,n)}),e.on("error",o=>{Ve(o,{mechanism:{handled:!1,type:"auto.ai.anthropic.stream_error"}}),t.isRecording()&&(t.setStatus({code:Ae,message:"stream_error"}),t.end())}),e}const Ql="Anthropic_AI",eH=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve","beta.messages.create"];function tH(e){return eH.includes(e)}function nH(e,t){t.error&&(e.setStatus({code:Ae,message:t.error.type||"internal_error"}),Ve(t.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}))}function rH(e){const{system:t,messages:n}=e,r=typeof t=="string"?[{role:"system",content:e.system}]:[],o=Array.isArray(n)?n:n!=null?[n]:[];return[...r,...o]}function oH(e,t){const n={[Yl]:"anthropic",[Wn]:Hc(t),[xe]:"auto.ai.anthropic"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];r.tools&&Array.isArray(r.tools)&&(n[Kl]=JSON.stringify(r.tools)),n[yt]=r.model??"unknown","temperature"in r&&(n[jl]=r.temperature),"top_p"in r&&(n[Wl]=r.top_p),"stream"in r&&(n[bE]=r.stream),"top_k"in r&&(n[uv]=r.top_k),"frequency_penalty"in r&&(n[ql]=r.frequency_penalty),"max_tokens"in r&&(n[CE]=r.max_tokens)}else t==="models.retrieve"||t==="models.get"?n[yt]=e[0]:n[yt]="unknown";return n}function _h(e,t){const n=rH(t);if(n.length){const r=Fn(n);e.setAttributes({[Vt]:r})}if("input"in t){const r=Fn(t.input);e.setAttributes({[Vt]:r})}"prompt"in t&&e.setAttributes({[D$]:JSON.stringify(t.prompt)})}function sH(e,t){if("content"in t&&Array.isArray(t.content)){e.setAttributes({[zt]:t.content.map(r=>r.text).filter(r=>!!r).join("")});const n=[];for(const r of t.content)(r.type==="tool_use"||r.type==="server_tool_use")&&n.push(r);n.length>0&&e.setAttributes({[In]:JSON.stringify(n)})}"completion"in t&&e.setAttributes({[zt]:t.completion}),"input_tokens"in t&&e.setAttributes({[zt]:JSON.stringify(t.input_tokens)})}function iH(e,t){"id"in t&&"model"in t&&(e.setAttributes({[_s]:t.id,[yn]:t.model}),"created"in t&&typeof t.created=="number"&&e.setAttributes({[OR]:new Date(t.created*1e3).toISOString()}),"created_at"in t&&typeof t.created_at=="number"&&e.setAttributes({[OR]:new Date(t.created_at*1e3).toISOString()}),"usage"in t&&t.usage&&wE(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}function aH(e,t,n){if(!(!t||typeof t!="object")){if("type"in t&&t.type==="error"){nH(e,t);return}n&&sH(e,t),iH(e,t)}}function vR(e,t,n){throw Ve(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:n}}}),t.isRecording()&&(t.setStatus({code:Ae,message:"internal_error"}),t.end()),e}function cH(e,t,n,r,o,s,i,a,c,u,f){const d=o[yt]??"unknown",l={name:`${s} ${d} stream-response`,op:Qu(i),attributes:o};return u&&!f?Hn(l,async _=>{try{c.recordInputs&&a&&_h(_,a);const p=await e.apply(n,r);return QB(p,_,c.recordOutputs??!1)}catch(p){return vR(p,_,i)}}):Hn(l,_=>{try{c.recordInputs&&a&&_h(_,a);const p=t.apply(n,r);return JB(p,_,c.recordOutputs??!1)}catch(p){return vR(p,_,i)}})}function uH(e,t,n,r){return new Proxy(e,{apply(o,s,i){const a=oH(i,t),c=a[yt]??"unknown",u=Hc(t),f=typeof i[0]=="object"?i[0]:void 0,d=!!f?.stream,l=t==="messages.stream";return d||l?cH(e,o,n,i,a,u,t,f,r,d,l):fs({name:`${u} ${c}`,op:Qu(t),attributes:a},_=>(r.recordInputs&&f&&_h(_,f),_o(()=>o.apply(n,i),p=>{Ve(p,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}})},()=>{},p=>aH(_,p,r.recordOutputs))))}})}function gv(e,t="",n){return new Proxy(e,{get(r,o){const s=r[o],i=_v(t,String(o));return typeof s=="function"&&tH(i)?uH(s,i,r,n):typeof s=="function"?s.bind(r):s&&typeof s=="object"?gv(s,i,n):s}})}function lH(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return gv(e,"",r)}const Jl="Google_GenAI",wR=["models.generateContent","models.generateContentStream","chats.create","sendMessage","sendMessageStream"],dH="google_genai",Av="chats.create",fH="chat";function _H(e,t){const n=e?.promptFeedback;if(n?.blockReason){const r=n.blockReasonMessage??n.blockReason;return t.setStatus({code:Ae,message:`Content blocked: ${r}`}),Ve(`Content blocked: ${r}`,{mechanism:{handled:!1,type:"auto.ai.google_genai"}}),!0}return!1}function pH(e,t){typeof e.responseId=="string"&&(t.responseId=e.responseId),typeof e.modelVersion=="string"&&(t.responseModel=e.modelVersion);const n=e.usageMetadata;n&&(typeof n.promptTokenCount=="number"&&(t.promptTokens=n.promptTokenCount),typeof n.candidatesTokenCount=="number"&&(t.completionTokens=n.candidatesTokenCount),typeof n.totalTokenCount=="number"&&(t.totalTokens=n.totalTokenCount))}function hH(e,t,n){Array.isArray(e.functionCalls)&&t.toolCalls.push(...e.functionCalls);for(const r of e.candidates??[]){r?.finishReason&&!t.finishReasons.includes(r.finishReason)&&t.finishReasons.push(r.finishReason);for(const o of r?.content?.parts??[])n&&o.text&&t.responseTexts.push(o.text),o.functionCall&&t.toolCalls.push({type:"function",id:o.functionCall.id,name:o.functionCall.name,arguments:o.functionCall.args})}}function EH(e,t,n,r){!e||_H(e,r)||(pH(e,t),hH(e,t,n))}async function*TH(e,t,n){const r={responseTexts:[],finishReasons:[],toolCalls:[]};try{for await(const o of e)EH(o,r,n,t),yield o}finally{const o={[zl]:!0};r.responseId&&(o[_s]=r.responseId),r.responseModel&&(o[yn]=r.responseModel),r.promptTokens!==void 0&&(o[Wt]=r.promptTokens),r.completionTokens!==void 0&&(o[Kt]=r.completionTokens),r.totalTokens!==void 0&&(o[po]=r.totalTokens),r.finishReasons.length&&(o[dr]=JSON.stringify(r.finishReasons)),n&&r.responseTexts.length&&(o[zt]=r.responseTexts.join("")),n&&r.toolCalls.length&&(o[In]=JSON.stringify(r.toolCalls)),t.setAttributes(o),t.end()}}function SH(e){if(wR.includes(e))return!0;const t=e.split(".").pop();return wR.includes(t)}function mH(e){return e.includes("Stream")||e.endsWith("generateContentStream")||e.endsWith("sendMessageStream")}function LR(e,t){if("model"in e&&typeof e.model=="string")return e.model;if(t&&typeof t=="object"){const n=t;if("model"in n&&typeof n.model=="string")return n.model;if("modelVersion"in n&&typeof n.modelVersion=="string")return n.modelVersion}return"unknown"}function gH(e){const t={};return"temperature"in e&&typeof e.temperature=="number"&&(t[jl]=e.temperature),"topP"in e&&typeof e.topP=="number"&&(t[Wl]=e.topP),"topK"in e&&typeof e.topK=="number"&&(t[uv]=e.topK),"maxOutputTokens"in e&&typeof e.maxOutputTokens=="number"&&(t[CE]=e.maxOutputTokens),"frequencyPenalty"in e&&typeof e.frequencyPenalty=="number"&&(t[ql]=e.frequencyPenalty),"presencePenalty"in e&&typeof e.presencePenalty=="number"&&(t[IE]=e.presencePenalty),t}function AH(e,t,n){const r={[Yl]:dH,[Wn]:Hc(e),[xe]:"auto.ai.google_genai"};if(t){if(r[yt]=LR(t,n),"config"in t&&typeof t.config=="object"&&t.config){const o=t.config;if(Object.assign(r,gH(o)),"tools"in o&&Array.isArray(o.tools)){const s=o.tools.flatMap(i=>i.functionDeclarations);r[Kl]=JSON.stringify(s)}}}else r[yt]=LR({},n);return r}function DR(e,t){if("contents"in t){const n=t.contents,r=Fn(n);e.setAttributes({[Vt]:r})}if("message"in t){const n=t.message,r=Fn(n);e.setAttributes({[Vt]:r})}if("history"in t){const n=t.history,r=Fn(n);e.setAttributes({[Vt]:r})}}function RH(e,t,n){if(!(!t||typeof t!="object")){if(t.usageMetadata&&typeof t.usageMetadata=="object"){const r=t.usageMetadata;typeof r.promptTokenCount=="number"&&e.setAttributes({[Wt]:r.promptTokenCount}),typeof r.candidatesTokenCount=="number"&&e.setAttributes({[Kt]:r.candidatesTokenCount}),typeof r.totalTokenCount=="number"&&e.setAttributes({[po]:r.totalTokenCount})}if(n&&Array.isArray(t.candidates)&&t.candidates.length>0){const r=t.candidates.map(o=>o.content?.parts&&Array.isArray(o.content.parts)?o.content.parts.map(s=>typeof s.text=="string"?s.text:"").filter(s=>s.length>0).join(""):"").filter(o=>o.length>0);r.length>0&&e.setAttributes({[zt]:r.join("")})}if(n&&t.functionCalls){const r=t.functionCalls;Array.isArray(r)&&r.length>0&&e.setAttributes({[In]:JSON.stringify(r)})}}}function UR(e,t,n,r){const o=t===Av;return new Proxy(e,{apply(s,i,a){const c=a[0],u=AH(t,c,n),f=u[yt]??"unknown",d=Hc(t);return mH(t)?Hn({name:`${d} ${f} stream-response`,op:Qu(t),attributes:u},async l=>{try{r.recordInputs&&c&&DR(l,c);const _=await s.apply(n,a);return TH(_,l,!!r.recordOutputs)}catch(_){throw l.setStatus({code:Ae,message:"internal_error"}),Ve(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}}),l.end(),_}}):fs({name:o?`${d} ${f} create`:`${d} ${f}`,op:Qu(t),attributes:u},l=>(r.recordInputs&&c&&DR(l,c),_o(()=>s.apply(n,a),_=>{Ve(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}})},()=>{},_=>{o||RH(l,_,r.recordOutputs)})))}})}function ph(e,t="",n){return new Proxy(e,{get:(r,o,s)=>{const i=Reflect.get(r,o,s),a=_v(t,String(o));if(typeof i=="function"&&SH(a)){if(a===Av){const c=UR(i,a,r,n);return function(...f){const d=c(...f);return d&&typeof d=="object"?ph(d,fH,n):d}}return UR(i,a,r,n)}return typeof i=="function"?i.bind(r):i&&typeof i=="object"?ph(i,a,n):i}})}function yH(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return ph(e,"",r)}const Rv="LangChain",rc="auto.ai.langchain",NH={human:"user",ai:"assistant",assistant:"assistant",system:"system",function:"function",tool:"tool"},$n=(e,t,n)=>{n!=null&&(e[t]=n)},Dt=(e,t,n)=>{const r=Number(n);Number.isNaN(r)||(e[t]=r)};function Mt(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}}function Sa(e){const t=e.toLowerCase();return NH[t]??t}function kR(e){return e.includes("System")?"system":e.includes("Human")?"user":e.includes("AI")||e.includes("Assistant")?"assistant":e.includes("Function")?"function":e.includes("Tool")?"tool":"user"}function xR(e){if(!(!e||Array.isArray(e)))return e.invocation_params}function UE(e){return e.map(t=>{const n=t._getType;if(typeof n=="function"){const o=n.call(t);return{role:Sa(o),content:Mt(t.content)}}const r=t.constructor?.name;if(r)return{role:Sa(kR(r)),content:Mt(t.content)};if(t.type){const o=String(t.type).toLowerCase();return{role:Sa(o),content:Mt(t.content)}}if(t.role)return{role:Sa(String(t.role)),content:Mt(t.content)};if(t.lc===1&&t.kwargs){const o=t.id,s=Array.isArray(o)&&o.length>0?o[o.length-1]:"",i=typeof s=="string"?kR(s):"user";return{role:Sa(i),content:Mt(t.kwargs?.content)}}return{role:"user",content:Mt(t.content)}})}function OH(e,t,n){const r={},o="kwargs"in e?e.kwargs:void 0,s=t?.temperature??n?.ls_temperature??o?.temperature;Dt(r,jl,s);const i=t?.max_tokens??n?.ls_max_tokens??o?.max_tokens;Dt(r,CE,i);const a=t?.top_p??o?.top_p;Dt(r,Wl,a);const c=t?.frequency_penalty;Dt(r,ql,c);const u=t?.presence_penalty;return Dt(r,IE,u),t&&"stream"in t&&$n(r,bE,!!t.stream),r}function yv(e,t,n,r,o,s){return{[Yl]:Mt(e??"langchain"),[Wn]:n,[yt]:Mt(t),[xe]:rc,...OH(r,o,s)}}function bH(e,t,n,r,o){const s=o?.ls_provider,i=r?.model??o?.ls_model_name??"unknown",a=yv(s,i,"pipeline",e,r,o);if(n&&Array.isArray(t)&&t.length>0){const c=t.map(u=>({role:"user",content:u}));$n(a,Vt,Mt(c))}return a}function CH(e,t,n,r,o){const s=o?.ls_provider??e.id?.[2],i=r?.model??o?.ls_model_name??"unknown",a=yv(s,i,"chat",e,r,o);if(n&&Array.isArray(t)&&t.length>0){const c=UE(t.flat()),u=vE(c);$n(a,Vt,Mt(u))}return a}function IH(e,t){const n=[],r=e.flat();for(const o of r){const s=o.message?.content;if(Array.isArray(s))for(const i of s){const a=i;a.type==="tool_use"&&n.push(a)}}n.length>0&&$n(t,In,Mt(n))}function PH(e,t){if(!e)return;const n=e.tokenUsage,r=e.usage;if(n)Dt(t,Wt,n.promptTokens),Dt(t,Kt,n.completionTokens),Dt(t,po,n.totalTokens);else if(r){Dt(t,Wt,r.input_tokens),Dt(t,Kt,r.output_tokens);const o=Number(r.input_tokens),s=Number(r.output_tokens),i=(Number.isNaN(o)?0:o)+(Number.isNaN(s)?0:s);i>0&&Dt(t,po,i),r.cache_creation_input_tokens!==void 0&&Dt(t,V$,r.cache_creation_input_tokens),r.cache_read_input_tokens!==void 0&&Dt(t,$$,r.cache_read_input_tokens)}}function MH(e,t){if(!e)return;const n={};if(Array.isArray(e.generations)){const u=e.generations.flat().map(f=>f.generationInfo?.finish_reason?f.generationInfo.finish_reason:f.generation_info?.finish_reason?f.generation_info.finish_reason:null).filter(f=>typeof f=="string");if(u.length>0&&$n(n,dr,Mt(u)),IH(e.generations,n),t){const f=e.generations.flat().map(d=>d.text??d.message?.content).filter(d=>typeof d=="string");f.length>0&&$n(n,zt,Mt(f))}}PH(e.llmOutput,n);const r=e.llmOutput,s=e.generations?.[0]?.[0]?.message,i=r?.model_name??r?.model??s?.response_metadata?.model_name;i&&$n(n,yn,i);const a=r?.id??s?.id;a&&$n(n,_s,a);const c=r?.stop_reason??s?.response_metadata?.finish_reason;return c&&$n(n,x$,Mt(c)),n}function vH(e={}){const t=e.recordInputs??!1,n=e.recordOutputs??!1,r=new Map,o=i=>{const a=r.get(i);a?.isRecording()&&(a.end(),r.delete(i))},s={lc_serializable:!1,lc_namespace:["langchain_core","callbacks","sentry"],lc_secrets:void 0,lc_attributes:void 0,lc_aliases:void 0,lc_serializable_keys:void 0,lc_id:["langchain_core","callbacks","sentry"],lc_kwargs:{},name:"SentryCallbackHandler",ignoreLLM:!1,ignoreChain:!1,ignoreAgent:!1,ignoreRetriever:!1,ignoreCustomEvent:!1,raiseError:!1,awaitHandlers:!0,handleLLMStart(i,a,c,u,f,d,l,_){const p=xR(d),h=bH(i,a,t,p,l),E=h[yt],T=h[Wn];Hn({name:`${T} ${E}`,op:"gen_ai.pipeline",attributes:{...h,[Ee]:"gen_ai.pipeline"}},S=>(r.set(c,S),S))},handleChatModelStart(i,a,c,u,f,d,l,_){const p=xR(d),h=CH(i,a,t,p,l),E=h[yt],T=h[Wn];Hn({name:`${T} ${E}`,op:"gen_ai.chat",attributes:{...h,[Ee]:"gen_ai.chat"}},S=>(r.set(c,S),S))},handleLLMEnd(i,a,c,u,f){const d=r.get(a);if(d?.isRecording()){const l=MH(i,n);l&&d.setAttributes(l),o(a)}},handleLLMError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"llm_error"}),o(a)),Ve(i,{mechanism:{handled:!1,type:`${rc}.llm_error_handler`}})},handleChainStart(i,a,c,u){const f=i.name||"unknown_chain",d={[xe]:"auto.ai.langchain","langchain.chain.name":f};t&&(d["langchain.chain.inputs"]=JSON.stringify(a)),Hn({name:`chain ${f}`,op:"gen_ai.invoke_agent",attributes:{...d,[Ee]:"gen_ai.invoke_agent"}},l=>(r.set(c,l),l))},handleChainEnd(i,a){const c=r.get(a);c?.isRecording()&&(n&&c.setAttributes({"langchain.chain.outputs":JSON.stringify(i)}),o(a))},handleChainError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"chain_error"}),o(a)),Ve(i,{mechanism:{handled:!1,type:`${rc}.chain_error_handler`}})},handleToolStart(i,a,c,u){const f=i.name||"unknown_tool",d={[xe]:rc,"gen_ai.tool.name":f};t&&(d["gen_ai.tool.input"]=a),Hn({name:`execute_tool ${f}`,op:"gen_ai.execute_tool",attributes:{...d,[Ee]:"gen_ai.execute_tool"}},l=>(r.set(c,l),l))},handleToolEnd(i,a){const c=r.get(a);c?.isRecording()&&(n&&c.setAttributes({"gen_ai.tool.output":JSON.stringify(i)}),o(a))},handleToolError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"tool_error"}),o(a)),Ve(i,{mechanism:{handled:!1,type:`${rc}.tool_error_handler`}})},copy(){return s},toJSON(){return{lc:1,type:"not_implemented",id:s.lc_id}},toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:s.lc_id}}};return s}const Nv="LangGraph",Ov="auto.ai.langgraph";function wH(e){if(!e||e.length===0)return null;const t=[];for(const n of e)if(n&&typeof n=="object"){const r=n.tool_calls;r&&Array.isArray(r)&&t.push(...r)}return t.length>0?t:null}function LH(e){const t=e;let n=0,r=0,o=0;if(t.usage_metadata&&typeof t.usage_metadata=="object"){const s=t.usage_metadata;return typeof s.input_tokens=="number"&&(n=s.input_tokens),typeof s.output_tokens=="number"&&(r=s.output_tokens),typeof s.total_tokens=="number"&&(o=s.total_tokens),{inputTokens:n,outputTokens:r,totalTokens:o}}if(t.response_metadata&&typeof t.response_metadata=="object"){const s=t.response_metadata;if(s.tokenUsage&&typeof s.tokenUsage=="object"){const i=s.tokenUsage;typeof i.promptTokens=="number"&&(n=i.promptTokens),typeof i.completionTokens=="number"&&(r=i.completionTokens),typeof i.totalTokens=="number"&&(o=i.totalTokens)}}return{inputTokens:n,outputTokens:r,totalTokens:o}}function DH(e,t){const n=t;if(n.response_metadata&&typeof n.response_metadata=="object"){const r=n.response_metadata;r.model_name&&typeof r.model_name=="string"&&e.setAttribute(yn,r.model_name),r.finish_reason&&typeof r.finish_reason=="string"&&e.setAttribute(dr,[r.finish_reason])}}function UH(e){if(!e.builder?.nodes?.tools?.runnable?.tools)return null;const t=e.builder?.nodes?.tools?.runnable?.tools;return!t||!Array.isArray(t)||t.length===0?null:t.map(n=>({name:n.lc_kwargs?.name,description:n.lc_kwargs?.description,schema:n.lc_kwargs?.schema}))}function kH(e,t,n){const o=n?.messages;if(!o||!Array.isArray(o))return;const s=t?.length??0,i=o.length>s?o.slice(s):[];if(i.length===0)return;const a=wH(i);a&&e.setAttribute(In,JSON.stringify(a));const c=UE(i);e.setAttribute(zt,JSON.stringify(c));let u=0,f=0,d=0;for(const l of i){const _=LH(l);u+=_.inputTokens,f+=_.outputTokens,d+=_.totalTokens,DH(e,l)}u>0&&e.setAttribute(Wt,u),f>0&&e.setAttribute(Kt,f),d>0&&e.setAttribute(po,d)}function xH(e,t){return new Proxy(e,{apply(n,r,o){return fs({op:"gen_ai.create_agent",name:"create_agent",attributes:{[xe]:Ov,[Ee]:"gen_ai.create_agent",[Wn]:"create_agent"}},s=>{try{const i=Reflect.apply(n,r,o),a=o.length>0?o[0]:{};a?.name&&typeof a.name=="string"&&(s.setAttribute(lv,a.name),s.updateName(`create_agent ${a.name}`));const c=i.invoke;return c&&typeof c=="function"&&(i.invoke=GH(c.bind(i),i,a,t)),i}catch(i){throw s.setStatus({code:Ae,message:"internal_error"}),Ve(i,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),i}})}})}function GH(e,t,n,r){return new Proxy(e,{apply(o,s,i){return fs({op:"gen_ai.invoke_agent",name:"invoke_agent",attributes:{[xe]:Ov,[Ee]:B$,[Wn]:"invoke_agent"}},async a=>{try{const c=n?.name;c&&typeof c=="string"&&(a.setAttribute(G$,c),a.setAttribute(lv,c),a.updateName(`invoke_agent ${c}`));const u=UH(t);u&&a.setAttribute(Kl,JSON.stringify(u));const f=r.recordInputs,d=r.recordOutputs,l=i.length>0?i[0].messages??[]:[];if(l&&f){const p=UE(l),h=vE(p);a.setAttribute(Vt,JSON.stringify(h))}const _=await Reflect.apply(o,s,i);return d&&kH(a,l??null,_),_}catch(c){throw a.setStatus({code:Ae,message:"internal_error"}),Ve(c,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),c}})}})}function bv(e){if(e!==void 0)return e>=400&&e<500?"warning":e>=500?"error":void 0}function VH(e,t,n){const r=e[t];if(typeof r=="function"){try{e[t]=n}catch{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===r)try{e.default=n}catch{Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}}}function $H(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&e!==void 0&&!e.includes("node_modules/")}function BH(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,r=/at (?:async )?(.+?) \(data:(.*?),/;return o=>{const s=o.match(r);if(s)return{filename:`<data:${s[2]}>`,function:s[1]};const i=o.match(n);if(i){let a,c,u,f,d;if(i[1]){u=i[1];let p=u.lastIndexOf(".");if(u[p-1]==="."&&p--,p>0){a=u.slice(0,p),c=u.slice(p+1);const h=a.indexOf(".Module");h>0&&(u=u.slice(h+1),a=a.slice(0,h))}f=void 0}c&&(f=a,d=c),c==="<anonymous>"&&(d=void 0,u=void 0),u===void 0&&(d=d||fM,u=f?`${f}.${d}`:d);let l=i[2]?.startsWith("file://")?i[2].slice(7):i[2];const _=i[5]==="native";return l?.match(/\/[A-Z]:/)&&(l=l.slice(1)),!l&&i[5]&&!_&&(l=i[5]),{filename:l?decodeURI(l):void 0,module:e?e(l):void 0,function:u,lineno:GR(i[3]),colno:GR(i[4]),in_app:$H(l||"",_)}}if(o.match(t))return{filename:o}}}function HH(e){return[90,BH(e)]}function GR(e){return parseInt(e||"",10)||void 0}class ps{constructor(t){this._maxSize=t,this._cache=new Map}get size(){return this._cache.size}get(t){const n=this._cache.get(t);if(n!==void 0)return this._cache.delete(t),this._cache.set(t,n),n}set(t,n){if(this._cache.size>=this._maxSize){const r=this._cache.keys().next().value;this._cache.delete(r)}this._cache.set(t,n)}remove(t){const n=this._cache.get(t);return n&&this._cache.delete(t),n}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const t=[];return this._cache.forEach(n=>t.push(n)),t}}const Ju={};function Ne(e,t,n){return n?YH(e,t,n):FH(e,t)}function FH(e,t){return Object.assign(n=>{const r=Ju[e];if(r)return n&&r.setConfig(n),r;const o=t(n);return Ju[e]=o,wl({instrumentations:[o]}),o},{id:e})}function YH(e,t,n){return Object.assign(r=>{const o=n(r),s=Ju[e];if(s)return s.setConfig(o),s;const i=new t(o);return Ju[e]=i,wl({instrumentations:[i]}),i},{id:e})}function Cv(e){let t=!1,n=[];if(!jH(e))t=!0;else{const o=e._wrap;e._wrap=(...s)=>(t=!0,n.forEach(i=>i()),n=[],o(...s))}return o=>{t?o():n.push(o)}}function jH(e){return typeof e._wrap=="function"}const Ie=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Go="@sentry/instrumentation-http",qH=1024*1024,VR=b.createContextKey("sentry_http_server_instrumented"),tr="Http.Server",nf=new Map,$R=new WeakSet;function WH(e,t){un(e,"_startSpanCallback",new WeakRef(t))}const KH=((e={})=>{const t={sessions:e.sessions??!0,sessionFlushingDelayMS:e.sessionFlushingDelayMS??6e4,maxRequestBodySize:e.maxRequestBodySize??"medium",ignoreRequestBody:e.ignoreRequestBody};return{name:tr,setupOnce(){const n=(r=>{zH(r.server,t)});mn.subscribe("http.server.request.start",n)},afterAllSetup(n){Ie&&n.getIntegrationByName("Http")&&j.warn("It seems that you have manually added `httpServerIntegration` while `httpIntegration` is also present. Make sure to remove `httpServerIntegration` when adding `httpIntegration`.")}}}),Iv=KH;function zH(e,{ignoreRequestBody:t,maxRequestBodySize:n,sessions:r,sessionFlushingDelayMS:o}){const s=e.emit;if($R.has(s))return;const i=new Proxy(s,{apply(a,c,u){if(u[0]!=="request")return a.apply(c,u);const f=Te();if(b.context.active().getValue(VR)||!f)return a.apply(c,u);Ie&&j.log(tr,"Handling incoming request");const d=je().clone(),l=u[1],_=u[2],p=GV(l),h=l.ip||l.socket?.remoteAddress,E=l.url||"/";n!=="none"&&!t?.(E,l)&&XH(l,d,n),d.setSDKProcessingMetadata({normalizedRequest:p,ipAddress:h});const T=(l.method||"GET").toUpperCase(),S=Nc(E),g=`${T} ${S}`;return d.setTransactionName(g),r&&f&&ZH(f,{requestIsolationScope:d,response:_,sessionFlushingDelayMS:o??6e4}),yx(d,()=>{ze().getPropagationContext().propagationSpanId=go();const A=b.propagation.extract(b.context.active(),p.headers).setValue(VR,!0);return b.context.with(A,()=>{f.emit("httpServerRequest",l,_,p);const R=l._startSpanCallback?.deref();return R?R(()=>a.apply(c,u)):a.apply(c,u)})})}});$R.add(i),e.emit=i}function ZH(e,{requestIsolationScope:t,response:n,sessionFlushingDelayMS:r}){t.setSDKProcessingMetadata({requestSession:{status:"ok"}}),n.once("close",()=>{const o=t.getScopeData().sdkProcessingMetadata.requestSession;if(e&&o){Ie&&j.log(`Recorded request session with status: ${o.status}`);const s=new Date;s.setSeconds(0,0);const i=s.toISOString(),a=nf.get(e),c=a?.[i]||{exited:0,crashed:0,errored:0};if(c[{ok:"exited",crashed:"crashed",errored:"errored"}[o.status]]++,a)a[i]=c;else{Ie&&j.log("Opened new request session aggregate.");const u={[i]:c};nf.set(e,u);const f=()=>{clearTimeout(l),d(),nf.delete(e);const _=Object.entries(u).map(([p,h])=>({started:p,exited:h.exited,errored:h.errored,crashed:h.crashed}));e.sendSession({aggregates:_})},d=e.on("flush",()=>{Ie&&j.log("Sending request session aggregate due to client flush"),f()}),l=setTimeout(()=>{Ie&&j.log("Sending request session aggregate due to flushing schedule"),f()},r).unref()}}})}function XH(e,t,n){let r=0;const o=[];Ie&&j.log(tr,"Patching request.on");const s=new WeakMap,i=n==="small"?1e3:n==="medium"?1e4:qH;try{e.on=new Proxy(e.on,{apply:(a,c,u)=>{const[f,d,...l]=u;if(f==="data"){Ie&&j.log(tr,`Handling request.on("data") with maximum body size of ${i}b`);const _=new Proxy(d,{apply:(p,h,E)=>{try{const T=E[0],S=Buffer.from(T);r<i?(o.push(S),r+=S.byteLength):Ie&&j.log(tr,`Dropping request body chunk because maximum body length of ${i}b is exceeded.`)}catch{Ie&&j.error(tr,"Encountered error while storing body chunk.")}return Reflect.apply(p,h,E)}});return s.set(d,_),Reflect.apply(a,c,[f,_,...l])}return Reflect.apply(a,c,u)}}),e.off=new Proxy(e.off,{apply:(a,c,u)=>{const[,f]=u,d=s.get(f);if(d){s.delete(f);const l=u.slice();return l[1]=d,Reflect.apply(a,c,l)}return Reflect.apply(a,c,u)}}),e.on("end",()=>{try{const a=Buffer.concat(o).toString("utf-8");if(a){const u=Buffer.byteLength(a,"utf-8")>i?`${Buffer.from(a).subarray(0,i-3).toString("utf-8")}...`:a;t.setSDKProcessingMetadata({normalizedRequest:{data:u}})}}catch(a){Ie&&j.error(tr,"Error building captured request body",a)}})}catch(a){Ie&&j.error(tr,"Error patching request to capture body",a)}}const BR="Http.ServerSpans",QH=((e={})=>{const t=e.ignoreStaticAssets??!0,n=e.ignoreIncomingRequests,r=e.ignoreStatusCodes??[[401,404],[301,303],[305,399]],{onSpanCreated:o}=e,{requestHook:s,responseHook:i,applyCustomAttributesOnSpan:a}=e.instrumentation??{};return{name:BR,setup(c){typeof __SENTRY_TRACING__<"u"&&!__SENTRY_TRACING__||c.on("httpServerRequest",(u,f,d)=>{const l=u,_=f;WH(l,h=>{if(tF(l,{ignoreStaticAssets:t,ignoreIncomingRequests:n}))return Ie&&j.log(BR,"Skipping span creation for incoming request",l.url),h();const E=d.url||l.url||"/",T=LV(E),S=l.headers,g=S["user-agent"],A=S["x-forwarded-for"],R=l.httpVersion,O=S.host,C=O?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",I=c.tracer,w=E.startsWith("https")?"https":"http",U=d.method||l.method?.toUpperCase()||"GET",B=T?T.pathname:Nc(E),F=`${U} ${B}`,G=I.startSpan(F,{kind:b.SpanKind.SERVER,attributes:{[Ee]:"http.server",[xe]:"auto.http.otel.http","sentry.http.prefetch":JH(l)||void 0,"http.url":E,"http.method":d.method,"http.target":T?`${T.pathname}${T.search}`:B,"http.host":O,"net.host.name":C,"http.client_ip":typeof A=="string"?A.split(",")[0]:void 0,"http.user_agent":g,"http.scheme":w,"http.flavor":R,"net.transport":R?.toUpperCase()==="QUIC"?"ip_udp":"ip_tcp",...nF(l),...BV(d.headers||{})}});s?.(G,l),i?.(G,_),a?.(G,l,_),o?.(G,l,_);const x={type:ao.HTTP,span:G};return b.context.with(FP(b.trace.setSpan(b.context.active(),G),x),()=>{b.context.bind(b.context.active(),l),b.context.bind(b.context.active(),_);let Y=!1;function v(P){if(Y)return;Y=!0;const H=sF(l,_);G.setAttributes(H),G.setStatus(P),G.end();const J=H["http.route"];J&&je().setTransactionName(`${l.method?.toUpperCase()||"GET"} ${J}`)}return _.on("close",()=>{v(oh(_.statusCode))}),_.on(A0.errorMonitor,()=>{const P=oh(_.statusCode);v(P.code===Ae?P:{code:Ae})}),h()})})})},processEvent(c){if(c.type==="transaction"){const u=c.contexts?.trace?.data?.["http.response.status_code"];if(typeof u=="number"&&iF(u,r))return Ie&&j.log("Dropping transaction due to status code",u),null}return c},afterAllSetup(c){Ie&&(c.getIntegrationByName("Http")&&j.warn("It seems that you have manually added `httpServerSpansIntergation` while `httpIntegration` is also present. Make sure to remove `httpIntegration` when adding `httpServerSpansIntegration`."),c.getIntegrationByName("Http.Server")||j.error("It seems that you have manually added `httpServerSpansIntergation` without adding `httpServerIntegration`. This is a requiement for spans to be created - please add the `httpServerIntegration` integration."))}}}),Pv=QH;function JH(e){return e.headers["next-router-prefetch"]==="1"}function eF(e){const t=Nc(e);return!!(t.match(/\.(ico|png|jpg|jpeg|gif|svg|css|js|woff|woff2|ttf|eot|webp|avif)$/)||t.match(/^\/(robots\.txt|sitemap\.xml|manifest\.json|browserconfig\.xml)$/))}function tF(e,{ignoreStaticAssets:t,ignoreIncomingRequests:n}){if(Cn(b.context.active()))return!0;const r=e.url,o=e.method?.toUpperCase();return!!(o==="OPTIONS"||o==="HEAD"||!r||t&&o==="GET"&&eF(r)||n?.(r,e))}function nF(e){const t=rF(e.headers);return t==null?{}:oF(e.headers)?{"http.request_content_length":t}:{"http.request_content_length_uncompressed":t}}function rF(e){const t=e["content-length"];if(t===void 0)return null;const n=parseInt(t,10);return isNaN(n)?null:n}function oF(e){const t=e["content-encoding"];return!!t&&t!=="identity"}function sF(e,t){const{socket:n}=e,{statusCode:r,statusMessage:o}=t,s={[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:r,[Q.SEMATTRS_HTTP_STATUS_CODE]:r,"http.status_text":o?.toUpperCase()},i=Ml(b.context.active());if(n){const{localAddress:a,localPort:c,remoteAddress:u,remotePort:f}=n;s[Q.SEMATTRS_NET_HOST_IP]=a,s[Q.SEMATTRS_NET_HOST_PORT]=c,s[Q.SEMATTRS_NET_PEER_IP]=u,s["net.peer.port"]=f}if(s[Q.SEMATTRS_HTTP_STATUS_CODE]=r,s["http.status_text"]=(o||"").toUpperCase(),i?.type===ao.HTTP&&i.route!==void 0){const a=i.route;s[Q.ATTR_HTTP_ROUTE]=a}return s}function iF(e,t){return t.some(n=>{if(typeof n=="number")return n===e;const[r,o]=n;return e>=r&&e<=o})}function Mv(e){const t=e.protocol||"",n=e.hostname||e.host||"",r=!e.port||e.port===80||e.port===443||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`,o=e.path?e.path:"/";return`${t}//${n}${r}${o}`}function aF(){return`unknown_service:${process.argv0}`}const oc=e=>e!==null&&typeof e=="object"&&typeof e.then=="function";class el{_rawAttributes;_asyncAttributesPending=!1;_schemaUrl;_memoizedAttributes;static FromAttributeList(t,n){const r=new el({},n);return r._rawAttributes=HR(t),r._asyncAttributesPending=t.filter(([o,s])=>oc(s)).length>0,r}constructor(t,n){const r=t.attributes??{};this._rawAttributes=Object.entries(r).map(([o,s])=>(oc(s)&&(this._asyncAttributesPending=!0),[o,s])),this._rawAttributes=HR(this._rawAttributes),this._schemaUrl=cF(n?.schemaUrl)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let t=0;t<this._rawAttributes.length;t++){const[n,r]=this._rawAttributes[t];this._rawAttributes[t]=[n,oc(r)?await r:r]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&b.diag.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const t={};for(const[n,r]of this._rawAttributes){if(oc(r)){b.diag.debug(`Unsettled resource attribute ${n} skipped`);continue}r!=null&&(t[n]??=r)}return this._asyncAttributesPending||(this._memoizedAttributes=t),t}getRawAttributes(){return this._rawAttributes}get schemaUrl(){return this._schemaUrl}merge(t){if(t==null)return this;const n=uF(this,t),r=n?{schemaUrl:n}:void 0;return el.FromAttributeList([...t.getRawAttributes(),...this.getRawAttributes()],r)}}function vv(e,t){return el.FromAttributeList(Object.entries(e),t)}function wv(){return vv({[Q.ATTR_SERVICE_NAME]:aF(),[Q.ATTR_TELEMETRY_SDK_LANGUAGE]:Ru[Q.ATTR_TELEMETRY_SDK_LANGUAGE],[Q.ATTR_TELEMETRY_SDK_NAME]:Ru[Q.ATTR_TELEMETRY_SDK_NAME],[Q.ATTR_TELEMETRY_SDK_VERSION]:Ru[Q.ATTR_TELEMETRY_SDK_VERSION]})}function HR(e){return e.map(([t,n])=>oc(n)?[t,n.catch(r=>{b.diag.debug("promise rejection for resource attribute: %s - %s",t,r)})]:[t,n])}function cF(e){if(typeof e=="string"||e===void 0)return e;b.diag.warn("Schema URL must be string or undefined, got %s. Schema URL will be ignored.",e)}function uF(e,t){const n=e?.schemaUrl,r=t?.schemaUrl,o=n===void 0||n==="",s=r===void 0||r==="";if(o)return r;if(s||n===r)return n;b.diag.warn('Schema URL merge conflict: old resource has "%s", updating resource has "%s". Resulting resource will have undefined Schema URL.',n,r)}const lF="exception";class dF{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:b.SpanStatusCode.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(t){const n=Date.now();this._spanContext=t.spanContext,this._performanceStartTime=oo.now(),this._performanceOffset=n-(this._performanceStartTime+Il()),this._startTimeProvided=t.startTime!=null,this._spanLimits=t.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=t.spanProcessor,this.name=t.name,this.parentSpanContext=t.parentSpanContext,this.kind=t.kind,this.links=t.links||[],this.startTime=this._getTime(t.startTime??n),this.resource=t.resource,this.instrumentationScope=t.scope,t.attributes!=null&&this.setAttributes(t.attributes),this._spanProcessor.onStart(this,t.context)}spanContext(){return this._spanContext}setAttribute(t,n){if(n==null||this._isSpanEnded())return this;if(t.length===0)return b.diag.warn(`Invalid attribute key: ${t}`),this;if(!Zh(n))return b.diag.warn(`Invalid attribute value set for key: ${t}`),this;const{attributeCountLimit:r}=this._spanLimits;return r!==void 0&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(n),this)}setAttributes(t){for(const[n,r]of Object.entries(t))this.setAttribute(n,r);return this}addEvent(t,n,r){if(this._isSpanEnded())return this;const{eventCountLimit:o}=this._spanLimits;if(o===0)return b.diag.warn("No events allowed."),this._droppedEventsCount++,this;o!==void 0&&this.events.length>=o&&(this._droppedEventsCount===0&&b.diag.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),Jp(n)&&(Jp(r)||(r=n),n=void 0);const s=uc(n);return this.events.push({name:t,attributes:s,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()?this:(this.status={...t},this.status.message!=null&&typeof t.message!="string"&&(b.diag.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message),this)}updateName(t){return this._isSpanEnded()?this:(this.name=t,this)}end(t){if(this._isSpanEnded()){b.diag.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`);return}this._ended=!0,this.endTime=this._getTime(t),this._duration=BP(this.startTime,this.endTime),this._duration[0]<0&&(b.diag.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&b.diag.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this)}_getTime(t){if(typeof t=="number"&&t<=oo.now())return Jh(t+this._performanceOffset);if(typeof t=="number")return Bn(t);if(t instanceof Date)return Bn(t.getTime());if(Pl(t))return t;if(this._startTimeProvided)return Bn(Date.now());const n=oo.now()-this._performanceStartTime;return eE(this.startTime,Bn(n))}isRecording(){return this._ended===!1}recordException(t,n){const r={};typeof t=="string"?r[Q.ATTR_EXCEPTION_MESSAGE]=t:t&&(t.code?r[Q.ATTR_EXCEPTION_TYPE]=t.code.toString():t.name&&(r[Q.ATTR_EXCEPTION_TYPE]=t.name),t.message&&(r[Q.ATTR_EXCEPTION_MESSAGE]=t.message),t.stack&&(r[Q.ATTR_EXCEPTION_STACKTRACE]=t.stack)),r[Q.ATTR_EXCEPTION_TYPE]||r[Q.ATTR_EXCEPTION_MESSAGE]?this.addEvent(lF,r,n):b.diag.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const t=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);b.diag.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,t)}return this._ended}_truncateToLimitUtil(t,n){return t.length<=n?t:t.substring(0,n)}_truncateToSize(t){const n=this._attributeValueLengthLimit;return n<=0?(b.diag.warn(`Attribute value limit must be positive, got ${n}`),t):typeof t=="string"?this._truncateToLimitUtil(t,n):Array.isArray(t)?t.map(r=>typeof r=="string"?this._truncateToLimitUtil(r,n):r):t}}var kt;(function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(kt||(kt={}));class tl{shouldSample(){return{decision:kt.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Ko{shouldSample(){return{decision:kt.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class Qc{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(t){this._root=t.root,this._root||(Xh(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Ko),this._remoteParentSampled=t.remoteParentSampled??new Ko,this._remoteParentNotSampled=t.remoteParentNotSampled??new tl,this._localParentSampled=t.localParentSampled??new Ko,this._localParentNotSampled=t.localParentNotSampled??new tl}shouldSample(t,n,r,o,s,i){const a=b.trace.getSpanContext(t);return!a||!b.isSpanContextValid(a)?this._root.shouldSample(t,n,r,o,s,i):a.isRemote?a.traceFlags&b.TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(t,n,r,o,s,i):this._remoteParentNotSampled.shouldSample(t,n,r,o,s,i):a.traceFlags&b.TraceFlags.SAMPLED?this._localParentSampled.shouldSample(t,n,r,o,s,i):this._localParentNotSampled.shouldSample(t,n,r,o,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class FR{_ratio;_upperBound;constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(t,n){return{decision:b.isValidTraceId(n)&&this._accumulate(n)<this._upperBound?kt.RECORD_AND_SAMPLED:kt.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return typeof t!="number"||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let n=0;for(let r=0;r<t.length/8;r++){const o=r*8,s=parseInt(t.slice(o,o+8),16);n=(n^s)>>>0}return n}}var hn;(function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"})(hn||(hn={}));const Jc=1;function Lv(){return{sampler:Dv(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:Pt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:Pt("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:Pt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:Pt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:Pt("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:Pt("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:Pt("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:Pt("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function Dv(){const e=Qh("OTEL_TRACES_SAMPLER")??hn.ParentBasedAlwaysOn;switch(e){case hn.AlwaysOn:return new Ko;case hn.AlwaysOff:return new tl;case hn.ParentBasedAlwaysOn:return new Qc({root:new Ko});case hn.ParentBasedAlwaysOff:return new Qc({root:new tl});case hn.TraceIdRatio:return new FR(YR());case hn.ParentBasedTraceIdRatio:return new Qc({root:new FR(YR())});default:return b.diag.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "${hn.ParentBasedAlwaysOn}".`),new Qc({root:new Ko})}}function YR(){const e=Pt("OTEL_TRACES_SAMPLER_ARG");return e==null?(b.diag.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${Jc}.`),Jc):e<0||e>1?(b.diag.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to ${Jc}.`),Jc):e}const fF=128,_F=1/0;function pF(e){const t={sampler:Dv()},n=Lv(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}function hF(e){const t=Object.assign({},e.spanLimits);return t.attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??Pt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??Pt("OTEL_ATTRIBUTE_COUNT_LIMIT")??fF,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??Pt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??Pt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??_F,Object.assign({},e,{spanLimits:t})}const EF=8,Uv=16;class TF{generateTraceId=jR(Uv);generateSpanId=jR(EF)}const eu=Buffer.allocUnsafe(Uv);function jR(e){return function(){for(let n=0;n<e/4;n++)eu.writeUInt32BE(Math.random()*2**32>>>0,n*4);for(let n=0;n<e&&!(eu[n]>0);n++)n===e-1&&(eu[e-1]=1);return eu.toString("hex",0,e)}}class SF{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(t,n,r,o){const s=pF(n);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=n.idGenerator||new TF,this._resource=r,this._spanProcessor=o,this.instrumentationScope=t}startSpan(t,n={},r=b.context.active()){n.root&&(r=b.trace.deleteSpan(r));const o=b.trace.getSpan(r);if(Cn(r))return b.diag.debug("Instrumentation suppressed, returning Noop Span"),b.trace.wrapSpanContext(b.INVALID_SPAN_CONTEXT);const s=o?.spanContext(),i=this._idGenerator.generateSpanId();let a,c,u;!s||!b.trace.isSpanContextValid(s)?c=this._idGenerator.generateTraceId():(c=s.traceId,u=s.traceState,a=s);const f=n.kind??b.SpanKind.INTERNAL,d=(n.links??[]).map(S=>({context:S.context,attributes:uc(S.attributes)})),l=uc(n.attributes),_=this._sampler.shouldSample(r,c,t,f,l,d);u=_.traceState??u;const p=_.decision===b.SamplingDecision.RECORD_AND_SAMPLED?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,h={traceId:c,spanId:i,traceFlags:p,traceState:u};if(_.decision===b.SamplingDecision.NOT_RECORD)return b.diag.debug("Recording is off, propagating context in a non-recording span"),b.trace.wrapSpanContext(h);const E=uc(Object.assign(l,_.attributes));return new dF({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:h,name:t,kind:f,links:d,parentSpanContext:a,attributes:E,startTime:n.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(t,n,r,o){let s,i,a;if(arguments.length<2)return;arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,i=r,a=o);const c=i??b.context.active(),u=this.startSpan(t,s,c),f=b.trace.setSpan(c,u);return b.context.with(f,a,void 0,u)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class mF{_spanProcessors;constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const n of this._spanProcessors)t.push(n.forceFlush());return new Promise(n=>{Promise.all(t).then(()=>{n()}).catch(r=>{Xh(r||new Error("MultiSpanProcessor: forceFlush failed")),n()})})}onStart(t,n){for(const r of this._spanProcessors)r.onStart(t,n)}onEnd(t){for(const n of this._spanProcessors)n.onEnd(t)}shutdown(){const t=[];for(const n of this._spanProcessors)t.push(n.shutdown());return new Promise((n,r)=>{Promise.all(t).then(()=>{n()},r)})}}var ro;(function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"})(ro||(ro={}));class gF{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(t={}){const n=KP({},Lv(),hF(t));this._resource=n.resource??wv(),this._config=Object.assign({},n,{resource:this._resource});const r=[];t.spanProcessors?.length&&r.push(...t.spanProcessors),this._activeSpanProcessor=new mF(r)}getTracer(t,n,r){const o=`${t}@${n||""}:${r?.schemaUrl||""}`;return this._tracers.has(o)||this._tracers.set(o,new SF({name:t,version:n,schemaUrl:r?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(o)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,n=this._activeSpanProcessor._spanProcessors.map(r=>new Promise(o=>{let s;const i=setTimeout(()=>{o(new Error(`Span processor did not completed within timeout period of ${t} ms`)),s=ro.timeout},t);r.forceFlush().then(()=>{clearTimeout(i),s!==ro.timeout&&(s=ro.resolved,o(s))}).catch(a=>{clearTimeout(i),s=ro.error,o(a)})}));return new Promise((r,o)=>{Promise.all(n).then(s=>{const i=s.filter(a=>a!==ro.resolved);i.length>0?o(i):r()}).catch(s=>o([s]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}const kE="sentry.parentIsRemote",sc="sentry.graphql.operation";function xE(e){if("parentSpanId"in e)return e.parentSpanId;if("parentSpanContext"in e)return e.parentSpanContext?.spanId}function GE(e){const t=e;return!!t.attributes&&typeof t.attributes=="object"}function AF(e){return typeof e.kind=="number"}function RF(e){return!!e.status}function kv(e){return!!e.name}function yF(e){if(!GE(e))return{};const t=e.attributes[Q.ATTR_URL_FULL]||e.attributes[Q.SEMATTRS_HTTP_URL],n={url:t,"http.method":e.attributes[Q.ATTR_HTTP_REQUEST_METHOD]||e.attributes[Q.SEMATTRS_HTTP_METHOD]};!n["http.method"]&&n.url&&(n["http.method"]="GET");try{if(typeof t=="string"){const r=Hl(t);n.url=Fl(r),r.search&&(n["http.query"]=r.search),r.hash&&(n["http.fragment"]=r.hash)}}catch{}return n}function NF(e){return AF(e)?e.kind:b.SpanKind.INTERNAL}const rf="sentry-trace",hh="baggage",VE="sentry.dsc",$E="sentry.sampled_not_recording",xv="sentry.url",OF="sentry.sample_rand",bF="sentry.sample_rate",Gv=b.createContextKey("sentry_scopes"),Eh=b.createContextKey("sentry_fork_isolation_scope"),Th=b.createContextKey("sentry_fork_set_scope"),Sh=b.createContextKey("sentry_fork_set_isolation_scope"),Vv="_scopeContext";function hs(e){return e.getValue(Gv)}function $v(e,t){return e.setValue(Gv,t)}function CF(e,t){un(e,Vv,t)}function Oc(e){return e[Vv]}function os(e){const{traceFlags:t,traceState:n}=e,r=n?n.get($E)==="1":!1;if(t===b.TraceFlags.SAMPLED)return!0;if(r)return!1;const o=n?n.get(VE):void 0,s=o?$c(o):void 0;if(s?.sampled==="true")return!0;if(s?.sampled==="false")return!1}function Bv(e,t,n){const r=t[Q.ATTR_HTTP_REQUEST_METHOD]||t[Q.SEMATTRS_HTTP_METHOD];if(r)return PF({attributes:t,name:e,kind:n},r);const o=t[Q.SEMATTRS_DB_SYSTEM],s=typeof t[Ee]=="string"&&t[Ee].startsWith("cache.");if(o&&!s)return IF({attributes:t,name:e});const i=t[Zt]==="custom"?"custom":"route";if(t[Q.SEMATTRS_RPC_SERVICE])return{...dc(e,t,"route"),op:"rpc"};if(t[Q.SEMATTRS_MESSAGING_SYSTEM])return{...dc(e,t,i),op:"message"};const u=t[Q.SEMATTRS_FAAS_TRIGGER];return u?{...dc(e,t,i),op:u.toString()}:{op:void 0,description:e,source:"custom"}}function Hv(e){const t=GE(e)?e.attributes:{},n=kv(e)?e.name:"<unknown>",r=NF(e);return Bv(n,t,r)}function IF({attributes:e,name:t}){const n=e[ts];if(typeof n=="string")return{op:"db",description:n,source:e[Zt]||"custom"};if(e[Zt]==="custom")return{op:"db",description:t,source:"custom"};const r=e[Q.SEMATTRS_DB_STATEMENT];return{op:"db",description:r?r.toString():t,source:"task"}}function PF({name:e,kind:t,attributes:n},r){const o=["http"];switch(t){case b.SpanKind.CLIENT:o.push("client");break;case b.SpanKind.SERVER:o.push("server");break}n["sentry.http.prefetch"]&&o.push("prefetch");const{urlPath:s,url:i,query:a,fragment:c,hasRoute:u}=vF(n,t);if(!s)return{...dc(e,n),op:o.join(".")};const f=n[sc],d=`${r} ${s}`,l=f?`${d} (${MF(f)})`:d,_=u||s==="/"?"route":"url",p={};i&&(p.url=i),a&&(p["http.query"]=a),c&&(p["http.fragment"]=c);const h=t===b.SpanKind.CLIENT||t===b.SpanKind.SERVER,T=!`${n[xe]||"manual"}`.startsWith("auto"),S=n[Zt]==="custom",g=n[ts],A=!S&&g==null&&(h||!T),{description:R,source:O}=A?{description:l,source:_}:dc(e,n);return{op:o.join("."),description:R,source:O,data:p}}function MF(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}function vF(e,t){const n=e[Q.SEMATTRS_HTTP_TARGET],r=e[Q.SEMATTRS_HTTP_URL]||e[Q.ATTR_URL_FULL],o=e[Q.ATTR_HTTP_ROUTE],s=typeof r=="string"?Hl(r):void 0,i=s?Fl(s):void 0,a=s?.search||void 0,c=s?.hash||void 0;return typeof o=="string"?{urlPath:o,url:i,query:a,fragment:c,hasRoute:!0}:t===b.SpanKind.SERVER&&typeof n=="string"?{urlPath:Nc(n),url:i,query:a,fragment:c,hasRoute:!1}:s?{urlPath:i,url:i,query:a,fragment:c,hasRoute:!1}:typeof n=="string"?{urlPath:Nc(n),url:i,query:a,fragment:c,hasRoute:!1}:{urlPath:void 0,url:i,query:a,fragment:c,hasRoute:!1}}function dc(e,t,n="custom"){const r=t[Zt]||n,o=t[ts];return o&&typeof o=="string"?{description:o,source:r}:{description:e,source:r}}function wF(e){e.on("createDsc",(t,n)=>{if(!n)return;const s=ye(n).data[Zt],{description:i}=kv(n)?Hv(n):{description:void 0};if(s!=="url"&&i&&(t.transaction=i),Xt()){const a=os(n.spanContext());t.sampled=a==null?void 0:String(a)}})}function Fv(){return b.trace.getActiveSpan()}const Nn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Yv({dsc:e,sampled:t}){const n=e?EE(e):void 0,r=new us,o=n?r.set(VE,n):r;return t===!1?o.set($E,"1"):o}const jv=new Set;function LF(){return Array.from(jv)}function ed(e){jv.add(e)}class DF extends UP{constructor(){super(),ed("SentryPropagator"),this._urlMatchesTargetsMap=new ps(100)}inject(t,n,r){if(Cn(t)){Nn&&j.log("[Tracing] Not injecting trace data for url because tracing is suppressed.");return}const o=b.trace.getSpan(t),s=o&&xF(o),i=Te()?.getOptions()?.tracePropagationTargets;if(!BE(s,i,this._urlMatchesTargetsMap)){Nn&&j.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",s);return}const a=kF(n);let c=b.propagation.getBaggage(t)||b.propagation.createBaggage({});const{dynamicSamplingContext:u,traceId:f,spanId:d,sampled:l}=qv(t);if(a){const _=ju(a);_&&Object.entries(_).forEach(([p,h])=>{c=c.setEntry(p,{value:h})})}u&&(c=Object.entries(u).reduce((_,[p,h])=>h?_.setEntry(`${hE}${p}`,{value:h}):_,c)),f&&f!==b.INVALID_TRACEID&&r.set(n,rf,Ul(f,d,l)),super.inject(b.propagation.setBaggage(t,c),n,r)}extract(t,n,r){const o=r.get(n,rf),s=r.get(n,hh),i=o?Array.isArray(o)?o[0]:o:void 0;return Kv(Wv(t,{sentryTrace:i,baggage:s}))}fields(){return[rf,hh]}}const qR="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function BE(e,t,n){if(typeof e!="string"||!t)return!0;const r=n?.get(e);if(r!==void 0)return Nn&&!r&&j.log(qR,e),r;const o=xc(e,t);return n?.set(e,o),Nn&&!o&&j.log(qR,e),o}function qv(e,t={}){const n=b.trace.getSpan(e);if(n?.spanContext().isRemote){const a=n.spanContext();return{dynamicSamplingContext:$t(n),traceId:a.traceId,spanId:void 0,sampled:os(a)}}if(n){const a=n.spanContext();return{dynamicSamplingContext:$t(n),traceId:a.traceId,spanId:a.spanId,sampled:os(a)}}const r=t.scope||hs(e)?.scope||ze(),o=t.client||Te(),s=r.getPropagationContext();return{dynamicSamplingContext:o?Bc(o,r):void 0,traceId:s.traceId,spanId:s.propagationSpanId,sampled:s.sampled}}function Wv(e,{sentryTrace:t,baggage:n}){const r=PM(t,n),{traceId:o,parentSpanId:s,sampled:i,dsc:a}=r,c=Te(),u=$c(n);if(!s||c&&!Yx(c,u?.org_id))return e;const f=GF({traceId:o,spanId:s,sampled:i,dsc:a});return b.trace.setSpanContext(e,f)}function UF(e,t,n){const r=Kv(Wv(e,t));return b.context.with(r,n)}function Kv(e){const t=hs(e),n={scope:t?t.scope:ze().clone(),isolationScope:t?t.isolationScope:je()};return $v(e,n)}function kF(e){try{const t=e[hh];return Array.isArray(t)?t.join(","):t}catch{return}}function xF(e){const t=ye(e).data,n=t[Q.SEMATTRS_HTTP_URL]||t[Q.ATTR_URL_FULL];if(typeof n=="string")return n;const r=e.spanContext().traceState?.get(xv);if(r)return r}function GF({spanId:e,traceId:t,sampled:n,dsc:r}){const o=Yv({dsc:r,sampled:n});return{traceId:t,spanId:e,isRemote:!0,traceFlags:n?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,traceState:o}}function zv(e,t,n){const r=Xv(),{name:o,parentSpan:s}=e;return ew(s)(()=>{const a=Jv(e.scope,e.forceTransaction),u=e.onlyIfParent&&!b.trace.getSpan(a)?io(a):a,f=Qv(e);if(!Xt()){const d=Cn(u)?u:io(u);return b.context.with(d,()=>r.startActiveSpan(o,f,d,l=>b.context.with(a,()=>_o(()=>t(l),()=>{ye(l).status===void 0&&l.setStatus({code:b.SpanStatusCode.ERROR})},n?()=>l.end():void 0))))}return r.startActiveSpan(o,f,u,d=>_o(()=>t(d),()=>{ye(d).status===void 0&&d.setStatus({code:b.SpanStatusCode.ERROR})},n?()=>d.end():void 0))})}function VF(e,t){return zv(e,t,!0)}function $F(e,t){return zv(e,n=>t(n,()=>n.end()),!1)}function BF(e){const t=Xv(),{name:n,parentSpan:r}=e;return ew(r)(()=>{const s=Jv(e.scope,e.forceTransaction);let a=e.onlyIfParent&&!b.trace.getSpan(s)?io(s):s;const c=Qv(e);return Xt()||(a=Cn(a)?a:io(a)),t.startSpan(n,c,a)})}function Zv(e,t){const n=e?b.trace.setSpan(b.context.active(),e):b.trace.deleteSpan(b.context.active());return b.context.with(n,()=>t(ze()))}function Xv(){return Te()?.tracer||b.trace.getTracer("@sentry/opentelemetry",Qe)}function Qv(e){const{startTime:t,attributes:n,kind:r,op:o,links:s}=e,i=typeof t=="number"?HF(t):t;return{attributes:o?{[Ee]:o,...n}:n,kind:r,links:s,startTime:i}}function HF(e){return e<9999999999?e*1e3:e}function Jv(e,t){const n=FF(e),r=b.trace.getSpan(n);if(!r||!t)return n;const o=b.trace.deleteSpan(n),{spanId:s,traceId:i}=r.spanContext(),a=os(r.spanContext()),c=qt(r),u=$t(c),f=Yv({dsc:u,sampled:a}),d={traceId:i,spanId:s,isRemote:!0,traceFlags:a?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,traceState:f};return b.trace.setSpanContext(o,d)}function FF(e){if(e){const t=Oc(e);if(t)return t}return b.context.active()}function YF(e,t){return UF(b.context.active(),e,t)}function jF(e,t){const n=Oc(t),r=n&&b.trace.getSpan(n),o=r?kl(r):fE(t);return[r?$t(r):Bc(e,t),o]}function ew(e){return e!==void 0?t=>Zv(e,t):t=>t()}function qF(e){const t=io(b.context.active());return b.context.with(t,e)}function WF(e){e.on("preprocessEvent",t=>{const n=Fv();if(!n||t.type==="transaction")return;t.contexts={trace:kl(n),...t.contexts};const r=qt(n);return t.sdkProcessingMetadata={dynamicSamplingContext:$t(r),...t.sdkProcessingMetadata},t})}function KF({span:e,scope:t,client:n}={}){let r=(t&&Oc(t))??b.context.active();if(e){const{scope:c}=ns(e);r=c&&Oc(c)||b.trace.setSpan(b.context.active(),e)}const{traceId:o,spanId:s,sampled:i,dynamicSamplingContext:a}=qv(r,{scope:t,client:n});return{"sentry-trace":Ul(o,s,i),baggage:EE(a)}}function zF(){function e(){const a=b.context.active(),c=hs(a);return c||{scope:dE(),isolationScope:ds()}}function t(a){const c=b.context.active();return b.context.with(c,()=>a(s()))}function n(a,c){const u=Oc(a)||b.context.active();return b.context.with(u.setValue(Th,a),()=>c(a))}function r(a){const c=b.context.active();return b.context.with(c.setValue(Eh,!0),()=>a(i()))}function o(a,c){const u=b.context.active();return b.context.with(u.setValue(Sh,a),()=>c(i()))}function s(){return e().scope}function i(){return e().isolationScope}Ax({withScope:t,withSetScope:n,withSetIsolationScope:o,withIsolationScope:r,getCurrentScope:s,getIsolationScope:i,startSpan:VF,startSpanManual:$F,startInactiveSpan:BF,getActiveSpan:Fv,suppressTracing:qF,getTraceData:KF,continueTrace:YF,withActiveSpan:Zv})}function ZF(e){class t extends e{constructor(...r){super(...r),ed("SentryContextManager")}with(r,o,s,...i){const a=hs(r),c=a?.scope||ze(),u=a?.isolationScope||je(),f=r.getValue(Eh)===!0,d=r.getValue(Th),l=r.getValue(Sh),_=d||c.clone(),p=l||(f?u.clone():u),T=$v(r,{scope:_,isolationScope:p}).deleteValue(Eh).deleteValue(Th).deleteValue(Sh);return CF(_,T),super.with(T,o,s,...i)}}return t}function XF(e){const t=new Map;for(const n of e)QF(t,n);return Array.from(t,function([n,r]){return r})}function tw(e){return e.attributes[kE]===!0?void 0:xE(e)}function QF(e,t){const n=t.spanContext().spanId,r=tw(t);if(!r){mh(e,{id:n,span:t,children:[]});return}const o=JF(e,r),s=mh(e,{id:n,span:t,parentNode:o,children:[]});o.children.push(s)}function JF(e,t){const n=e.get(t);return n||mh(e,{id:t,children:[]})}function mh(e,t){const n=e.get(t.id);return n?.span?n:n&&!n.span?(n.span=t.span,n.parentNode=t.parentNode,n):(e.set(t.id,t),t)}const nw={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"},eY=e=>Object.values(nw).includes(e);function rw(e){const t=GE(e)?e.attributes:{},n=RF(e)?e.status:void 0;if(n){if(n.code===b.SpanStatusCode.OK)return{code:Yu};if(n.code===b.SpanStatusCode.ERROR){if(typeof n.message>"u"){const o=WR(t);if(o)return o}return n.message&&eY(n.message)?{code:Ae,message:n.message}:{code:Ae,message:"internal_error"}}}const r=WR(t);return r||(n?.code===b.SpanStatusCode.UNSET?{code:Yu}:{code:Ae,message:"unknown_error"})}function WR(e){const t=e[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]||e[Q.SEMATTRS_HTTP_STATUS_CODE],n=e[Q.SEMATTRS_RPC_GRPC_STATUS_CODE],r=typeof t=="number"?t:typeof t=="string"?parseInt(t):void 0;if(typeof r=="number")return oh(r);if(typeof n=="string")return{code:Ae,message:nw[n]||"unknown_error"}}const KR=1e3,zR=300;class tY{constructor(t){this._finishedSpanBucketSize=t?.timeout||zR,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap,this._sentSpans=new Map,this._debouncedFlush=kV(this.flush.bind(this),1,{maxWait:100})}export(t){const n=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==n){let i=0;this._finishedSpanBuckets.forEach((a,c)=>{a&&a.timestampInS<=n-this._finishedSpanBucketSize&&(i+=a.spans.size,this._finishedSpanBuckets[c]=void 0)}),i>0&&Nn&&j.log(`SpanExporter dropped ${i} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=n}const r=n%this._finishedSpanBucketSize,o=this._finishedSpanBuckets[r]||{timestampInS:n,spans:new Set};this._finishedSpanBuckets[r]=o,o.spans.add(t),this._spansToBucketEntry.set(t,o);const s=tw(t);(!s||this._sentSpans.has(s))&&this._debouncedFlush()}flush(){const t=this._finishedSpanBuckets.flatMap(i=>i?Array.from(i.spans):[]);this._flushSentSpanCache();const n=this._maybeSend(t),r=n.size,o=t.length-r;Nn&&j.log(`SpanExporter exported ${r} spans, ${o} spans are waiting for their parent spans to finish`);const s=Date.now()+zR*1e3;for(const i of n){this._sentSpans.set(i.spanContext().spanId,s);const a=this._spansToBucketEntry.get(i);a&&a.spans.delete(i)}this._debouncedFlush.cancel()}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._sentSpans.clear(),this._debouncedFlush.cancel()}_maybeSend(t){const n=XF(t),r=new Set,o=this._getCompletedRootNodes(n);for(const s of o){const i=s.span;r.add(i);const a=rY(i);if(s.parentNode&&this._sentSpans.has(s.parentNode.id)){const f=a.contexts?.trace?.data;f&&(f["sentry.parent_span_already_sent"]=!0)}const c=a.spans||[];for(const f of s.children)gh(f,c,r);a.spans=c.length>KR?c.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,KR):c;const u=qu(i.events);u&&(a.measurements=u),GG(a)}return r}_flushSentSpanCache(){const t=Date.now();for(const[n,r]of this._sentSpans.entries())r<=t&&this._sentSpans.delete(n)}_nodeIsCompletedRootNodeOrHasSentParent(t){return!!t.span&&(!t.parentNode||this._sentSpans.has(t.parentNode.id))}_getCompletedRootNodes(t){return t.filter(n=>this._nodeIsCompletedRootNodeOrHasSentParent(n))}}function nY(e){const t=e.attributes,n=t[xe],r=t[Ee],o=t[Zt];return{origin:n,op:r,source:o}}function rY(e){const{op:t,description:n,data:r,origin:o="manual",source:s}=ow(e),i=ns(e),a=e.attributes[es],c={[Zt]:s,[es]:a,[Ee]:t,[xe]:o,...r,...sw(e.attributes)},{links:u}=e,{traceId:f,spanId:d}=e.spanContext(),l=xE(e),_=rw(e),p={parent_span_id:l,span_id:d,trace_id:f,data:c,origin:o,op:t,status:Gl(_),links:xl(u)},h=c[Q.ATTR_HTTP_RESPONSE_STATUS_CODE],E=typeof h=="number"?{response:{status_code:h}}:void 0;return{contexts:{trace:p,otel:{resource:e.resource.attributes},...E},spans:[],start_timestamp:An(e.startTime),timestamp:An(e.endTime),transaction:n,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:i.scope,capturedSpanIsolationScope:i.isolationScope,sampleRate:a,dynamicSamplingContext:$t(e)},...s&&{transaction_info:{source:s}}}}function gh(e,t,n){const r=e.span;if(r&&n.add(r),!r){e.children.forEach(g=>{gh(g,t,n)});return}const s=r.spanContext().spanId,i=r.spanContext().traceId,a=xE(r),{attributes:c,startTime:u,endTime:f,links:d}=r,{op:l,description:_,data:p,origin:h="manual"}=ow(r),E={[xe]:h,[Ee]:l,...sw(c),...p},T=rw(r),S={span_id:s,trace_id:i,data:E,description:_,parent_span_id:a,start_timestamp:An(u),timestamp:An(f)||void 0,status:Gl(T),op:l,origin:h,measurements:qu(r.events),links:xl(d)};t.push(S),e.children.forEach(g=>{gh(g,t,n)})}function ow(e){const{op:t,source:n,origin:r}=nY(e),{op:o,description:s,source:i,data:a}=Hv(e),c=t||o,u=n||i,f={...a,...oY(e)};return{op:c,description:s,source:u,origin:r,data:f}}function sw(e){const t={...e};return delete t[es],delete t[kE],delete t[ts],t}function oY(e){const t=e.attributes,n={};e.kind!==b.SpanKind.INTERNAL&&(n["otel.kind"]=b.SpanKind[e.kind]);const r=t[Q.SEMATTRS_HTTP_STATUS_CODE];r&&(n[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]=r);const o=yF(e);return o.url&&(n.url=o.url),o["http.query"]&&(n["http.query"]=o["http.query"].slice(1)),o["http.fragment"]&&(n["http.fragment"]=o["http.fragment"].slice(1)),n}function sY(e,t){const n=b.trace.getSpan(t);let r=hs(t);n&&!n.spanContext().isRemote&&SE(n,e),n?.spanContext().isRemote&&e.setAttribute(kE,!0),t===b.ROOT_CONTEXT&&(r={scope:dE(),isolationScope:ds()}),r&&NM(e,r.scope,r.isolationScope),xM(e),Te()?.emit("spanStart",e)}function iY(e){GM(e),Te()?.emit("spanEnd",e)}class aY{constructor(t){ed("SentrySpanProcessor"),this._exporter=new tY(t)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(t,n){sY(t,n)}onEnd(t){iY(t),this._exporter.export(t)}}class cY{constructor(t){this._client=t,ed("SentrySampler")}shouldSample(t,n,r,o,s,i){const a=this._client.getOptions(),c=dY(t),u=c?.spanContext();if(!Xt(a))return Mo({decision:void 0,context:t,spanAttributes:s});const f=s[Q.SEMATTRS_HTTP_METHOD]||s[Q.ATTR_HTTP_REQUEST_METHOD];if(o===b.SpanKind.CLIENT&&f&&(!c||u?.isRemote))return Mo({decision:void 0,context:t,spanAttributes:s});const d=c?uY(c,n,r):void 0;if(!(!c||u?.isRemote))return Mo({decision:d?kt.RECORD_AND_SAMPLED:kt.NOT_RECORD,context:t,spanAttributes:s});const{description:_,data:p,op:h}=Bv(r,s,o),E={...p,...s};h&&(E[Ee]=h);const T={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:E,spanName:_,parentSampled:d,parentContext:u},T),!T.decision)return Mo({decision:void 0,context:t,spanAttributes:s});const{isolationScope:S}=hs(t)??{},g=u?.traceState?u.traceState.get(VE):void 0,A=g?$c(g):void 0,R=fo(A?.sample_rand)??Math.random(),[O,C,I]=VM(a,{name:_,attributes:E,normalizedRequest:S?.getScopeData().sdkProcessingMetadata.normalizedRequest,parentSampled:d,parentSampleRate:fo(A?.sample_rate)},R),w=`${f}`.toUpperCase();return w==="OPTIONS"||w==="HEAD"?(Nn&&j.log(`[Tracing] Not sampling span because HTTP method is '${w}' for ${r}`),Mo({decision:kt.NOT_RECORD,context:t,spanAttributes:s,sampleRand:R,downstreamTraceSampleRate:0})):(!O&&d===void 0&&(Nn&&j.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),this._client.recordDroppedEvent("sample_rate","transaction")),{...Mo({decision:O?kt.RECORD_AND_SAMPLED:kt.NOT_RECORD,context:t,spanAttributes:s,sampleRand:R,downstreamTraceSampleRate:I?C:void 0}),attributes:{[es]:I?C:void 0}})}toString(){return"SentrySampler"}}function uY(e,t,n){const r=e.spanContext();if(b.isSpanContextValid(r)&&r.traceId===t){if(r.isRemote){const s=os(e.spanContext());return Nn&&j.log(`[Tracing] Inheriting remote parent's sampled decision for ${n}: ${s}`),s}const o=os(r);return Nn&&j.log(`[Tracing] Inheriting parent's sampled decision for ${n}: ${o}`),o}}function Mo({decision:e,context:t,spanAttributes:n,sampleRand:r,downstreamTraceSampleRate:o}){let s=lY(t,n);return o!==void 0&&(s=s.set(bF,`${o}`)),r!==void 0&&(s=s.set(OF,`${r}`)),e==null?{decision:kt.NOT_RECORD,traceState:s}:e===kt.NOT_RECORD?{decision:e,traceState:s.set($E,"1")}:{decision:e,traceState:s}}function lY(e,t){let o=b.trace.getSpan(e)?.spanContext()?.traceState||new us;const s=t[Q.SEMATTRS_HTTP_URL]||t[Q.ATTR_URL_FULL];return s&&typeof s=="string"&&(o=o.set(xv,s)),o}function dY(e){const t=b.trace.getSpan(e);return t&&b.isSpanContextValid(t.spanContext())?t:void 0}function Ah(e,t){if(!e)return t;const n=ju(e),r=ju(t);if(!r)return e;const o={...n};return Object.entries(r).forEach(([s,i])=>{o[s]||(o[s]=i)}),OM(o)}function fY(e,t){const n=pY(e),r=t?.statusCode,o=bv(r);rs({category:"http",data:{status_code:r,...n},type:"http",level:o},{event:"response",request:e,response:t})}function _Y(e,t){const n=EY(e),r=Te()?.getOptions().tracePropagationTargets,o=BE(n,r,t)?iv():void 0;if(!o)return;const{"sentry-trace":s,baggage:i}=o;if(s&&!e.getHeader("sentry-trace"))try{e.setHeader("sentry-trace",s),Ie&&j.log(Go,"Added sentry-trace header to outgoing request")}catch(a){Ie&&j.error(Go,"Failed to add sentry-trace header to outgoing request:",$u(a)?a.message:"Unknown error")}if(i){const a=Ah(e.getHeader("baggage"),i);if(a)try{e.setHeader("baggage",a),Ie&&j.log(Go,"Added baggage header to outgoing request")}catch(c){Ie&&j.error(Go,"Failed to add baggage header to outgoing request:",$u(c)?c.message:"Unknown error")}}}function pY(e){try{const t=e.getHeader("host")||e.host,n=new URL(e.path,`${e.protocol}//${t}`),r=Hl(n.toString()),o={url:Fl(r),"http.method":e.method||"GET"};return r.search&&(o["http.query"]=r.search),r.hash&&(o["http.fragment"]=r.hash),o}catch{return{}}}function hY(e){return{method:e.method,protocol:e.protocol,host:e.host,hostname:e.host,path:e.path,headers:e.getHeaders()}}function EY(e){const t=e.getHeader("host")||e.host,n=e.protocol,r=e.path;return`${n}//${t}${r}`}class iw extends bt{constructor(t={}){super(Go,Qe,t),this._propagationDecisionMap=new ps(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){let t=!1;const n=(a=>{const c=a;this._onOutgoingRequestFinish(c.request,c.response)}),r=(a=>{const c=a;this._onOutgoingRequestFinish(c.request,void 0)}),o=(a=>{const c=a;this._onOutgoingRequestCreated(c.request)}),s=a=>(t||(t=!0,mn.subscribe("http.client.response.finish",n),mn.subscribe("http.client.request.error",r),this.getConfig().propagateTraceInOutgoingRequests&&mn.subscribe("http.client.request.created",o)),a),i=()=>{mn.unsubscribe("http.client.response.finish",n),mn.unsubscribe("http.client.request.error",r),mn.unsubscribe("http.client.request.created",o)};return[new ft("http",["*"],s,i),new ft("https",["*"],s,i)]}_onOutgoingRequestFinish(t,n){Ie&&j.log(Go,"Handling finished outgoing request");const r=this.getConfig().breadcrumbs,o=typeof r>"u"?!0:r,s=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,s),o&&!s&&fY(t,n)}_onOutgoingRequestCreated(t){const n=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,n),!n&&_Y(t,this._propagationDecisionMap)}_shouldIgnoreOutgoingRequest(t){if(Cn(b.context.active()))return!0;const n=this.getConfig().ignoreOutgoingRequests;if(!n)return!1;const r=hY(t),o=Mv(t);return n(o,r)}}const aw="Http",TY=Ne(`${aw}.sentry`,e=>new iw(e)),SY=(e={})=>{const t={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},n={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes},r={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!0,ignoreOutgoingRequests:e.ignoreOutgoingRequests},o=Iv(t),s=Pv(n),i=e.spans??!1,a=e.disableIncomingRequestSpans??!1,c=i&&!a;return{name:aw,setup(u){c&&s.setup(u)},setupOnce(){o.setupOnce(),TY(r)},processEvent(u){return s.processEvent(u)}}},td=lx(process.versions.node),zo=td.major,Rh=td.minor,tu="sentry-trace",of="baggage",ZR=/baggage: (.*)\r\n/;class cw extends bt{constructor(t={}){super("@sentry/instrumentation-node-fetch",Qe,t),this._channelSubs=[],this._propagationDecisionMap=new ps(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(t=>t.unsubscribe()),this._channelSubs=[]}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this._subscribeToChannel("undici:request:create",this._onRequestCreated.bind(this)),this._subscribeToChannel("undici:request:headers",this._onResponseHeaders.bind(this)))}_onRequestCreated({request:t}){if(!(this.getConfig().enabled!==!1))return;const o=this._shouldIgnoreOutgoingRequest(t);if(this._ignoreOutgoingRequestsMap.set(t,o),o)return;const s=yh(t.origin,t.path),i=Te()?.getOptions().tracePropagationTargets,a=BE(s,i,this._propagationDecisionMap)?iv():void 0;if(!a)return;const{"sentry-trace":c,baggage:u}=a;if(Array.isArray(t.headers)){const f=t.headers;c&&!f.includes(tu)&&f.push(tu,c);const d=f.findIndex(l=>l===of);if(u&&d===-1)f.push(of,u);else if(u){const l=f[d+1],_=Ah(l,u);_&&(f[d+1]=_)}}else{const f=t.headers;c&&!f.includes(`${tu}:`)&&(t.headers+=`${tu}: ${c}\r
`);const d=t.headers.match(ZR)?.[1];if(u&&!d)t.headers+=`${of}: ${u}\r
`;else if(u){const l=Ah(d,u);l&&(t.headers=t.headers.replace(ZR,`baggage: ${l}\r
`))}}}_onResponseHeaders({request:t,response:n}){const r=this.getConfig();if(!(r.enabled!==!1))return;const s=r.breadcrumbs,i=typeof s>"u"?!0:s,a=this._ignoreOutgoingRequestsMap.get(t);i&&!a&&mY(t,n)}_subscribeToChannel(t,n){const r=zo>18||zo===18&&Rh>=19;let o;if(r)Ad.subscribe?.(t,n),o=()=>Ad.unsubscribe?.(t,n);else{const s=Ad.channel(t);s.subscribe(n),o=()=>s.unsubscribe(n)}this._channelSubs.push({name:t,unsubscribe:o})}_shouldIgnoreOutgoingRequest(t){if(Cn(b.context.active()))return!0;const n=yh(t.origin,t.path),r=this.getConfig().ignoreOutgoingRequests;return typeof r!="function"||!n?!1:r(n)}}function mY(e,t){const n=gY(e),r=t.statusCode,o=bv(r);rs({category:"http",data:{status_code:r,...n},type:"http",level:o},{event:"response",request:e,response:t})}function gY(e){try{const t=yh(e.origin,e.path),n=Hl(t),r={url:Fl(n),"http.method":e.method||"GET"};return n.search&&(r["http.query"]=n.search),n.hash&&(r["http.fragment"]=n.hash),r}catch{return{}}}function yh(e,t="/"){try{return new URL(t,e).toString()}catch{const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}}const AY="NodeFetch",RY=Ne(`${AY}.sentry`,cw,e=>e),yY=((e={})=>({name:"NodeFetch",setupOnce(){RY(e)}})),NY=yY,OY=Uc.promisify(pe.readFile),bY=Uc.promisify(pe.readdir),CY="Context",IY=((e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(s){t===void 0&&(t=o());const i=MY(await t);return s.contexts={...s.contexts,app:{...i.app,...s.contexts?.app},os:{...i.os,...s.contexts?.os},device:{...i.device,...s.contexts?.device},culture:{...i.culture,...s.contexts?.culture},cloud_resource:{...i.cloud_resource,...s.contexts?.cloud_resource}},s}async function o(){const s={};if(n.os&&(s.os=await vY()),n.app&&(s.app=LY()),n.device&&(s.device=DY(n.device)),n.culture){const i=wY();i&&(s.culture=i)}return n.cloudResource&&(s.cloud_resource=$Y()),s}return{name:CY,processEvent(s){return r(s)}}}),PY=IY;function MY(e){if(e.app?.app_memory&&(e.app.app_memory=process.memoryUsage().rss),e.app?.free_memory&&typeof process.availableMemory=="function"){const t=process.availableMemory?.();t!=null&&(e.app.free_memory=t)}return e.device?.free_memory&&(e.device.free_memory=Ut.freemem()),e}async function vY(){const e=Ut.platform();switch(e){case"darwin":return GY();case"linux":return VY();default:return{name:UY[e]||e,version:Ut.release()}}}function wY(){try{if(typeof process.versions.icu!="string")return;const e=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(e)==="enero"){const n=Intl.DateTimeFormat().resolvedOptions();return{locale:n.locale,timezone:n.timeZone}}}catch{}}function LY(){const e=process.memoryUsage().rss,n={app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:e};if(typeof process.availableMemory=="function"){const r=process.availableMemory?.();r!=null&&(n.free_memory=r)}return n}function DY(e){const t={};let n;try{n=Ut.uptime()}catch{}if(typeof n=="number"&&(t.boot_time=new Date(Date.now()-n*1e3).toISOString()),t.arch=Ut.arch(),(e===!0||e.memory)&&(t.memory_size=Ut.totalmem(),t.free_memory=Ut.freemem()),e===!0||e.cpu){const r=Ut.cpus(),o=r?.[0];o&&(t.processor_count=r.length,t.cpu_description=o.model,t.processor_frequency=o.speed)}return t}const UY={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows",ohos:"OpenHarmony",android:"Android"},kY=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],xY={alpine:e=>e,arch:e=>Tn(/distrib_release=(.*)/,e),centos:e=>Tn(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>Tn(/release (..)/,e),mint:e=>Tn(/distrib_release=(.*)/,e),red:e=>Tn(/release ([^ ]+)/,e),suse:e=>Tn(/VERSION = (.*)\n/,e),ubuntu:e=>Tn(/distrib_release=(.*)/,e)};function Tn(e,t){const n=e.exec(t);return n?n[1]:void 0}async function GY(){const e={kernel_version:Ut.release(),name:"Mac OS X",version:`10.${Number(Ut.release().split(".")[0])-4}`};try{const t=await new Promise((n,r)=>{Dc.execFile("/usr/bin/sw_vers",(o,s)=>{if(o){r(o);return}n(s)})});e.name=Tn(/^ProductName:\s+(.*)$/m,t),e.version=Tn(/^ProductVersion:\s+(.*)$/m,t),e.build=Tn(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}function XR(e){return e.split(" ")[0].toLowerCase()}async function VY(){const e={kernel_version:Ut.release(),name:"Linux"};try{const t=await bY("/etc"),n=kY.find(a=>t.includes(a.name));if(!n)return e;const r=ce.join("/etc",n.name),o=(await OY(r,{encoding:"utf-8"})).toLowerCase(),{distros:s}=n;e.name=s.find(a=>o.indexOf(XR(a))>=0)||s[0];const i=XR(e.name);e.version=xY[i]?.(o)}catch{}return e}function $Y(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}const Nh=new ps(10),uw=new ps(20),BY=7,HY="ContextLines",FY=1e3,YY=1e4;function jY(e,t,n){const r=e.get(t);return r===void 0?(e.set(t,n),n):r}function qY(e){return!!(e.startsWith("node:")||e.endsWith(".min.js")||e.endsWith(".min.cjs")||e.endsWith(".min.mjs")||e.startsWith("data:"))}function WY(e){return e.lineno!==void 0&&e.lineno>YY||e.colno!==void 0&&e.colno>FY}function KY(e,t){const n=Nh.get(e);if(n===void 0)return!1;for(let r=t[0];r<=t[1];r++)if(n[r]===void 0)return!1;return!0}function zY(e,t){if(!e.length)return[];let n=0;const r=e[0];if(typeof r!="number")return[];let o=JR(r,t);const s=[];for(;;){if(n===e.length-1){s.push(o);break}const i=e[n+1];if(typeof i!="number")break;i<=o[1]?o[1]=i+t:(s.push(o),o=JR(i,t)),n++}return s}function ZY(e,t,n){return new Promise((r,o)=>{const s=pe.createReadStream(e),i=R0.createInterface({input:s});function a(){s.destroy(),r()}let c=0,u=0;const f=t[u];if(f===void 0){a();return}let d=f[0],l=f[1];function _(p){uw.set(e,1),Ie&&j.error(`Failed to read file: ${e}. Error: ${p}`),i.close(),i.removeAllListeners(),a()}s.on("error",_),i.on("error",_),i.on("close",a),i.on("line",p=>{if(c++,!(c<d)&&(n[c]=ox(p,0),c>=l)){if(u===t.length-1){i.close(),i.removeAllListeners();return}u++;const h=t[u];if(h===void 0){i.close(),i.removeAllListeners();return}d=h[0],l=h[1]}})})}async function XY(e,t){const n={};if(t>0&&e.exception?.values){for(const s of e.exception.values)if(s.stacktrace?.frames?.length)for(let i=s.stacktrace.frames.length-1;i>=0;i--){const a=s.stacktrace.frames[i],c=a?.filename;if(!a||typeof c!="string"||typeof a.lineno!="number"||qY(c)||WY(a))continue;n[c]||(n[c]=[]),n[c].push(a.lineno)}}const r=Object.keys(n);if(r.length==0)return e;const o=[];for(const s of r){if(uw.get(s))continue;const i=n[s];if(!i)continue;i.sort((u,f)=>u-f);const a=zY(i,t);if(a.every(u=>KY(s,u)))continue;const c=jY(Nh,s,{});o.push(ZY(s,a,c))}if(await Promise.all(o).catch(()=>{Ie&&j.log("Failed to read one or more source files and resolve context lines")}),t>0&&e.exception?.values)for(const s of e.exception.values)s.stacktrace?.frames&&s.stacktrace.frames.length>0&&QY(s.stacktrace.frames,t,Nh);return e}function QY(e,t,n){for(const r of e)if(r.filename&&r.context_line===void 0&&typeof r.lineno=="number"){const o=n.get(r.filename);if(o===void 0)continue;JY(r.lineno,r,t,o)}}function QR(e){delete e.pre_context,delete e.context_line,delete e.post_context}function JY(e,t,n,r){if(t.lineno===void 0||r===void 0){Ie&&j.error("Cannot resolve context for frame with no lineno or file contents");return}t.pre_context=[];for(let s=lw(e,n);s<e;s++){const i=r[s];if(i===void 0){QR(t),Ie&&j.error(`Could not find line ${s} in file ${t.filename}`);return}t.pre_context.push(i)}if(r[e]===void 0){QR(t),Ie&&j.error(`Could not find line ${e} in file ${t.filename}`);return}t.context_line=r[e];const o=dw(e,n);t.post_context=[];for(let s=e+1;s<=o;s++){const i=r[s];if(i===void 0)break;t.post_context.push(i)}}function lw(e,t){return Math.max(1,e-t)}function dw(e,t){return e+t}function JR(e,t){return[lw(e,t),dw(e,t)]}const ej=((e={})=>{const t=e.frameContextLines!==void 0?e.frameContextLines:BY;return{name:HY,processEvent(n){return XY(n,t)}}}),tj=ej;let nu;async function fw(){if(nu===void 0)try{nu=!!(await import("node:inspector")).url()}catch{nu=!1}return nu}const ru="__SENTRY_ERROR_LOCAL_VARIABLES__";function nj(e,t,n){let r=0,o=5,s=0;return setInterval(()=>{s===0?r>e&&(o*=2,n(o),o>86400&&(o=86400),s=o):(s-=1,s===0&&t()),r=0},1e3).unref(),()=>{r+=1}}function ey(e){return e!==void 0&&(e.length===0||e==="?"||e==="<anonymous>")}function _w(e,t){return e===t||`Object.${e}`===t||e===`Object.${t}`||ey(e)&&ey(t)}const rj="LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjI5LjAgKDM1MjlkNDYpIHwgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdCAqLwppbXBvcnR7U2Vzc2lvbiBhcyBlfWZyb20ibm9kZTppbnNwZWN0b3IvcHJvbWlzZXMiO2ltcG9ydHt3b3JrZXJEYXRhIGFzIHR9ZnJvbSJub2RlOndvcmtlcl90aHJlYWRzIjtjb25zdCBuPWdsb2JhbFRoaXMsaT17fTtjb25zdCBvPSJfX1NFTlRSWV9FUlJPUl9MT0NBTF9WQVJJQUJMRVNfXyI7Y29uc3QgYT10O2Z1bmN0aW9uIHMoLi4uZSl7YS5kZWJ1ZyYmZnVuY3Rpb24oZSl7aWYoISgiY29uc29sZSJpbiBuKSlyZXR1cm4gZSgpO2NvbnN0IHQ9bi5jb25zb2xlLG89e30sYT1PYmplY3Qua2V5cyhpKTthLmZvckVhY2goZT0+e2NvbnN0IG49aVtlXTtvW2VdPXRbZV0sdFtlXT1ufSk7dHJ5e3JldHVybiBlKCl9ZmluYWxseXthLmZvckVhY2goZT0+e3RbZV09b1tlXX0pfX0oKCk9PmNvbnNvbGUubG9nKCJbTG9jYWxWYXJpYWJsZXMgV29ya2VyXSIsLi4uZSkpfWFzeW5jIGZ1bmN0aW9uIGMoZSx0LG4saSl7Y29uc3Qgbz1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pO2lbbl09by5yZXN1bHQuZmlsdGVyKGU9PiJsZW5ndGgiIT09ZS5uYW1lJiYhaXNOYU4ocGFyc2VJbnQoZS5uYW1lLDEwKSkpLnNvcnQoKGUsdCk9PnBhcnNlSW50KGUubmFtZSwxMCktcGFyc2VJbnQodC5uYW1lLDEwKSkubWFwKGU9PmUudmFsdWU/LnZhbHVlKX1hc3luYyBmdW5jdGlvbiByKGUsdCxuLGkpe2NvbnN0IG89YXdhaXQgZS5wb3N0KCJSdW50aW1lLmdldFByb3BlcnRpZXMiLHtvYmplY3RJZDp0LG93blByb3BlcnRpZXM6ITB9KTtpW25dPW8ucmVzdWx0Lm1hcChlPT5bZS5uYW1lLGUudmFsdWU/LnZhbHVlXSkucmVkdWNlKChlLFt0LG5dKT0+KGVbdF09bixlKSx7fSl9ZnVuY3Rpb24gdShlLHQpe2UudmFsdWUmJigidmFsdWUiaW4gZS52YWx1ZT92b2lkIDA9PT1lLnZhbHVlLnZhbHVlfHxudWxsPT09ZS52YWx1ZS52YWx1ZT90W2UubmFtZV09YDwke2UudmFsdWUudmFsdWV9PmA6dFtlLm5hbWVdPWUudmFsdWUudmFsdWU6ImRlc2NyaXB0aW9uImluIGUudmFsdWUmJiJmdW5jdGlvbiIhPT1lLnZhbHVlLnR5cGU/dFtlLm5hbWVdPWA8JHtlLnZhbHVlLmRlc2NyaXB0aW9ufT5gOiJ1bmRlZmluZWQiPT09ZS52YWx1ZS50eXBlJiYodFtlLm5hbWVdPSI8dW5kZWZpbmVkPiIpKX1hc3luYyBmdW5jdGlvbiBsKGUsdCl7Y29uc3Qgbj1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pLGk9e307Zm9yKGNvbnN0IHQgb2Ygbi5yZXN1bHQpaWYodC52YWx1ZT8ub2JqZWN0SWQmJiJBcnJheSI9PT10LnZhbHVlLmNsYXNzTmFtZSl7Y29uc3Qgbj10LnZhbHVlLm9iamVjdElkO2F3YWl0IGMoZSxuLHQubmFtZSxpKX1lbHNlIGlmKHQudmFsdWU/Lm9iamVjdElkJiYiT2JqZWN0Ij09PXQudmFsdWUuY2xhc3NOYW1lKXtjb25zdCBuPXQudmFsdWUub2JqZWN0SWQ7YXdhaXQgcihlLG4sdC5uYW1lLGkpfWVsc2UgdC52YWx1ZSYmdSh0LGkpO3JldHVybiBpfWxldCBmOyhhc3luYyBmdW5jdGlvbigpe2NvbnN0IHQ9bmV3IGU7dC5jb25uZWN0VG9NYWluVGhyZWFkKCkscygiQ29ubmVjdGVkIHRvIG1haW4gdGhyZWFkIik7bGV0IG49ITE7dC5vbigiRGVidWdnZXIucmVzdW1lZCIsKCk9PntuPSExfSksdC5vbigiRGVidWdnZXIucGF1c2VkIixlPT57bj0hMCxhc3luYyBmdW5jdGlvbihlLHtyZWFzb246dCxkYXRhOntvYmplY3RJZDpufSxjYWxsRnJhbWVzOml9KXtpZigiZXhjZXB0aW9uIiE9PXQmJiJwcm9taXNlUmVqZWN0aW9uIiE9PXQpcmV0dXJuO2lmKGY/LigpLG51bGw9PW4pcmV0dXJuO2NvbnN0IGE9W107Zm9yKGxldCB0PTA7dDxpLmxlbmd0aDt0Kyspe2NvbnN0e3Njb3BlQ2hhaW46bixmdW5jdGlvbk5hbWU6byx0aGlzOnN9PWlbdF0sYz1uLmZpbmQoZT0+ImxvY2FsIj09PWUudHlwZSkscj0iZ2xvYmFsIiE9PXMuY2xhc3NOYW1lJiZzLmNsYXNzTmFtZT9gJHtzLmNsYXNzTmFtZX0uJHtvfWA6bztpZih2b2lkIDA9PT1jPy5vYmplY3Qub2JqZWN0SWQpYVt0XT17ZnVuY3Rpb246cn07ZWxzZXtjb25zdCBuPWF3YWl0IGwoZSxjLm9iamVjdC5vYmplY3RJZCk7YVt0XT17ZnVuY3Rpb246cix2YXJzOm59fX1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuY2FsbEZ1bmN0aW9uT24iLHtmdW5jdGlvbkRlY2xhcmF0aW9uOmBmdW5jdGlvbigpIHsgdGhpcy4ke299ID0gdGhpcy4ke299IHx8ICR7SlNPTi5zdHJpbmdpZnkoYSl9OyB9YCxzaWxlbnQ6ITAsb2JqZWN0SWQ6bn0pLGF3YWl0IGUucG9zdCgiUnVudGltZS5yZWxlYXNlT2JqZWN0Iix7b2JqZWN0SWQ6bn0pfSh0LGUucGFyYW1zKS50aGVuKGFzeW5jKCk9PntuJiZhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpfSxhc3luYyBlPT57biYmYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5yZXN1bWUiKX0pfSksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5lbmFibGUiKTtjb25zdCBpPSExIT09YS5jYXB0dXJlQWxsRXhjZXB0aW9ucztpZihhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6aT8iYWxsIjoidW5jYXVnaHQifSksaSl7Y29uc3QgZT1hLm1heEV4Y2VwdGlvbnNQZXJTZWNvbmR8fDUwO2Y9ZnVuY3Rpb24oZSx0LG4pe2xldCBpPTAsbz01LGE9MDtyZXR1cm4gc2V0SW50ZXJ2YWwoKCk9PnswPT09YT9pPmUmJihvKj0yLG4obyksbz44NjQwMCYmKG89ODY0MDApLGE9byk6KGEtPTEsMD09PWEmJnQoKSksaT0wfSwxZTMpLnVucmVmKCksKCk9PntpKz0xfX0oZSxhc3luYygpPT57cygiUmF0ZS1saW1pdCBsaWZ0ZWQuIiksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJhbGwifSl9LGFzeW5jIGU9PntzKGBSYXRlLWxpbWl0IGV4Y2VlZGVkLiBEaXNhYmxpbmcgY2FwdHVyaW5nIG9mIGNhdWdodCBleGNlcHRpb25zIGZvciAke2V9IHNlY29uZHMuYCksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJ1bmNhdWdodCJ9KX0pfX0pKCkuY2F0Y2goZT0+e3MoIkZhaWxlZCB0byBzdGFydCBkZWJ1Z2dlciIsZSl9KSxzZXRJbnRlcnZhbCgoKT0+e30sMWU0KTs=";function ty(...e){j.log("[LocalVariables]",...e)}const oj=((e={})=>{function t(s,i){const a=(s.stacktrace?.frames||[]).filter(c=>c.function!=="new Promise");for(let c=0;c<a.length;c++){const u=a.length-c-1,f=i[c],d=a[u];if(!d||!f)break;f.vars===void 0||d.in_app===!1&&e.includeOutOfAppFrames!==!0||!_w(d.function,f.function)||(d.vars=f.vars)}}function n(s,i){if(i.originalException&&typeof i.originalException=="object"&&ru in i.originalException&&Array.isArray(i.originalException[ru])){for(const a of s.exception?.values||[])t(a,i.originalException[ru]);i.originalException[ru]=void 0}return s}async function r(){const s=await import("node:inspector");s.url()||s.open(0)}function o(s){const i=new Al.Worker(new URL(`data:application/javascript;base64,${rj}`),{workerData:s,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{i.terminate()}),i.once("error",a=>{ty("Worker error",a)}),i.once("exit",a=>{ty("Worker exit",a)}),i.unref()}return{name:"LocalVariablesAsync",async setup(s){if(!s.getOptions().includeLocalVariables)return;if(await fw()){j.warn("Local variables capture has been disabled because the debugger was already enabled");return}const a={...e,debug:j.isEnabled()};r().then(()=>{try{o(a)}catch(c){j.error("Failed to start worker",c)}},c=>{j.error("Failed to start inspector",c)})},processEvent(s,i){return n(s,i)}}});function pw(e){if(e!==void 0)return e.slice(-10).reduce((t,n)=>`${t},${n.function},${n.lineno},${n.colno}`,"")}function sj(e,t){if(t!==void 0)return pw(e(t,1))}function hw(e){let t=[],n=!1;function r(i){t=[],!n&&(n=!0,e(i))}t.push(r);function o(i){t.push(i)}function s(i){const a=t.pop()||r;try{a(i)}catch{r(i)}}return{add:o,next:s}}class HE{constructor(t){this._session=t}static async create(t){if(t)return t;const n=await import("node:inspector");return new HE(new n.Session)}configureAndConnect(t,n){this._session.connect(),this._session.on("Debugger.paused",r=>{t(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:n?"all":"uncaught"})}setPauseOnExceptions(t){this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}getLocalVariables(t,n){this._getProperties(t,r=>{const{add:o,next:s}=hw(n);for(const i of r)if(i.value?.objectId&&i.value.className==="Array"){const a=i.value.objectId;o(c=>this._unrollArray(a,i.name,c,s))}else if(i.value?.objectId&&i.value.className==="Object"){const a=i.value.objectId;o(c=>this._unrollObject(a,i.name,c,s))}else i.value&&o(a=>this._unrollOther(i,a,s));s({})})}_getProperties(t,n){this._session.post("Runtime.getProperties",{objectId:t,ownProperties:!0},(r,o)=>{n(r?[]:o.result)})}_unrollArray(t,n,r,o){this._getProperties(t,s=>{r[n]=s.filter(i=>i.name!=="length"&&!isNaN(parseInt(i.name,10))).sort((i,a)=>parseInt(i.name,10)-parseInt(a.name,10)).map(i=>i.value?.value),o(r)})}_unrollObject(t,n,r,o){this._getProperties(t,s=>{r[n]=s.map(i=>[i.name,i.value?.value]).reduce((i,[a,c])=>(i[a]=c,i),{}),o(r)})}_unrollOther(t,n,r){t.value&&("value"in t.value?t.value.value===void 0||t.value.value===null?n[t.name]=`<${t.value.value}>`:n[t.name]=t.value.value:"description"in t.value&&t.value.type!=="function"?n[t.name]=`<${t.value.description}>`:t.value.type==="undefined"&&(n[t.name]="<undefined>")),r(n)}}const ij="LocalVariables",aj=((e={},t)=>{const n=new ps(20);let r,o=!1;function s(u){const f=pw(u.stacktrace?.frames);if(f===void 0)return;const d=n.remove(f);if(d===void 0)return;const l=(u.stacktrace?.frames||[]).filter(_=>_.function!=="new Promise");for(let _=0;_<l.length;_++){const p=l.length-_-1,h=d[_],E=l[p];if(!E||!h)break;h.vars===void 0||E.in_app===!1&&e.includeOutOfAppFrames!==!0||!_w(E.function,h.function)||(E.vars=h.vars)}}function i(u){for(const f of u.exception?.values||[])s(f);return u}let a;async function c(){const f=Te()?.getOptions();if(!f?.includeLocalVariables)return;if(zo<18){j.log("The `LocalVariables` integration is only supported on Node >= v18.");return}if(await fw()){j.warn("Local variables capture has been disabled because the debugger was already enabled");return}try{const l=await HE.create(t),_=(h,{params:{reason:E,data:T,callFrames:S}},g)=>{if(E!=="exception"&&E!=="promiseRejection"){g();return}r?.();const A=sj(h,T.description);if(A==null){g();return}const{add:R,next:O}=hw(C=>{n.set(A,C),g()});for(let C=0;C<Math.min(S.length,5);C++){const{scopeChain:I,functionName:w,this:U}=S[C],B=I.find(G=>G.type==="local"),F=U.className==="global"||!U.className?w:`${U.className}.${w}`;if(B?.object.objectId===void 0)R(G=>{G[C]={function:F},O(G)});else{const G=B.object.objectId;R(x=>l.getLocalVariables(G,Y=>{x[C]={function:F,vars:Y},O(x)}))}}O([])},p=e.captureAllExceptions!==!1;if(l.configureAndConnect((h,E)=>_(f.stackParser,h,E),p),p){const h=e.maxExceptionsPerSecond||50;r=nj(h,()=>{j.log("Local variables rate-limit lifted."),l.setPauseOnExceptions(!0)},E=>{j.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${E} seconds.`),l.setPauseOnExceptions(!1)})}o=!0}catch(l){j.log("The `LocalVariables` integration failed to start.",l)}}return{name:ij,setupOnce(){a=c()},async processEvent(u){return await a,o?i(u):u},_getCachedFramesCount(){return n.size},_getFirstCachedFrame(){return n.values()[0]}}}),cj=aj,uj=(e={})=>td.major<19?cj(e):oj(e);function FE(){try{return typeof module<"u"&&typeof module.exports<"u"}catch{return!1}}let ny;function lj(){return FE()?!1:zo>=21||zo===20&&Rh>=6||zo===18&&Rh>=19?!0:(ny||(ny=!0,cn(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})),!1)}let sf;const dj="Modules",fj=typeof __SENTRY_SERVER_MODULES__>"u"?{}:__SENTRY_SERVER_MODULES__,_j=(()=>({name:dj,processEvent(e){return e.modules={...e.modules,...ry()},e},getModules:ry})),pj=_j;function hj(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}function Ej(){return{...fj,...mj(),...FE()?Tj():{}}}function Tj(){const e=require.main?.paths||[],t=hj(),n={},r=new Set;return t.forEach(o=>{let s=o;const i=()=>{const a=s;if(s=ce.dirname(a),!s||a===s||r.has(a))return;if(e.indexOf(s)<0)return i();const c=ce.join(a,"package.json");if(r.add(a),!pe.existsSync(c))return i();try{const u=JSON.parse(pe.readFileSync(c,"utf8"));n[u.name]=u.version}catch{}};i()}),n}function ry(){return sf||(sf=Ej()),sf}function Sj(){try{const e=ce.join(process.cwd(),"package.json");return JSON.parse(pe.readFileSync(e,"utf8"))}catch{return{}}}function mj(){const e=Sj();return{...e.dependencies,...e.devDependencies}}const gj=2e3;function Oh(e){cn(()=>{console.error(e)});const t=Te();if(t===void 0){Ie&&j.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1);return}const n=t.getOptions(),r=n?.shutdownTimeout&&n.shutdownTimeout>0?n.shutdownTimeout:gj;t.close(r).then(o=>{o||Ie&&j.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},o=>{Ie&&j.error(o)})}const Aj="OnUncaughtException",Rj=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!1,...e};return{name:Aj,setup(n){global.process.on("uncaughtException",yj(n,t))}}};function yj(e,t){let r=!1,o=!1,s=!1,i;const a=e.getOptions();return Object.assign(c=>{let u=Oh;t.onFatalError?u=t.onFatalError:a.onFatalError&&(u=a.onFatalError);const d=global.process.listeners("uncaughtException").filter(_=>_.name!=="domainUncaughtExceptionClear"&&_.tag!=="sentry_tracingErrorCallback"&&_._errorHandler!==!0).length===0,l=t.exitEvenIfOtherHandlersAreRegistered||d;r?l&&(s?(Ie&&j.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),Oh(c)):o||(o=!0,setTimeout(()=>{s||(s=!0,u(i,c))},2e3))):(i=c,r=!0,Te()===e&&Ve(c,{originalException:c,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"auto.node.onuncaughtexception"}}),!s&&l&&(s=!0,u(c)))},{_errorHandler:!0})}const Nj="OnUnhandledRejection",Oj=[{name:"AI_NoOutputGeneratedError"}],bj=((e={})=>{const t={mode:e.mode??"warn",ignore:[...Oj,...e.ignore??[]]};return{name:Nj,setup(n){global.process.on("unhandledRejection",vj(n,t))}}}),Cj=bj;function Ij(e){if(typeof e!="object"||e===null)return{name:"",message:String(e??"")};const t=e,n=typeof t.name=="string"?t.name:"",r=typeof t.message=="string"?t.message:String(e);return{name:n,message:r}}function Pj(e,t){const n=e.name===void 0||Wo(t.name,e.name,!0),r=e.message===void 0||Wo(t.message,e.message);return n&&r}function Mj(e,t){const n=Ij(t);return e.some(r=>Pj(r,n))}function vj(e,t){return function(r,o){if(Te()!==e||Mj(t.ignore??[],r))return;const s=t.mode==="strict"?"fatal":"error",i=r&&typeof r=="object"?r._sentry_active_span:void 0;(i?c=>$M(i,c):c=>c())(()=>{Ve(r,{originalException:o,captureContext:{extra:{unhandledPromiseRejection:!0},level:s},mechanism:{handled:!1,type:"auto.node.onunhandledrejection"}})}),wj(r,t.mode)}}function wj(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";t==="warn"?cn(()=>{console.warn(n),console.error(e&&typeof e=="object"&&"stack"in e?e.stack:e)}):t==="strict"&&(cn(()=>{console.warn(n)}),Oh(e))}const Ew="Spotlight",Lj=((e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:Ew,setup(n){try{process.env.NODE_ENV&&process.env.NODE_ENV!=="development"&&j.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?")}catch{}Uj(n,t)}}}),Dj=Lj;function Uj(e,t){const n=kj(t.sidecarUrl);if(!n)return;let r=0;e.on("beforeEnvelope",o=>{if(r>3){j.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");return}const s=UM(o);BM(()=>{const i=wu.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},a=>{a.statusCode&&a.statusCode>=200&&a.statusCode<400&&(r=0),a.on("data",()=>{}),a.on("end",()=>{}),a.setEncoding("utf8")});i.on("error",()=>{r++,j.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),i.write(s),i.end()})})}function kj(e){try{return new URL(`${e}`)}catch{j.warn(`[Spotlight] Invalid sidecar URL: ${e}`);return}}const xj="NodeSystemError";function Gj(e){return!(e instanceof Error)||!("errno"in e)||typeof e.errno!="number"?!1:I0.getSystemErrorMap().has(e.errno)}const Vj=(e={})=>({name:xj,processEvent:(t,n,r)=>{if(!Gj(n.originalException))return t;const o=n.originalException,s={...o};!r.getOptions().sendDefaultPii&&e.includePaths!==!0&&(delete s.path,delete s.dest),t.contexts={...t.contexts,node_system_error:s};for(const i of t.exception?.values||[])i.value&&(o.path&&i.value.includes(o.path)&&(i.value=i.value.replace(`'${o.path}'`,"").trim()),o.dest&&i.value.includes(o.dest)&&(i.value=i.value.replace(`'${o.dest}'`,"").trim()));return t}}),$j="ChildProcess",Bj=(e={})=>({name:$j,setup(){vu.channel("child_process").subscribe(t=>{t&&typeof t=="object"&&"process"in t&&Hj(t.process,e)}),vu.channel("worker_threads").subscribe(t=>{t&&typeof t=="object"&&"worker"in t&&Fj(t.worker,e)})}});function Hj(e,t){let n=!1,r;e.on("spawn",()=>{if(e.spawnfile==="/usr/bin/sw_vers"){n=!0;return}r={spawnfile:e.spawnfile},t.includeChildProcessArgs&&(r.spawnargs=e.spawnargs)}).on("exit",o=>{n||(n=!0,o!==null&&o!==0&&rs({category:"child_process",message:`Child process exited with code '${o}'`,level:o===0?"info":"warning",data:r}))}).on("error",o=>{n||(n=!0,rs({category:"child_process",message:`Child process errored with '${o.message}'`,level:"error",data:r}))})}function Fj(e,t){let n;e.on("online",()=>{n=e.threadId}).on("error",r=>{t.captureWorkerErrors!==!1?Ve(r,{mechanism:{type:"auto.child_process.worker_thread",handled:!1,data:{threadId:String(n)}}}):rs({category:"worker_thread",message:`Worker thread errored with '${r.message}'`,level:"error",data:{threadId:n}})})}var af={},ma={},ga={},oy;function Tw(){if(oy)return ga;oy=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.AbstractAsyncHooksContextManager=void 0;const e=wc,t=["addListener","on","once","prependListener","prependOnceListener"];let n=class{bind(o,s){return s instanceof e.EventEmitter?this._bindEventEmitter(o,s):typeof s=="function"?this._bindFunction(o,s):s}_bindFunction(o,s){const i=this,a=function(...c){return i.with(o,()=>s.apply(this,c))};return Object.defineProperty(a,"length",{enumerable:!1,configurable:!0,writable:!1,value:s.length}),a}_bindEventEmitter(o,s){return this._getPatchMap(s)!==void 0||(this._createPatchMap(s),t.forEach(a=>{s[a]!==void 0&&(s[a]=this._patchAddListener(s,s[a],o))}),typeof s.removeListener=="function"&&(s.removeListener=this._patchRemoveListener(s,s.removeListener)),typeof s.off=="function"&&(s.off=this._patchRemoveListener(s,s.off)),typeof s.removeAllListeners=="function"&&(s.removeAllListeners=this._patchRemoveAllListeners(s,s.removeAllListeners))),s}_patchRemoveListener(o,s){const i=this;return function(a,c){const u=i._getPatchMap(o)?.[a];if(u===void 0)return s.call(this,a,c);const f=u.get(c);return s.call(this,a,f||c)}}_patchRemoveAllListeners(o,s){const i=this;return function(a){const c=i._getPatchMap(o);return c!==void 0&&(arguments.length===0?i._createPatchMap(o):c[a]!==void 0&&delete c[a]),s.apply(this,arguments)}}_patchAddListener(o,s,i){const a=this;return function(c,u){if(a._wrapped)return s.call(this,c,u);let f=a._getPatchMap(o);f===void 0&&(f=a._createPatchMap(o));let d=f[c];d===void 0&&(d=new WeakMap,f[c]=d);const l=a.bind(i,u);d.set(u,l),a._wrapped=!0;try{return s.call(this,c,l)}finally{a._wrapped=!1}}}_createPatchMap(o){const s=Object.create(null);return o[this._kOtListeners]=s,s}_getPatchMap(o){return o[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1};return ga.AbstractAsyncHooksContextManager=n,ga}var sy;function Yj(){if(sy)return ma;sy=1,Object.defineProperty(ma,"__esModule",{value:!0}),ma.AsyncHooksContextManager=void 0;const e=Pe(),t=RP,n=Tw();let r=class extends n.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=t.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??e.ROOT_CONTEXT}with(s,i,a,...c){this._enterContext(s);try{return i.call(a,...c)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(s,i){if(i==="TIMERWRAP")return;const a=this._stack[this._stack.length-1];a!==void 0&&this._contexts.set(s,a)}_destroy(s){this._contexts.delete(s)}_before(s){const i=this._contexts.get(s);i!==void 0&&this._enterContext(i)}_after(){this._exitContext()}_enterContext(s){this._stack.push(s)}_exitContext(){this._stack.pop()}};return ma.AsyncHooksContextManager=r,ma}var Aa={},iy;function jj(){if(iy)return Aa;iy=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.AsyncLocalStorageContextManager=void 0;const e=Pe(),t=RP,n=Tw();let r=class extends n.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new t.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??e.ROOT_CONTEXT}with(s,i,a,...c){const u=a==null?i:i.bind(a);return this._asyncLocalStorage.run(s,u,...c)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}};return Aa.AsyncLocalStorageContextManager=r,Aa}var ay;function qj(){return ay||(ay=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncLocalStorageContextManager=e.AsyncHooksContextManager=void 0;var t=Yj();Object.defineProperty(e,"AsyncHooksContextManager",{enumerable:!0,get:function(){return t.AsyncHooksContextManager}});var n=jj();Object.defineProperty(e,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return n.AsyncLocalStorageContextManager}})})(af)),af}var Wj=qj();const Kj=ZF(Wj.AsyncLocalStorageContextManager);function zj(){b.diag.disable(),b.diag.setLogger({error:j.error,warn:j.warn,info:j.log,debug:j.log,verbose:j.log},b.DiagLogLevel.DEBUG)}const Zj="ProcessSession",Xj=()=>({name:Zj,setupOnce(){HG(),process.on("beforeExit",()=>{je().getSession()?.status!=="ok"&&qM()})}}),_n=Symbol("AgentBaseInternalState");class Qj extends wu.Agent{constructor(t){super(t),this[_n]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}const{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}createSocket(t,n,r){const o={...n,secureEndpoint:this.isSecureEndpoint(n)};Promise.resolve().then(()=>this.connect(t,o)).then(s=>{if(s instanceof wu.Agent)return s.addRequest(t,o);this[_n].currentSocket=s,super.createSocket(t,n,r)},r)}createConnection(){const t=this[_n].currentSocket;if(this[_n].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[_n].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[_n]&&(this[_n].defaultPort=t)}get protocol(){return this[_n].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[_n]&&(this[_n].protocol=t)}}function ou(...e){j.log("[https-proxy-agent:parse-proxy-response]",...e)}function Jj(e){return new Promise((t,n)=>{let r=0;const o=[];function s(){const f=e.read();f?u(f):e.once("readable",s)}function i(){e.removeListener("end",a),e.removeListener("error",c),e.removeListener("readable",s)}function a(){i(),ou("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function c(f){i(),ou("onerror %o",f),n(f)}function u(f){o.push(f),r+=f.length;const d=Buffer.concat(o,r),l=d.indexOf(`\r
\r
`);if(l===-1){ou("have not received end of HTTP headers yet..."),s();return}const _=d.subarray(0,l).toString("ascii").split(`\r
`),p=_.shift();if(!p)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const h=p.split(" "),E=+(h[1]||0),T=h.slice(2).join(" "),S={};for(const g of _){if(!g)continue;const A=g.indexOf(":");if(A===-1)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${g}"`));const R=g.slice(0,A).toLowerCase(),O=g.slice(A+1).trimStart(),C=S[R];typeof C=="string"?S[R]=[C,O]:Array.isArray(C)?C.push(O):S[R]=O}ou("got proxy server response: %o %o",p,S),i(),t({connect:{statusCode:E,statusText:T,headers:S},buffered:d})}e.on("error",c),e.on("end",a),s()})}function Ra(...e){j.log("[https-proxy-agent]",...e)}class Sw extends Qj{static __initStatic(){this.protocols=["http","https"]}constructor(t,n){super(n),this.options={},this.proxy=typeof t=="string"?new URL(t):t,this.proxyHeaders=n?.headers??{},Ra("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),o=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?cy(n,"headers"):null,host:r,port:o}}async connect(t,n){const{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let o;if(r.protocol==="https:"){Ra("Creating `tls.Socket`: %o",this.connectOpts);const l=this.connectOpts.servername||this.connectOpts.host;o=zm.connect({...this.connectOpts,servername:l&&Uo.isIP(l)?void 0:l})}else Ra("Creating `net.Socket`: %o",this.connectOpts),o=Uo.connect(this.connectOpts);const s=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},i=Uo.isIPv6(n.host)?`[${n.host}]`:n.host;let a=`CONNECT ${i}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){const l=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;s["Proxy-Authorization"]=`Basic ${Buffer.from(l).toString("base64")}`}s.Host=`${i}:${n.port}`,s["Proxy-Connection"]||(s["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const l of Object.keys(s))a+=`${l}: ${s[l]}\r
`;const c=Jj(o);o.write(`${a}\r
`);const{connect:u,buffered:f}=await c;if(t.emit("proxyConnect",u),this.emit("proxyConnect",u,t),u.statusCode===200){if(t.once("socket",eq),n.secureEndpoint){Ra("Upgrading socket connection to TLS");const l=n.servername||n.host;return zm.connect({...cy(n,"host","path","port"),socket:o,servername:Uo.isIP(l)?void 0:l})}return o}o.destroy();const d=new Uo.Socket({writable:!1});return d.readable=!0,t.once("socket",l=>{Ra("Replaying proxy buffer for failed request"),l.push(f),l.push(null)}),d}}Sw.__initStatic();function eq(e){e.resume()}function cy(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}const tq=1024*32;function nq(e){return new O0.Readable({read(){this.push(e),this.push(null)}})}function rq(e){let t;try{t=new URL(e.url)}catch{return cn(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),aR(e,()=>Promise.resolve({}))}const n=t.protocol==="https:",r=oq(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),o=n?M0:wu,s=e.keepAlive===void 0?!1:e.keepAlive,i=r?new Sw(r):new o.Agent({keepAlive:s,maxSockets:30,timeout:2e3}),a=sq(e,e.httpModule??o,i);return aR(e,a)}function oq(e,t){const{no_proxy:n}=process.env;if(!n?.split(",").some(o=>e.host.endsWith(o)||e.hostname.endsWith(o)))return t}function sq(e,t,n){const{hostname:r,pathname:o,port:s,protocol:i,search:a}=new URL(e.url);return function(u){return new Promise((f,d)=>{BM(()=>{let l=nq(u.body);const _={...e.headers};u.body.length>tq&&(_["content-encoding"]="gzip",l=l.pipe(b0.createGzip()));const p=t.request({method:"POST",agent:n,headers:_,hostname:r,path:`${o}${a}`,port:s,protocol:i,ca:e.caCerts},h=>{h.on("data",()=>{}),h.on("end",()=>{}),h.setEncoding("utf8");const E=h.headers["retry-after"]??null,T=h.headers["x-sentry-rate-limits"]??null;f({statusCode:h.statusCode,headers:{"retry-after":E,"x-sentry-rate-limits":Array.isArray(T)?T[0]||null:T}})});p.on("error",d),l.pipe(p)})})}}const iq=new Set(["false","f","n","no","off","0"]),aq=new Set(["true","t","y","yes","on","1"]);function bh(e,t){const n=String(e).toLowerCase();return iq.has(n)?!1:aq.has(n)?!0:t?.strict?null:!!e}function uy(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function cq(e=process.argv[1]?b$(process.argv[1]):process.cwd(),t=ce.sep==="\\"){const n=t?uy(e):e;return r=>{if(!r)return;const o=t?uy(r):r;let{dir:s,base:i,ext:a}=ce.posix.parse(o);(a===".js"||a===".mjs"||a===".cjs")&&(i=i.slice(0,a.length*-1));const c=decodeURIComponent(i);s||(s=".");const u=s.lastIndexOf("/node_modules");if(u>-1)return`${s.slice(u+14).replace(/\//g,".")}:${c}`;if(s.startsWith(n)){const f=s.slice(n.length+1).replace(/\//g,".");return f?`${f}:${c}`:c}return c}}function uq(e){if(process.env.SENTRY_RELEASE)return process.env.SENTRY_RELEASE;if(Oe.SENTRY_RELEASE?.id)return Oe.SENTRY_RELEASE.id;const t=process.env.GITHUB_SHA||process.env.CI_MERGE_REQUEST_SOURCE_BRANCH_SHA||process.env.CI_BUILD_REF||process.env.CI_COMMIT_SHA||process.env.BITBUCKET_COMMIT,n=process.env.APPVEYOR_PULL_REQUEST_HEAD_COMMIT||process.env.APPVEYOR_REPO_COMMIT||process.env.CODEBUILD_RESOLVED_SOURCE_VERSION||process.env.AWS_COMMIT_ID||process.env.BUILD_SOURCEVERSION||process.env.GIT_CLONE_COMMIT_HASH||process.env.BUDDY_EXECUTION_REVISION||process.env.BUILDKITE_COMMIT||process.env.CIRCLE_SHA1||process.env.CIRRUS_CHANGE_IN_REPO||process.env.CF_REVISION||process.env.CM_COMMIT||process.env.CF_PAGES_COMMIT_SHA||process.env.DRONE_COMMIT_SHA||process.env.FC_GIT_COMMIT_SHA||process.env.HEROKU_TEST_RUN_COMMIT_VERSION||process.env.HEROKU_SLUG_COMMIT||process.env.RAILWAY_GIT_COMMIT_SHA||process.env.RENDER_GIT_COMMIT||process.env.SEMAPHORE_GIT_SHA||process.env.TRAVIS_PULL_REQUEST_SHA||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA,r=process.env.CI_COMMIT_ID||process.env.SOURCE_COMMIT||process.env.SOURCE_VERSION||process.env.GIT_COMMIT||process.env.COMMIT_REF||process.env.BUILD_VCS_NUMBER||process.env.CI_COMMIT_SHA;return t||n||r||e}const lq=_M(HH(cq())),dq=6e4;class fq extends PV{constructor(t){const n=t.includeServerName===!1?void 0:t.serverName||global.process.env.SENTRY_NAME||Ut.hostname(),r={...t,platform:"node",runtime:{name:"node",version:global.process.version},serverName:n};t.openTelemetryInstrumentations&&wl({instrumentations:t.openTelemetryInstrumentations}),OE(r,"node"),j.log(`Initializing Sentry: process: ${process.pid}, thread: ${Xp.isMainThread?"main":`worker-${Xp.threadId}`}.`),super(r),this.getOptions().enableLogs&&(this._logOnExitFlushListener=()=>{KM(this)},n&&this.on("beforeCaptureLog",o=>{o.attributes={...o.attributes,"server.address":n}}),process.on("beforeExit",this._logOnExitFlushListener))}get tracer(){if(this._tracer)return this._tracer;const t="@sentry/node",n=Qe,r=b.trace.getTracer(t,n);return this._tracer=r,r}async flush(t){return await this.traceProvider?.forceFlush(),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(t)}async close(t){this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),this._logOnExitFlushListener&&process.off("beforeExit",this._logOnExitFlushListener);const n=await super.close(t);return this.traceProvider&&await this.traceProvider.shutdown(),n}startClientReportTracking(){const t=this.getOptions();t.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{Ie&&j.log("Flushing client reports based on interval."),this._flushOutcomes()},t.clientReportFlushInterval??dq).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_setupIntegrations(){vV(),super._setupIntegrations()}_getTraceInfoFromScope(t){return t?jF(this,t):[void 0,void 0]}}function _q(){if(lj()&&!Oe._sentryEsmLoaderHookRegistered){Oe._sentryEsmLoaderHookRegistered=!0;try{const{addHookMessagePort:e}=cM.createAddHookMessageChannel();P0.register("import-in-the-middle/hook.mjs",typeof document>"u"?require("url").pathToFileURL(__filename).href:gd&&gd.tagName.toUpperCase()==="SCRIPT"&&gd.src||new URL("worker.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){j.warn("Failed to register 'import-in-the-middle' hook",e)}}}function mw(){return[ZV(),qV(),u$(),T$(),Vj(),w$(),SY(),NY(),Rj(),Cj(),tj(),uj(),PY(),Bj(),Xj(),pj()]}function pq(e={}){return hq(e,mw)}function hq(e={},t){const n=Tq(e,t);n.debug===!0&&(Ie?j.enable():cn(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),n.registerEsmLoaderHooks!==!1&&_q(),zF(),ze().update(n.initialScope),n.spotlight&&!n.integrations.some(({name:s})=>s===Ew)&&n.integrations.push(Dj({sidecarUrl:typeof n.spotlight=="string"?n.spotlight:void 0})),OE(n,"node-core");const o=new fq(n);return ze().setClient(o),o.init(),Oe._sentryInjectLoaderHookRegister?.(),j.log(`SDK initialized from ${FE()?"CommonJS":"ESM"}`),o.startClientReportTracking(),gq(),wF(o),WF(o),o}function Eq(){if(!Ie)return;const e=LF(),t=["SentryContextManager","SentryPropagator"];Xt()&&t.push("SentrySpanProcessor");for(const n of t)e.includes(n)||j.error(`You have to set up the ${n}. Without this, the OpenTelemetry & Sentry integration will not work properly.`);e.includes("SentrySampler")||j.warn("You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected. If you use a custom sampler, make sure to use `wrapSamplingDecision`.")}function Tq(e,t){const n=Sq(e.release);let r;if(e.spotlight===!1)r=!1;else if(typeof e.spotlight=="string")r=e.spotlight;else{const c=bh(process.env.SENTRY_SPOTLIGHT,{strict:!0}),u=c===null&&process.env.SENTRY_SPOTLIGHT?process.env.SENTRY_SPOTLIGHT:void 0;r=e.spotlight===!0?u??!0:c??u}const o=mq(e.tracesSampleRate),s={...e,dsn:e.dsn??process.env.SENTRY_DSN,environment:e.environment??process.env.SENTRY_ENVIRONMENT,sendClientReports:e.sendClientReports??!0,transport:e.transport??rq,stackParser:V1(e.stackParser||lq),release:n,tracesSampleRate:o,spotlight:r,debug:bh(e.debug??process.env.SENTRY_DEBUG)},i=e.integrations,a=e.defaultIntegrations??t(s);return{...s,integrations:ZG({defaultIntegrations:a,integrations:i})}}function Sq(e){if(e!==void 0)return e;const t=uq();if(t!==void 0)return t}function mq(e){if(e!==void 0)return e;const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(!t)return;const n=parseFloat(t);return isFinite(n)?n:void 0}function gq(){if(bh(process.env.SENTRY_USE_ENVIRONMENT)!==!1){const e=process.env.SENTRY_TRACE,t=process.env.SENTRY_BAGGAGE,n=PM(e,t);ze().setPropagationContext(n)}}function Ot(e,t){e.setAttribute(xe,t)}const YE="Http",ly="@opentelemetry_sentry-patched/instrumentation-http",Aq=Ne(`${YE}.sentry`,e=>new iw(e)),Rq=Ne(YE,e=>{const t=new w1.HttpInstrumentation({...e,disableIncomingRequestInstrumentation:!0});try{t._diag=b.diag.createComponentLogger({namespace:ly}),t.instrumentationName=ly}catch{}return t});function yq(e,t={}){return typeof e.spans=="boolean"?e.spans:!(t.skipOpenTelemetrySetup||!Xt(t)&&td.major>=22)}const Nq=(e={})=>{const t=e.spans??!0,n=e.disableIncomingRequestSpans,r={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},o={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes,instrumentation:e.instrumentation,onSpanCreated:e.incomingRequestSpanHook},s=Iv(r),i=Pv(o),a=t&&!n;return{name:YE,setup(c){const u=c.getOptions();a&&Xt(u)&&i.setup(c)},setupOnce(){const c=Te()?.getOptions()||{},u=yq(e,c);s.setupOnce();const f={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!u,ignoreOutgoingRequests:e.ignoreOutgoingRequests};if(Aq(f),u){const d=Oq(e);Rq(d)}},processEvent(c){return i.processEvent(c)}}};function Oq(e={}){return{ignoreOutgoingRequestHook:n=>{const r=Mv(n);if(!r)return!1;const o=e.ignoreOutgoingRequests;return!!o?.(r,n)},requireParentforOutgoingSpans:!1,requestHook:(n,r)=>{Ot(n,"auto.http.otel.http"),e.instrumentation?.requestHook?.(n,r)},responseHook:(n,r)=>{e.instrumentation?.responseHook?.(n,r)},applyCustomAttributesOnSpan:(n,r,o)=>{e.instrumentation?.applyCustomAttributesOnSpan?.(n,r,o)}}}var cf={},ya={},Ir={},dy;function bq(){return dy||(dy=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.PACKAGE_NAME=Ir.PACKAGE_VERSION=void 0,Ir.PACKAGE_VERSION="0.19.0",Ir.PACKAGE_NAME="@opentelemetry/instrumentation-undici"),Ir}var fy;function Cq(){if(fy)return ya;fy=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.UndiciInstrumentation=void 0;const e=AP,t=Nl,n=Le,r=Pe(),o=fn,s=pt(),i=bq();class a extends n.InstrumentationBase{_recordFromReq=new WeakMap;constructor(u={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,u)}init(){}disable(){super.disable(),this._channelSubs.forEach(u=>u.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram(s.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:r.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(u,f){const[d,l]=process.version.replace("v","").split(".").map(h=>Number(h)),_=d>18||d===18&&l>=19;let p;if(_)e.subscribe?.(u,f),p=()=>e.unsubscribe?.(u,f);else{const h=e.channel(u);h.subscribe(f),p=()=>h.unsubscribe(f)}this._channelSubs.push({name:u,unsubscribe:p})}parseRequestHeaders(u){const f=new Map;if(Array.isArray(u.headers))for(let d=0;d<u.headers.length;d+=2){const l=u.headers[d],_=u.headers[d+1];typeof l=="string"&&f.set(l.toLowerCase(),_)}else if(typeof u.headers=="string"){const d=u.headers.split(`\r
`);for(const l of d){if(!l)continue;const _=l.indexOf(":");if(_===-1)continue;const p=l.substring(0,_).toLowerCase(),h=l.substring(_+1).trim(),E=f.get(p);E&&Array.isArray(E)?E.push(h):E?f.set(p,[E,h]):f.set(p,h)}}return f}onRequestCreated({request:u}){const f=this.getConfig(),d=f.enabled!==!1;if((0,n.safeExecuteInTheMiddle)(()=>!d||u.method==="CONNECT"||f.ignoreRequestHook?.(u),x=>x&&this._diag.error("caught ignoreRequestHook error: ",x),!0))return;const _=(0,o.hrTime)();let p;try{p=new t.URL(u.path,u.origin)}catch(x){this._diag.warn("could not determine url.full:",x);return}const h=p.protocol.replace(":",""),E=this.getRequestMethod(u.method),T={[s.ATTR_HTTP_REQUEST_METHOD]:E,[s.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]:u.method,[s.ATTR_URL_FULL]:p.toString(),[s.ATTR_URL_PATH]:p.pathname,[s.ATTR_URL_QUERY]:p.search,[s.ATTR_URL_SCHEME]:h},S={https:"443",http:"80"},g=p.hostname,A=p.port||S[h];T[s.ATTR_SERVER_ADDRESS]=g,A&&!isNaN(Number(A))&&(T[s.ATTR_SERVER_PORT]=Number(A));const O=this.parseRequestHeaders(u).get("user-agent");if(O){const x=Array.isArray(O)?O[O.length-1]:O;T[s.ATTR_USER_AGENT_ORIGINAL]=x}const C=(0,n.safeExecuteInTheMiddle)(()=>f.startSpanHook?.(u),x=>x&&this._diag.error("caught startSpanHook error: ",x),!0);C&&Object.entries(C).forEach(([x,Y])=>{T[x]=Y});const I=r.context.active(),w=r.trace.getSpan(I);let U;f.requireParentforSpans&&(!w||!r.trace.isSpanContextValid(w.spanContext()))?U=r.trace.wrapSpanContext(r.INVALID_SPAN_CONTEXT):U=this.tracer.startSpan(E==="_OTHER"?"HTTP":E,{kind:r.SpanKind.CLIENT,attributes:T},I),(0,n.safeExecuteInTheMiddle)(()=>f.requestHook?.(U,u),x=>x&&this._diag.error("caught requestHook error: ",x),!0);const B=r.trace.setSpan(r.context.active(),U),F={};r.propagation.inject(B,F);const G=Object.entries(F);for(let x=0;x<G.length;x++){const[Y,v]=G[x];typeof u.addHeader=="function"?u.addHeader(Y,v):typeof u.headers=="string"?u.headers+=`${Y}: ${v}\r
`:Array.isArray(u.headers)&&u.headers.push(Y,v)}this._recordFromReq.set(u,{span:U,attributes:T,startTime:_})}onRequestHeaders({request:u,socket:f}){const d=this._recordFromReq.get(u);if(!d)return;const l=this.getConfig(),{span:_}=d,{remoteAddress:p,remotePort:h}=f,E={[s.ATTR_NETWORK_PEER_ADDRESS]:p,[s.ATTR_NETWORK_PEER_PORT]:h};if(l.headersToSpanAttributes?.requestHeaders){const T=new Set(l.headersToSpanAttributes.requestHeaders.map(g=>g.toLowerCase())),S=this.parseRequestHeaders(u);for(const[g,A]of S.entries())if(T.has(g)){const R=Array.isArray(A)?A.join(", "):A;E[`http.request.header.${g}`]=R}}_.setAttributes(E)}onResponseHeaders({request:u,response:f}){const d=this._recordFromReq.get(u);if(!d)return;const{span:l,attributes:_}=d,p={[s.ATTR_HTTP_RESPONSE_STATUS_CODE]:f.statusCode},h=this.getConfig();(0,n.safeExecuteInTheMiddle)(()=>h.responseHook?.(l,{request:u,response:f}),T=>T&&this._diag.error("caught responseHook error: ",T),!0);const E=new Set;h.headersToSpanAttributes?.responseHeaders&&h.headersToSpanAttributes?.responseHeaders.forEach(T=>E.add(T.toLowerCase()));for(let T=0;T<f.headers.length;T=T+2){const S=f.headers[T].toString().toLowerCase(),g=f.headers[T+1];if(E.has(S)&&(p[`http.response.header.${S}`]=g.toString()),S==="content-length"){const A=Number(g.toString());isNaN(A)||(p["http.response.header.content-length"]=A)}}l.setAttributes(p),l.setStatus({code:f.statusCode>=400?r.SpanStatusCode.ERROR:r.SpanStatusCode.UNSET}),d.attributes=Object.assign(_,p)}onDone({request:u}){const f=this._recordFromReq.get(u);if(!f)return;const{span:d,attributes:l,startTime:_}=f;d.end(),this._recordFromReq.delete(u),this.recordRequestDuration(l,_)}onError({request:u,error:f}){const d=this._recordFromReq.get(u);if(!d)return;const{span:l,attributes:_,startTime:p}=d;l.recordException(f),l.setStatus({code:r.SpanStatusCode.ERROR,message:f.message}),l.end(),this._recordFromReq.delete(u),_[s.ATTR_ERROR_TYPE]=f.message,this.recordRequestDuration(_,p)}recordRequestDuration(u,f){const d={};[s.ATTR_HTTP_RESPONSE_STATUS_CODE,s.ATTR_HTTP_REQUEST_METHOD,s.ATTR_SERVER_ADDRESS,s.ATTR_SERVER_PORT,s.ATTR_URL_SCHEME,s.ATTR_ERROR_TYPE].forEach(p=>{p in u&&(d[p]=u[p])});const _=(0,o.hrTimeToMilliseconds)((0,o.hrTimeDuration)(f,(0,o.hrTime)()))/1e3;this._httpClientDurationHistogram.record(_,d)}getRequestMethod(u){const f={CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0};return u.toUpperCase()in f?u.toUpperCase():"_OTHER"}}return ya.UndiciInstrumentation=a,ya}var _y;function Iq(){return _y||(_y=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UndiciInstrumentation=void 0;var t=Cq();Object.defineProperty(e,"UndiciInstrumentation",{enumerable:!0,get:function(){return t.UndiciInstrumentation}})})(cf)),cf}var Pq=Iq();const gw="NodeFetch",Mq=Ne(gw,Pq.UndiciInstrumentation,e=>kq(e)),vq=Ne(`${gw}.sentry`,cw,e=>e),wq=((e={})=>({name:"NodeFetch",setupOnce(){Uq(e,Te()?.getOptions())&&Mq(e),vq(e)}})),Lq=wq;function Dq(e,t="/"){const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}function Uq(e,t={}){return typeof e.spans=="boolean"?e.spans:!t.skipOpenTelemetrySetup&&Xt(t)}function kq(e={}){return{requireParentforSpans:!1,ignoreRequestHook:n=>{const r=Dq(n.origin,n.path),o=e.ignoreOutgoingRequests;return!!(o&&r&&o(r))},startSpanHook:()=>({[xe]:"auto.http.otel.node_fetch"}),requestHook:e.requestHook,responseHook:e.responseHook}}var uf={},Na={},lf={},py;function jE(){return py||(py=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExpressLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ExpressLayerType||(e.ExpressLayerType={}))})(lf)),lf}var df={},hy;function qE(){return hy||(hy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.EXPRESS_TYPE="express.type",t.EXPRESS_NAME="express.name"})(e.AttributeNames||(e.AttributeNames={}))})(df)),df}var ff={},Pr={},Ey;function Aw(){return Ey||(Ey=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr._LAYERS_STORE_PROPERTY=Pr.kLayerPatched=void 0,Pr.kLayerPatched=Symbol("express-layer-patched"),Pr._LAYERS_STORE_PROPERTY="__ot_middlewares"),Pr}var Ty;function xq(){return Ty||(Ty=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getActualMatchedRoute=e.getConstructedRoute=e.getLayerPath=e.asErrorAndMessage=e.isLayerIgnored=e.getLayerMetadata=e.getRouterPath=e.storeLayerPath=void 0;const t=jE(),n=qE(),r=Aw(),o=(h,E)=>(Array.isArray(h[r._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(h,r._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),E===void 0?{isLayerPathStored:!1}:(h[r._LAYERS_STORE_PROPERTY].push(E),{isLayerPathStored:!0}));e.storeLayerPath=o;const s=(h,E)=>{const T=E.handle?.stack?.[0];return T?.route?.path?`${h}${T.route.path}`:T?.handle?.stack?(0,e.getRouterPath)(h,T):h};e.getRouterPath=s;const i=(h,E,T)=>{if(E.name==="router"){const S=(0,e.getRouterPath)("",E),g=S||T||h||"/";return{attributes:{[n.AttributeNames.EXPRESS_NAME]:g,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.ROUTER},name:`router - ${g}`}}else return E.name==="bound dispatch"||E.name==="handle"?{attributes:{[n.AttributeNames.EXPRESS_NAME]:(h||T)??"request handler",[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.REQUEST_HANDLER},name:`request handler${E.path?` - ${h||T}`:""}`}:{attributes:{[n.AttributeNames.EXPRESS_NAME]:E.name,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.MIDDLEWARE},name:`middleware - ${E.name}`}};e.getLayerMetadata=i;const a=(h,E)=>{if(typeof E=="string")return E===h;if(E instanceof RegExp)return E.test(h);if(typeof E=="function")return E(h);throw new TypeError("Pattern is in unsupported datatype")},c=(h,E,T)=>{if(Array.isArray(T?.ignoreLayersType)&&T?.ignoreLayersType?.includes(E))return!0;if(Array.isArray(T?.ignoreLayers)===!1)return!1;try{for(const S of T.ignoreLayers)if(a(h,S))return!0}catch{}return!1};e.isLayerIgnored=c;const u=h=>h instanceof Error?[h,h.message]:[String(h),String(h)];e.asErrorAndMessage=u;const f=h=>{const E=h[0];return Array.isArray(E)?E.map(T=>d(T)||"").join(","):d(E)};e.getLayerPath=f;const d=h=>{if(typeof h=="string")return h;if(h instanceof RegExp||typeof h=="number")return h.toString()};function l(h){const T=(Array.isArray(h[r._LAYERS_STORE_PROPERTY])?h[r._LAYERS_STORE_PROPERTY]:[]).filter(S=>S!=="/"&&S!=="/*");return T.length===1&&T[0]==="*"?"*":T.join("").replace(/\/{2,}/g,"/")}e.getConstructedRoute=l;function _(h){const E=Array.isArray(h[r._LAYERS_STORE_PROPERTY])?h[r._LAYERS_STORE_PROPERTY]:[];if(E.length===0)return;if(E.every(A=>A==="/"))return h.originalUrl==="/"?"/":void 0;const T=l(h);if(T==="*"||T.includes("/")&&(T.includes(",")||T.includes("\\")||T.includes("*")||T.includes("[")))return T;const S=T.startsWith("/")?T:`/${T}`;return S.length>0&&(h.originalUrl===S||h.originalUrl.startsWith(S)||p(S))?S:void 0}e.getActualMatchedRoute=_;function p(h){return h.includes(":")||h.includes("*")}})(ff)),ff}var Mr={},Sy;function Gq(){return Sy||(Sy=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.PACKAGE_NAME=Mr.PACKAGE_VERSION=void 0,Mr.PACKAGE_VERSION="0.57.0",Mr.PACKAGE_NAME="@opentelemetry/instrumentation-express"),Mr}var my;function Vq(){if(my)return Na;my=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.ExpressInstrumentation=void 0;const e=fn,t=Pe(),n=jE(),r=qE(),o=xq(),s=Gq(),i=Le,a=pt(),c=Aw();class u extends i.InstrumentationBase{constructor(d={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,d)}init(){return[new i.InstrumentationNodeModuleDefinition("express",[">=4.0.0 <6"],d=>{const l=typeof d?.Router?.prototype?.route=="function",_=l?d.Router.prototype:d.Router;return(0,i.isWrapped)(_.route)&&this._unwrap(_,"route"),this._wrap(_,"route",this._getRoutePatch()),(0,i.isWrapped)(_.use)&&this._unwrap(_,"use"),this._wrap(_,"use",this._getRouterUsePatch()),(0,i.isWrapped)(d.application.use)&&this._unwrap(d.application,"use"),this._wrap(d.application,"use",this._getAppUsePatch(l)),d},d=>{if(d===void 0)return;const _=typeof d?.Router?.prototype?.route=="function"?d.Router.prototype:d.Router;this._unwrap(_,"route"),this._unwrap(_,"use"),this._unwrap(d.application,"use")})]}_getRoutePatch(){const d=this;return function(l){return function(...p){const h=l.apply(this,p),E=this.stack[this.stack.length-1];return d._applyPatch(E,(0,o.getLayerPath)(p)),h}}}_getRouterUsePatch(){const d=this;return function(l){return function(...p){const h=l.apply(this,p),E=this.stack[this.stack.length-1];return d._applyPatch(E,(0,o.getLayerPath)(p)),h}}}_getAppUsePatch(d){const l=this;return function(_){return function(...h){const E=d?this.router:this._router,T=_.apply(this,h);if(E){const S=E.stack[E.stack.length-1];l._applyPatch(S,(0,o.getLayerPath)(h))}return T}}}_applyPatch(d,l){const _=this;d[c.kLayerPatched]!==!0&&(d[c.kLayerPatched]=!0,this._wrap(d,"handle",p=>{if(p.length===4)return p;const h=function(E,T){const{isLayerPathStored:S}=(0,o.storeLayerPath)(E,l),g=(0,o.getConstructedRoute)(E),A=(0,o.getActualMatchedRoute)(E),R={[a.ATTR_HTTP_ROUTE]:A},O=(0,o.getLayerMetadata)(g,d,l),C=O.attributes[r.AttributeNames.EXPRESS_TYPE],I=(0,e.getRPCMetadata)(t.context.active());if(I?.type===e.RPCType.HTTP&&(I.route=A),(0,o.isLayerIgnored)(O.name,C,_.getConfig()))return C===n.ExpressLayerType.MIDDLEWARE&&E[c._LAYERS_STORE_PROPERTY].pop(),p.apply(this,arguments);if(t.trace.getSpan(t.context.active())===void 0)return p.apply(this,arguments);const w=_._getSpanName({request:E,layerType:C,route:g},O.name),U=_.tracer.startSpan(w,{attributes:Object.assign(R,O.attributes)}),B=t.context.active();let F=t.trace.setSpan(B,U);const{requestHook:G}=_.getConfig();G&&(0,i.safeExecuteInTheMiddle)(()=>G(U,{request:E,layerType:C,route:g}),H=>{H&&t.diag.error("express instrumentation: request hook failed",H)},!0);let x=!1;O.attributes[r.AttributeNames.EXPRESS_TYPE]===n.ExpressLayerType.ROUTER&&(U.end(),x=!0,F=B);const Y=()=>{x===!1&&(x=!0,U.end())},v=Array.from(arguments),P=v.findIndex(H=>typeof H=="function");P>=0&&(arguments[P]=function(){const H=arguments[0],J=![void 0,null,"route","router"].includes(H);if(!x&&J){const[ne,M]=(0,o.asErrorAndMessage)(H);U.recordException(ne),U.setStatus({code:t.SpanStatusCode.ERROR,message:M})}x===!1&&(x=!0,E.res?.removeListener("finish",Y),U.end()),!(E.route&&J)&&S&&E[c._LAYERS_STORE_PROPERTY].pop();const se=v[P];return t.context.bind(B,se).apply(this,arguments)});try{return t.context.bind(F,p).apply(this,arguments)}catch(H){const[J,se]=(0,o.asErrorAndMessage)(H);throw U.recordException(J),U.setStatus({code:t.SpanStatusCode.ERROR,message:se}),H}finally{x||T.once("finish",Y)}};for(const E in p)Object.defineProperty(h,E,{get(){return p[E]},set(T){p[E]=T}});return h}))}_getSpanName(d,l){const{spanNameHook:_}=this.getConfig();if(!(_ instanceof Function))return l;try{return _(d,l)??l}catch(p){return t.diag.error("express instrumentation: error calling span name rewrite hook",p),l}}}return Na.ExpressInstrumentation=u,Na}var gy;function $q(){return gy||(gy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.ExpressLayerType=e.ExpressInstrumentation=void 0;var t=Vq();Object.defineProperty(e,"ExpressInstrumentation",{enumerable:!0,get:function(){return t.ExpressInstrumentation}});var n=jE();Object.defineProperty(e,"ExpressLayerType",{enumerable:!0,get:function(){return n.ExpressLayerType}});var r=qE();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return r.AttributeNames}})})(uf)),uf}var Bq=$q();const ho=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Rw="Express";function Hq(e){Ot(e,"auto.http.otel.express");const t=ye(e).data,n=t["express.type"];n&&e.setAttribute(Ee,`${n}.express`);const r=t["express.name"];typeof r=="string"&&e.updateName(r)}function Fq(e,t){if(je()===ds())return ho&&j.warn("Isolation scope is still default isolation scope - skipping setting transactionName"),t;if(e.layerType==="request_handler"){const n=e.request,r=n.method?n.method.toUpperCase():"GET";je().setTransactionName(`${r} ${e.route}`)}return t}const Yq=Ne(Rw,()=>new Bq.ExpressInstrumentation({requestHook:e=>Hq(e),spanNameHook:(e,t)=>Fq(e,t)})),jq=(()=>({name:Rw,setupOnce(){Yq()}})),qq=jq;var _f,Ay;function Wq(){if(Ay)return _f;Ay=1,_f=e;function e(r,o,s){r instanceof RegExp&&(r=t(r,s)),o instanceof RegExp&&(o=t(o,s));var i=n(r,o,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+r.length,i[1]),post:s.slice(i[1]+o.length)}}function t(r,o){var s=o.match(r);return s?s[0]:null}e.range=n;function n(r,o,s){var i,a,c,u,f,d=s.indexOf(r),l=s.indexOf(o,d+1),_=d;if(d>=0&&l>0){if(r===o)return[d,l];for(i=[],c=s.length;_>=0&&!f;)_==d?(i.push(_),d=s.indexOf(r,_+1)):i.length==1?f=[i.pop(),l]:(a=i.pop(),a<c&&(c=a,u=l),l=s.indexOf(o,_+1)),_=d<l&&d>=0?d:l;i.length&&(f=[c,u])}return f}return _f}var pf,Ry;function Kq(){if(Ry)return pf;Ry=1;var e=Wq();pf=f;var t="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",r="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",s="\0PERIOD"+Math.random()+"\0";function i(E){return parseInt(E,10)==E?parseInt(E,10):E.charCodeAt(0)}function a(E){return E.split("\\\\").join(t).split("\\{").join(n).split("\\}").join(r).split("\\,").join(o).split("\\.").join(s)}function c(E){return E.split(t).join("\\").split(n).join("{").split(r).join("}").split(o).join(",").split(s).join(".")}function u(E){if(!E)return[""];var T=[],S=e("{","}",E);if(!S)return E.split(",");var g=S.pre,A=S.body,R=S.post,O=g.split(",");O[O.length-1]+="{"+A+"}";var C=u(R);return R.length&&(O[O.length-1]+=C.shift(),O.push.apply(O,C)),T.push.apply(T,O),T}function f(E){return E?(E.substr(0,2)==="{}"&&(E="\\{\\}"+E.substr(2)),h(a(E),!0).map(c)):[]}function d(E){return"{"+E+"}"}function l(E){return/^-?0\d/.test(E)}function _(E,T){return E<=T}function p(E,T){return E>=T}function h(E,T){var S=[],g=e("{","}",E);if(!g)return[E];var A=g.pre,R=g.post.length?h(g.post,!1):[""];if(/\$$/.test(g.pre))for(var O=0;O<R.length;O++){var C=A+"{"+g.body+"}"+R[O];S.push(C)}else{var I=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(g.body),w=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(g.body),U=I||w,B=g.body.indexOf(",")>=0;if(!U&&!B)return g.post.match(/,(?!,).*\}/)?(E=g.pre+"{"+g.body+r+g.post,h(E)):[E];var F;if(U)F=g.body.split(/\.\./);else if(F=u(g.body),F.length===1&&(F=h(F[0],!1).map(d),F.length===1))return R.map(function(K){return g.pre+F[0]+K});var G;if(U){var x=i(F[0]),Y=i(F[1]),v=Math.max(F[0].length,F[1].length),P=F.length==3?Math.abs(i(F[2])):1,H=_,J=Y<x;J&&(P*=-1,H=p);var se=F.some(l);G=[];for(var ne=x;H(ne,Y);ne+=P){var M;if(w)M=String.fromCharCode(ne),M==="\\"&&(M="");else if(M=String(ne),se){var L=v-M.length;if(L>0){var V=new Array(L+1).join("0");ne<0?M="-"+V+M.slice(1):M=V+M}}G.push(M)}}else{G=[];for(var $=0;$<F.length;$++)G.push.apply(G,h(F[$],!1))}for(var $=0;$<G.length;$++)for(var O=0;O<R.length;O++){var C=A+G[$]+R[O];(!T||U||C)&&S.push(C)}}return S}return pf}var zq=Kq();const Zq=Ol(zq),Xq=1024*64,nl=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>Xq)throw new TypeError("pattern is too long")},Qq={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Oa=e=>e.replace(/[[\]\\-]/g,"\\$&"),Jq=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),yy=e=>e.join(""),eW=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],o=[];let s=n+1,i=!1,a=!1,c=!1,u=!1,f=n,d="";e:for(;s<e.length;){const h=e.charAt(s);if((h==="!"||h==="^")&&s===n+1){u=!0,s++;continue}if(h==="]"&&i&&!c){f=s+1;break}if(i=!0,h==="\\"&&!c){c=!0,s++;continue}if(h==="["&&!c){for(const[E,[T,S,g]]of Object.entries(Qq))if(e.startsWith(E,s)){if(d)return["$.",!1,e.length-n,!0];s+=E.length,g?o.push(T):r.push(T),a=a||S;continue e}}if(c=!1,d){h>d?r.push(Oa(d)+"-"+Oa(h)):h===d&&r.push(Oa(h)),d="",s++;continue}if(e.startsWith("-]",s+1)){r.push(Oa(h+"-")),s+=2;continue}if(e.startsWith("-",s+1)){d=h,s+=2;continue}r.push(Oa(h)),s++}if(f<s)return["",!1,0,!1];if(!r.length&&!o.length)return["$.",!1,e.length-n,!0];if(o.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!u){const h=r[0].length===2?r[0].slice(-1):r[0];return[Jq(h),!1,f-n,!1]}const l="["+(u?"^":"")+yy(r)+"]",_="["+(u?"":"^")+yy(o)+"]";return[r.length&&o.length?"("+l+"|"+_+")":r.length?l:_,a,f-n,!0]},ic=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),tW=new Set(["!","?","+","*","@"]),Ny=e=>tW.has(e),nW="(?!(?:^|/)\\.\\.?(?:$|/))",su="(?!\\.)",rW=new Set(["[","."]),oW=new Set(["..","."]),sW=new Set("().*{}+?[]^$\\!"),iW=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),WE="[^/]",Oy=WE+"*?",by=WE+"+?";class gt{type;#e;#t;#r=!1;#n=[];#o;#i;#c;#a=!1;#s;#u;#d=!1;constructor(t,n,r={}){this.type=t,t&&(this.#t=!0),this.#o=n,this.#e=this.#o?this.#o.#e:this,this.#s=this.#e===this?r:this.#e.#s,this.#c=this.#e===this?[]:this.#e.#c,t==="!"&&!this.#e.#a&&this.#c.push(this),this.#i=this.#o?this.#o.#n.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(const t of this.#n)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#u!==void 0?this.#u:this.type?this.#u=this.type+"("+this.#n.map(t=>String(t)).join("|")+")":this.#u=this.#n.map(t=>String(t)).join("")}#_(){if(this!==this.#e)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let t;for(;t=this.#c.pop();){if(t.type!=="!")continue;let n=t,r=n.#o;for(;r;){for(let o=n.#i+1;!r.type&&o<r.#n.length;o++)for(const s of t.#n){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(r.#n[o])}n=r,r=n.#o}}return this}push(...t){for(const n of t)if(n!==""){if(typeof n!="string"&&!(n instanceof gt&&n.#o===this))throw new Error("invalid part: "+n);this.#n.push(n)}}toJSON(){const t=this.type===null?this.#n.slice().map(n=>typeof n=="string"?n:n.toJSON()):[this.type,...this.#n.map(n=>n.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#a&&this.#o?.type==="!")&&t.push({}),t}isStart(){if(this.#e===this)return!0;if(!this.#o?.isStart())return!1;if(this.#i===0)return!0;const t=this.#o;for(let n=0;n<this.#i;n++){const r=t.#n[n];if(!(r instanceof gt&&r.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#o?.type==="!")return!0;if(!this.#o?.isEnd())return!1;if(!this.type)return this.#o?.isEnd();const t=this.#o?this.#o.#n.length:0;return this.#i===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const n=new gt(this.type,t);for(const r of this.#n)n.copyIn(r);return n}static#l(t,n,r,o){let s=!1,i=!1,a=-1,c=!1;if(n.type===null){let _=r,p="";for(;_<t.length;){const h=t.charAt(_++);if(s||h==="\\"){s=!s,p+=h;continue}if(i){_===a+1?(h==="^"||h==="!")&&(c=!0):h==="]"&&!(_===a+2&&c)&&(i=!1),p+=h;continue}else if(h==="["){i=!0,a=_,c=!1,p+=h;continue}if(!o.noext&&Ny(h)&&t.charAt(_)==="("){n.push(p),p="";const E=new gt(h,n);_=gt.#l(t,E,_,o),n.push(E);continue}p+=h}return n.push(p),_}let u=r+1,f=new gt(null,n);const d=[];let l="";for(;u<t.length;){const _=t.charAt(u++);if(s||_==="\\"){s=!s,l+=_;continue}if(i){u===a+1?(_==="^"||_==="!")&&(c=!0):_==="]"&&!(u===a+2&&c)&&(i=!1),l+=_;continue}else if(_==="["){i=!0,a=u,c=!1,l+=_;continue}if(Ny(_)&&t.charAt(u)==="("){f.push(l),l="";const p=new gt(_,f);f.push(p),u=gt.#l(t,p,u,o);continue}if(_==="|"){f.push(l),l="",d.push(f),f=new gt(null,n);continue}if(_===")")return l===""&&n.#n.length===0&&(n.#d=!0),f.push(l),l="",n.push(...d,f),u;l+=_}return n.type=null,n.#t=void 0,n.#n=[t.substring(r-1)],u}static fromGlob(t,n={}){const r=new gt(null,void 0,n);return gt.#l(t,r,0,n),r}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();const t=this.toString(),[n,r,o,s]=this.toRegExpSource();if(!(o||this.#t||this.#s.nocase&&!this.#s.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return r;const a=(this.#s.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${n}$`,a),{_src:n,_glob:t})}get options(){return this.#s}toRegExpSource(t){const n=t??!!this.#s.dot;if(this.#e===this&&this.#_(),!this.type){const c=this.isStart()&&this.isEnd(),u=this.#n.map(_=>{const[p,h,E,T]=typeof _=="string"?gt.#p(_,this.#t,c):_.toRegExpSource(t);return this.#t=this.#t||E,this.#r=this.#r||T,p}).join("");let f="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&oW.has(this.#n[0]))){const p=rW,h=n&&p.has(u.charAt(0))||u.startsWith("\\.")&&p.has(u.charAt(2))||u.startsWith("\\.\\.")&&p.has(u.charAt(4)),E=!n&&!t&&p.has(u.charAt(0));f=h?nW:E?su:""}let d="";return this.isEnd()&&this.#e.#a&&this.#o?.type==="!"&&(d="(?:$|\\/)"),[f+u+d,ic(u),this.#t=!!this.#t,this.#r]}const r=this.type==="*"||this.type==="+",o=this.type==="!"?"(?:(?!(?:":"(?:";let s=this.#f(n);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){const c=this.toString();return this.#n=[c],this.type=null,this.#t=void 0,[c,ic(this.toString()),!1,!1]}let i=!r||t||n||!su?"":this.#f(!0);i===s&&(i=""),i&&(s=`(?:${s})(?:${i})*?`);let a="";if(this.type==="!"&&this.#d)a=(this.isStart()&&!n?su:"")+by;else{const c=this.type==="!"?"))"+(this.isStart()&&!n&&!t?su:"")+Oy+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;a=o+s+c}return[a,ic(s),this.#t=!!this.#t,this.#r]}#f(t){return this.#n.map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[r,o,s,i]=n.toRegExpSource(t);return this.#r=this.#r||i,r}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")}static#p(t,n,r=!1){let o=!1,s="",i=!1;for(let a=0;a<t.length;a++){const c=t.charAt(a);if(o){o=!1,s+=(sW.has(c)?"\\":"")+c;continue}if(c==="\\"){a===t.length-1?s+="\\\\":o=!0;continue}if(c==="["){const[u,f,d,l]=eW(t,a);if(d){s+=u,i=i||f,a+=d-1,n=n||l;continue}}if(c==="*"){r&&t==="*"?s+=by:s+=Oy,n=!0;continue}if(c==="?"){s+=WE,n=!0;continue}s+=iW(c)}return[s,ic(t),!!n,i]}}const aW=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),_t=(e,t,n={})=>(nl(t),!n.nocomment&&t.charAt(0)==="#"?!1:new nd(t,n).match(e)),cW=/^\*+([^+@!?\*\[\(]*)$/,uW=e=>t=>!t.startsWith(".")&&t.endsWith(e),lW=e=>t=>t.endsWith(e),dW=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),fW=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),_W=/^\*+\.\*+$/,pW=e=>!e.startsWith(".")&&e.includes("."),hW=e=>e!=="."&&e!==".."&&e.includes("."),EW=/^\.\*+$/,TW=e=>e!=="."&&e!==".."&&e.startsWith("."),SW=/^\*+$/,mW=e=>e.length!==0&&!e.startsWith("."),gW=e=>e.length!==0&&e!=="."&&e!=="..",AW=/^\?+([^+@!?\*\[\(]*)?$/,RW=([e,t=""])=>{const n=yw([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},yW=([e,t=""])=>{const n=Nw([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},NW=([e,t=""])=>{const n=Nw([e]);return t?r=>n(r)&&r.endsWith(t):n},OW=([e,t=""])=>{const n=yw([e]);return t?r=>n(r)&&r.endsWith(t):n},yw=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},Nw=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},Ow=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Cy={win32:{sep:"\\"},posix:{sep:"/"}},bW=Ow==="win32"?Cy.win32.sep:Cy.posix.sep;_t.sep=bW;const Ht=Symbol("globstar **");_t.GLOBSTAR=Ht;const CW="[^/]",IW=CW+"*?",PW="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",MW="(?:(?!(?:\\/|^)\\.).)*?",vW=(e,t={})=>n=>_t(n,e,t);_t.filter=vW;const Bt=(e,t={})=>Object.assign({},e,t),wW=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return _t;const t=_t;return Object.assign((r,o,s={})=>t(r,o,Bt(e,s)),{Minimatch:class extends t.Minimatch{constructor(o,s={}){super(o,Bt(e,s))}static defaults(o){return t.defaults(Bt(e,o)).Minimatch}},AST:class extends t.AST{constructor(o,s,i={}){super(o,s,Bt(e,i))}static fromGlob(o,s={}){return t.AST.fromGlob(o,Bt(e,s))}},unescape:(r,o={})=>t.unescape(r,Bt(e,o)),escape:(r,o={})=>t.escape(r,Bt(e,o)),filter:(r,o={})=>t.filter(r,Bt(e,o)),defaults:r=>t.defaults(Bt(e,r)),makeRe:(r,o={})=>t.makeRe(r,Bt(e,o)),braceExpand:(r,o={})=>t.braceExpand(r,Bt(e,o)),match:(r,o,s={})=>t.match(r,o,Bt(e,s)),sep:t.sep,GLOBSTAR:Ht})};_t.defaults=wW;const bw=(e,t={})=>(nl(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:Zq(e));_t.braceExpand=bw;const LW=(e,t={})=>new nd(e,t).makeRe();_t.makeRe=LW;const DW=(e,t,n={})=>{const r=new nd(t,n);return e=e.filter(o=>r.match(o)),r.options.nonull&&!e.length&&e.push(t),e};_t.match=DW;const Iy=/[?*]|[+@!]\(.*?\)|\[|\]/,UW=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class nd{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,n={}){nl(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||Ow,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let o=this.globParts.map((s,i,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=s[0]===""&&s[1]===""&&(s[2]==="?"||!Iy.test(s[2]))&&!Iy.test(s[3]),u=/^[a-z]:/i.test(s[0]);if(c)return[...s.slice(0,4),...s.slice(4).map(f=>this.parse(f))];if(u)return[s[0],...s.slice(1).map(f=>this.parse(f))]}return s.map(c=>this.parse(c))});if(this.debug(this.pattern,o),this.set=o.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const i=this.set[s];i[0]===""&&i[1]===""&&this.globParts[s][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let r=0;r<t.length;r++)for(let o=0;o<t[r].length;o++)t[r][o]==="**"&&(t[r][o]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let o=r;for(;n[o+1]==="**";)o++;o!==r&&n.splice(r,o-r)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((r,o)=>{const s=r[r.length-1];return o==="**"&&s==="**"?r:o===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(o),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let o=1;o<t.length-1;o++){const s=t[o];o===1&&s===""&&t[0]===""||(s==="."||s==="")&&(n=!0,t.splice(o,1),o--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let r=0;for(;(r=t.indexOf("..",r+1))!==-1;){const o=t[r-1];o&&o!=="."&&o!==".."&&o!=="**"&&(n=!0,t.splice(r-1,2),r-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let r of t){let o=-1;for(;(o=r.indexOf("**",o+1))!==-1;){let i=o;for(;r[i+1]==="**";)i++;i>o&&r.splice(o+1,i-o);let a=r[o+1];const c=r[o+2],u=r[o+3];if(a!==".."||!c||c==="."||c===".."||!u||u==="."||u==="..")continue;n=!0,r.splice(o,1);const f=r.slice(0);f[o]="**",t.push(f),o--}if(!this.preserveMultipleSlashes){for(let i=1;i<r.length-1;i++){const a=r[i];i===1&&a===""&&r[0]===""||(a==="."||a==="")&&(n=!0,r.splice(i,1),i--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){const i=r[s-1];if(i&&i!=="."&&i!==".."&&i!=="**"){n=!0;const c=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...c),r.length===0&&r.push(""),s-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let r=n+1;r<t.length;r++){const o=this.partsMatch(t[n],t[r],!this.preserveMultipleSlashes);if(o){t[n]=[],t[r]=o;break}}return t.filter(n=>n.length)}partsMatch(t,n,r=!1){let o=0,s=0,i=[],a="";for(;o<t.length&&s<n.length;)if(t[o]===n[s])i.push(a==="b"?n[s]:t[o]),o++,s++;else if(r&&t[o]==="**"&&n[s]===t[o+1])i.push(t[o]),o++;else if(r&&n[s]==="**"&&t[o]===n[s+1])i.push(n[s]),s++;else if(t[o]==="*"&&n[s]&&(this.options.dot||!n[s].startsWith("."))&&n[s]!=="**"){if(a==="b")return!1;a="a",i.push(t[o]),o++,s++}else if(n[s]==="*"&&t[o]&&(this.options.dot||!t[o].startsWith("."))&&t[o]!=="**"){if(a==="a")return!1;a="b",i.push(n[s]),o++,s++}else return!1;return t.length===n.length&&i}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,r=0;for(let o=0;o<t.length&&t.charAt(o)==="!";o++)n=!n,r++;r&&(this.pattern=t.slice(r)),this.negate=n}matchOne(t,n,r=!1){const o=this.options;if(this.isWindows){const h=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),E=!h&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),T=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),S=!T&&n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]),g=E?3:h?0:void 0,A=S?3:T?0:void 0;if(typeof g=="number"&&typeof A=="number"){const[R,O]=[t[g],n[A]];R.toLowerCase()===O.toLowerCase()&&(n[A]=R,A>g?n=n.slice(A):g>A&&(t=t.slice(g)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var i=0,a=0,c=t.length,u=n.length;i<c&&a<u;i++,a++){this.debug("matchOne loop");var f=n[a],d=t[i];if(this.debug(n,f,d),f===!1)return!1;if(f===Ht){this.debug("GLOBSTAR",[n,f,d]);var l=i,_=a+1;if(_===u){for(this.debug("** at the end");i<c;i++)if(t[i]==="."||t[i]===".."||!o.dot&&t[i].charAt(0)===".")return!1;return!0}for(;l<c;){var p=t[l];if(this.debug(`
globstar while`,t,l,n,_,p),this.matchOne(t.slice(l),n.slice(_),r))return this.debug("globstar found match!",l,c,p),!0;if(p==="."||p===".."||!o.dot&&p.charAt(0)==="."){this.debug("dot detected!",t,l,n,_);break}this.debug("globstar swallow a segment, and continue"),l++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,l,n,_),l===c))}let h;if(typeof f=="string"?(h=d===f,this.debug("string match",f,d,h)):(h=f.test(d),this.debug("pattern match",f,d,h)),!h)return!1}if(i===c&&a===u)return!0;if(i===c)return r;if(a===u)return i===c-1&&t[i]==="";throw new Error("wtf?")}braceExpand(){return bw(this.pattern,this.options)}parse(t){nl(t);const n=this.options;if(t==="**")return Ht;if(t==="")return"";let r,o=null;(r=t.match(SW))?o=n.dot?gW:mW:(r=t.match(cW))?o=(n.nocase?n.dot?fW:dW:n.dot?lW:uW)(r[1]):(r=t.match(AW))?o=(n.nocase?n.dot?yW:RW:n.dot?NW:OW)(r):(r=t.match(_W))?o=n.dot?hW:pW:(r=t.match(EW))&&(o=TW);const s=gt.fromGlob(t,this.options).toMMPattern();return o&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:o}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?IW:n.dot?PW:MW,o=new Set(n.nocase?["i"]:[]);let s=t.map(c=>{const u=c.map(f=>{if(f instanceof RegExp)for(const d of f.flags.split(""))o.add(d);return typeof f=="string"?UW(f):f===Ht?Ht:f._src});return u.forEach((f,d)=>{const l=u[d+1],_=u[d-1];f!==Ht||_===Ht||(_===void 0?l!==void 0&&l!==Ht?u[d+1]="(?:\\/|"+r+"\\/)?"+l:u[d]=r:l===void 0?u[d-1]=_+"(?:\\/|"+r+")?":l!==Ht&&(u[d-1]=_+"(?:\\/|\\/"+r+"\\/)"+l,u[d+1]=Ht))}),u.filter(f=>f!==Ht).join("/")}).join("|");const[i,a]=t.length>1?["(?:",")"]:["",""];s="^"+i+s+a+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const r=this.options;this.isWindows&&(t=t.split("\\").join("/"));const o=this.slashSplit(t);this.debug(this.pattern,"split",o);const s=this.set;this.debug(this.pattern,"set",s);let i=o[o.length-1];if(!i)for(let a=o.length-2;!i&&a>=0;a--)i=o[a];for(let a=0;a<s.length;a++){const c=s[a];let u=o;if(r.matchBase&&c.length===1&&(u=[i]),this.matchOne(u,c,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(t){return _t.defaults(t).Minimatch}}_t.AST=gt;_t.Minimatch=nd;_t.escape=aW;_t.unescape=ic;const Py="@fastify/otel",kW="0.8.0",xW=">=4.0.0 <6",My=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],Ge={HOOK_NAME:"hook.name",FASTIFY_TYPE:"fastify.type",HOOK_CALLBACK_NAME:"hook.callback.name",ROOT:"fastify.root"},Jn={ROUTE:"route-hook",INSTANCE:"hook",HANDLER:"request-handler"},vn="anonymous",Et=Symbol("fastify otel instance"),er=Symbol("fastify otel request spans"),ba=Symbol("fastify otel request context"),vy=Symbol("fastify otel addhook original"),wy=Symbol("fastify otel setnotfound original"),iu=Symbol("fastify otel ignore path");class GW extends bt{constructor(t){if(super(Py,kW,t),this.servername=t?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[iu]=null,this._logger=b.diag.createComponentLogger({namespace:Py}),t?.ignorePaths!=null||process.env.OTEL_FASTIFY_IGNORE_PATHS!=null){const n=t?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if((typeof n!="string"||n.length===0)&&typeof n!="function")throw new TypeError("ignorePaths must be a string or a function");const r=_t;this[iu]=o=>typeof n=="function"?n(o):r(o.url,n)}}enable(){if(this._handleInitialization===void 0&&this.getConfig().registerOnInitialization){const t=this.plugin();this._handleInitialization=n=>{n.fastify.register(t)},mn.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){return this._handleInitialization&&(mn.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0),super.disable()}init(){return[]}plugin(){const t=this;return n[Symbol.for("skip-override")]=!0,n[Symbol.for("fastify.display-name")]="@fastify/otel",n[Symbol.for("plugin-meta")]={fastify:xW,name:"@fastify/otel"},n;function n(r,o,s){r.decorate(Et,t),r.decorate(vy,r.addHook),r.decorate(wy,r.setNotFoundHandler),r.decorateRequest("opentelemetry",function(){const l=this[ba];return{span:this[er],tracer:t.tracer,context:l,inject:(p,h)=>b.propagation.inject(l,p,h),extract:(p,h)=>b.propagation.extract(l,p,h)}}),r.decorateRequest(er,null),r.decorateRequest(ba,null),r.addHook("onRoute",function(d){if(t[iu]?.(d)===!0){t._logger.debug(`Ignoring route instrumentation ${d.method} ${d.url} because it matches the ignore path`);return}for(const l of My)if(d[l]!=null){const _=d[l];if(typeof _=="function")d[l]=f(_,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - route -> ${l}`,[Ge.FASTIFY_TYPE]:Jn.ROUTE,[Q.ATTR_HTTP_ROUTE]:d.url,[Ge.HOOK_CALLBACK_NAME]:_.name?.length>0?_.name:vn});else if(Array.isArray(_)){const p=[];for(const h of _)p.push(f(h,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - route -> ${l}`,[Ge.FASTIFY_TYPE]:Jn.ROUTE,[Q.ATTR_HTTP_ROUTE]:d.url,[Ge.HOOK_CALLBACK_NAME]:h.name?.length>0?h.name:vn}));d[l]=p}}d.onSend!=null?d.onSend=Array.isArray(d.onSend)?[...d.onSend,i]:[d.onSend,i]:d.onSend=i,d.onError!=null?d.onError=Array.isArray(d.onError)?[...d.onError,a]:[d.onError,a]:d.onError=a,d.handler=f(d.handler,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - route-handler`,[Ge.FASTIFY_TYPE]:Jn.HANDLER,[Q.ATTR_HTTP_ROUTE]:d.url,[Ge.HOOK_CALLBACK_NAME]:d.handler.name.length>0?d.handler.name:vn})}),r.addHook("onRequest",function(d,l,_){if(this[Et].isEnabled()===!1)return _();if(this[Et][iu]?.({url:d.url,method:d.method})===!0)return this[Et]._logger.debug(`Ignoring request ${d.method} ${d.url} because it matches the ignore path`),_();let p=b.context.active();b.trace.getSpan(p)==null&&(p=b.propagation.extract(p,d.headers));const h=Ml(p);d.routeOptions.url!=null&&h?.type===ao.HTTP&&(h.route=d.routeOptions.url);const E=this[Et].tracer.startSpan("request",{attributes:{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.ROOT]:"@fastify/otel",[Q.ATTR_HTTP_ROUTE]:d.url,[Q.ATTR_HTTP_REQUEST_METHOD]:d.method}},p);d[ba]=b.trace.setSpan(p,E),d[er]=E,b.context.with(d[ba],()=>{_()})}),r.addHook("onResponse",function(d,l,_){const p=d[er];p!=null&&(p.setStatus({code:b.SpanStatusCode.OK,message:"OK"}),p.setAttributes({[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:404}),p.end()),d[er]=null,_()}),r.addHook=c,r.setNotFoundHandler=u,s();function i(d,l,_,p){const h=d[er];h!=null&&(l.statusCode<500&&h.setStatus({code:b.SpanStatusCode.OK,message:"OK"}),h.setAttributes({[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:l.statusCode}),h.end()),d[er]=null,p(null,_)}function a(d,l,_,p){const h=d[er];h!=null&&(h.setStatus({code:b.SpanStatusCode.ERROR,message:_.message}),h.recordException(_)),p()}function c(d,l){const _=this[vy];return My.includes(d)?_.call(this,d,f(l,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - ${d}`,[Ge.FASTIFY_TYPE]:Jn.INSTANCE,[Ge.HOOK_CALLBACK_NAME]:l.name?.length>0?l.name:vn})):_.call(this,d,l)}function u(d,l){const _=this[wy];typeof d=="function"?(l=f(d,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[Ge.FASTIFY_TYPE]:Jn.INSTANCE,[Ge.HOOK_CALLBACK_NAME]:d.name?.length>0?d.name:vn}),_.call(this,l)):(d.preValidation!=null&&(d.preValidation=f(d.preValidation,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - not-found-handler - preValidation`,[Ge.FASTIFY_TYPE]:Jn.INSTANCE,[Ge.HOOK_CALLBACK_NAME]:d.preValidation.name?.length>0?d.preValidation.name:vn})),d.preHandler!=null&&(d.preHandler=f(d.preHandler,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - not-found-handler - preHandler`,[Ge.FASTIFY_TYPE]:Jn.INSTANCE,[Ge.HOOK_CALLBACK_NAME]:d.preHandler.name?.length>0?d.preHandler.name:vn})),l=f(l,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ge.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[Ge.FASTIFY_TYPE]:Jn.INSTANCE,[Ge.HOOK_CALLBACK_NAME]:l.name?.length>0?l.name:vn}),_.call(this,d,l))}function f(d,l={}){return function(...p){const h=this[Et],[E]=p;if(h.isEnabled()===!1)return d.call(this,...p);const T=E[ba]??b.context.active(),S=h.tracer.startSpan(`handler - ${d.name?.length>0?d.name:this.pluginName??vn}`,{attributes:l},T);return b.context.with(b.trace.setSpan(T,S),function(){try{const g=d.call(this,...p);return typeof g?.then=="function"?g.then(A=>(S.end(),A),A=>(S.setStatus({code:b.SpanStatusCode.ERROR,message:A.message}),S.recordException(A),S.end(),Promise.reject(A))):(S.end(),g)}catch(g){throw S.setStatus({code:b.SpanStatusCode.ERROR,message:g.message}),S.recordException(g),S.end(),g}},this)}}}}}var nr;(function(e){const t="fastify.name";e.FASTIFY_NAME=t;const n="fastify.type";e.FASTIFY_TYPE=n;const r="hook.name";e.HOOK_NAME=r;const o="plugin.name";e.PLUGIN_NAME=o})(nr||(nr={}));var rl;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request_handler";e.REQUEST_HANDLER=n})(rl||(rl={}));var ol;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request handler";e.REQUEST_HANDLER=n})(ol||(ol={}));const sl=Symbol("opentelemetry.instrumentation.fastify.request_active_span");function Ly(e,t,n,r={}){const o=t.startSpan(n,{attributes:r}),s=e[sl]||[];return s.push(o),Object.defineProperty(e,sl,{enumerable:!1,configurable:!0,value:s}),o}function hf(e,t){const n=e[sl]||[];n.length&&(n.forEach(r=>{t&&(r.setStatus({code:b.SpanStatusCode.ERROR,message:t.message}),r.recordException(t)),r.end()}),delete e[sl])}function VW(e,t,n){let r,o;try{o=e(),Dy(o)&&o.then(s=>t(void 0,s),s=>t(s))}catch(s){r=s}finally{if(!Dy(o)&&(t(r,o),r))throw r;return o}}function Dy(e){return typeof e=="object"&&e&&typeof Object.getOwnPropertyDescriptor(e,"then")?.value=="function"||!1}const $W="0.1.0",BW="@sentry/instrumentation-fastify-v3",Uy="anonymous",HW=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);class FW extends bt{constructor(t={}){super(BW,$W,t)}init(){return[new ft("fastify",[">=3.0.0 <4"],t=>this._patchConstructor(t))]}_hookOnRequest(){const t=this;return function(r,o,s){if(!t.isEnabled())return s();t._wrap(o,"send",t._patchSend());const i=r,a=Ml(b.context.active()),c=i.routeOptions?i.routeOptions.url:r.routerPath;c&&a?.type===ao.HTTP&&(a.route=c);const u=r.method||"GET";je().setTransactionName(`${u} ${c}`),s()}}_wrapHandler(t,n,r,o){const s=this;return this._diag.debug("Patching fastify route.handler function"),function(...i){if(!s.isEnabled())return r.apply(this,i);const a=r.name||t||Uy,c=`${ol.MIDDLEWARE} - ${a}`,u=i[1],f=Ly(u,s.tracer,c,{[nr.FASTIFY_TYPE]:rl.MIDDLEWARE,[nr.PLUGIN_NAME]:t,[nr.HOOK_NAME]:n}),d=o&&i[i.length-1];return d&&(i[i.length-1]=function(...l){hf(u),d.apply(this,l)}),b.context.with(b.trace.setSpan(b.context.active(),f),()=>VW(()=>r.apply(this,i),l=>{l instanceof Error&&(f.setStatus({code:b.SpanStatusCode.ERROR,message:l.message}),f.recordException(l)),o||hf(u)}))}}_wrapAddHook(){const t=this;return this._diag.debug("Patching fastify server.addHook function"),function(n){return function(...o){const s=o[0],i=o[1],a=this.pluginName;if(!HW.has(s))return n.apply(this,o);const c=typeof o[o.length-1]=="function"&&i.constructor.name!=="AsyncFunction";return n.apply(this,[s,t._wrapHandler(a,s,i,c)])}}}_patchConstructor(t){const n=this;function r(...o){const s=t.fastify.apply(this,o);return s.addHook("onRequest",n._hookOnRequest()),s.addHook("preHandler",n._hookPreHandler()),YW(),n._wrap(s,"addHook",n._wrapAddHook()),s}return t.errorCodes!==void 0&&(r.errorCodes=t.errorCodes),r.fastify=r,r.default=r,r}_patchSend(){const t=this;return this._diag.debug("Patching fastify reply.send function"),function(r){return function(...s){const i=s[0];return t.isEnabled()?cr(()=>r.apply(this,s),a=>{!a&&i instanceof Error&&(a=i),hf(this,a)}):r.apply(this,s)}}}_hookPreHandler(){const t=this;return this._diag.debug("Patching fastify preHandler function"),function(r,o,s){if(!t.isEnabled())return s();const i=r,a=i.routeOptions?.handler||i.context?.handler,c=a?.name.startsWith("bound ")?a.name.substring(6):a?.name,u=`${ol.REQUEST_HANDLER} - ${c||this.pluginName||Uy}`,f={[nr.PLUGIN_NAME]:this.pluginName,[nr.FASTIFY_TYPE]:rl.REQUEST_HANDLER,[Q.SEMATTRS_HTTP_ROUTE]:i.routeOptions?i.routeOptions.url:r.routerPath};c&&(f[nr.FASTIFY_NAME]=c);const d=Ly(o,t.tracer,u,f);Cw(d);const{requestHook:l}=t.getConfig();return l&&cr(()=>l(d,{request:r}),_=>{_&&t._diag.error("request hook failed",_)},!0),b.context.with(b.trace.setSpan(b.context.active(),d),()=>{s()})}}}function YW(){const e=Te();e&&e.on("spanStart",t=>{Cw(t)})}function Cw(e){const t=ye(e).data,n=t["fastify.type"];if(t[Ee]||!n)return;e.setAttributes({[xe]:"auto.http.otel.fastify",[Ee]:`${n}.fastify`});const r=t["fastify.name"]||t["plugin.name"]||t["hook.name"];if(typeof r=="string"){const o=r.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(o)}}const rd="Fastify",jW=Ne(`${rd}.v3`,()=>new FW);function qW(){const e=Te();if(e)return e.getIntegrationByName(rd)}function ky(e,t,n,r){const o=qW()?.getShouldHandleError()||Iw;if(r==="diagnostics-channel"&&(this.diagnosticsChannelExists=!0),this.diagnosticsChannelExists&&r==="onError-hook"){ho&&j.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options.");return}o(e,t,n)&&Ve(e,{mechanism:{handled:!1,type:"auto.function.fastify"}})}const WW=Ne(`${rd}.v5`,()=>{const e=new GW,t=e.plugin();return vu.subscribe("fastify.initialization",n=>{const r=n.fastify;r?.register(t).after(o=>{o?ho&&j.error("Failed to setup Fastify instrumentation",o):(ZW(),r&&XW(r))})}),vu.subscribe("tracing:fastify.request.handler:error",n=>{const{error:r,request:o,reply:s}=n;ky.call(ky,r,o,s,"diagnostics-channel")}),e}),KW=(({shouldHandleError:e})=>{let t;return{name:rd,setupOnce(){t=e||Iw,jW(),WW()},getShouldHandleError(){return t},setShouldHandleError(n){t=n}}}),zW=(e={})=>KW(e);function Iw(e,t,n){const r=n.statusCode;return r>=500||r<=299}function Pw(e){const t=ye(e),n=t.description,r=t.data,o=r["fastify.type"],s=o==="hook",i=o===n?.startsWith("handler -"),a=n==="request"||o==="request-handler";if(r[Ee]||!i&&!a&&!s)return;const c=s?"hook":i?"middleware":a?"request-handler":"<unknown>";e.setAttributes({[xe]:"auto.http.otel.fastify",[Ee]:`${c}.fastify`});const u=r["fastify.name"]||r["plugin.name"]||r["hook.name"];if(typeof u=="string"){const f=u.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(f)}}function ZW(){const e=Te();e&&e.on("spanStart",t=>{Pw(t)})}function XW(e){e.addHook("onRequest",async(t,n)=>{if(t.opentelemetry){const{span:s}=t.opentelemetry();s&&Pw(s)}const r=t.routeOptions?.url,o=t.method||"GET";je().setTransactionName(`${o} ${r}`)})}var Ef={},Ca={},Tf={},xy;function Mw(){return xy||(xy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=e.TokenKind=e.AllowedOperationTypes=void 0,(function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"})(e.AllowedOperationTypes||(e.AllowedOperationTypes={})),(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(e.TokenKind||(e.TokenKind={})),(function(t){t.EXECUTE="graphql.execute",t.PARSE="graphql.parse",t.RESOLVE="graphql.resolve",t.VALIDATE="graphql.validate",t.SCHEMA_VALIDATE="graphql.validateSchema",t.SCHEMA_PARSE="graphql.parseSchema"})(e.SpanNames||(e.SpanNames={}))})(Tf)),Tf}var Sf={},Gy;function vw(){return Gy||(Gy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.SOURCE="graphql.source",t.FIELD_NAME="graphql.field.name",t.FIELD_PATH="graphql.field.path",t.FIELD_TYPE="graphql.field.type",t.OPERATION_TYPE="graphql.operation.type",t.OPERATION_NAME="graphql.operation.name",t.VARIABLES="graphql.variables.",t.ERROR_VALIDATION_NAME="graphql.validation.error"})(e.AttributeNames||(e.AttributeNames={}))})(Sf)),Sf}var vr={},Vy;function KE(){return Vy||(Vy=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.OTEL_GRAPHQL_DATA_SYMBOL=vr.OTEL_PATCHED_SYMBOL=void 0,vr.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched"),vr.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data")),vr}var Ia={},$y;function QW(){return $y||($y=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.OPERATION_NOT_SUPPORTED=void 0,KE(),Ia.OPERATION_NOT_SUPPORTED="Operation$operationName$not supported"),Ia}var mf={},By;function JW(){return By||(By=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapFieldResolver=e.wrapFields=e.getSourceFromLocation=e.getOperation=e.endSpan=e.addSpanSource=e.addInputVariableAttributes=e.isPromise=void 0;const t=Pe(),n=Mw(),r=vw(),o=KE(),s=Object.values(n.AllowedOperationTypes),i=v=>typeof v?.then=="function";e.isPromise=i;const a=v=>typeof v=="object"&&v!==null;function c(v,P,H){Array.isArray(H)?H.forEach((J,se)=>{c(v,`${P}.${se}`,J)}):H instanceof Object?Object.entries(H).forEach(([J,se])=>{c(v,`${P}.${J}`,se)}):v.setAttribute(`${r.AttributeNames.VARIABLES}${String(P)}`,H)}function u(v,P){Object.entries(P).forEach(([H,J])=>{c(v,H,J)})}e.addInputVariableAttributes=u;function f(v,P,H,J,se){const ne=I(P,H,J,se);v.setAttribute(r.AttributeNames.SOURCE,ne)}e.addSpanSource=f;function d(v,P,H,J,se){let ne=E(H,se);if(ne)return{field:ne,spanAdded:!1};const L=P().flatResolveSpans?S(H):T(H,se);return ne={span:l(v,P,H,J,se,L)},h(H,se,ne),{field:ne,spanAdded:!0}}function l(v,P,H,J,se,ne){const M={[r.AttributeNames.FIELD_NAME]:J.fieldName,[r.AttributeNames.FIELD_PATH]:se.join("."),[r.AttributeNames.FIELD_TYPE]:J.returnType.toString()},L=v.startSpan(`${n.SpanNames.RESOLVE} ${M[r.AttributeNames.FIELD_PATH]}`,{attributes:M},ne?t.trace.setSpan(t.context.active(),ne):void 0),V=H[o.OTEL_GRAPHQL_DATA_SYMBOL].source,$=J.fieldNodes.find(K=>K.kind==="Field");return $&&f(L,V.loc,P().allowValues,$.loc?.start,$.loc?.end),L}function _(v,P){P&&v.recordException(P),v.end()}e.endSpan=_;function p(v,P){if(!(!v||!Array.isArray(v.definitions)))return P?v.definitions.filter(H=>s.indexOf(H?.operation)!==-1).find(H=>P===H?.name?.value):v.definitions.find(H=>s.indexOf(H?.operation)!==-1)}e.getOperation=p;function h(v,P,H){return v[o.OTEL_GRAPHQL_DATA_SYMBOL].fields[P.join(".")]=H}function E(v,P){return v[o.OTEL_GRAPHQL_DATA_SYMBOL].fields[P.join(".")]}function T(v,P){for(let H=P.length-1;H>0;H--){const J=E(v,P.slice(0,H));if(J)return J.span}return S(v)}function S(v){return v[o.OTEL_GRAPHQL_DATA_SYMBOL].span}function g(v,P){const H=[];let J=P;for(;J;){let se=J.key;v&&typeof se=="number"&&(se="*"),H.push(String(se)),J=J.prev}return H.reverse()}function A(v){return O(`
`,v)}function R(v){return O(" ",v)}function O(v,P){let H="";for(let J=0;J<P;J++)H+=v;return H}const C=[n.TokenKind.FLOAT,n.TokenKind.STRING,n.TokenKind.INT,n.TokenKind.BLOCK_STRING];function I(v,P=!1,H,J){let se="";if(v?.startToken){const ne=typeof H=="number"?H:v.start,M=typeof J=="number"?J:v.end;let L=v.startToken.next,V=1;for(;L;){if(L.start<ne){L=L.next,V=L?.line;continue}if(L.end>M){L=L.next,V=L?.line;continue}let $=L.value||L.kind,K="";!P&&C.indexOf(L.kind)>=0&&($="*"),L.kind===n.TokenKind.STRING&&($=`"${$}"`),L.kind===n.TokenKind.EOF&&($=""),L.line>V?(se+=A(L.line-V),V=L.line,K=R(L.column-1)):L.line===L.prev?.line&&(K=R(L.start-(L.prev?.end||0))),se+=K+$,L&&(L=L.next)}}return se}e.getSourceFromLocation=I;function w(v,P,H){if(!v||v[o.OTEL_PATCHED_SYMBOL])return;const J=v.getFields();v[o.OTEL_PATCHED_SYMBOL]=!0,Object.keys(J).forEach(se=>{const ne=J[se];if(ne&&(ne.resolve&&(ne.resolve=Y(P,H,ne.resolve)),ne.type)){const M=U(ne.type);for(const L of M)w(L,P,H)}})}e.wrapFields=w;function U(v){return"ofType"in v?U(v.ofType):B(v)?v.getTypes():F(v)?[v]:[]}function B(v){return"getTypes"in v&&typeof v.getTypes=="function"}function F(v){return"getFields"in v&&typeof v.getFields=="function"}const G=(v,P,H)=>{H&&(v.recordException(P),v.setStatus({code:t.SpanStatusCode.ERROR,message:P.message}),v.end())},x=(v,P)=>{P&&v.end()};function Y(v,P,H,J=!1){if(se[o.OTEL_PATCHED_SYMBOL]||typeof H!="function")return H;function se(ne,M,L,V){if(!H)return;const $=P();if($.ignoreTrivialResolveSpans&&J&&(a(ne)||typeof ne=="function")&&typeof ne[V.fieldName]!="function")return H.call(this,ne,M,L,V);if(!L[o.OTEL_GRAPHQL_DATA_SYMBOL])return H.call(this,ne,M,L,V);const K=g($.mergeItems,V&&V.path),X=K.filter(z=>typeof z=="string").length;let D,k=!1;if($.depth>=0&&$.depth<X)D=T(L,K);else{const{field:z,spanAdded:q}=d(v,P,L,V,K);D=z.span,k=q}return t.context.with(t.trace.setSpan(t.context.active(),D),()=>{try{const z=H.call(this,ne,M,L,V);return(0,e.isPromise)(z)?z.then(q=>(x(D,k),q),q=>{throw G(D,q,k),q}):(x(D,k),z)}catch(z){throw G(D,z,k),z}})}return se[o.OTEL_PATCHED_SYMBOL]=!0,se}e.wrapFieldResolver=Y})(mf)),mf}var wr={},Hy;function eK(){return Hy||(Hy=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.PACKAGE_NAME=wr.PACKAGE_VERSION=void 0,wr.PACKAGE_VERSION="0.56.0",wr.PACKAGE_NAME="@opentelemetry/instrumentation-graphql"),wr}var Fy;function tK(){if(Fy)return Ca;Fy=1,Object.defineProperty(Ca,"__esModule",{value:!0}),Ca.GraphQLInstrumentation=void 0;const e=Pe(),t=Le,n=Mw(),r=vw(),o=KE(),s=QW(),i=JW(),a=eK(),c={mergeItems:!1,depth:-1,allowValues:!1,ignoreResolveSpans:!1},u=[">=14.0.0 <17"];class f extends t.InstrumentationBase{constructor(l={}){super(a.PACKAGE_NAME,a.PACKAGE_VERSION,{...c,...l})}setConfig(l={}){super.setConfig({...c,...l})}init(){const l=new t.InstrumentationNodeModuleDefinition("graphql",u);return l.files.push(this._addPatchingExecute()),l.files.push(this._addPatchingParser()),l.files.push(this._addPatchingValidate()),l}_addPatchingExecute(){return new t.InstrumentationNodeModuleFile("graphql/execution/execute.js",u,l=>((0,t.isWrapped)(l.execute)&&this._unwrap(l,"execute"),this._wrap(l,"execute",this._patchExecute(l.defaultFieldResolver)),l),l=>{l&&this._unwrap(l,"execute")})}_addPatchingParser(){return new t.InstrumentationNodeModuleFile("graphql/language/parser.js",u,l=>((0,t.isWrapped)(l.parse)&&this._unwrap(l,"parse"),this._wrap(l,"parse",this._patchParse()),l),l=>{l&&this._unwrap(l,"parse")})}_addPatchingValidate(){return new t.InstrumentationNodeModuleFile("graphql/validation/validate.js",u,l=>((0,t.isWrapped)(l.validate)&&this._unwrap(l,"validate"),this._wrap(l,"validate",this._patchValidate()),l),l=>{l&&this._unwrap(l,"validate")})}_patchExecute(l){const _=this;return function(h){return function(){let T;if(arguments.length>=2){const A=arguments;T=_._wrapExecuteArgs(A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],l)}else{const A=arguments[0];T=_._wrapExecuteArgs(A.schema,A.document,A.rootValue,A.contextValue,A.variableValues,A.operationName,A.fieldResolver,A.typeResolver,l)}const S=(0,i.getOperation)(T.document,T.operationName),g=_._createExecuteSpan(S,T);return T.contextValue[o.OTEL_GRAPHQL_DATA_SYMBOL]={source:T.document?T.document||T.document[o.OTEL_GRAPHQL_DATA_SYMBOL]:void 0,span:g,fields:{}},e.context.with(e.trace.setSpan(e.context.active(),g),()=>(0,t.safeExecuteInTheMiddle)(()=>h.apply(this,[T]),(A,R)=>{_._handleExecutionResult(g,A,R)}))}}}_handleExecutionResult(l,_,p){const h=this.getConfig();if(p===void 0||_){(0,i.endSpan)(l,_);return}if((0,i.isPromise)(p))p.then(E=>{if(typeof h.responseHook!="function"){(0,i.endSpan)(l);return}this._executeResponseHook(l,E)},E=>{(0,i.endSpan)(l,E)});else{if(typeof h.responseHook!="function"){(0,i.endSpan)(l);return}this._executeResponseHook(l,p)}}_executeResponseHook(l,_){const{responseHook:p}=this.getConfig();p&&(0,t.safeExecuteInTheMiddle)(()=>{p(l,_)},h=>{h&&this._diag.error("Error running response hook",h),(0,i.endSpan)(l,void 0)},!0)}_patchParse(){const l=this;return function(p){return function(E,T){return l._parse(this,p,E,T)}}}_patchValidate(){const l=this;return function(p){return function(E,T,S,g,A){return l._validate(this,p,E,T,S,A,g)}}}_parse(l,_,p,h){const E=this.getConfig(),T=this.tracer.startSpan(n.SpanNames.PARSE);return e.context.with(e.trace.setSpan(e.context.active(),T),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(l,p,h),(S,g)=>{g&&((0,i.getOperation)(g)?g.loc&&(0,i.addSpanSource)(T,g.loc,E.allowValues):T.updateName(n.SpanNames.SCHEMA_PARSE)),(0,i.endSpan)(T,S)}))}_validate(l,_,p,h,E,T,S){const g=this.tracer.startSpan(n.SpanNames.VALIDATE,{});return e.context.with(e.trace.setSpan(e.context.active(),g),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(l,p,h,E,S,T),(A,R)=>{h.loc||g.updateName(n.SpanNames.SCHEMA_VALIDATE),R&&R.length&&g.recordException({name:r.AttributeNames.ERROR_VALIDATION_NAME,message:JSON.stringify(R)}),(0,i.endSpan)(g,A)}))}_createExecuteSpan(l,_){const p=this.getConfig(),h=this.tracer.startSpan(n.SpanNames.EXECUTE,{});if(l){const{operation:E,name:T}=l;h.setAttribute(r.AttributeNames.OPERATION_TYPE,E);const S=T?.value;S?(h.setAttribute(r.AttributeNames.OPERATION_NAME,S),h.updateName(`${E} ${S}`)):h.updateName(E)}else{let E=" ";_.operationName&&(E=` "${_.operationName}" `),E=s.OPERATION_NOT_SUPPORTED.replace("$operationName$",E),h.setAttribute(r.AttributeNames.OPERATION_NAME,E)}return _.document?.loc&&(0,i.addSpanSource)(h,_.document.loc,p.allowValues),_.variableValues&&p.allowValues&&(0,i.addInputVariableAttributes)(h,_.variableValues),h}_wrapExecuteArgs(l,_,p,h,E,T,S,g,A){if(h||(h={}),h[o.OTEL_GRAPHQL_DATA_SYMBOL]||this.getConfig().ignoreResolveSpans)return{schema:l,document:_,rootValue:p,contextValue:h,variableValues:E,operationName:T,fieldResolver:S,typeResolver:g};const R=S==null,O=S??A;return S=(0,i.wrapFieldResolver)(this.tracer,()=>this.getConfig(),O,R),l&&((0,i.wrapFields)(l.getQueryType(),this.tracer,()=>this.getConfig()),(0,i.wrapFields)(l.getMutationType(),this.tracer,()=>this.getConfig())),{schema:l,document:_,rootValue:p,contextValue:h,variableValues:E,operationName:T,fieldResolver:S,typeResolver:g}}}return Ca.GraphQLInstrumentation=f,Ca}var Yy;function nK(){return Yy||(Yy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLInstrumentation=void 0;var t=tK();Object.defineProperty(e,"GraphQLInstrumentation",{enumerable:!0,get:function(){return t.GraphQLInstrumentation}})})(Ef)),Ef}var rK=nK();const ww="Graphql",oK=Ne(ww,rK.GraphQLInstrumentation,e=>{const t=Lw(e);return{...t,responseHook(n,r){Ot(n,"auto.graphql.otel.graphql"),r.errors?.length&&!ye(n).status&&n.setStatus({code:b.SpanStatusCode.ERROR});const s=ye(n).data,i=s["graphql.operation.type"],a=s["graphql.operation.name"];if(t.useOperationNameForRootSpan&&i){const c=qt(n),f=ye(c).data[sc]||[],d=a?`${i} ${a}`:`${i}`;Array.isArray(f)?(f.push(d),c.setAttribute(sc,f)):typeof f=="string"?c.setAttribute(sc,[f,d]):c.setAttribute(sc,d),ye(c).data["original-description"]||c.setAttribute("original-description",ye(c).description),c.updateName(`${ye(c).data["original-description"]} (${aK(f)})`)}}}}),sK=((e={})=>({name:ww,setupOnce(){oK(Lw(e))}})),iK=sK;function Lw(e){return{ignoreResolveSpans:!0,ignoreTrivialResolveSpans:!0,useOperationNameForRootSpan:!0,...e}}function aK(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}var gf={},Pa={},Ma={},jy;function cK(){return jy||(jy=1,Object.defineProperty(Ma,"__esModule",{value:!0}),Ma.EVENT_LISTENERS_SET=void 0,Ma.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet")),Ma}var va={},qy;function uK(){return qy||(qy=1,Object.defineProperty(va,"__esModule",{value:!0}),va.bufferTextMapGetter=void 0,va.bufferTextMapGetter={get(e,t){if(!e)return;const n=Object.keys(e);for(const r of n)if(r===t||r.toLowerCase()===t)return e[r]?.toString()},keys(e){return e?Object.keys(e):[]}}),va}var me={},Wy;function lK(){return Wy||(Wy=1,Object.defineProperty(me,"__esModule",{value:!0}),me.METRIC_MESSAGING_PROCESS_DURATION=me.METRIC_MESSAGING_CLIENT_SENT_MESSAGES=me.METRIC_MESSAGING_CLIENT_OPERATION_DURATION=me.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES=me.MESSAGING_SYSTEM_VALUE_KAFKA=me.MESSAGING_OPERATION_TYPE_VALUE_SEND=me.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE=me.MESSAGING_OPERATION_TYPE_VALUE_PROCESS=me.ATTR_MESSAGING_SYSTEM=me.ATTR_MESSAGING_OPERATION_TYPE=me.ATTR_MESSAGING_OPERATION_NAME=me.ATTR_MESSAGING_KAFKA_OFFSET=me.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE=me.ATTR_MESSAGING_KAFKA_MESSAGE_KEY=me.ATTR_MESSAGING_DESTINATION_PARTITION_ID=me.ATTR_MESSAGING_DESTINATION_NAME=me.ATTR_MESSAGING_BATCH_MESSAGE_COUNT=void 0,me.ATTR_MESSAGING_BATCH_MESSAGE_COUNT="messaging.batch.message_count",me.ATTR_MESSAGING_DESTINATION_NAME="messaging.destination.name",me.ATTR_MESSAGING_DESTINATION_PARTITION_ID="messaging.destination.partition.id",me.ATTR_MESSAGING_KAFKA_MESSAGE_KEY="messaging.kafka.message.key",me.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE="messaging.kafka.message.tombstone",me.ATTR_MESSAGING_KAFKA_OFFSET="messaging.kafka.offset",me.ATTR_MESSAGING_OPERATION_NAME="messaging.operation.name",me.ATTR_MESSAGING_OPERATION_TYPE="messaging.operation.type",me.ATTR_MESSAGING_SYSTEM="messaging.system",me.MESSAGING_OPERATION_TYPE_VALUE_PROCESS="process",me.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE="receive",me.MESSAGING_OPERATION_TYPE_VALUE_SEND="send",me.MESSAGING_SYSTEM_VALUE_KAFKA="kafka",me.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES="messaging.client.consumed.messages",me.METRIC_MESSAGING_CLIENT_OPERATION_DURATION="messaging.client.operation.duration",me.METRIC_MESSAGING_CLIENT_SENT_MESSAGES="messaging.client.sent.messages",me.METRIC_MESSAGING_PROCESS_DURATION="messaging.process.duration"),me}var Lr={},Ky;function dK(){return Ky||(Ky=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.PACKAGE_NAME=Lr.PACKAGE_VERSION=void 0,Lr.PACKAGE_VERSION="0.18.0",Lr.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs"),Lr}var zy;function fK(){if(zy)return Pa;zy=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.KafkaJsInstrumentation=void 0;const e=Pe(),t=Le,n=pt(),r=cK(),o=uK(),s=lK(),i=dK();function a(d,l,_){return p=>{d.add(l,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}function c(d,l,_){return p=>{d.record((Date.now()-l)/1e3,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}const u=[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10];class f extends t.InstrumentationBase{constructor(l={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,l)}_updateMetricInstruments(){this._clientDuration=this.meter.createHistogram(s.METRIC_MESSAGING_CLIENT_OPERATION_DURATION,{advice:{explicitBucketBoundaries:u}}),this._sentMessages=this.meter.createCounter(s.METRIC_MESSAGING_CLIENT_SENT_MESSAGES),this._consumedMessages=this.meter.createCounter(s.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES),this._processDuration=this.meter.createHistogram(s.METRIC_MESSAGING_PROCESS_DURATION,{advice:{explicitBucketBoundaries:u}})}init(){const l=p=>{(0,t.isWrapped)(p?.Kafka?.prototype.producer)&&this._unwrap(p.Kafka.prototype,"producer"),(0,t.isWrapped)(p?.Kafka?.prototype.consumer)&&this._unwrap(p.Kafka.prototype,"consumer")};return new t.InstrumentationNodeModuleDefinition("kafkajs",[">=0.3.0 <3"],p=>(l(p),this._wrap(p?.Kafka?.prototype,"producer",this._getProducerPatch()),this._wrap(p?.Kafka?.prototype,"consumer",this._getConsumerPatch()),p),l)}_getConsumerPatch(){const l=this;return _=>function(...h){const E=_.apply(this,h);return(0,t.isWrapped)(E.run)&&l._unwrap(E,"run"),l._wrap(E,"run",l._getConsumerRunPatch()),l._setKafkaEventListeners(E),E}}_setKafkaEventListeners(l){l[r.EVENT_LISTENERS_SET]||(l.events?.REQUEST&&l.on(l.events.REQUEST,this._recordClientDurationMetric.bind(this)),l[r.EVENT_LISTENERS_SET]=!0)}_recordClientDurationMetric(l){const[_,p]=l.payload.broker.split(":");this._clientDuration.record(l.payload.duration/1e3,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:`${l.payload.apiName}`,[n.ATTR_SERVER_ADDRESS]:_,[n.ATTR_SERVER_PORT]:Number.parseInt(p,10)})}_getProducerPatch(){const l=this;return _=>function(...h){const E=_.apply(this,h);return(0,t.isWrapped)(E.sendBatch)&&l._unwrap(E,"sendBatch"),l._wrap(E,"sendBatch",l._getSendBatchPatch()),(0,t.isWrapped)(E.send)&&l._unwrap(E,"send"),l._wrap(E,"send",l._getSendPatch()),(0,t.isWrapped)(E.transaction)&&l._unwrap(E,"transaction"),l._wrap(E,"transaction",l._getProducerTransactionPatch()),l._setKafkaEventListeners(E),E}}_getConsumerRunPatch(){const l=this;return _=>function(...h){const E=h[0];return E?.eachMessage&&((0,t.isWrapped)(E.eachMessage)&&l._unwrap(E,"eachMessage"),l._wrap(E,"eachMessage",l._getConsumerEachMessagePatch())),E?.eachBatch&&((0,t.isWrapped)(E.eachBatch)&&l._unwrap(E,"eachBatch"),l._wrap(E,"eachBatch",l._getConsumerEachBatchPatch())),_.call(this,E)}}_getConsumerEachMessagePatch(){const l=this;return _=>function(...h){const E=h[0],T=e.propagation.extract(e.ROOT_CONTEXT,E.message.headers,o.bufferTextMapGetter),S=l._startConsumerSpan({topic:E.topic,message:E.message,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,ctx:T,attributes:{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)}}),g=[c(l._processDuration,Date.now(),{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)}),a(l._consumedMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)})],A=e.context.with(e.trace.setSpan(T,S),()=>_.apply(this,h));return l._endSpansOnPromise([S],g,A)}}_getConsumerEachBatchPatch(){return l=>{const _=this;return function(...h){const E=h[0],T=_._startConsumerSpan({topic:E.batch.topic,message:void 0,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE,ctx:e.ROOT_CONTEXT,attributes:{[s.ATTR_MESSAGING_BATCH_MESSAGE_COUNT]:E.batch.messages.length,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}});return e.context.with(e.trace.setSpan(e.context.active(),T),()=>{const S=Date.now(),g=[],A=[a(_._consumedMessages,E.batch.messages.length,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:E.batch.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)})];E.batch.messages.forEach(O=>{const C=e.propagation.extract(e.ROOT_CONTEXT,O.headers,o.bufferTextMapGetter),I=e.trace.getSpan(C)?.spanContext();let w;I&&(w={context:I}),g.push(_._startConsumerSpan({topic:E.batch.topic,message:O,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,link:w,attributes:{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}})),A.push(c(_._processDuration,S,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:E.batch.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}))});const R=l.apply(this,h);return g.unshift(T),_._endSpansOnPromise(g,A,R)})}}}_getProducerTransactionPatch(){const l=this;return _=>function(...h){const E=l.tracer.startSpan("transaction"),T=_.apply(this,h);return T.then(S=>{const g=S.send;S.send=function(...I){return e.context.with(e.trace.setSpan(e.context.active(),E),()=>l._getSendPatch()(g).apply(this,I).catch(U=>{throw E.setStatus({code:e.SpanStatusCode.ERROR,message:U?.message}),E.recordException(U),U}))};const A=S.sendBatch;S.sendBatch=function(...I){return e.context.with(e.trace.setSpan(e.context.active(),E),()=>l._getSendBatchPatch()(A).apply(this,I).catch(U=>{throw E.setStatus({code:e.SpanStatusCode.ERROR,message:U?.message}),E.recordException(U),U}))};const R=S.commit;S.commit=function(...I){const w=R.apply(this,I).then(()=>{E.setStatus({code:e.SpanStatusCode.OK})});return l._endSpansOnPromise([E],[],w)};const O=S.abort;S.abort=function(...I){const w=O.apply(this,I);return l._endSpansOnPromise([E],[],w)}}).catch(S=>{E.setStatus({code:e.SpanStatusCode.ERROR,message:S?.message}),E.recordException(S),E.end()}),T}}_getSendBatchPatch(){const l=this;return _=>function(...h){const T=h[0].topicMessages||[],S=[],g=[];T.forEach(R=>{R.messages.forEach(O=>{S.push(l._startProducerSpan(R.topic,O)),g.push(a(l._sentMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_DESTINATION_NAME]:R.topic,...O.partition!==void 0?{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(O.partition)}:{}}))})});const A=_.apply(this,h);return l._endSpansOnPromise(S,g,A)}}_getSendPatch(){const l=this;return _=>function(...h){const E=h[0],T=E.messages.map(A=>l._startProducerSpan(E.topic,A)),S=E.messages.map(A=>a(l._sentMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,...A.partition!==void 0?{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(A.partition)}:{}})),g=_.apply(this,h);return l._endSpansOnPromise(T,S,g)}}_endSpansOnPromise(l,_,p){return Promise.resolve(p).then(h=>(_.forEach(E=>E()),h)).catch(h=>{let E,T=n.ERROR_TYPE_VALUE_OTHER;throw typeof h=="string"||h===void 0?E=h:typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"message")&&(E=h.message,T=h.constructor.name),_.forEach(S=>S(T)),l.forEach(S=>{S.setAttribute(n.ATTR_ERROR_TYPE,T),S.setStatus({code:e.SpanStatusCode.ERROR,message:E})}),h}).finally(()=>{l.forEach(h=>h.end())})}_startConsumerSpan({topic:l,message:_,operationType:p,ctx:h,link:E,attributes:T}){const S=p===s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?"poll":p,g=this.tracer.startSpan(`${S} ${l}`,{kind:p===s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?e.SpanKind.CLIENT:e.SpanKind.CONSUMER,attributes:{...T,[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_DESTINATION_NAME]:l,[s.ATTR_MESSAGING_OPERATION_TYPE]:p,[s.ATTR_MESSAGING_OPERATION_NAME]:S,[s.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_?.key?String(_.key):void 0,[s.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_?.key&&_.value===null?!0:void 0,[s.ATTR_MESSAGING_KAFKA_OFFSET]:_?.offset},links:E?[E]:[]},h),{consumerHook:A}=this.getConfig();return A&&_&&(0,t.safeExecuteInTheMiddle)(()=>A(g,{topic:l,message:_}),R=>{R&&this._diag.error("consumerHook error",R)},!0),g}_startProducerSpan(l,_){const p=this.tracer.startSpan(`send ${l}`,{kind:e.SpanKind.PRODUCER,attributes:{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_DESTINATION_NAME]:l,[s.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_.key?String(_.key):void 0,[s.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_.key&&_.value===null?!0:void 0,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:_.partition!==void 0?String(_.partition):void 0,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_OPERATION_TYPE]:s.MESSAGING_OPERATION_TYPE_VALUE_SEND}});_.headers=_.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),p),_.headers);const{producerHook:h}=this.getConfig();return h&&(0,t.safeExecuteInTheMiddle)(()=>h(p,{topic:l,message:_}),E=>{E&&this._diag.error("producerHook error",E)},!0),p}}return Pa.KafkaJsInstrumentation=f,Pa}var Zy;function _K(){return Zy||(Zy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KafkaJsInstrumentation=void 0;var t=fK();Object.defineProperty(e,"KafkaJsInstrumentation",{enumerable:!0,get:function(){return t.KafkaJsInstrumentation}})})(gf)),gf}var pK=_K();const Dw="Kafka",hK=Ne(Dw,()=>new pK.KafkaJsInstrumentation({consumerHook(e){Ot(e,"auto.kafkajs.otel.consumer")},producerHook(e){Ot(e,"auto.kafkajs.otel.producer")}})),EK=(()=>({name:Dw,setupOnce(){hK()}})),TK=EK;var Af={},wa={},Dr={},Xy;function SK(){return Xy||(Xy=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.PACKAGE_NAME=Dr.PACKAGE_VERSION=void 0,Dr.PACKAGE_VERSION="0.53.0",Dr.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer"),Dr}var Qy;function mK(){if(Qy)return wa;Qy=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.LruMemoizerInstrumentation=void 0;const e=Pe(),t=Le,n=SK();class r extends t.InstrumentationBase{constructor(s={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,s)}init(){return[new t.InstrumentationNodeModuleDefinition("lru-memoizer",[">=1.3 <3"],s=>{const i=function(){const a=s.apply(this,arguments);return function(){const c=[...arguments],u=c.pop(),f=typeof u=="function"?e.context.bind(e.context.active(),u):u;return c.push(f),a.apply(this,c)}};return i.sync=s.sync,i},void 0)]}}return wa.LruMemoizerInstrumentation=r,wa}var Jy;function gK(){return Jy||(Jy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LruMemoizerInstrumentation=void 0;var t=mK();Object.defineProperty(e,"LruMemoizerInstrumentation",{enumerable:!0,get:function(){return t.LruMemoizerInstrumentation}})})(Af)),Af}var AK=gK();const Uw="LruMemoizer",RK=Ne(Uw,()=>new AK.LruMemoizerInstrumentation),yK=(()=>({name:Uw,setupOnce(){RK()}})),NK=yK;var Rf={},La={},Be={},eN;function OK(){return eN||(eN=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.METRIC_DB_CLIENT_CONNECTIONS_USAGE=Be.DB_SYSTEM_VALUE_MONGODB=Be.ATTR_NET_PEER_PORT=Be.ATTR_NET_PEER_NAME=Be.ATTR_DB_SYSTEM=Be.ATTR_DB_STATEMENT=Be.ATTR_DB_OPERATION=Be.ATTR_DB_NAME=Be.ATTR_DB_MONGODB_COLLECTION=Be.ATTR_DB_CONNECTION_STRING=void 0,Be.ATTR_DB_CONNECTION_STRING="db.connection_string",Be.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",Be.ATTR_DB_NAME="db.name",Be.ATTR_DB_OPERATION="db.operation",Be.ATTR_DB_STATEMENT="db.statement",Be.ATTR_DB_SYSTEM="db.system",Be.ATTR_NET_PEER_NAME="net.peer.name",Be.ATTR_NET_PEER_PORT="net.peer.port",Be.DB_SYSTEM_VALUE_MONGODB="mongodb",Be.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),Be}var yf={},tN;function bK(){return tN||(tN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.AGGREGATE="aggregate",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(yf)),yf}var Ur={},nN;function CK(){return nN||(nN=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.PACKAGE_NAME=Ur.PACKAGE_VERSION=void 0,Ur.PACKAGE_VERSION="0.61.0",Ur.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb"),Ur}var rN;function IK(){if(rN)return La;rN=1,Object.defineProperty(La,"__esModule",{value:!0}),La.MongoDBInstrumentation=void 0;const e=Pe(),t=Le,n=OK(),r=bK(),o=CK(),s={requireParentSpan:!0};class i extends t.InstrumentationBase{constructor(c={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,{...s,...c})}setConfig(c={}){super.setConfig({...s,...c})}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){const{v3PatchConnection:c,v3UnpatchConnection:u}=this._getV3ConnectionPatches(),{v4PatchConnect:f,v4UnpatchConnect:d}=this._getV4ConnectPatches(),{v4PatchConnectionCallback:l,v4PatchConnectionPromise:_,v4UnpatchConnection:p}=this._getV4ConnectionPatches(),{v4PatchConnectionPool:h,v4UnpatchConnectionPool:E}=this._getV4ConnectionPoolPatches(),{v4PatchSessions:T,v4UnpatchSessions:S}=this._getV4SessionsPatches();return[new t.InstrumentationNodeModuleDefinition("mongodb",[">=3.3.0 <4"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/core/wireprotocol/index.js",[">=3.3.0 <4"],c,u)]),new t.InstrumentationNodeModuleDefinition("mongodb",[">=4.0.0 <7"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=4.0.0 <6.4"],l,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=6.4.0 <7"],_,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection_pool.js",[">=4.0.0 <6.4"],h,E),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connect.js",[">=4.0.0 <7"],f,d),new t.InstrumentationNodeModuleFile("mongodb/lib/sessions.js",[">=4.0.0 <7"],T,S)])]}_getV3ConnectionPatches(){return{v3PatchConnection:c=>((0,t.isWrapped)(c.insert)&&this._unwrap(c,"insert"),this._wrap(c,"insert",this._getV3PatchOperation("insert")),(0,t.isWrapped)(c.remove)&&this._unwrap(c,"remove"),this._wrap(c,"remove",this._getV3PatchOperation("remove")),(0,t.isWrapped)(c.update)&&this._unwrap(c,"update"),this._wrap(c,"update",this._getV3PatchOperation("update")),(0,t.isWrapped)(c.command)&&this._unwrap(c,"command"),this._wrap(c,"command",this._getV3PatchCommand()),(0,t.isWrapped)(c.query)&&this._unwrap(c,"query"),this._wrap(c,"query",this._getV3PatchFind()),(0,t.isWrapped)(c.getMore)&&this._unwrap(c,"getMore"),this._wrap(c,"getMore",this._getV3PatchCursor()),c),v3UnpatchConnection:c=>{c!==void 0&&(this._unwrap(c,"insert"),this._unwrap(c,"remove"),this._unwrap(c,"update"),this._unwrap(c,"command"),this._unwrap(c,"query"),this._unwrap(c,"getMore"))}}}_getV4SessionsPatches(){return{v4PatchSessions:c=>((0,t.isWrapped)(c.acquire)&&this._unwrap(c,"acquire"),this._wrap(c.ServerSessionPool.prototype,"acquire",this._getV4AcquireCommand()),(0,t.isWrapped)(c.release)&&this._unwrap(c,"release"),this._wrap(c.ServerSessionPool.prototype,"release",this._getV4ReleaseCommand()),c),v4UnpatchSessions:c=>{c!==void 0&&((0,t.isWrapped)(c.acquire)&&this._unwrap(c,"acquire"),(0,t.isWrapped)(c.release)&&this._unwrap(c,"release"))}}}_getV4AcquireCommand(){const c=this;return u=>function(){const d=this.sessions.length,l=u.call(this),_=this.sessions.length;return d===_?c._connectionsUsage.add(1,{state:"used","pool.name":c._poolName}):d-1===_&&(c._connectionsUsage.add(-1,{state:"idle","pool.name":c._poolName}),c._connectionsUsage.add(1,{state:"used","pool.name":c._poolName})),l}}_getV4ReleaseCommand(){const c=this;return u=>function(d){const l=u.call(this,d);return c._connectionsUsage.add(-1,{state:"used","pool.name":c._poolName}),c._connectionsUsage.add(1,{state:"idle","pool.name":c._poolName}),l}}_getV4ConnectionPoolPatches(){return{v4PatchConnectionPool:c=>{const u=c.ConnectionPool.prototype;return(0,t.isWrapped)(u.checkOut)&&this._unwrap(u,"checkOut"),this._wrap(u,"checkOut",this._getV4ConnectionPoolCheckOut()),c},v4UnpatchConnectionPool:c=>{c!==void 0&&this._unwrap(c.ConnectionPool.prototype,"checkOut")}}}_getV4ConnectPatches(){return{v4PatchConnect:c=>((0,t.isWrapped)(c.connect)&&this._unwrap(c,"connect"),this._wrap(c,"connect",this._getV4ConnectCommand()),c),v4UnpatchConnect:c=>{c!==void 0&&this._unwrap(c,"connect")}}}_getV4ConnectionPoolCheckOut(){return c=>function(f){const d=e.context.bind(e.context.active(),f);return c.call(this,d)}}_getV4ConnectCommand(){const c=this;return u=>function(d,l){if(u.length===1){const p=u.call(this,d);return p&&typeof p.then=="function"&&p.then(()=>c.setPoolName(d),()=>{}),p}const _=function(p,h){if(p||!h){l(p,h);return}c.setPoolName(d),l(p,h)};return u.call(this,d,_)}}_getV4ConnectionPatches(){return{v4PatchConnectionCallback:c=>((0,t.isWrapped)(c.Connection.prototype.command)&&this._unwrap(c.Connection.prototype,"command"),this._wrap(c.Connection.prototype,"command",this._getV4PatchCommandCallback()),c),v4PatchConnectionPromise:c=>((0,t.isWrapped)(c.Connection.prototype.command)&&this._unwrap(c.Connection.prototype,"command"),this._wrap(c.Connection.prototype,"command",this._getV4PatchCommandPromise()),c),v4UnpatchConnection:c=>{c!==void 0&&this._unwrap(c.Connection.prototype,"command")}}}_getV3PatchOperation(c){const u=this;return f=>function(l,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=u._checkSkipInstrumentation(T),g=typeof h=="function"?h:E;if(S||typeof g!="function"||typeof p!="object")return typeof h=="function"?f.call(this,l,_,p,h):f.call(this,l,_,p,h,E);const A=u.tracer.startSpan(`mongodb.${c}`,{kind:e.SpanKind.CLIENT});u._populateV3Attributes(A,_,l,p[0],c);const R=u._patchEnd(A,g);return typeof h=="function"?f.call(this,l,_,p,R):f.call(this,l,_,p,h,R)}}_getV3PatchCommand(){const c=this;return u=>function(d,l,_,p,h){const E=e.trace.getSpan(e.context.active()),T=c._checkSkipInstrumentation(E),S=typeof p=="function"?p:h;if(T||typeof S!="function"||typeof _!="object")return typeof p=="function"?u.call(this,d,l,_,p):u.call(this,d,l,_,p,h);const g=i._getCommandType(_),A=g===r.MongodbCommandType.UNKNOWN?"command":g,R=c.tracer.startSpan(`mongodb.${A}`,{kind:e.SpanKind.CLIENT}),O=g===r.MongodbCommandType.UNKNOWN?void 0:g;c._populateV3Attributes(R,l,d,_,O);const C=c._patchEnd(R,S);return typeof p=="function"?u.call(this,d,l,_,C):u.call(this,d,l,_,p,C)}}_getV4PatchCommandCallback(){const c=this;return u=>function(d,l,_,p){const h=e.trace.getSpan(e.context.active()),E=c._checkSkipInstrumentation(h),T=p,S=Object.keys(l)[0];if(typeof l!="object"||l.ismaster||l.hello)return u.call(this,d,l,_,p);let g;E||(g=c.tracer.startSpan(`mongodb.${S}`,{kind:e.SpanKind.CLIENT}),c._populateV4Attributes(g,this,d,l,S));const A=c._patchEnd(g,T,this.id,S);return u.call(this,d,l,_,A)}}_getV4PatchCommandPromise(){const c=this;return u=>function(...d){const[l,_]=d,p=e.trace.getSpan(e.context.active()),h=c._checkSkipInstrumentation(p),E=Object.keys(_)[0],T=()=>{};if(typeof _!="object"||_.ismaster||_.hello)return u.apply(this,d);let S;h||(S=c.tracer.startSpan(`mongodb.${E}`,{kind:e.SpanKind.CLIENT}),c._populateV4Attributes(S,this,l,_,E));const g=c._patchEnd(S,T,this.id,E),A=u.apply(this,d);return A.then(R=>g(null,R),R=>g(R)),A}}_getV3PatchFind(){const c=this;return u=>function(d,l,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=c._checkSkipInstrumentation(T),g=typeof h=="function"?h:E;if(S||typeof g!="function"||typeof _!="object")return typeof h=="function"?u.call(this,d,l,_,p,h):u.call(this,d,l,_,p,h,E);const A=c.tracer.startSpan("mongodb.find",{kind:e.SpanKind.CLIENT});c._populateV3Attributes(A,l,d,_,"find");const R=c._patchEnd(A,g);return typeof h=="function"?u.call(this,d,l,_,p,R):u.call(this,d,l,_,p,h,R)}}_getV3PatchCursor(){const c=this;return u=>function(d,l,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=c._checkSkipInstrumentation(T),g=typeof h=="function"?h:E;if(S||typeof g!="function")return typeof h=="function"?u.call(this,d,l,_,p,h):u.call(this,d,l,_,p,h,E);const A=c.tracer.startSpan("mongodb.getMore",{kind:e.SpanKind.CLIENT});c._populateV3Attributes(A,l,d,_.cmd,"getMore");const R=c._patchEnd(A,g);return typeof h=="function"?u.call(this,d,l,_,p,R):u.call(this,d,l,_,p,h,R)}}static _getCommandType(c){return c.createIndexes!==void 0?r.MongodbCommandType.CREATE_INDEXES:c.findandmodify!==void 0?r.MongodbCommandType.FIND_AND_MODIFY:c.ismaster!==void 0?r.MongodbCommandType.IS_MASTER:c.count!==void 0?r.MongodbCommandType.COUNT:c.aggregate!==void 0?r.MongodbCommandType.AGGREGATE:r.MongodbCommandType.UNKNOWN}_populateV4Attributes(c,u,f,d,l){let _,p;if(u){const E=typeof u.address=="string"?u.address.split(":"):"";E.length===2&&(_=E[0],p=E[1])}let h;d?.documents&&d.documents[0]?h=d.documents[0]:d?.cursors?h=d.cursors:h=d,this._addAllSpanAttributes(c,f.db,f.collection,_,p,h,l)}_populateV3Attributes(c,u,f,d,l){let _,p;if(f&&f.s&&(_=f.s.options?.host??f.s.host,p=(f.s.options?.port??f.s.port)?.toString(),_==null||p==null)){const S=f.description?.address;if(S){const g=S.split(":");_=g[0],p=g[1]}}const[h,E]=u.toString().split("."),T=d?.query??d?.q??d;this._addAllSpanAttributes(c,h,E,_,p,T,l)}_addAllSpanAttributes(c,u,f,d,l,_,p){if(c.setAttributes({[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MONGODB,[n.ATTR_DB_NAME]:u,[n.ATTR_DB_MONGODB_COLLECTION]:f,[n.ATTR_DB_OPERATION]:p,[n.ATTR_DB_CONNECTION_STRING]:`mongodb://${d}:${l}/${u}`}),d&&l){c.setAttribute(n.ATTR_NET_PEER_NAME,d);const T=parseInt(l,10);isNaN(T)||c.setAttribute(n.ATTR_NET_PEER_PORT,T)}if(!_)return;const{dbStatementSerializer:h}=this.getConfig(),E=typeof h=="function"?h:this._defaultDbStatementSerializer.bind(this);(0,t.safeExecuteInTheMiddle)(()=>{const T=E(_);c.setAttribute(n.ATTR_DB_STATEMENT,T)},T=>{T&&this._diag.error("Error running dbStatementSerializer hook",T)},!0)}_getDefaultDbStatementReplacer(){const c=new WeakSet;return(u,f)=>typeof f!="object"||!f?"?":c.has(f)?"[Circular]":(c.add(f),f)}_defaultDbStatementSerializer(c){const{enhancedDatabaseReporting:u}=this.getConfig();return u?JSON.stringify(c):JSON.stringify(c,this._getDefaultDbStatementReplacer())}_handleExecutionResult(c,u){const{responseHook:f}=this.getConfig();typeof f=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{f(c,{data:u})},d=>{d&&this._diag.error("Error running response hook",d)},!0)}_patchEnd(c,u,f,d){const l=e.context.active(),_=this;return function(...h){const E=h[0];if(c){if(E instanceof Error)c?.setStatus({code:e.SpanStatusCode.ERROR,message:E.message});else{const T=h[1];_._handleExecutionResult(c,T)}c.end()}return e.context.with(l,()=>(d==="endSessions"&&_._connectionsUsage.add(-1,{state:"idle","pool.name":_._poolName}),u.apply(this,h)))}}setPoolName(c){const u=c.hostAddress?.host,f=c.hostAddress?.port,d=c.dbName,l=`mongodb://${u}:${f}/${d}`;this._poolName=l}_checkSkipInstrumentation(c){return this.getConfig().requireParentSpan===!0&&c===void 0}}return La.MongoDBInstrumentation=i,La}var Nf={},oN;function PK(){return oN||(oN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(Nf)),Nf}var sN;function MK(){return sN||(sN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=e.MongoDBInstrumentation=void 0;var t=IK();Object.defineProperty(e,"MongoDBInstrumentation",{enumerable:!0,get:function(){return t.MongoDBInstrumentation}});var n=PK();Object.defineProperty(e,"MongodbCommandType",{enumerable:!0,get:function(){return n.MongodbCommandType}})})(Rf)),Rf}var vK=MK();const kw="Mongo",wK=Ne(kw,()=>new vK.MongoDBInstrumentation({dbStatementSerializer:LK,responseHook(e){Ot(e,"auto.db.otel.mongo")}}));function LK(e){const t=Ch(e);return JSON.stringify(t)}function Ch(e){if(Array.isArray(e))return e.map(t=>Ch(t));if(DK(e)){const t={};return Object.entries(e).map(([n,r])=>[n,Ch(r)]).reduce((n,r)=>(kK(r)&&(n[r[0]]=r[1]),n),t)}return"?"}function DK(e){return typeof e=="object"&&e!==null&&!UK(e)}function UK(e){let t=!1;return typeof Buffer<"u"&&(t=Buffer.isBuffer(e)),t}function kK(e){return Array.isArray(e)}const xK=(()=>({name:kw,setupOnce(){wK()}})),GK=xK;var Of={},bf={},wn={},et={},iN;function xw(){return iN||(iN=1,Object.defineProperty(et,"__esModule",{value:!0}),et.ATTR_NET_PEER_PORT=et.ATTR_NET_PEER_NAME=et.ATTR_DB_USER=et.ATTR_DB_SYSTEM=et.ATTR_DB_STATEMENT=et.ATTR_DB_OPERATION=et.ATTR_DB_NAME=et.ATTR_DB_MONGODB_COLLECTION=void 0,et.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",et.ATTR_DB_NAME="db.name",et.ATTR_DB_OPERATION="db.operation",et.ATTR_DB_STATEMENT="db.statement",et.ATTR_DB_SYSTEM="db.system",et.ATTR_DB_USER="db.user",et.ATTR_NET_PEER_NAME="net.peer.name",et.ATTR_NET_PEER_PORT="net.peer.port"),et}var aN;function VK(){if(aN)return wn;aN=1,Object.defineProperty(wn,"__esModule",{value:!0}),wn.handleCallbackResponse=wn.handlePromiseResponse=wn.getAttributesFromCollection=void 0;const e=Pe(),t=Le,n=xw();function r(c){return{[n.ATTR_DB_MONGODB_COLLECTION]:c.name,[n.ATTR_DB_NAME]:c.conn.name,[n.ATTR_DB_USER]:c.conn.user,[n.ATTR_NET_PEER_NAME]:c.conn.host,[n.ATTR_NET_PEER_PORT]:c.conn.port}}wn.getAttributesFromCollection=r;function o(c,u={}){c.recordException(u),c.setStatus({code:e.SpanStatusCode.ERROR,message:`${u.message} ${u.code?`
Mongoose Error Code: ${u.code}`:""}`})}function s(c,u,f,d=void 0){f&&(0,t.safeExecuteInTheMiddle)(()=>f(c,{moduleVersion:d,response:u}),l=>{l&&e.diag.error("mongoose instrumentation: responseHook error",l)},!0)}function i(c,u,f,d=void 0){return c instanceof Promise?c.then(l=>(s(u,l,f,d),l)).catch(l=>{throw o(u,l),l}).finally(()=>u.end()):(s(u,c,f,d),u.end(),c)}wn.handlePromiseResponse=i;function a(c,u,f,d,l,_,p=void 0){let h=0;return l.length===2?h=1:l.length===3&&(h=2),l[h]=(E,T)=>(E?o(d,E):s(d,T,_,p),d.end(),c(E,T)),u.apply(f,l)}return wn.handleCallbackResponse=a,wn}var kr={},cN;function $K(){return cN||(cN=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.PACKAGE_NAME=kr.PACKAGE_VERSION=void 0,kr.PACKAGE_VERSION="0.55.0",kr.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose"),kr}var uN;function BK(){return uN||(uN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=e._STORED_PARENT_SPAN=void 0;const t=Pe(),n=fn,r=VK(),o=Le,s=$K(),i=xw(),a=["deleteOne","deleteMany","find","findOne","estimatedDocumentCount","countDocuments","distinct","where","$where","findOneAndUpdate","findOneAndDelete","findOneAndReplace"],c=["remove","count","findOneAndRemove",...a],u=["count","findOneAndRemove",...a],f=[...a];function d(p){return p?p.startsWith("6.")||p.startsWith("5.")?c:p.startsWith("7.")?u:f:a}function l(p){return p&&(p.startsWith("5.")||p.startsWith("6."))||!1}e._STORED_PARENT_SPAN=Symbol("stored-parent-span");class _ extends o.InstrumentationBase{constructor(h={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,h)}init(){return new o.InstrumentationNodeModuleDefinition("mongoose",[">=5.9.7 <9"],this.patch.bind(this),this.unpatch.bind(this))}patch(h,E){const T=h[Symbol.toStringTag]==="Module"?h.default:h;return this._wrap(T.Model.prototype,"save",this.patchOnModelMethods("save",E)),T.Model.prototype.$save=T.Model.prototype.save,l(E)&&this._wrap(T.Model.prototype,"remove",this.patchOnModelMethods("remove",E)),this._wrap(T.Query.prototype,"exec",this.patchQueryExec(E)),this._wrap(T.Aggregate.prototype,"exec",this.patchAggregateExec(E)),d(E).forEach(g=>{this._wrap(T.Query.prototype,g,this.patchAndCaptureSpanContext(g))}),this._wrap(T.Model,"aggregate",this.patchModelAggregate()),this._wrap(T.Model,"insertMany",this.patchModelStatic("insertMany",E)),this._wrap(T.Model,"bulkWrite",this.patchModelStatic("bulkWrite",E)),T}unpatch(h,E){const T=h[Symbol.toStringTag]==="Module"?h.default:h,S=d(E);this._unwrap(T.Model.prototype,"save"),T.Model.prototype.$save=T.Model.prototype.save,l(E)&&this._unwrap(T.Model.prototype,"remove"),this._unwrap(T.Query.prototype,"exec"),this._unwrap(T.Aggregate.prototype,"exec"),S.forEach(g=>{this._unwrap(T.Query.prototype,g)}),this._unwrap(T.Model,"aggregate"),this._unwrap(T.Model,"insertMany"),this._unwrap(T.Model,"bulkWrite")}patchAggregateExec(h){const E=this;return T=>function(g){if(E.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return T.apply(this,arguments);const A=this[e._STORED_PARENT_SPAN],R={},{dbStatementSerializer:O}=E.getConfig();O&&(R[i.ATTR_DB_STATEMENT]=O("aggregate",{options:this.options,aggregatePipeline:this._pipeline}));const C=E._startSpan(this._model.collection,this._model?.modelName,"aggregate",R,A);return E._handleResponse(C,T,this,arguments,g,h)}}patchQueryExec(h){const E=this;return T=>function(g){if(E.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return T.apply(this,arguments);const A=this[e._STORED_PARENT_SPAN],R={},{dbStatementSerializer:O}=E.getConfig();O&&(R[i.ATTR_DB_STATEMENT]=O(this.op,{condition:this._conditions,updates:this._update,options:this.options,fields:this._fields}));const C=E._startSpan(this.mongooseCollection,this.model.modelName,this.op,R,A);return E._handleResponse(C,T,this,arguments,g,h)}}patchOnModelMethods(h,E){const T=this;return S=>function(A,R){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return S.apply(this,arguments);const O={document:this};A&&!(A instanceof Function)&&(O.options=A);const C={},{dbStatementSerializer:I}=T.getConfig();I&&(C[i.ATTR_DB_STATEMENT]=I(h,O));const w=T._startSpan(this.constructor.collection,this.constructor.modelName,h,C);return A instanceof Function&&(R=A,A=void 0),T._handleResponse(w,S,this,arguments,R,E)}}patchModelStatic(h,E){const T=this;return S=>function(A,R,O){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return S.apply(this,arguments);typeof R=="function"&&(O=R,R=void 0);const C={};switch(h){case"insertMany":C.documents=A;break;case"bulkWrite":C.operations=A;break;default:C.document=A;break}R!==void 0&&(C.options=R);const I={},{dbStatementSerializer:w}=T.getConfig();w&&(I[i.ATTR_DB_STATEMENT]=w(h,C));const U=T._startSpan(this.collection,this.modelName,h,I);return T._handleResponse(U,S,this,arguments,O,E)}}patchModelAggregate(){const h=this;return E=>function(){const S=t.trace.getSpan(t.context.active()),g=h._callOriginalFunction(()=>E.apply(this,arguments));return g&&(g[e._STORED_PARENT_SPAN]=S),g}}patchAndCaptureSpanContext(h){const E=this;return T=>function(){return this[e._STORED_PARENT_SPAN]=t.trace.getSpan(t.context.active()),E._callOriginalFunction(()=>T.apply(this,arguments))}}_startSpan(h,E,T,S,g){return this.tracer.startSpan(`mongoose.${E}.${T}`,{kind:t.SpanKind.CLIENT,attributes:{...S,...(0,r.getAttributesFromCollection)(h),[i.ATTR_DB_OPERATION]:T,[i.ATTR_DB_SYSTEM]:"mongoose"}},g?t.trace.setSpan(t.context.active(),g):void 0)}_handleResponse(h,E,T,S,g,A=void 0){const R=this;if(g instanceof Function)return R._callOriginalFunction(()=>(0,r.handleCallbackResponse)(g,E,T,h,S,R.getConfig().responseHook,A));{const O=R._callOriginalFunction(()=>E.apply(T,S));return(0,r.handlePromiseResponse)(O,h,R.getConfig().responseHook,A)}}_callOriginalFunction(h){return this.getConfig().suppressInternalInstrumentation?t.context.with((0,n.suppressTracing)(t.context.active()),h):h()}}e.MongooseInstrumentation=_})(bf)),bf}var lN;function HK(){return lN||(lN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=void 0;var t=BK();Object.defineProperty(e,"MongooseInstrumentation",{enumerable:!0,get:function(){return t.MongooseInstrumentation}})})(Of)),Of}var FK=HK();const Gw="Mongoose",YK=Ne(Gw,()=>new FK.MongooseInstrumentation({responseHook(e){Ot(e,"auto.db.otel.mongoose")}})),jK=(()=>({name:Gw,setupOnce(){YK()}})),qK=jK;var Cf={},Da={},We={},dN;function Vw(){return dN||(dN=1,Object.defineProperty(We,"__esModule",{value:!0}),We.METRIC_DB_CLIENT_CONNECTIONS_USAGE=We.DB_SYSTEM_VALUE_MYSQL=We.ATTR_NET_PEER_PORT=We.ATTR_NET_PEER_NAME=We.ATTR_DB_USER=We.ATTR_DB_SYSTEM=We.ATTR_DB_STATEMENT=We.ATTR_DB_NAME=We.ATTR_DB_CONNECTION_STRING=void 0,We.ATTR_DB_CONNECTION_STRING="db.connection_string",We.ATTR_DB_NAME="db.name",We.ATTR_DB_STATEMENT="db.statement",We.ATTR_DB_SYSTEM="db.system",We.ATTR_DB_USER="db.user",We.ATTR_NET_PEER_NAME="net.peer.name",We.ATTR_NET_PEER_PORT="net.peer.port",We.DB_SYSTEM_VALUE_MYSQL="mysql",We.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),We}var If={},fN;function WK(){return fN||(fN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.MYSQL_VALUES="db.mysql.values"})(e.AttributeNames||(e.AttributeNames={}))})(If)),If}var Tt={},_N;function KK(){if(_N)return Tt;_N=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.getPoolName=Tt.arrayStringifyHelper=Tt.getSpanName=Tt.getDbValues=Tt.getDbStatement=Tt.getConnectionAttributes=void 0;const e=Vw();function t(u){const{host:f,port:d,database:l,user:_}=n(u),p=parseInt(d,10);return isNaN(p)?{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,l),[e.ATTR_DB_NAME]:l,[e.ATTR_DB_USER]:_}:{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_NET_PEER_PORT]:p,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,l),[e.ATTR_DB_NAME]:l,[e.ATTR_DB_USER]:_}}Tt.getConnectionAttributes=t;function n(u){const{host:f,port:d,database:l,user:_}=u&&u.connectionConfig||u||{};return{host:f,port:d,database:l,user:_}}function r(u,f,d){let l=`jdbc:mysql://${u||"localhost"}`;return typeof f=="number"&&(l+=`:${f}`),typeof d=="string"&&(l+=`/${d}`),l}function o(u){return typeof u=="string"?u:u.sql}Tt.getDbStatement=o;function s(u,f){return a(typeof u=="string"?f:f||u.values)}Tt.getDbValues=s;function i(u){const f=typeof u=="object"?u.sql:u,d=f?.indexOf(" ");return typeof d=="number"&&d!==-1?f?.substring(0,d):f}Tt.getSpanName=i;function a(u){return u?`[${u.toString()}]`:""}Tt.arrayStringifyHelper=a;function c(u){const f=u.config.connectionConfig;let d="";return d+=f.host?`host: '${f.host}', `:"",d+=f.port?`port: ${f.port}, `:"",d+=f.database?`database: '${f.database}', `:"",d+=f.user?`user: '${f.user}'`:"",f.user||(d=d.substring(0,d.length-2)),d.trim()}return Tt.getPoolName=c,Tt}var xr={},pN;function zK(){return pN||(pN=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.PACKAGE_NAME=xr.PACKAGE_VERSION=void 0,xr.PACKAGE_VERSION="0.54.0",xr.PACKAGE_NAME="@opentelemetry/instrumentation-mysql"),xr}var hN;function ZK(){if(hN)return Da;hN=1,Object.defineProperty(Da,"__esModule",{value:!0}),Da.MySQLInstrumentation=void 0;const e=Pe(),t=Le,n=Vw(),r=WK(),o=KK(),s=zK();class i extends t.InstrumentationBase{static COMMON_ATTRIBUTES={[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MYSQL};constructor(c={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,c)}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){return[new t.InstrumentationNodeModuleDefinition("mysql",[">=2.0.0 <3"],c=>((0,t.isWrapped)(c.createConnection)&&this._unwrap(c,"createConnection"),this._wrap(c,"createConnection",this._patchCreateConnection()),(0,t.isWrapped)(c.createPool)&&this._unwrap(c,"createPool"),this._wrap(c,"createPool",this._patchCreatePool()),(0,t.isWrapped)(c.createPoolCluster)&&this._unwrap(c,"createPoolCluster"),this._wrap(c,"createPoolCluster",this._patchCreatePoolCluster()),c),c=>{c!==void 0&&(this._unwrap(c,"createConnection"),this._unwrap(c,"createPool"),this._unwrap(c,"createPoolCluster"))})]}_patchCreateConnection(){return c=>{const u=this;return function(d){const l=c(...arguments);return u._wrap(l,"query",u._patchQuery(l)),l}}}_patchCreatePool(){return c=>{const u=this;return function(d){const l=c(...arguments);return u._wrap(l,"query",u._patchQuery(l)),u._wrap(l,"getConnection",u._patchGetConnection(l)),u._wrap(l,"end",u._patchPoolEnd(l)),u._setPoolcallbacks(l,u,""),l}}}_patchPoolEnd(c){return u=>{const f=this;return function(l){const _=c._allConnections.length,p=c._freeConnections.length,h=_-p,E=(0,o.getPoolName)(c);f._connectionsUsage.add(-h,{state:"used",name:E}),f._connectionsUsage.add(-p,{state:"idle",name:E}),u.apply(c,arguments)}}}_patchCreatePoolCluster(){return c=>{const u=this;return function(d){const l=c(...arguments);return u._wrap(l,"getConnection",u._patchGetConnection(l)),u._wrap(l,"add",u._patchAdd(l)),l}}}_patchAdd(c){return u=>{const f=this;return function(l,_){if(!f._enabled)return f._unwrap(c,"add"),u.apply(c,arguments);u.apply(c,arguments);const p=c._nodes;if(p){const h=typeof l=="object"?"CLUSTER::"+c._lastId:String(l),E=p[h].pool;f._setPoolcallbacks(E,f,l)}}}}_patchGetConnection(c){return u=>{const f=this;return function(l,_,p){if(!f._enabled)return f._unwrap(c,"getConnection"),u.apply(c,arguments);if(arguments.length===1&&typeof l=="function"){const h=f._getConnectionCallbackPatchFn(l);return u.call(c,h)}if(arguments.length===2&&typeof _=="function"){const h=f._getConnectionCallbackPatchFn(_);return u.call(c,l,h)}if(arguments.length===3&&typeof p=="function"){const h=f._getConnectionCallbackPatchFn(p);return u.call(c,l,_,h)}return u.apply(c,arguments)}}}_getConnectionCallbackPatchFn(c){const u=this,f=e.context.active();return function(d,l){l&&((0,t.isWrapped)(l.query)||u._wrap(l,"query",u._patchQuery(l))),typeof c=="function"&&e.context.with(f,c,this,d,l)}}_patchQuery(c){return u=>{const f=this;return function(d,l,_){if(!f._enabled)return f._unwrap(c,"query"),u.apply(c,arguments);const p=f.tracer.startSpan((0,o.getSpanName)(d),{kind:e.SpanKind.CLIENT,attributes:{...i.COMMON_ATTRIBUTES,...(0,o.getConnectionAttributes)(c.config)}});if(p.setAttribute(n.ATTR_DB_STATEMENT,(0,o.getDbStatement)(d)),f.getConfig().enhancedDatabaseReporting){let T;Array.isArray(l)?T=l:arguments[2]&&(T=[l]),p.setAttribute(r.AttributeNames.MYSQL_VALUES,(0,o.getDbValues)(d,T))}const h=Array.from(arguments).findIndex(T=>typeof T=="function"),E=e.context.active();if(h===-1){const T=e.context.with(e.trace.setSpan(e.context.active(),p),()=>u.apply(c,arguments));return e.context.bind(E,T),T.on("error",S=>p.setStatus({code:e.SpanStatusCode.ERROR,message:S.message})).on("end",()=>{p.end()})}else return f._wrap(arguments,h,f._patchCallbackQuery(p,E)),e.context.with(e.trace.setSpan(e.context.active(),p),()=>u.apply(c,arguments))}}}_patchCallbackQuery(c,u){return f=>function(d,l,_){return d&&c.setStatus({code:e.SpanStatusCode.ERROR,message:d.message}),c.end(),e.context.with(u,()=>f(...arguments))}}_setPoolcallbacks(c,u,f){const d=f||(0,o.getPoolName)(c);c.on("connection",l=>{u._connectionsUsage.add(1,{state:"idle",name:d})}),c.on("acquire",l=>{u._connectionsUsage.add(-1,{state:"idle",name:d}),u._connectionsUsage.add(1,{state:"used",name:d})}),c.on("release",l=>{u._connectionsUsage.add(-1,{state:"used",name:d}),u._connectionsUsage.add(1,{state:"idle",name:d})})}}return Da.MySQLInstrumentation=i,Da}var EN;function XK(){return EN||(EN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQLInstrumentation=void 0;var t=ZK();Object.defineProperty(e,"MySQLInstrumentation",{enumerable:!0,get:function(){return t.MySQLInstrumentation}})})(Cf)),Cf}var QK=XK();const $w="Mysql",JK=Ne($w,()=>new QK.MySQLInstrumentation({})),e2=(()=>({name:$w,setupOnce(){JK()}})),t2=e2;var Pf={},Ua={},tt={},TN;function Bw(){return TN||(TN=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.DB_SYSTEM_VALUE_MYSQL=tt.ATTR_NET_PEER_PORT=tt.ATTR_NET_PEER_NAME=tt.ATTR_DB_USER=tt.ATTR_DB_SYSTEM=tt.ATTR_DB_STATEMENT=tt.ATTR_DB_NAME=tt.ATTR_DB_CONNECTION_STRING=void 0,tt.ATTR_DB_CONNECTION_STRING="db.connection_string",tt.ATTR_DB_NAME="db.name",tt.ATTR_DB_STATEMENT="db.statement",tt.ATTR_DB_SYSTEM="db.system",tt.ATTR_DB_USER="db.user",tt.ATTR_NET_PEER_NAME="net.peer.name",tt.ATTR_NET_PEER_PORT="net.peer.port",tt.DB_SYSTEM_VALUE_MYSQL="mysql"),tt}var ka={},SN;function Hw(){if(SN)return ka;SN=1,Object.defineProperty(ka,"__esModule",{value:!0}),ka.addSqlCommenterComment=void 0;const e=Pe(),t=fn;function n(s){const i=s.indexOf("--");if(i>=0)return!0;if(s.indexOf("/*")<0)return!1;const c=s.indexOf("*/");return i<c}function r(s){return encodeURIComponent(s).replace(/[!'()*]/g,i=>`%${i.charCodeAt(0).toString(16).toUpperCase()}`)}function o(s,i){if(typeof i!="string"||i.length===0||n(i))return i;const a=new t.W3CTraceContextPropagator,c={};a.inject(e.trace.setSpan(e.ROOT_CONTEXT,s),c,e.defaultTextMapSetter);const u=Object.keys(c).sort();if(u.length===0)return i;const f=u.map(d=>{const l=r(c[d]);return`${d}='${l}'`}).join(",");return`${i} /*${f}*/`}return ka.addSqlCommenterComment=o,ka}var Lt={},mN;function n2(){if(mN)return Lt;mN=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.getConnectionPrototypeToInstrument=Lt.once=Lt.getSpanName=Lt.getQueryText=Lt.getConnectionAttributes=void 0;const e=Bw(),t=Le,n=pt();function r(l,_,p){const{host:h,port:E,database:T,user:S}=o(l),g={};_&t.SemconvStability.OLD&&(g[e.ATTR_DB_CONNECTION_STRING]=s(h,E,T),g[e.ATTR_DB_NAME]=T,g[e.ATTR_DB_USER]=S),_&t.SemconvStability.STABLE&&(g[n.ATTR_DB_NAMESPACE]=T);const A=parseInt(E,10);return p&t.SemconvStability.OLD&&(g[e.ATTR_NET_PEER_NAME]=h,isNaN(A)||(g[e.ATTR_NET_PEER_PORT]=A)),p&t.SemconvStability.STABLE&&(g[n.ATTR_SERVER_ADDRESS]=h,isNaN(A)||(g[n.ATTR_SERVER_PORT]=A)),g}Lt.getConnectionAttributes=r;function o(l){const{host:_,port:p,database:h,user:E}=l&&l.connectionConfig||l||{};return{host:_,port:p,database:h,user:E}}function s(l,_,p){let h=`jdbc:mysql://${l||"localhost"}`;return typeof _=="number"&&(h+=`:${_}`),typeof p=="string"&&(h+=`/${p}`),h}function i(l,_,p,h=!1,E=a){const[T,S]=typeof l=="string"?[l,p]:[l.sql,c(l)?p||l.values:p];try{return h?E(T):_&&S?_(T,S):T}catch{return"Could not determine the query due to an error in masking or formatting"}}Lt.getQueryText=i;function a(l){return l.replace(/\b\d+\b/g,"?").replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,"?")}function c(l){return"values"in l}function u(l){const _=typeof l=="object"?l.sql:l,p=_?.indexOf(" ");return typeof p=="number"&&p!==-1?_?.substring(0,p):_}Lt.getSpanName=u;const f=l=>{let _=!1;return(...p)=>{if(!_)return _=!0,l(...p)}};Lt.once=f;function d(l){const _=l.prototype,p=Object.getPrototypeOf(_);return typeof p?.query=="function"&&typeof p?.execute=="function"?p:_}return Lt.getConnectionPrototypeToInstrument=d,Lt}var Gr={},gN;function r2(){return gN||(gN=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.PACKAGE_NAME=Gr.PACKAGE_VERSION=void 0,Gr.PACKAGE_VERSION="0.55.0",Gr.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2"),Gr}var AN;function o2(){if(AN)return Ua;AN=1,Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.MySQL2Instrumentation=void 0;const e=Pe(),t=Le,n=Bw(),r=Hw(),o=n2(),s=r2(),i=pt(),a=[">=1.4.2 <4"];class c extends t.InstrumentationBase{_netSemconvStability;_dbSemconvStability;constructor(f={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,f),this._setSemconvStabilityFromEnv()}_setSemconvStabilityFromEnv(){this._netSemconvStability=(0,t.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN),this._dbSemconvStability=(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){let f;function d(p){!f&&p.format&&(f=p.format)}const l=p=>{(0,t.isWrapped)(p.query)&&this._unwrap(p,"query"),this._wrap(p,"query",this._patchQuery(f,!1)),(0,t.isWrapped)(p.execute)&&this._unwrap(p,"execute"),this._wrap(p,"execute",this._patchQuery(f,!0))},_=p=>{this._unwrap(p,"query"),this._unwrap(p,"execute")};return[new t.InstrumentationNodeModuleDefinition("mysql2",a,p=>(d(p),p),()=>{},[new t.InstrumentationNodeModuleFile("mysql2/promise.js",a,p=>(d(p),p),()=>{}),new t.InstrumentationNodeModuleFile("mysql2/lib/connection.js",a,p=>{const h=(0,o.getConnectionPrototypeToInstrument)(p);return l(h),p},p=>{if(p===void 0)return;const h=(0,o.getConnectionPrototypeToInstrument)(p);_(h)})])]}_patchQuery(f,d){return l=>{const _=this;return function(p,h,E){let T;Array.isArray(h)?T=h:arguments[2]&&(T=[h]);const{maskStatement:S,maskStatementHook:g,responseHook:A}=_.getConfig(),R=(0,o.getConnectionAttributes)(this.config,_._dbSemconvStability,_._netSemconvStability),O=(0,o.getQueryText)(p,f,T,S,g);_._dbSemconvStability&t.SemconvStability.OLD&&(R[n.ATTR_DB_SYSTEM]=n.DB_SYSTEM_VALUE_MYSQL,R[n.ATTR_DB_STATEMENT]=O),_._dbSemconvStability&t.SemconvStability.STABLE&&(R[i.ATTR_DB_SYSTEM_NAME]=i.DB_SYSTEM_NAME_VALUE_MYSQL,R[i.ATTR_DB_QUERY_TEXT]=O);const C=_.tracer.startSpan((0,o.getSpanName)(p),{kind:e.SpanKind.CLIENT,attributes:R});!d&&_.getConfig().addSqlCommenterCommentToQueries&&(arguments[0]=p=typeof p=="string"?(0,r.addSqlCommenterComment)(C,p):Object.assign(p,{sql:(0,r.addSqlCommenterComment)(C,p.sql)}));const I=(0,o.once)((w,U)=>{w?C.setStatus({code:e.SpanStatusCode.ERROR,message:w.message}):typeof A=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{A(C,{queryResults:U})},B=>{B&&_._diag.warn("Failed executing responseHook",B)},!0),C.end()});if(arguments.length===1){typeof p.onResult=="function"&&_._wrap(p,"onResult",_._patchCallbackQuery(I));const w=l.apply(this,arguments);return w.once("error",U=>{I(U)}).once("result",U=>{I(void 0,U)}),w}return typeof arguments[1]=="function"?_._wrap(arguments,1,_._patchCallbackQuery(I)):typeof arguments[2]=="function"&&_._wrap(arguments,2,_._patchCallbackQuery(I)),l.apply(this,arguments)}}}_patchCallbackQuery(f){return d=>function(l,_,p){return f(l,_),d(...arguments)}}}return Ua.MySQL2Instrumentation=c,Ua}var RN;function s2(){return RN||(RN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQL2Instrumentation=void 0;var t=o2();Object.defineProperty(e,"MySQL2Instrumentation",{enumerable:!0,get:function(){return t.MySQL2Instrumentation}})})(Pf)),Pf}var i2=s2();const Fw="Mysql2",a2=Ne(Fw,()=>new i2.MySQL2Instrumentation({responseHook(e){Ot(e,"auto.db.otel.mysql2")}})),c2=(()=>({name:Fw,setupOnce(){a2()}})),u2=c2;var Mf={},xa={},St={},yN;function l2(){return yN||(yN=1,Object.defineProperty(St,"__esModule",{value:!0}),St.DB_SYSTEM_VALUE_REDIS=St.ATTR_NET_PEER_PORT=St.ATTR_NET_PEER_NAME=St.ATTR_DB_SYSTEM=St.ATTR_DB_STATEMENT=St.ATTR_DB_CONNECTION_STRING=void 0,St.ATTR_DB_CONNECTION_STRING="db.connection_string",St.ATTR_DB_STATEMENT="db.statement",St.ATTR_DB_SYSTEM="db.system",St.ATTR_NET_PEER_NAME="net.peer.name",St.ATTR_NET_PEER_PORT="net.peer.port",St.DB_SYSTEM_VALUE_REDIS="redis"),St}var Ga={},NN;function d2(){if(NN)return Ga;NN=1,Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.endSpan=void 0;const e=Pe(),t=(n,r)=>{r&&(n.recordException(r),n.setStatus({code:e.SpanStatusCode.ERROR,message:r.message})),n.end()};return Ga.endSpan=t,Ga}var Va={},ON;function zE(){if(ON)return Va;ON=1,Object.defineProperty(Va,"__esModule",{value:!0}),Va.defaultDbStatementSerializer=void 0;const e=[{regex:/^ECHO/i,args:0},{regex:/^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,args:1},{regex:/^(HSET|HMSET|LSET|LINSERT)/i,args:2},{regex:/^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,args:-1}],t=(n,r)=>{if(Array.isArray(r)&&r.length){const o=e.find(({regex:i})=>i.test(n))?.args??0,s=o>=0?r.slice(0,o):r;return r.length>s.length&&s.push(`[${r.length-o} other arguments]`),`${n} ${s.join(" ")}`}return n};return Va.defaultDbStatementSerializer=t,Va}var Vr={},bN;function f2(){return bN||(bN=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.PACKAGE_NAME=Vr.PACKAGE_VERSION=void 0,Vr.PACKAGE_VERSION="0.56.0",Vr.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis"),Vr}var CN;function _2(){if(CN)return xa;CN=1,Object.defineProperty(xa,"__esModule",{value:!0}),xa.IORedisInstrumentation=void 0;const e=Pe(),t=Le,n=l2(),r=Le,o=d2(),s=zE(),i=f2(),a={requireParentSpan:!0};class c extends t.InstrumentationBase{constructor(f={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,{...a,...f})}setConfig(f={}){super.setConfig({...a,...f})}init(){return[new t.InstrumentationNodeModuleDefinition("ioredis",[">=2.0.0 <6"],(f,d)=>{const l=f[Symbol.toStringTag]==="Module"?f.default:f;return(0,t.isWrapped)(l.prototype.sendCommand)&&this._unwrap(l.prototype,"sendCommand"),this._wrap(l.prototype,"sendCommand",this._patchSendCommand(d)),(0,t.isWrapped)(l.prototype.connect)&&this._unwrap(l.prototype,"connect"),this._wrap(l.prototype,"connect",this._patchConnection()),f},f=>{if(f===void 0)return;const d=f[Symbol.toStringTag]==="Module"?f.default:f;this._unwrap(d.prototype,"sendCommand"),this._unwrap(d.prototype,"connect")})]}_patchSendCommand(f){return d=>this._traceSendCommand(d,f)}_patchConnection(){return f=>this._traceConnection(f)}_traceSendCommand(f,d){const l=this;return function(_){if(arguments.length<1||typeof _!="object")return f.apply(this,arguments);const p=l.getConfig(),h=p.dbStatementSerializer||s.defaultDbStatementSerializer,E=e.trace.getSpan(e.context.active())===void 0;if(p.requireParentSpan===!0&&E)return f.apply(this,arguments);const T=l.tracer.startSpan(_.name,{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:h(_.name,_.args)}}),{requestHook:S}=p;S&&(0,r.safeExecuteInTheMiddle)(()=>S(T,{moduleVersion:d,cmdName:_.name,cmdArgs:_.args}),R=>{R&&e.diag.error("ioredis instrumentation: request hook failed",R)},!0);const{host:g,port:A}=this.options;T.setAttributes({[n.ATTR_NET_PEER_NAME]:g,[n.ATTR_NET_PEER_PORT]:A,[n.ATTR_DB_CONNECTION_STRING]:`redis://${g}:${A}`});try{const R=f.apply(this,arguments),O=_.resolve;_.resolve=function(I){(0,r.safeExecuteInTheMiddle)(()=>p.responseHook?.(T,_.name,_.args,I),w=>{w&&e.diag.error("ioredis instrumentation: response hook failed",w)},!0),(0,o.endSpan)(T,null),O(I)};const C=_.reject;return _.reject=function(I){(0,o.endSpan)(T,I),C(I)},R}catch(R){throw(0,o.endSpan)(T,R),R}}}_traceConnection(f){const d=this;return function(){const l=e.trace.getSpan(e.context.active())===void 0;if(d.getConfig().requireParentSpan===!0&&l)return f.apply(this,arguments);const _=d.tracer.startSpan("connect",{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:"connect"}}),{host:p,port:h}=this.options;_.setAttributes({[n.ATTR_NET_PEER_NAME]:p,[n.ATTR_NET_PEER_PORT]:h,[n.ATTR_DB_CONNECTION_STRING]:`redis://${p}:${h}`});try{const E=f.apply(this,arguments);return(0,o.endSpan)(_,null),E}catch(E){throw(0,o.endSpan)(_,E),E}}}}return xa.IORedisInstrumentation=c,xa}var IN;function p2(){return IN||(IN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IORedisInstrumentation=void 0;var t=_2();Object.defineProperty(e,"IORedisInstrumentation",{enumerable:!0,get:function(){return t.IORedisInstrumentation}})})(Mf)),Mf}var h2=p2(),vf={},$a={},$r={},PN;function ZE(){return PN||(PN=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.PACKAGE_NAME=$r.PACKAGE_VERSION=void 0,$r.PACKAGE_VERSION="0.57.0",$r.PACKAGE_NAME="@opentelemetry/instrumentation-redis"),$r}var Ba={},Ln={},MN;function E2(){if(MN)return Ln;MN=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.getTracedCreateStreamTrace=Ln.getTracedCreateClient=Ln.endSpan=void 0;const e=Pe(),t=(o,s)=>{s&&o.setStatus({code:e.SpanStatusCode.ERROR,message:s.message}),o.end()};Ln.endSpan=t;const n=o=>function(){const i=o.apply(this,arguments);return e.context.bind(e.context.active(),i)};Ln.getTracedCreateClient=n;const r=o=>function(){return Object.prototype.hasOwnProperty.call(this,"stream")||Object.defineProperty(this,"stream",{get(){return this._patched_redis_stream},set(i){e.context.bind(e.context.active(),i),this._patched_redis_stream=i}}),o.apply(this,arguments)};return Ln.getTracedCreateStreamTrace=r,Ln}var st={},vN;function XE(){return vN||(vN=1,Object.defineProperty(st,"__esModule",{value:!0}),st.DB_SYSTEM_VALUE_REDIS=st.DB_SYSTEM_NAME_VALUE_REDIS=st.ATTR_NET_PEER_PORT=st.ATTR_NET_PEER_NAME=st.ATTR_DB_SYSTEM=st.ATTR_DB_STATEMENT=st.ATTR_DB_CONNECTION_STRING=void 0,st.ATTR_DB_CONNECTION_STRING="db.connection_string",st.ATTR_DB_STATEMENT="db.statement",st.ATTR_DB_SYSTEM="db.system",st.ATTR_NET_PEER_NAME="net.peer.name",st.ATTR_NET_PEER_PORT="net.peer.port",st.DB_SYSTEM_NAME_VALUE_REDIS="redis",st.DB_SYSTEM_VALUE_REDIS="redis"),st}var wN;function T2(){if(wN)return Ba;wN=1,Object.defineProperty(Ba,"__esModule",{value:!0}),Ba.RedisInstrumentationV2_V3=void 0;const e=Le,t=E2(),n=ZE(),r=Pe(),o=pt(),s=XE(),i=zE();class a extends e.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(u={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,u),this._semconvStability=u.semconvStability?u.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(u={}){super.setConfig(u),this._semconvStability=u.semconvStability?u.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[new e.InstrumentationNodeModuleDefinition("redis",[">=2.6.0 <4"],u=>((0,e.isWrapped)(u.RedisClient.prototype.internal_send_command)&&this._unwrap(u.RedisClient.prototype,"internal_send_command"),this._wrap(u.RedisClient.prototype,"internal_send_command",this._getPatchInternalSendCommand()),(0,e.isWrapped)(u.RedisClient.prototype.create_stream)&&this._unwrap(u.RedisClient.prototype,"create_stream"),this._wrap(u.RedisClient.prototype,"create_stream",this._getPatchCreateStream()),(0,e.isWrapped)(u.createClient)&&this._unwrap(u,"createClient"),this._wrap(u,"createClient",this._getPatchCreateClient()),u),u=>{u!==void 0&&(this._unwrap(u.RedisClient.prototype,"internal_send_command"),this._unwrap(u.RedisClient.prototype,"create_stream"),this._unwrap(u,"createClient"))})]}_getPatchInternalSendCommand(){const u=this;return function(d){return function(_){if(arguments.length!==1||typeof _!="object")return d.apply(this,arguments);const p=u.getConfig(),h=r.trace.getSpan(r.context.active())===void 0;if(p.requireParentSpan===!0&&h)return d.apply(this,arguments);const E=p?.dbStatementSerializer||i.defaultDbStatementSerializer,T={};u._semconvStability&e.SemconvStability.OLD&&Object.assign(T,{[s.ATTR_DB_SYSTEM]:s.DB_SYSTEM_VALUE_REDIS,[s.ATTR_DB_STATEMENT]:E(_.command,_.args)}),u._semconvStability&e.SemconvStability.STABLE&&Object.assign(T,{[o.ATTR_DB_SYSTEM_NAME]:s.DB_SYSTEM_NAME_VALUE_REDIS,[o.ATTR_DB_OPERATION_NAME]:_.command,[o.ATTR_DB_QUERY_TEXT]:E(_.command,_.args)});const S=u.tracer.startSpan(`${a.COMPONENT}-${_.command}`,{kind:r.SpanKind.CLIENT,attributes:T});if(this.connection_options){const A={};u._semconvStability&e.SemconvStability.OLD&&Object.assign(A,{[s.ATTR_NET_PEER_NAME]:this.connection_options.host,[s.ATTR_NET_PEER_PORT]:this.connection_options.port}),u._semconvStability&e.SemconvStability.STABLE&&Object.assign(A,{[o.ATTR_SERVER_ADDRESS]:this.connection_options.host,[o.ATTR_SERVER_PORT]:this.connection_options.port}),S.setAttributes(A)}this.address&&u._semconvStability&e.SemconvStability.OLD&&S.setAttribute(s.ATTR_DB_CONNECTION_STRING,`redis://${this.address}`);const g=arguments[0].callback;if(g){const A=r.context.active();arguments[0].callback=function(O,C){if(p?.responseHook){const I=p.responseHook;(0,e.safeExecuteInTheMiddle)(()=>{I(S,_.command,_.args,C)},w=>{w&&u._diag.error("Error executing responseHook",w)},!0)}return(0,t.endSpan)(S,O),r.context.with(A,g,this,...arguments)}}try{return d.apply(this,arguments)}catch(A){throw(0,t.endSpan)(S,A),A}}}}_getPatchCreateClient(){return function(f){return(0,t.getTracedCreateClient)(f)}}_getPatchCreateStream(){return function(f){return(0,t.getTracedCreateStreamTrace)(f)}}}return Ba.RedisInstrumentationV2_V3=a,Ba}var Ha={},Fa={},LN;function S2(){if(LN)return Fa;LN=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.getClientAttributes=void 0;const e=pt(),t=XE(),n=Le;function r(s,i,a){const c={};return a&n.SemconvStability.OLD&&Object.assign(c,{[t.ATTR_DB_SYSTEM]:t.DB_SYSTEM_VALUE_REDIS,[t.ATTR_NET_PEER_NAME]:i?.socket?.host,[t.ATTR_NET_PEER_PORT]:i?.socket?.port,[t.ATTR_DB_CONNECTION_STRING]:o(s,i?.url)}),a&n.SemconvStability.STABLE&&Object.assign(c,{[e.ATTR_DB_SYSTEM_NAME]:t.DB_SYSTEM_NAME_VALUE_REDIS,[e.ATTR_SERVER_ADDRESS]:i?.socket?.host,[e.ATTR_SERVER_PORT]:i?.socket?.port}),c}Fa.getClientAttributes=r;function o(s,i){if(!(typeof i!="string"||!i))try{const a=new URL(i);return a.searchParams.delete("user_pwd"),a.username="",a.password="",a.href}catch(a){s.error("failed to sanitize redis connection url",a)}}return Fa}var DN;function m2(){if(DN)return Ha;DN=1,Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.RedisInstrumentationV4_V5=void 0;const e=Pe(),t=Le,n=S2(),r=zE(),o=ZE(),s=pt(),i=XE(),a=Symbol("opentelemetry.instrumentation.redis.open_spans"),c=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class u extends t.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(d={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(d={}){super.setConfig(d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(d){const l=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/commander.js`,["^1.0.0"],(h,E)=>{const T=h.transformCommandArguments;if(!T)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),h;const S=E?.startsWith("1.0.")?"extendWithCommands":"attachCommands";return(0,t.isWrapped)(h?.[S])&&this._unwrap(h,S),this._wrap(h,S,this._getPatchExtendWithCommands(T)),h},h=>{(0,t.isWrapped)(h?.extendWithCommands)&&this._unwrap(h,"extendWithCommands"),(0,t.isWrapped)(h?.attachCommands)&&this._unwrap(h,"attachCommands")}),_=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/multi-command.js`,["^1.0.0","^5.0.0"],h=>{const E=h?.default?.prototype;return(0,t.isWrapped)(E?.exec)&&this._unwrap(E,"exec"),this._wrap(E,"exec",this._getPatchMultiCommandsExec()),(0,t.isWrapped)(E?.addCommand)&&this._unwrap(E,"addCommand"),this._wrap(E,"addCommand",this._getPatchMultiCommandsAddCommand()),h},h=>{const E=h?.default?.prototype;(0,t.isWrapped)(E?.exec)&&this._unwrap(E,"exec"),(0,t.isWrapped)(E?.addCommand)&&this._unwrap(E,"addCommand")}),p=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/index.js`,["^1.0.0","^5.0.0"],h=>{const E=h?.default?.prototype;return E?.multi&&((0,t.isWrapped)(E?.multi)&&this._unwrap(E,"multi"),this._wrap(E,"multi",this._getPatchRedisClientMulti())),E?.MULTI&&((0,t.isWrapped)(E?.MULTI)&&this._unwrap(E,"MULTI"),this._wrap(E,"MULTI",this._getPatchRedisClientMulti())),(0,t.isWrapped)(E?.sendCommand)&&this._unwrap(E,"sendCommand"),this._wrap(E,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(E,"connect",this._getPatchedClientConnect()),h},h=>{const E=h?.default?.prototype;(0,t.isWrapped)(E?.multi)&&this._unwrap(E,"multi"),(0,t.isWrapped)(E?.MULTI)&&this._unwrap(E,"MULTI"),(0,t.isWrapped)(E?.sendCommand)&&this._unwrap(E,"sendCommand")});return new t.InstrumentationNodeModuleDefinition(d,["^1.0.0","^5.0.0"],h=>h,()=>{},[l,_,p])}_getPatchExtendWithCommands(d){const l=this;return function(p){return function(E){if(E?.BaseClass?.name!=="RedisClient")return p.apply(this,arguments);const T=E.executor;return E.executor=function(S,g){const A=d(S,g).args;return l._traceClientCommand(T,this,arguments,A)},p.apply(this,arguments)}}}_getPatchMultiCommandsExec(){const d=this;return function(_){return function(){const h=_.apply(this,arguments);return typeof h?.then!="function"?(d._diag.error("got non promise result when patching RedisClientMultiCommand.exec"),h):h.then(E=>{const T=this[a];return d._endSpansWithRedisReplies(T,E),E}).catch(E=>{const T=this[a];if(!T)d._diag.error("cannot find open spans to end for redis multi command");else{const S=E.constructor.name==="MultiErrorReply"?E.replies:new Array(T.length).fill(E);d._endSpansWithRedisReplies(T,S)}return Promise.reject(E)})}}}_getPatchMultiCommandsAddCommand(){const d=this;return function(_){return function(h){return d._traceClientCommand(_,this,arguments,h)}}}_getPatchRedisClientMulti(){return function(l){return function(){const p=l.apply(this,arguments);return p[c]=this.options,p}}}_getPatchRedisClientSendCommand(){const d=this;return function(_){return function(h){return d._traceClientCommand(_,this,arguments,h)}}}_getPatchedClientConnect(){const d=this;return function(_){return function(){const h=this.options,E=(0,n.getClientAttributes)(d._diag,h,d._semconvStability),T=d.tracer.startSpan(`${u.COMPONENT}-connect`,{kind:e.SpanKind.CLIENT,attributes:E});return e.context.with(e.trace.setSpan(e.context.active(),T),()=>_.apply(this)).then(g=>(T.end(),g)).catch(g=>(T.recordException(g),T.setStatus({code:e.SpanStatusCode.ERROR,message:g.message}),T.end(),Promise.reject(g)))}}}_traceClientCommand(d,l,_,p){if(e.trace.getSpan(e.context.active())===void 0&&this.getConfig().requireParentSpan)return d.apply(l,_);const E=l.options||l[c],T=p[0],S=p.slice(1),g=this.getConfig().dbStatementSerializer||r.defaultDbStatementSerializer,A=(0,n.getClientAttributes)(this._diag,E,this._semconvStability);this._semconvStability&t.SemconvStability.STABLE&&(A[s.ATTR_DB_OPERATION_NAME]=T);try{const C=g(T,S);C!=null&&(this._semconvStability&t.SemconvStability.OLD&&(A[i.ATTR_DB_STATEMENT]=C),this._semconvStability&t.SemconvStability.STABLE&&(A[s.ATTR_DB_QUERY_TEXT]=C))}catch(C){this._diag.error("dbStatementSerializer throw an exception",C,{commandName:T})}const R=this.tracer.startSpan(`${u.COMPONENT}-${T}`,{kind:e.SpanKind.CLIENT,attributes:A}),O=e.context.with(e.trace.setSpan(e.context.active(),R),()=>d.apply(l,_));if(typeof O?.then=="function")O.then(C=>{this._endSpanWithResponse(R,T,S,C,void 0)},C=>{this._endSpanWithResponse(R,T,S,null,C)});else{const C=O;C[a]=C[a]||[],C[a].push({span:R,commandName:T,commandArgs:S})}return O}_endSpansWithRedisReplies(d,l){if(!d)return this._diag.error("cannot find open spans to end for redis multi command");if(l.length!==d.length)return this._diag.error("number of multi command spans does not match response from redis");for(let _=0;_<d.length;_++){const{span:p,commandName:h,commandArgs:E}=d[_],T=l[_],[S,g]=T instanceof Error?[null,T]:[T,void 0];this._endSpanWithResponse(p,h,E,S,g)}}_endSpanWithResponse(d,l,_,p,h){const{responseHook:E}=this.getConfig();if(!h&&E)try{E(d,l,_,p)}catch(T){this._diag.error("responseHook throw an exception",T)}h&&(d.recordException(h),d.setStatus({code:e.SpanStatusCode.ERROR,message:h?.message})),d.end()}}return Ha.RedisInstrumentationV4_V5=u,Ha}var UN;function g2(){if(UN)return $a;UN=1,Object.defineProperty($a,"__esModule",{value:!0}),$a.RedisInstrumentation=void 0;const e=Le,t=ZE(),n=T2(),r=m2(),o={requireParentSpan:!1};class s extends e.InstrumentationBase{instrumentationV2_V3;instrumentationV4_V5;initialized=!1;constructor(a={}){const c={...o,...a};super(t.PACKAGE_NAME,t.PACKAGE_VERSION,c),this.instrumentationV2_V3=new n.RedisInstrumentationV2_V3(this.getConfig()),this.instrumentationV4_V5=new r.RedisInstrumentationV4_V5(this.getConfig()),this.initialized=!0}setConfig(a={}){const c={...o,...a};super.setConfig(c),this.initialized&&(this.instrumentationV2_V3.setConfig(c),this.instrumentationV4_V5.setConfig(c))}init(){}getModuleDefinitions(){return[...this.instrumentationV2_V3.getModuleDefinitions(),...this.instrumentationV4_V5.getModuleDefinitions()]}setTracerProvider(a){super.setTracerProvider(a),this.initialized&&(this.instrumentationV2_V3.setTracerProvider(a),this.instrumentationV4_V5.setTracerProvider(a))}enable(){super.enable(),this.initialized&&(this.instrumentationV2_V3.enable(),this.instrumentationV4_V5.enable())}disable(){super.disable(),this.initialized&&(this.instrumentationV2_V3.disable(),this.instrumentationV4_V5.disable())}}return $a.RedisInstrumentation=s,$a}var kN;function A2(){return kN||(kN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RedisInstrumentation=void 0;var t=g2();Object.defineProperty(e,"RedisInstrumentation",{enumerable:!0,get:function(){return t.RedisInstrumentation}})})(vf)),vf}var R2=A2();const y2=["get","set","setex"],Yw=["get","mget"],N2=["set","setex"];function il(e,t){return e.includes(t.toLowerCase())}function jw(e){return il(Yw,e)?"cache.get":il(N2,e)?"cache.put":void 0}function O2(e,t){return t.some(n=>e.startsWith(n))}function b2(e,t){try{if(t.length===0)return;const n=o=>typeof o=="string"||typeof o=="number"||Buffer.isBuffer(o)?[o.toString()]:Array.isArray(o)?xN(o.map(s=>n(s))):["<unknown>"],r=t[0];return il(y2,e)&&r!=null?n(r):xN(t.map(o=>n(o)))}catch{return}}function C2(e,t,n){if(!jw(e))return!1;for(const r of t)if(O2(r,n))return!0;return!1}function I2(e){const t=n=>{try{return Buffer.isBuffer(n)?n.byteLength:typeof n=="string"?n.length:typeof n=="number"?n.toString().length:n==null?0:JSON.stringify(n).length}catch{return}};return Array.isArray(e)?e.reduce((n,r)=>{const o=t(r);return typeof o=="number"?n!==void 0?n+o:o:n},0):t(e)}function xN(e){const t=[],n=r=>{r.forEach(o=>{Array.isArray(o)?n(o):t.push(o)})};return n(e),t}const od="Redis";let ac={};const qw=(e,t,n,r)=>{e.setAttribute(xe,"auto.db.otel.redis");const o=b2(t,n),s=jw(t);if(!o||!s||!ac.cachePrefixes||!C2(t,o,ac.cachePrefixes))return;const i=ye(e).data["net.peer.name"],a=ye(e).data["net.peer.port"];a&&i&&e.setAttributes({"network.peer.address":i,"network.peer.port":a});const c=I2(r);c&&e.setAttribute(Px,c),il(Yw,t)&&c!==void 0&&e.setAttribute(Cx,c>0),e.setAttributes({[Ee]:s,[Ix]:o});const u=o.join(", ");e.updateName(ac.maxCacheKeyLength?Hu(u,ac.maxCacheKeyLength):u)},P2=Ne(`${od}.IORedis`,()=>new h2.IORedisInstrumentation({responseHook:qw})),M2=Ne(`${od}.Redis`,()=>new R2.RedisInstrumentation({responseHook:qw})),v2=Object.assign(()=>{P2(),M2()},{id:od}),w2=((e={})=>({name:od,setupOnce(){ac=e,v2()}})),L2=w2;var wf={},Ya={},ja={},GN;function D2(){return GN||(GN=1,Object.defineProperty(ja,"__esModule",{value:!0}),ja.EVENT_LISTENERS_SET=void 0,ja.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet")),ja}var ge={},Lf={},VN;function Ww(){return VN||(VN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.PG_VALUES="db.postgresql.values",t.PG_PLAN="db.postgresql.plan",t.IDLE_TIMEOUT_MILLIS="db.postgresql.idle.timeout.millis",t.MAX_CLIENT="db.postgresql.max.client"})(e.AttributeNames||(e.AttributeNames={}))})(Lf)),Lf}var Me={},$N;function Kw(){return $N||($N=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS=Me.METRIC_DB_CLIENT_CONNECTION_COUNT=Me.DB_SYSTEM_VALUE_POSTGRESQL=Me.DB_CLIENT_CONNECTION_STATE_VALUE_USED=Me.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE=Me.ATTR_NET_PEER_PORT=Me.ATTR_NET_PEER_NAME=Me.ATTR_DB_USER=Me.ATTR_DB_SYSTEM=Me.ATTR_DB_STATEMENT=Me.ATTR_DB_NAME=Me.ATTR_DB_CONNECTION_STRING=Me.ATTR_DB_CLIENT_CONNECTION_STATE=Me.ATTR_DB_CLIENT_CONNECTION_POOL_NAME=void 0,Me.ATTR_DB_CLIENT_CONNECTION_POOL_NAME="db.client.connection.pool.name",Me.ATTR_DB_CLIENT_CONNECTION_STATE="db.client.connection.state",Me.ATTR_DB_CONNECTION_STRING="db.connection_string",Me.ATTR_DB_NAME="db.name",Me.ATTR_DB_STATEMENT="db.statement",Me.ATTR_DB_SYSTEM="db.system",Me.ATTR_DB_USER="db.user",Me.ATTR_NET_PEER_NAME="net.peer.name",Me.ATTR_NET_PEER_PORT="net.peer.port",Me.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE="idle",Me.DB_CLIENT_CONNECTION_STATE_VALUE_USED="used",Me.DB_SYSTEM_VALUE_POSTGRESQL="postgresql",Me.METRIC_DB_CLIENT_CONNECTION_COUNT="db.client.connection.count",Me.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS="db.client.connection.pending_requests"),Me}var Df={},BN;function zw(){return BN||(BN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=void 0,(function(t){t.QUERY_PREFIX="pg.query",t.CONNECT="pg.connect",t.POOL_CONNECT="pg-pool.connect"})(e.SpanNames||(e.SpanNames={}))})(Df)),Df}var HN;function U2(){if(HN)return ge;HN=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.sanitizedErrorMessage=ge.isObjectWithTextString=ge.getErrorMessage=ge.patchClientConnectCallback=ge.patchCallbackPGPool=ge.updateCounter=ge.getPoolName=ge.patchCallback=ge.handleExecutionResult=ge.handleConfigQuery=ge.shouldSkipInstrumentation=ge.getSemanticAttributesFromPoolConnection=ge.getSemanticAttributesFromConnection=ge.getConnectionString=ge.parseAndMaskConnectionString=ge.parseNormalizedOperationName=ge.getQuerySpanName=void 0;const e=Pe(),t=Ww(),n=pt(),r=Kw(),o=Le,s=zw();function i(I,w){if(!w)return s.SpanNames.QUERY_PREFIX;const U=typeof w.name=="string"&&w.name?w.name:a(w.text);return`${s.SpanNames.QUERY_PREFIX}:${U}${I?` ${I}`:""}`}ge.getQuerySpanName=i;function a(I){const w=I.indexOf(" ");let U=w===-1?I:I.slice(0,w);return U=U.toUpperCase(),U.endsWith(";")?U.slice(0,-1):U}ge.parseNormalizedOperationName=a;function c(I){try{const w=new URL(I);return w.username="",w.password="",w.toString()}catch{return"postgresql://localhost:5432/"}}ge.parseAndMaskConnectionString=c;function u(I){if("connectionString"in I&&I.connectionString)return c(I.connectionString);const w=I.host||"localhost",U=I.port||5432,B=I.database||"";return`postgresql://${w}:${U}/${B}`}ge.getConnectionString=u;function f(I){if(Number.isInteger(I))return I}function d(I,w){let U={};return w&o.SemconvStability.OLD&&(U={...U,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:I.database,[r.ATTR_DB_CONNECTION_STRING]:u(I),[r.ATTR_DB_USER]:I.user,[r.ATTR_NET_PEER_NAME]:I.host,[r.ATTR_NET_PEER_PORT]:f(I.port)}),w&o.SemconvStability.STABLE&&(U={...U,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:I.namespace,[n.ATTR_SERVER_ADDRESS]:I.host,[n.ATTR_SERVER_PORT]:f(I.port)}),U}ge.getSemanticAttributesFromConnection=d;function l(I,w){let U;try{U=I.connectionString?new URL(I.connectionString):void 0}catch{U=void 0}let B={[t.AttributeNames.IDLE_TIMEOUT_MILLIS]:I.idleTimeoutMillis,[t.AttributeNames.MAX_CLIENT]:I.maxClient};return w&o.SemconvStability.OLD&&(B={...B,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:U?.pathname.slice(1)??I.database,[r.ATTR_DB_CONNECTION_STRING]:u(I),[r.ATTR_NET_PEER_NAME]:U?.hostname??I.host,[r.ATTR_NET_PEER_PORT]:Number(U?.port)||f(I.port),[r.ATTR_DB_USER]:U?.username??I.user}),w&o.SemconvStability.STABLE&&(B={...B,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:I.namespace,[n.ATTR_SERVER_ADDRESS]:U?.hostname??I.host,[n.ATTR_SERVER_PORT]:Number(U?.port)||f(I.port)}),B}ge.getSemanticAttributesFromPoolConnection=l;function _(I){return I.requireParentSpan===!0&&e.trace.getSpan(e.context.active())===void 0}ge.shouldSkipInstrumentation=_;function p(I,w,U,B){const{connectionParameters:F}=this,G=F.database,x=i(G,B),Y=I.startSpan(x,{kind:e.SpanKind.CLIENT,attributes:d(F,U)});if(!B)return Y;if(B.text&&(U&o.SemconvStability.OLD&&Y.setAttribute(r.ATTR_DB_STATEMENT,B.text),U&o.SemconvStability.STABLE&&Y.setAttribute(n.ATTR_DB_QUERY_TEXT,B.text)),w.enhancedDatabaseReporting&&Array.isArray(B.values))try{const v=B.values.map(P=>P==null?"null":P instanceof Buffer?P.toString():typeof P=="object"?typeof P.toPostgres=="function"?P.toPostgres():JSON.stringify(P):P.toString());Y.setAttribute(t.AttributeNames.PG_VALUES,v)}catch(v){e.diag.error("failed to stringify ",B.values,v)}return typeof B.name=="string"&&Y.setAttribute(t.AttributeNames.PG_PLAN,B.name),Y}ge.handleConfigQuery=p;function h(I,w,U){typeof I.responseHook=="function"&&(0,o.safeExecuteInTheMiddle)(()=>{I.responseHook(w,{data:U})},B=>{B&&e.diag.error("Error running response hook",B)},!0)}ge.handleExecutionResult=h;function E(I,w,U,B,F){return function(x,Y){x?(Object.prototype.hasOwnProperty.call(x,"code")&&(B[n.ATTR_ERROR_TYPE]=x.code),x instanceof Error&&w.recordException(C(x)),w.setStatus({code:e.SpanStatusCode.ERROR,message:x.message})):h(I,w,Y),F(),w.end(),U.call(this,x,Y)}}ge.patchCallback=E;function T(I){let w="";return w+=(I?.host?`${I.host}`:"unknown_host")+":",w+=(I?.port?`${I.port}`:"unknown_port")+"/",w+=I?.database?`${I.database}`:"unknown_database",w.trim()}ge.getPoolName=T;function S(I,w,U,B,F){const G=w.totalCount,x=w.waitingCount,Y=w.idleCount,v=G-Y;return U.add(v-F.used,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_USED,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),U.add(Y-F.idle,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),B.add(x-F.pending,{[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),{used:v,idle:Y,pending:x}}ge.updateCounter=S;function g(I,w){return function(B,F,G){B&&(B instanceof Error&&I.recordException(C(B)),I.setStatus({code:e.SpanStatusCode.ERROR,message:B.message})),I.end(),w.call(this,B,F,G)}}ge.patchCallbackPGPool=g;function A(I,w){return function(B){B&&(B instanceof Error&&I.recordException(C(B)),I.setStatus({code:e.SpanStatusCode.ERROR,message:B.message})),I.end(),w.apply(this,arguments)}}ge.patchClientConnectCallback=A;function R(I){return typeof I=="object"&&I!==null&&"message"in I?String(I.message):void 0}ge.getErrorMessage=R;function O(I){return typeof I=="object"&&typeof I?.text=="string"}ge.isObjectWithTextString=O;function C(I){const w=I?.name??"PostgreSQLError",U=I?.code??"UNKNOWN";return`PostgreSQL error of type '${w}' occurred (code: ${U})`}return ge.sanitizedErrorMessage=C,ge}var Br={},FN;function k2(){return FN||(FN=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.PACKAGE_NAME=Br.PACKAGE_VERSION=void 0,Br.PACKAGE_VERSION="0.61.0",Br.PACKAGE_NAME="@opentelemetry/instrumentation-pg"),Br}var YN;function x2(){if(YN)return Ya;YN=1,Object.defineProperty(Ya,"__esModule",{value:!0}),Ya.PgInstrumentation=void 0;const e=Le,t=Pe(),n=D2(),r=U2(),o=Hw(),s=k2(),i=zw(),a=fn,c=pt(),u=Kw();function f(_){return _[Symbol.toStringTag]==="Module"?_.default:_}class d extends e.InstrumentationBase{_connectionsCounter={used:0,idle:0,pending:0};_semconvStability;constructor(p={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,p),this._semconvStability=(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._operationDuration=this.meter.createHistogram(c.METRIC_DB_CLIENT_OPERATION_DURATION,{description:"Duration of database client operations.",unit:"s",valueType:t.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.001,.005,.01,.05,.1,.5,1,5,10]}}),this._connectionsCounter={idle:0,pending:0,used:0},this._connectionsCount=this.meter.createUpDownCounter(u.METRIC_DB_CLIENT_CONNECTION_COUNT,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"}),this._connectionPendingRequests=this.meter.createUpDownCounter(u.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS,{description:"The number of current pending requests for an open connection.",unit:"{connection}"})}init(){const p=[">=8.0.3 <9"],h=[">=2.0.0 <4"],E=new e.InstrumentationNodeModuleFile("pg/lib/native/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),T=new e.InstrumentationNodeModuleFile("pg/lib/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),S=new e.InstrumentationNodeModuleDefinition("pg",p,A=>{const R=f(A);return this._patchPgClient(R.Client),A},A=>{const R=f(A);return this._unpatchPgClient(R.Client),A},[T,E]),g=new e.InstrumentationNodeModuleDefinition("pg-pool",h,A=>{const R=f(A);return(0,e.isWrapped)(R.prototype.connect)&&this._unwrap(R.prototype,"connect"),this._wrap(R.prototype,"connect",this._getPoolConnectPatch()),R},A=>{const R=f(A);(0,e.isWrapped)(R.prototype.connect)&&this._unwrap(R.prototype,"connect")});return[S,g]}_patchPgClient(p){if(!p)return;const h=f(p);return(0,e.isWrapped)(h.prototype.query)&&this._unwrap(h.prototype,"query"),(0,e.isWrapped)(h.prototype.connect)&&this._unwrap(h.prototype,"connect"),this._wrap(h.prototype,"query",this._getClientQueryPatch()),this._wrap(h.prototype,"connect",this._getClientConnectPatch()),p}_unpatchPgClient(p){const h=f(p);return(0,e.isWrapped)(h.prototype.query)&&this._unwrap(h.prototype,"query"),(0,e.isWrapped)(h.prototype.connect)&&this._unwrap(h.prototype,"connect"),p}_getClientConnectPatch(){const p=this;return h=>function(T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.call(this,T);const S=p.tracer.startSpan(i.SpanNames.CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromConnection(this,p._semconvStability)});if(T){const A=t.trace.getSpan(t.context.active());T=r.patchClientConnectCallback(S,T),A&&(T=t.context.bind(t.context.active(),T))}const g=t.context.with(t.trace.setSpan(t.context.active(),S),()=>h.call(this,T));return l(S,g)}}recordOperationDuration(p,h){const E={},T=[c.ATTR_DB_NAMESPACE,c.ATTR_ERROR_TYPE,c.ATTR_SERVER_PORT,c.ATTR_SERVER_ADDRESS,c.ATTR_DB_OPERATION_NAME];this._semconvStability&e.SemconvStability.OLD&&T.push(u.ATTR_DB_SYSTEM),this._semconvStability&e.SemconvStability.STABLE&&T.push(c.ATTR_DB_SYSTEM_NAME),T.forEach(g=>{g in p&&(E[g]=p[g])});const S=(0,a.hrTimeToMilliseconds)((0,a.hrTimeDuration)(h,(0,a.hrTime)()))/1e3;this._operationDuration.record(S,E)}_getClientQueryPatch(){const p=this;return h=>(this._diag.debug("Patching pg.Client.prototype.query"),function(...T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.apply(this,T);const S=(0,a.hrTime)(),g=T[0],A=typeof g=="string",R=r.isObjectWithTextString(g),O=A?{text:g,values:Array.isArray(T[1])?T[1]:void 0}:R?g:void 0,C={[u.ATTR_DB_SYSTEM]:u.DB_SYSTEM_VALUE_POSTGRESQL,[c.ATTR_DB_NAMESPACE]:this.database,[c.ATTR_SERVER_PORT]:this.connectionParameters.port,[c.ATTR_SERVER_ADDRESS]:this.connectionParameters.host};O?.text&&(C[c.ATTR_DB_OPERATION_NAME]=r.parseNormalizedOperationName(O?.text));const I=()=>{p.recordOperationDuration(C,S)},w=p.getConfig(),U=r.handleConfigQuery.call(this,p.tracer,w,p._semconvStability,O);if(w.addSqlCommenterCommentToQueries&&(A?T[0]=(0,o.addSqlCommenterComment)(U,g):R&&!("name"in g)&&(T[0]={...g,text:(0,o.addSqlCommenterComment)(U,g.text)})),T.length>0){const G=t.trace.getSpan(t.context.active());if(typeof T[T.length-1]=="function")T[T.length-1]=r.patchCallback(w,U,T[T.length-1],C,I),G&&(T[T.length-1]=t.context.bind(t.context.active(),T[T.length-1]));else if(typeof O?.callback=="function"){let x=r.patchCallback(p.getConfig(),U,O.callback,C,I);G&&(x=t.context.bind(t.context.active(),x)),T[0].callback=x}}const{requestHook:B}=w;typeof B=="function"&&O&&(0,e.safeExecuteInTheMiddle)(()=>{const{database:G,host:x,port:Y,user:v}=this.connectionParameters;B(U,{connection:{database:G,host:x,port:Y,user:v},query:{text:O.text,values:O.values,name:O.name}})},G=>{G&&p._diag.error("Error running query hook",G)},!0);let F;try{F=h.apply(this,T)}catch(G){throw G instanceof Error&&U.recordException(r.sanitizedErrorMessage(G)),U.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage(G)}),U.end(),G}return F instanceof Promise?F.then(G=>new Promise(x=>{r.handleExecutionResult(p.getConfig(),U,G),I(),U.end(),x(G)})).catch(G=>new Promise((x,Y)=>{G instanceof Error&&U.recordException(r.sanitizedErrorMessage(G)),U.setStatus({code:t.SpanStatusCode.ERROR,message:G.message}),I(),U.end(),Y(G)})):F})}_setPoolConnectEventListeners(p){if(p[n.EVENT_LISTENERS_SET])return;const h=r.getPoolName(p.options);p.on("connect",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("acquire",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("remove",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("release",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p[n.EVENT_LISTENERS_SET]=!0}_getPoolConnectPatch(){const p=this;return h=>function(T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.call(this,T);const S=p.tracer.startSpan(i.SpanNames.POOL_CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromPoolConnection(this.options,p._semconvStability)});if(p._setPoolConnectEventListeners(this),T){const A=t.trace.getSpan(t.context.active());T=r.patchCallbackPGPool(S,T),A&&(T=t.context.bind(t.context.active(),T))}const g=t.context.with(t.trace.setSpan(t.context.active(),S),()=>h.call(this,T));return l(S,g)}}}Ya.PgInstrumentation=d;function l(_,p){if(!(p instanceof Promise))return p;const h=p;return t.context.bind(t.context.active(),h.then(E=>(_.end(),E)).catch(E=>(E instanceof Error&&_.recordException(r.sanitizedErrorMessage(E)),_.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage(E)}),_.end(),Promise.reject(E))))}return Ya}var jN;function G2(){return jN||(jN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.PgInstrumentation=void 0;var t=x2();Object.defineProperty(e,"PgInstrumentation",{enumerable:!0,get:function(){return t.PgInstrumentation}});var n=Ww();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(wf)),wf}var V2=G2();const Zw="Postgres",$2=Ne(Zw,()=>new V2.PgInstrumentation({requireParentSpan:!0,requestHook(e){Ot(e,"auto.db.otel.postgres")}})),B2=(()=>({name:Zw,setupOnce(){$2()}})),H2=B2,QE="PostgresJs",qN=[">=3.0.0 <4"],F2=Ne(QE,e=>new Y2({requireParentSpan:e?.requireParentSpan??!0,requestHook:e?.requestHook}));class Y2 extends bt{constructor(t){super("sentry-postgres-js",Qe,t)}init(){const t=new ft("postgres",qN);return["src","cf/src","cjs/src"].forEach(n=>{t.files.push(new qn(`postgres/${n}/connection.js`,["*"],this._patchConnection.bind(this),this._unwrap.bind(this))),t.files.push(new qn(`postgres/${n}/query.js`,qN,this._patchQuery.bind(this),this._unwrap.bind(this)))}),[t]}_shouldCreateSpans(){const t=this.getConfig();return b.trace.getSpan(b.context.active())!==void 0||!t.requireParentSpan}_patchReject(t,n){return new Proxy(t,{apply:(r,o,s)=>{n.setStatus({code:Ae,message:s?.[0]?.message||"internal_error"});const i=Reflect.apply(r,o,s);return n.setAttribute(Q.ATTR_DB_RESPONSE_STATUS_CODE,s?.[0]?.code||"Unknown error"),n.setAttribute(Q.ATTR_ERROR_TYPE,s?.[0]?.name||"Unknown error"),n.end(),i}})}_patchResolve(t,n){return new Proxy(t,{apply:(r,o,s)=>{const i=Reflect.apply(r,o,s),a=s?.[0]?.command;return a&&n.setAttribute(Q.ATTR_DB_OPERATION_NAME,a),n.end(),i}})}_patchQuery(t){return t.Query.prototype.handle=new Proxy(t.Query.prototype.handle,{apply:async(n,r,o)=>{if(!this._shouldCreateSpans())return Reflect.apply(n,r,o);const s=this._sanitizeSqlQuery(r.strings?.[0]);return Hn({name:s||"postgresjs.query",op:"db"},i=>{const c=ze().getScopeData().contexts.postgresjsConnection;Ot(i,"auto.db.otel.postgres");const{requestHook:u}=this.getConfig();u&&cr(()=>u(i,s,c),_=>{_&&j.error(`Error in requestHook for ${QE} integration:`,_)});const f=c?.ATTR_DB_NAMESPACE||"<unknown database>",d=c?.ATTR_SERVER_ADDRESS||"<unknown host>",l=c?.ATTR_SERVER_PORT||"<unknown port>";i.setAttribute(Q.ATTR_DB_SYSTEM_NAME,"postgres"),i.setAttribute(Q.ATTR_DB_NAMESPACE,f),i.setAttribute(Q.ATTR_SERVER_ADDRESS,d),i.setAttribute(Q.ATTR_SERVER_PORT,l),i.setAttribute(Q.ATTR_DB_QUERY_TEXT,s),r.resolve=this._patchResolve(r.resolve,i),r.reject=this._patchReject(r.reject,i);try{return Reflect.apply(n,r,o)}catch(_){throw i.setStatus({code:Ae}),i.end(),_}})}}),t}_patchConnection(t){return new Proxy(t,{apply:(n,r,o)=>{const s=o[0]?.database||"<unknown database>",i=o[0]?.host?.[0]||"<unknown host>",a=o[0]?.port?.[0]||"<unknown port>";return ze().setContext("postgresjsConnection",{ATTR_DB_NAMESPACE:s,ATTR_SERVER_ADDRESS:i,ATTR_SERVER_PORT:a}),Reflect.apply(n,r,o)}})}_sanitizeSqlQuery(t){return t?t.replace(/\s+/g," ").trim().substring(0,1024).replace(/--.*?(\r?\n|$)/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/;\s*$/,"").replace(/\b\d+\b/g,"?").replace(/\s+/g," ").replace(/\bIN\b\s*\(\s*\?(?:\s*,\s*\?)*\s*\)/g,"IN (?)"):"Unknown SQL Query"}}const j2=(()=>({name:QE,setupOnce(){F2()}})),q2=j2;var W2=process.env.PRISMA_SHOW_ALL_TRACES==="true",K2="00-10-10-00";function z2(e){switch(e){case"client":return b.SpanKind.CLIENT;case"internal":default:return b.SpanKind.INTERNAL}}var Z2=class{tracerProvider;ignoreSpanTypes;constructor({tracerProvider:e,ignoreSpanTypes:t}){this.tracerProvider=e,this.ignoreSpanTypes=t}isEnabled(){return!0}getTraceParent(e){const t=b.trace.getSpanContext(e??b.context.active());return t?`00-${t.traceId}-${t.spanId}-0${t.traceFlags}`:K2}dispatchEngineSpans(e){const t=this.tracerProvider.getTracer("prisma"),n=new Map,r=e.filter(o=>o.parentId===null);for(const o of r)Xw(t,o,e,n,this.ignoreSpanTypes)}getActiveContext(){return b.context.active()}runInChildSpan(e,t){if(typeof e=="string"&&(e={name:e}),e.internal&&!W2)return t();const n=this.tracerProvider.getTracer("prisma"),r=e.context??this.getActiveContext(),o=`prisma:client:${e.name}`;if(Qw(o,this.ignoreSpanTypes))return t();if(e.active===!1){const s=n.startSpan(o,e,r);return WN(s,t(s,r))}return n.startActiveSpan(o,e,s=>WN(s,t(s,r)))}};function Xw(e,t,n,r,o){if(Qw(t.name,o))return;const s={attributes:t.attributes,kind:z2(t.kind),startTime:t.startTime};e.startActiveSpan(t.name,s,i=>{r.set(t.id,i.spanContext().spanId),t.links&&i.addLinks(t.links.flatMap(c=>{const u=r.get(c);return u?{context:{spanId:u,traceId:i.spanContext().traceId,traceFlags:i.spanContext().traceFlags}}:[]}));const a=n.filter(c=>c.parentId===t.id);for(const c of a)Xw(e,c,n,r,o);i.end(t.endTime)})}function WN(e,t){return X2(t)?t.then(n=>(e.end(),n),n=>{throw e.end(),n}):(e.end(),t)}function X2(e){return e!=null&&typeof e.then=="function"}function Qw(e,t){return t.some(n=>typeof n=="string"?n===e:n.test(e))}var Jw={name:"@prisma/instrumentation",version:"6.19.0"},Ih=Jw.version,Q2=Ih.split(".")[0],KN="PRISMA_INSTRUMENTATION",Uf=`V${Q2}_PRISMA_INSTRUMENTATION`,J2=Jw.name,ez="@prisma/client",tz=class extends bt{tracerProvider;constructor(e={}){super(J2,Ih,e)}setTracerProvider(e){this.tracerProvider=e}init(){return[new ft(ez,[Ih])]}enable(){const e=this._config,t={helper:new Z2({tracerProvider:this.tracerProvider??b.trace.getTracerProvider(),ignoreSpanTypes:e.ignoreSpanTypes??[]})};global[KN]=t,global[Uf]=t}disable(){delete global[KN],delete global[Uf]}isEnabled(){return!!global[Uf]}};const eL="Prisma";function nz(e){return!!e&&typeof e=="object"&&"dispatchEngineSpans"in e}function tL(){const e=globalThis.PRISMA_INSTRUMENTATION;return e&&typeof e=="object"&&"helper"in e?e.helper:void 0}class rz extends tz{constructor(){super()}enable(){super.enable();const t=tL();nz(t)&&(t.createEngineSpan=n=>{const r=b.trace.getTracer("prismaV5Compatibility"),o=r._idGenerator;if(!o){cn(()=>{console.warn("[Sentry] Could not find _idGenerator on tracer, skipping Prisma v5 compatibility - some Prisma spans may be missing!")});return}try{n.spans.forEach(s=>{const i=oz(s.kind),a=s.parent_span_id,c=s.span_id,u=s.trace_id,f=s.links?.map(l=>({context:{traceId:l.trace_id,spanId:l.span_id,traceFlags:b.TraceFlags.SAMPLED}})),d=b.trace.setSpanContext(b.context.active(),{traceId:u,spanId:a,traceFlags:b.TraceFlags.SAMPLED});b.context.with(d,()=>{const l={generateTraceId:()=>u,generateSpanId:()=>c};r._idGenerator=l,r.startSpan(s.name,{kind:i,links:f,startTime:s.start_time,attributes:s.attributes}).end(s.end_time),r._idGenerator=o})})}finally{r._idGenerator=o}})}}function oz(e){switch(e){case"client":return b.SpanKind.CLIENT;case"internal":default:return b.SpanKind.INTERNAL}}const sz=Ne(eL,e=>new rz),iz=e=>({name:eL,setupOnce(){sz()},setup(t){tL()&&t.on("spanStart",n=>{const r=ye(n);r.description?.startsWith("prisma:")&&n.setAttribute(xe,"auto.db.otel.prisma"),r.description==="prisma:engine:db_query"&&r.data["db.query.text"]&&n.updateName(r.data["db.query.text"]),r.description==="prisma:engine:db_query"&&!r.data["db.system"]&&n.setAttribute("db.system","prisma")})}});var kf={},qa={},Hr={},zN;function az(){return zN||(zN=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.PACKAGE_NAME=Hr.PACKAGE_VERSION=void 0,Hr.PACKAGE_VERSION="0.55.0",Hr.PACKAGE_NAME="@opentelemetry/instrumentation-hapi"),Hr}var rn={},ZN;function nL(){return ZN||(ZN=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.HapiLifecycleMethodNames=rn.HapiLayerType=rn.handlerPatched=rn.HapiComponentName=void 0,rn.HapiComponentName="@hapi/hapi",rn.handlerPatched=Symbol("hapi-handler-patched"),rn.HapiLayerType={ROUTER:"router",PLUGIN:"plugin",EXT:"server.ext"},rn.HapiLifecycleMethodNames=new Set(["onPreAuth","onCredentials","onPostAuth","onPreHandler","onPostHandler","onPreResponse","onRequest"])),rn}var xf={},Wa={},XN;function cz(){return XN||(XN=1,Object.defineProperty(Wa,"__esModule",{value:!0}),Wa.ATTR_HTTP_METHOD=void 0,Wa.ATTR_HTTP_METHOD="http.method"),Wa}var Gf={},QN;function rL(){return QN||(QN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HAPI_TYPE="hapi.type",t.PLUGIN_NAME="hapi.plugin.name",t.EXT_TYPE="server.ext.type"})(e.AttributeNames||(e.AttributeNames={}))})(Gf)),Gf}var JN;function uz(){return JN||(JN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPluginFromInput=e.getExtMetadata=e.getRouteMetadata=e.isPatchableExtMethod=e.isDirectExtInput=e.isLifecycleExtEventObj=e.isLifecycleExtType=e.getPluginName=void 0;const t=pt(),n=cz(),r=nL(),o=rL(),s=Le;function i(p){return p.name?p.name:p.pkg.name}e.getPluginName=i;const a=p=>typeof p=="string"&&r.HapiLifecycleMethodNames.has(p);e.isLifecycleExtType=a;const c=p=>{const h=p?.type;return h!==void 0&&(0,e.isLifecycleExtType)(h)};e.isLifecycleExtEventObj=c;const u=p=>Array.isArray(p)&&p.length<=3&&(0,e.isLifecycleExtType)(p[0])&&typeof p[1]=="function";e.isDirectExtInput=u;const f=p=>!Array.isArray(p);e.isPatchableExtMethod=f;const d=(p,h,E)=>{const T={[t.ATTR_HTTP_ROUTE]:p.path};h&s.SemconvStability.OLD&&(T[n.ATTR_HTTP_METHOD]=p.method),h&s.SemconvStability.STABLE&&(T[t.ATTR_HTTP_REQUEST_METHOD]=p.method);let S;return E?(T[o.AttributeNames.HAPI_TYPE]=r.HapiLayerType.PLUGIN,T[o.AttributeNames.PLUGIN_NAME]=E,S=`${E}: route - ${p.path}`):(T[o.AttributeNames.HAPI_TYPE]=r.HapiLayerType.ROUTER,S=`route - ${p.path}`),{attributes:T,name:S}};e.getRouteMetadata=d;const l=(p,h)=>h?{attributes:{[o.AttributeNames.EXT_TYPE]:p,[o.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT,[o.AttributeNames.PLUGIN_NAME]:h},name:`${h}: ext - ${p}`}:{attributes:{[o.AttributeNames.EXT_TYPE]:p,[o.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT},name:`ext - ${p}`};e.getExtMetadata=l;const _=p=>"plugin"in p?"plugin"in p.plugin?p.plugin.plugin:p.plugin:p;e.getPluginFromInput=_})(xf)),xf}var eO;function lz(){if(eO)return qa;eO=1,Object.defineProperty(qa,"__esModule",{value:!0}),qa.HapiInstrumentation=void 0;const e=Pe(),t=fn,n=Le,r=az(),o=nL(),s=uz();class i extends n.InstrumentationBase{_semconvStability;constructor(c={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,c),this._semconvStability=(0,n.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return new n.InstrumentationNodeModuleDefinition(o.HapiComponentName,[">=17.0.0 <22"],c=>{const u=c[Symbol.toStringTag]==="Module"?c.default:c;return(0,n.isWrapped)(u.server)||this._wrap(u,"server",this._getServerPatch.bind(this)),(0,n.isWrapped)(u.Server)||this._wrap(u,"Server",this._getServerPatch.bind(this)),u},c=>{const u=c[Symbol.toStringTag]==="Module"?c.default:c;this._massUnwrap([u],["server","Server"])})}_getServerPatch(c){const u=this,f=this;return function(l){const _=c.apply(this,[l]);return f._wrap(_,"route",p=>u._getServerRoutePatch.bind(u)(p)),f._wrap(_,"ext",p=>u._getServerExtPatch.bind(u)(p)),f._wrap(_,"register",u._getServerRegisterPatch.bind(u)),_}}_getServerRegisterPatch(c){const u=this;return function(d,l){if(Array.isArray(d))for(const _ of d){const p=(0,s.getPluginFromInput)(_);u._wrapRegisterHandler(p)}else{const _=(0,s.getPluginFromInput)(d);u._wrapRegisterHandler(_)}return c.apply(this,[d,l])}}_getServerExtPatch(c,u){const f=this;return function(...l){if(Array.isArray(l[0])){const _=l[0];for(let p=0;p<_.length;p++){const h=_[p];if((0,s.isLifecycleExtType)(h.type)){const E=h,T=f._wrapExtMethods(E.method,h.type,u);E.method=T,_[p]=E}}return c.apply(this,l)}else if((0,s.isDirectExtInput)(l)){const _=l,p=_[1],h=f._wrapExtMethods(p,_[0],u);return c.apply(this,[_[0],h,_[2]])}else if((0,s.isLifecycleExtEventObj)(l[0])){const _=l[0],p=f._wrapExtMethods(_.method,_.type,u);return _.method=p,c.call(this,_)}return c.apply(this,l)}}_getServerRoutePatch(c,u){const f=this;return function(d){if(Array.isArray(d))for(let l=0;l<d.length;l++){const _=f._wrapRouteHandler.call(f,d[l],u);d[l]=_}else d=f._wrapRouteHandler.call(f,d,u);return c.apply(this,[d])}}_wrapRegisterHandler(c){const u=this,f=(0,s.getPluginName)(c),d=c.register,l=this,_=function(p,h){return l._wrap(p,"route",E=>u._getServerRoutePatch.bind(u)(E,f)),l._wrap(p,"ext",E=>u._getServerExtPatch.bind(u)(E,f)),d.call(this,p,h)};c.register=_}_wrapExtMethods(c,u,f){const d=this;if(c instanceof Array){for(let l=0;l<c.length;l++)c[l]=d._wrapExtMethods(c[l],u);return c}else if((0,s.isPatchableExtMethod)(c))return c[o.handlerPatched]===!0?c:(c[o.handlerPatched]=!0,async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await c.apply(this,_);const p=(0,s.getExtMetadata)(u,f),h=d.tracer.startSpan(p.name,{attributes:p.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),h),c,void 0,..._)}catch(E){throw h.recordException(E),h.setStatus({code:e.SpanStatusCode.ERROR,message:E.message}),E}finally{h.end()}});return c}_wrapRouteHandler(c,u){const f=this;if(c[o.handlerPatched]===!0)return c;c[o.handlerPatched]=!0;const d=l=>async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await l.call(this,..._);const p=(0,t.getRPCMetadata)(e.context.active());p?.type===t.RPCType.HTTP&&(p.route=c.path);const h=(0,s.getRouteMetadata)(c,f._semconvStability,u),E=f.tracer.startSpan(h.name,{attributes:h.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),E),()=>l.call(this,..._))}catch(T){throw E.recordException(T),E.setStatus({code:e.SpanStatusCode.ERROR,message:T.message}),T}finally{E.end()}};if(typeof c.handler=="function")c.handler=d(c.handler);else if(typeof c.options=="function"){const l=c.options;c.options=function(_){const p=l(_);return typeof p.handler=="function"&&(p.handler=d(p.handler)),p}}else typeof c.options?.handler=="function"&&(c.options.handler=d(c.options.handler));return c}}return qa.HapiInstrumentation=i,qa}var tO;function dz(){return tO||(tO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.HapiInstrumentation=void 0;var t=lz();Object.defineProperty(e,"HapiInstrumentation",{enumerable:!0,get:function(){return t.HapiInstrumentation}});var n=rL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(kf)),kf}var fz=dz();const oL="Hapi",_z=Ne(oL,()=>new fz.HapiInstrumentation),pz=(()=>({name:oL,setupOnce(){_z()}})),hz=pz,Vo={HONO_TYPE:"hono.type",HONO_NAME:"hono.name"},au={MIDDLEWARE:"middleware",REQUEST_HANDLER:"request_handler"},Ez="@sentry/instrumentation-hono",Tz="0.0.1";class Sz extends bt{constructor(t={}){super(Ez,Tz,t)}init(){return[new ft("hono",[">=4.0.0 <5"],t=>this._patch(t))]}_patch(t){const n=this;class r extends t.Hono{constructor(...s){super(...s),n._wrap(this,"get",n._patchHandler()),n._wrap(this,"post",n._patchHandler()),n._wrap(this,"put",n._patchHandler()),n._wrap(this,"delete",n._patchHandler()),n._wrap(this,"options",n._patchHandler()),n._wrap(this,"patch",n._patchHandler()),n._wrap(this,"all",n._patchHandler()),n._wrap(this,"on",n._patchOnHandler()),n._wrap(this,"use",n._patchMiddlewareHandler())}}try{t.Hono=r}catch{return{...t,Hono:r}}return t}_patchHandler(){const t=this;return function(n){return function(...o){if(typeof o[0]=="string"){const s=o[0];if(o.length===1)return n.apply(this,[s]);const i=o.slice(1);return n.apply(this,[s,...i.map(a=>t._wrapHandler(a))])}return n.apply(this,o.map(s=>t._wrapHandler(s)))}}}_patchOnHandler(){const t=this;return function(n){return function(...o){const s=o.slice(2);return n.apply(this,[...o.slice(0,2),...s.map(i=>t._wrapHandler(i))])}}}_patchMiddlewareHandler(){const t=this;return function(n){return function(...o){if(typeof o[0]=="string"){const s=o[0];if(o.length===1)return n.apply(this,[s]);const i=o.slice(1);return n.apply(this,[s,...i.map(a=>t._wrapHandler(a))])}return n.apply(this,o.map(s=>t._wrapHandler(s)))}}}_wrapHandler(t){const n=this;return function(r,o){if(!n.isEnabled())return t.apply(this,[r,o]);const s=r.req.path,i=n.tracer.startSpan(s);return b.context.with(b.trace.setSpan(b.context.active(),i),()=>n._safeExecute(()=>{const a=t.apply(this,[r,o]);if(ur(a))return a.then(c=>{const u=n._determineHandlerType(c);return i.setAttributes({[Vo.HONO_TYPE]:u,[Vo.HONO_NAME]:u===au.REQUEST_HANDLER?s:t.name||"anonymous"}),n.getConfig().responseHook?.(i),c});{const c=n._determineHandlerType(a);return i.setAttributes({[Vo.HONO_TYPE]:c,[Vo.HONO_NAME]:c===au.REQUEST_HANDLER?s:t.name||"anonymous"}),n.getConfig().responseHook?.(i),a}},()=>i.end(),a=>{n._handleError(i,a),i.end()}))}}_safeExecute(t,n,r){try{const o=t();return ur(o)?o.then(()=>n(),s=>r(s)):n(),o}catch(o){throw r(o),o}}_determineHandlerType(t){return t===void 0?au.MIDDLEWARE:au.REQUEST_HANDLER}_handleError(t,n){n instanceof Error&&(t.setStatus({code:b.SpanStatusCode.ERROR,message:n.message}),t.recordException(n))}}const sL="Hono";function mz(e){const t=ye(e).data,n=t[Vo.HONO_TYPE];if(t[Ee]||!n)return;e.setAttributes({[xe]:"auto.http.otel.hono",[Ee]:`${n}.hono`});const r=t[Vo.HONO_NAME];if(typeof r=="string"&&e.updateName(r),je()===ds()){ho&&j.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const o=t[Q.ATTR_HTTP_ROUTE],s=t[Q.ATTR_HTTP_REQUEST_METHOD];typeof o=="string"&&typeof s=="string"&&je().setTransactionName(`${s} ${o}`)}const gz=Ne(sL,()=>new Sz({responseHook:e=>{mz(e)}})),Az=(()=>({name:sL,setupOnce(){gz()}})),Rz=Az;var Vf={},Ka={},$f={},nO;function JE(){return nO||(nO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware"})(e.KoaLayerType||(e.KoaLayerType={}))})($f)),$f}var Fr={},rO;function yz(){return rO||(rO=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.PACKAGE_NAME=Fr.PACKAGE_VERSION=void 0,Fr.PACKAGE_VERSION="0.57.0",Fr.PACKAGE_NAME="@opentelemetry/instrumentation-koa"),Fr}var Yr={},Bf={},oO;function iL(){return oO||(oO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.KOA_TYPE="koa.type",t.KOA_NAME="koa.name"})(e.AttributeNames||(e.AttributeNames={}))})(Bf)),Bf}var sO;function Nz(){if(sO)return Yr;sO=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.isLayerIgnored=Yr.getMiddlewareMetadata=void 0;const e=JE(),t=iL(),n=pt(),r=(s,i,a,c)=>a?{attributes:{[t.AttributeNames.KOA_NAME]:c?.toString(),[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.ROUTER,[n.ATTR_HTTP_ROUTE]:c?.toString()},name:s._matchedRouteName||`router - ${c}`}:{attributes:{[t.AttributeNames.KOA_NAME]:i.name??"middleware",[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.MIDDLEWARE},name:`middleware - ${i.name}`};Yr.getMiddlewareMetadata=r;const o=(s,i)=>!!(Array.isArray(i?.ignoreLayersType)&&i?.ignoreLayersType?.includes(s));return Yr.isLayerIgnored=o,Yr}var za={},iO;function Oz(){return iO||(iO=1,Object.defineProperty(za,"__esModule",{value:!0}),za.kLayerPatched=void 0,za.kLayerPatched=Symbol("koa-layer-patched")),za}var aO;function bz(){if(aO)return Ka;aO=1,Object.defineProperty(Ka,"__esModule",{value:!0}),Ka.KoaInstrumentation=void 0;const e=Pe(),t=Le,n=JE(),r=yz(),o=Nz(),s=fn,i=Oz();class a extends t.InstrumentationBase{constructor(u={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,u)}init(){return new t.InstrumentationNodeModuleDefinition("koa",[">=2.0.0 <4"],u=>{const f=u[Symbol.toStringTag]==="Module"?u.default:u;return f==null?f:((0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use"),this._wrap(f.prototype,"use",this._getKoaUsePatch.bind(this)),u)},u=>{const f=u[Symbol.toStringTag]==="Module"?u.default:u;(0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use")})}_getKoaUsePatch(u){const f=this;return function(l){let _;return l.router?_=f._patchRouterDispatch(l):_=f._patchLayer(l,!1),u.apply(this,[_])}}_patchRouterDispatch(u){e.diag.debug("Patching @koa/router dispatch");const d=u.router?.stack??[];for(const l of d){const _=l.path,p=l.stack;for(let h=0;h<p.length;h++){const E=p[h];p[h]=this._patchLayer(E,!0,_)}}return u}_patchLayer(u,f,d){const l=f?n.KoaLayerType.ROUTER:n.KoaLayerType.MIDDLEWARE;return u[i.kLayerPatched]===!0||(0,o.isLayerIgnored)(l,this.getConfig())?u:u.constructor.name==="GeneratorFunction"||u.constructor.name==="AsyncGeneratorFunction"?(e.diag.debug("ignoring generator-based Koa middleware layer"),u):(u[i.kLayerPatched]=!0,e.diag.debug("patching Koa middleware layer"),async(_,p)=>{if(e.trace.getSpan(e.context.active())===void 0)return u(_,p);const E=(0,o.getMiddlewareMetadata)(_,u,f,d),T=this.tracer.startSpan(E.name,{attributes:E.attributes}),S=(0,s.getRPCMetadata)(e.context.active());S?.type===s.RPCType.HTTP&&_._matchedRoute&&(S.route=_._matchedRoute.toString());const{requestHook:g}=this.getConfig();g&&(0,t.safeExecuteInTheMiddle)(()=>g(T,{context:_,middlewareLayer:u,layerType:l}),R=>{R&&e.diag.error("koa instrumentation: request hook failed",R)},!0);const A=e.trace.setSpan(e.context.active(),T);return e.context.with(A,async()=>{try{return await u(_,p)}catch(R){throw T.recordException(R),R}finally{T.end()}})})}}return Ka.KoaInstrumentation=a,Ka}var cO;function Cz(){return cO||(cO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=e.AttributeNames=e.KoaInstrumentation=void 0;var t=bz();Object.defineProperty(e,"KoaInstrumentation",{enumerable:!0,get:function(){return t.KoaInstrumentation}});var n=iL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}});var r=JE();Object.defineProperty(e,"KoaLayerType",{enumerable:!0,get:function(){return r.KoaLayerType}})})(Vf)),Vf}var Iz=Cz();const aL="Koa",Pz=Ne(aL,Iz.KoaInstrumentation,(e={})=>({ignoreLayersType:e.ignoreLayersType,requestHook(t,n){Ot(t,"auto.http.otel.koa");const r=ye(t).data,o=r["koa.type"];o&&t.setAttribute(Ee,`${o}.koa`);const s=r["koa.name"];if(typeof s=="string"&&t.updateName(s||"< unknown >"),je()===ds()){ho&&j.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const i=r[Q.ATTR_HTTP_ROUTE],a=n.context?.request?.method?.toUpperCase()||"GET";i&&je().setTransactionName(`${a} ${i}`)}})),Mz=((e={})=>({name:aL,setupOnce(){Pz(e)}})),vz=Mz;var Hf={},Ff={},Yf={},uO;function cL(){return uO||(uO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectNames=e.ConnectTypes=e.AttributeNames=void 0,(function(t){t.CONNECT_TYPE="connect.type",t.CONNECT_NAME="connect.name"})(e.AttributeNames||(e.AttributeNames={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ConnectTypes||(e.ConnectTypes={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request handler"})(e.ConnectNames||(e.ConnectNames={}))})(Yf)),Yf}var jr={},lO;function wz(){return lO||(lO=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.PACKAGE_NAME=jr.PACKAGE_VERSION=void 0,jr.PACKAGE_VERSION="0.52.0",jr.PACKAGE_NAME="@opentelemetry/instrumentation-connect"),jr}var Dn={},Za={},dO;function Lz(){return dO||(dO=1,Object.defineProperty(Za,"__esModule",{value:!0}),Za._LAYERS_STORE_PROPERTY=void 0,Za._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack")),Za}var fO;function Dz(){if(fO)return Dn;fO=1,Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.generateRoute=Dn.replaceCurrentStackRoute=Dn.addNewStackLayer=void 0;const e=Pe(),t=Lz(),n=s=>{Array.isArray(s[t._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(s,t._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),s[t._LAYERS_STORE_PROPERTY].push("/");const i=s[t._LAYERS_STORE_PROPERTY].length;return()=>{i===s[t._LAYERS_STORE_PROPERTY].length?s[t._LAYERS_STORE_PROPERTY].pop():e.diag.warn("Connect: Trying to pop the stack multiple time")}};Dn.addNewStackLayer=n;const r=(s,i)=>{i&&s[t._LAYERS_STORE_PROPERTY].splice(-1,1,i)};Dn.replaceCurrentStackRoute=r;const o=s=>s[t._LAYERS_STORE_PROPERTY].reduce((i,a)=>i.replace(/\/+$/,"")+a);return Dn.generateRoute=o,Dn}var _O;function Uz(){return _O||(_O=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectInstrumentation=e.ANONYMOUS_NAME=void 0;const t=Pe(),n=fn,r=cL(),o=wz(),s=Le,i=pt(),a=Dz();e.ANONYMOUS_NAME="anonymous";class c extends s.InstrumentationBase{constructor(f={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,f)}init(){return[new s.InstrumentationNodeModuleDefinition("connect",[">=3.0.0 <4"],f=>this._patchConstructor(f))]}_patchApp(f){(0,s.isWrapped)(f.use)||this._wrap(f,"use",this._patchUse.bind(this)),(0,s.isWrapped)(f.handle)||this._wrap(f,"handle",this._patchHandle.bind(this))}_patchConstructor(f){const d=this;return function(...l){const _=f.apply(this,l);return d._patchApp(_),_}}_patchNext(f,d){return function(_){const p=f.apply(this,[_]);return d(),p}}_startSpan(f,d){let l,_,p;f?(l=r.ConnectTypes.REQUEST_HANDLER,p=r.ConnectNames.REQUEST_HANDLER,_=f):(l=r.ConnectTypes.MIDDLEWARE,p=r.ConnectNames.MIDDLEWARE,_=d.name||e.ANONYMOUS_NAME);const h=`${p} - ${_}`,E={attributes:{[i.ATTR_HTTP_ROUTE]:f.length>0?f:"/",[r.AttributeNames.CONNECT_TYPE]:l,[r.AttributeNames.CONNECT_NAME]:_}};return this.tracer.startSpan(h,E)}_patchMiddleware(f,d){const l=this,_=d.length===4;function p(){if(!l.isEnabled())return d.apply(this,arguments);const[h,E,T]=_?[1,2,3]:[0,1,2],S=arguments[h],g=arguments[E],A=arguments[T];(0,a.replaceCurrentStackRoute)(S,f);const R=(0,n.getRPCMetadata)(t.context.active());f&&R?.type===n.RPCType.HTTP&&(R.route=(0,a.generateRoute)(S));let O="";f?O=`request handler - ${f}`:O=`middleware - ${d.name||e.ANONYMOUS_NAME}`;const C=l._startSpan(f,d);l._diag.debug("start span",O);let I=!1;function w(){I?l._diag.debug(`span ${C.name} - already finished`):(I=!0,l._diag.debug(`finishing span ${C.name}`),C.end()),g.removeListener("close",w)}return g.addListener("close",w),arguments[T]=l._patchNext(A,w),d.apply(this,arguments)}return Object.defineProperty(p,"length",{value:d.length,writable:!1,configurable:!0}),p}_patchUse(f){const d=this;return function(...l){const _=l[l.length-1],p=l[l.length-2]||"";return l[l.length-1]=d._patchMiddleware(p,_),f.apply(this,l)}}_patchHandle(f){const d=this;return function(){const[l,_]=[0,2],p=arguments[l],h=arguments[_],E=(0,a.addNewStackLayer)(p);return typeof h=="function"&&(arguments[_]=d._patchOut(h,E)),f.apply(this,arguments)}}_patchOut(f,d){return function(..._){return d(),Reflect.apply(f,this,_)}}}e.ConnectInstrumentation=c})(Ff)),Ff}var pO;function kz(){return pO||(pO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectTypes=e.ConnectNames=e.AttributeNames=e.ANONYMOUS_NAME=e.ConnectInstrumentation=void 0;var t=Uz();Object.defineProperty(e,"ConnectInstrumentation",{enumerable:!0,get:function(){return t.ConnectInstrumentation}}),Object.defineProperty(e,"ANONYMOUS_NAME",{enumerable:!0,get:function(){return t.ANONYMOUS_NAME}});var n=cL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}}),Object.defineProperty(e,"ConnectNames",{enumerable:!0,get:function(){return n.ConnectNames}}),Object.defineProperty(e,"ConnectTypes",{enumerable:!0,get:function(){return n.ConnectTypes}})})(Hf)),Hf}var xz=kz();const uL="Connect",Gz=Ne(uL,()=>new xz.ConnectInstrumentation),Vz=(()=>({name:uL,setupOnce(){Gz()}})),$z=Vz;var jf={},qf={},nt={},hO;function Bz(){return hO||(hO=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.DB_SYSTEM_VALUE_MSSQL=nt.ATTR_NET_PEER_PORT=nt.ATTR_NET_PEER_NAME=nt.ATTR_DB_USER=nt.ATTR_DB_SYSTEM=nt.ATTR_DB_STATEMENT=nt.ATTR_DB_SQL_TABLE=nt.ATTR_DB_NAME=void 0,nt.ATTR_DB_NAME="db.name",nt.ATTR_DB_SQL_TABLE="db.sql.table",nt.ATTR_DB_STATEMENT="db.statement",nt.ATTR_DB_SYSTEM="db.system",nt.ATTR_DB_USER="db.user",nt.ATTR_NET_PEER_NAME="net.peer.name",nt.ATTR_NET_PEER_PORT="net.peer.port",nt.DB_SYSTEM_VALUE_MSSQL="mssql"),nt}var qr={},EO;function Hz(){if(EO)return qr;EO=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.once=qr.getSpanName=void 0;function e(n,r,o,s){return n==="execBulkLoad"&&s&&r?`${n} ${s} ${r}`:n==="callProcedure"?r?`${n} ${o} ${r}`:`${n} ${o}`:r?`${n} ${r}`:`${n}`}qr.getSpanName=e;const t=n=>{let r=!1;return(...o)=>{if(!r)return r=!0,n(...o)}};return qr.once=t,qr}var Wr={},TO;function Fz(){return TO||(TO=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.PACKAGE_NAME=Wr.PACKAGE_VERSION=void 0,Wr.PACKAGE_VERSION="0.27.0",Wr.PACKAGE_NAME="@opentelemetry/instrumentation-tedious"),Wr}var SO;function Yz(){return SO||(SO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=e.INJECTED_CTX=void 0;const t=Pe(),n=wc,r=Le,o=Bz(),s=Hz(),i=Fz(),a=Symbol("opentelemetry.instrumentation-tedious.current-database");e.INJECTED_CTX=Symbol("opentelemetry.instrumentation-tedious.context-info-injected");const c=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function u(d){Object.defineProperty(this,a,{value:d,writable:!0})}class f extends r.InstrumentationBase{static COMPONENT="tedious";constructor(l={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,l)}init(){return[new r.InstrumentationNodeModuleDefinition(f.COMPONENT,[">=1.11.0 <20"],l=>{const _=l.Connection.prototype;for(const p of c)(0,r.isWrapped)(_[p])&&this._unwrap(_,p),this._wrap(_,p,this._patchQuery(p,l));return(0,r.isWrapped)(_.connect)&&this._unwrap(_,"connect"),this._wrap(_,"connect",this._patchConnect),l},l=>{if(l===void 0)return;const _=l.Connection.prototype;for(const p of c)this._unwrap(_,p);this._unwrap(_,"connect")})]}_patchConnect(l){return function(){return u.call(this,this.config?.options?.database),this.removeListener("databaseChange",u),this.on("databaseChange",u),this.once("end",()=>{this.removeListener("databaseChange",u)}),l.apply(this,arguments)}}_buildTraceparent(l){const _=l.spanContext();return`00-${_.traceId}-${_.spanId}-0${Number(_.traceFlags||t.TraceFlags.NONE).toString(16)}`}_injectContextInfo(l,_,p){return new Promise(h=>{try{const E="set context_info @opentelemetry_traceparent",T=new _.Request(E,g=>{h()});Object.defineProperty(T,e.INJECTED_CTX,{value:!0});const S=Buffer.from(p,"utf8");T.addParameter("opentelemetry_traceparent",_.TYPES.VarBinary,S,{length:S.length}),l.execSql(T)}catch{h()}})}_shouldInjectFor(l){return l==="execSql"||l==="execSqlBatch"||l==="callProcedure"||l==="execute"}_patchQuery(l,_){return p=>{const h=this;function E(T){if(T?.[e.INJECTED_CTX])return p.apply(this,arguments);if(!(T instanceof n.EventEmitter))return h._diag.warn(`Unexpected invocation of patched ${l} method. Span not recorded`),p.apply(this,arguments);let S=0,g=0;const A=()=>g++,R=()=>S++,O=this[a],C=(x=>x.sqlTextOrProcedure==="sp_prepare"&&x.parametersByName?.stmt?.value?x.parametersByName.stmt.value:x.sqlTextOrProcedure)(T),I=h.tracer.startSpan((0,s.getSpanName)(l,O,C,T.table),{kind:t.SpanKind.CLIENT,attributes:{[o.ATTR_DB_SYSTEM]:o.DB_SYSTEM_VALUE_MSSQL,[o.ATTR_DB_NAME]:O,[o.ATTR_NET_PEER_PORT]:this.config?.options?.port,[o.ATTR_NET_PEER_NAME]:this.config?.server,[o.ATTR_DB_USER]:this.config?.userName??this.config?.authentication?.options?.userName,[o.ATTR_DB_STATEMENT]:C,[o.ATTR_DB_SQL_TABLE]:T.table}}),w=(0,s.once)(x=>{T.removeListener("done",A),T.removeListener("doneInProc",A),T.removeListener("doneProc",R),T.removeListener("error",w),this.removeListener("end",w),I.setAttribute("tedious.procedure_count",S),I.setAttribute("tedious.statement_count",g),x&&I.setStatus({code:t.SpanStatusCode.ERROR,message:x.message}),I.end()});T.on("done",A),T.on("doneInProc",A),T.on("doneProc",R),T.once("error",w),this.on("end",w),typeof T.callback=="function"?h._wrap(T,"callback",h._patchCallbackQuery(w)):h._diag.error("Expected request.callback to be a function");const U=()=>t.context.with(t.trace.setSpan(t.context.active(),I),p,this,...arguments);if(!(h.getConfig().enableTraceContextPropagation&&h._shouldInjectFor(l)))return U();const G=h._buildTraceparent(I);h._injectContextInfo(this,_,G).finally(U)}return Object.defineProperty(E,"length",{value:p.length,writable:!1}),E}}_patchCallbackQuery(l){return _=>function(p,h,E){return l(p),_.apply(this,arguments)}}}e.TediousInstrumentation=f})(qf)),qf}var mO;function jz(){return mO||(mO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=void 0;var t=Yz();Object.defineProperty(e,"TediousInstrumentation",{enumerable:!0,get:function(){return t.TediousInstrumentation}})})(jf)),jf}var qz=jz();const Wz=new Set(["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"]),lL="Tedious",Kz=Ne(lL,()=>new qz.TediousInstrumentation({})),zz=(()=>{let e;return{name:lL,setupOnce(){const t=Kz();e=Cv(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const{description:r,data:o}=ye(n);if(!r||o["db.system"]!=="mssql")return;const s=r.split(" ")[0]||"";Wz.has(s)&&n.setAttribute(xe,"auto.db.otel.tedious")}))}}}),Zz=zz;var Wf={},Xa={},Kr={},gO;function Xz(){return gO||(gO=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.PACKAGE_NAME=Kr.PACKAGE_VERSION=void 0,Kr.PACKAGE_VERSION="0.52.0",Kr.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool"),Kr}var AO;function Qz(){if(AO)return Xa;AO=1,Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.GenericPoolInstrumentation=void 0;const e=Pe(),t=Le,n=Xz(),r="generic-pool";class o extends t.InstrumentationBase{_isDisabled=!1;constructor(i={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,i)}init(){return[new t.InstrumentationNodeModuleDefinition(r,[">=3.0.0 <4"],i=>{const a=i.Pool;return(0,t.isWrapped)(a.prototype.acquire)&&this._unwrap(a.prototype,"acquire"),this._wrap(a.prototype,"acquire",this._acquirePatcher.bind(this)),i},i=>{const a=i.Pool;return this._unwrap(a.prototype,"acquire"),i}),new t.InstrumentationNodeModuleDefinition(r,[">=2.4.0 <3"],i=>{const a=i.Pool;return(0,t.isWrapped)(a.prototype.acquire)&&this._unwrap(a.prototype,"acquire"),this._wrap(a.prototype,"acquire",this._acquireWithCallbacksPatcher.bind(this)),i},i=>{const a=i.Pool;return this._unwrap(a.prototype,"acquire"),i}),new t.InstrumentationNodeModuleDefinition(r,[">=2.0.0 <2.4"],i=>(this._isDisabled=!1,(0,t.isWrapped)(i.Pool)&&this._unwrap(i,"Pool"),this._wrap(i,"Pool",this._poolWrapper.bind(this)),i),i=>(this._isDisabled=!0,i))]}_acquirePatcher(i){const a=this;return function(...u){const f=e.context.active(),d=a.tracer.startSpan("generic-pool.acquire",{},f);return e.context.with(e.trace.setSpan(f,d),()=>i.call(this,...u).then(l=>(d.end(),l),l=>{throw d.recordException(l),d.end(),l}))}}_poolWrapper(i){const a=this;return function(){const u=i.apply(this,arguments);return a._wrap(u,"acquire",a._acquireWithCallbacksPatcher.bind(a)),u}}_acquireWithCallbacksPatcher(i){const a=this;return function(u,f){if(a._isDisabled)return i.call(this,u,f);const d=e.context.active(),l=a.tracer.startSpan("generic-pool.acquire",{},d);return e.context.with(e.trace.setSpan(d,l),()=>{i.call(this,(_,p)=>{if(l.end(),u)return u(_,p)},f)})}}}return Xa.GenericPoolInstrumentation=o,Xa}var RO;function Jz(){return RO||(RO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenericPoolInstrumentation=void 0;var t=Qz();Object.defineProperty(e,"GenericPoolInstrumentation",{enumerable:!0,get:function(){return t.GenericPoolInstrumentation}})})(Wf)),Wf}var e3=Jz();const dL="GenericPool",t3=Ne(dL,()=>new e3.GenericPoolInstrumentation({})),n3=(()=>{let e;return{name:dL,setupOnce(){const t=t3();e=Cv(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const o=ye(n).description;(o==="generic-pool.aquire"||o==="generic-pool.acquire")&&n.setAttribute(xe,"auto.db.otel.generic_pool")}))}}}),r3=n3;var Kf={},Qa={},on={},yO;function fL(){return yO||(yO=1,Object.defineProperty(on,"__esModule",{value:!0}),on.ATTR_NET_PEER_PORT=on.ATTR_NET_PEER_NAME=on.ATTR_MESSAGING_SYSTEM=on.ATTR_MESSAGING_OPERATION=void 0,on.ATTR_MESSAGING_OPERATION="messaging.operation",on.ATTR_MESSAGING_SYSTEM="messaging.system",on.ATTR_NET_PEER_NAME="net.peer.name",on.ATTR_NET_PEER_PORT="net.peer.port"),on}var He={},NO;function _L(){return NO||(NO=1,Object.defineProperty(He,"__esModule",{value:!0}),He.ATTR_MESSAGING_CONVERSATION_ID=He.OLD_ATTR_MESSAGING_MESSAGE_ID=He.MESSAGING_DESTINATION_KIND_VALUE_TOPIC=He.ATTR_MESSAGING_URL=He.ATTR_MESSAGING_PROTOCOL_VERSION=He.ATTR_MESSAGING_PROTOCOL=He.MESSAGING_OPERATION_VALUE_PROCESS=He.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY=He.ATTR_MESSAGING_DESTINATION_KIND=He.ATTR_MESSAGING_DESTINATION=void 0,He.ATTR_MESSAGING_DESTINATION="messaging.destination",He.ATTR_MESSAGING_DESTINATION_KIND="messaging.destination_kind",He.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY="messaging.rabbitmq.routing_key",He.MESSAGING_OPERATION_VALUE_PROCESS="process",He.ATTR_MESSAGING_PROTOCOL="messaging.protocol",He.ATTR_MESSAGING_PROTOCOL_VERSION="messaging.protocol_version",He.ATTR_MESSAGING_URL="messaging.url",He.MESSAGING_DESTINATION_KIND_VALUE_TOPIC="topic",He.OLD_ATTR_MESSAGING_MESSAGE_ID="messaging.message_id",He.ATTR_MESSAGING_CONVERSATION_ID="messaging.conversation_id"),He}var zf={},OO;function pL(){return OO||(OO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CONFIG=e.EndOperation=void 0,(function(t){t.AutoAck="auto ack",t.Ack="ack",t.AckAll="ackAll",t.Reject="reject",t.Nack="nack",t.NackAll="nackAll",t.ChannelClosed="channel closed",t.ChannelError="channel error",t.InstrumentationTimeout="instrumentation timeout"})(e.EndOperation||(e.EndOperation={})),e.DEFAULT_CONFIG={consumeTimeoutMs:1e3*60,useLinksForConsume:!1}})(zf)),zf}var Fe={},bO;function o3(){if(bO)return Fe;bO=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.isConfirmChannelTracing=Fe.unmarkConfirmChannelTracing=Fe.markConfirmChannelTracing=Fe.getConnectionAttributesFromUrl=Fe.getConnectionAttributesFromServer=Fe.normalizeExchange=Fe.CONNECTION_ATTRIBUTES=Fe.CHANNEL_CONSUME_TIMEOUT_TIMER=Fe.CHANNEL_SPANS_NOT_ENDED=Fe.MESSAGE_STORED_SPAN=void 0;const e=Pe(),t=fL(),n=_L();Fe.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span"),Fe.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended"),Fe.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer"),Fe.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");const r=(0,e.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel"),o=h=>h!==""?h:"<default>";Fe.normalizeExchange=o;const s=h=>h.replace(/:[^:@/]*@/,":***@"),i=(h,E)=>h||(E==="AMQP"?5672:5671),a=h=>{const E=h||"amqp";return(E.endsWith(":")?E.substring(0,E.length-1):E).toUpperCase()},c=h=>h||"localhost",u=(h,E,T,S)=>T?{[E]:T}:(e.diag.error(`amqplib instrumentation: could not extract connection attribute ${S} from user supplied url`,{url:h}),{}),f=h=>{const E=h.serverProperties.product?.toLowerCase?.();return E?{[t.ATTR_MESSAGING_SYSTEM]:E}:{}};Fe.getConnectionAttributesFromServer=f;const d=h=>{const E={[n.ATTR_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if(h=h||"amqp://localhost",typeof h=="object"){const T=h,S=a(T?.protocol);Object.assign(E,{...u(h,n.ATTR_MESSAGING_PROTOCOL,S,"protocol")});const g=c(T?.hostname);Object.assign(E,{...u(h,t.ATTR_NET_PEER_NAME,g,"hostname")});const A=i(T.port,S);Object.assign(E,{...u(h,t.ATTR_NET_PEER_PORT,A,"port")})}else{const T=s(h);E[n.ATTR_MESSAGING_URL]=T;try{const S=new URL(T),g=a(S.protocol);Object.assign(E,{...u(T,n.ATTR_MESSAGING_PROTOCOL,g,"protocol")});const A=c(S.hostname);Object.assign(E,{...u(T,t.ATTR_NET_PEER_NAME,A,"hostname")});const R=i(S.port?parseInt(S.port):void 0,g);Object.assign(E,{...u(T,t.ATTR_NET_PEER_PORT,R,"port")})}catch(S){e.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:T,err:S})}}return E};Fe.getConnectionAttributesFromUrl=d;const l=h=>h.setValue(r,!0);Fe.markConfirmChannelTracing=l;const _=h=>h.deleteValue(r);Fe.unmarkConfirmChannelTracing=_;const p=h=>h.getValue(r)===!0;return Fe.isConfirmChannelTracing=p,Fe}var zr={},CO;function s3(){return CO||(CO=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.PACKAGE_NAME=zr.PACKAGE_VERSION=void 0,zr.PACKAGE_VERSION="0.55.0",zr.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib"),zr}var IO;function i3(){if(IO)return Qa;IO=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.AmqplibInstrumentation=void 0;const e=Pe(),t=fn,n=Le,r=fL(),o=_L(),s=pL(),i=o3(),a=s3(),c=[">=0.5.5 <1"];class u extends n.InstrumentationBase{constructor(d={}){super(a.PACKAGE_NAME,a.PACKAGE_VERSION,{...s.DEFAULT_CONFIG,...d})}setConfig(d={}){super.setConfig({...s.DEFAULT_CONFIG,...d})}init(){const d=new n.InstrumentationNodeModuleFile("amqplib/lib/channel_model.js",c,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),l=new n.InstrumentationNodeModuleFile("amqplib/lib/callback_model.js",c,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),_=new n.InstrumentationNodeModuleFile("amqplib/lib/connect.js",c,this.patchConnect.bind(this),this.unpatchConnect.bind(this));return new n.InstrumentationNodeModuleDefinition("amqplib",c,void 0,void 0,[d,_,l])}patchConnect(d){return d=this.unpatchConnect(d),(0,n.isWrapped)(d.connect)||this._wrap(d,"connect",this.getConnectPatch.bind(this)),d}unpatchConnect(d){return(0,n.isWrapped)(d.connect)&&this._unwrap(d,"connect"),d}patchChannelModel(d,l){return(0,n.isWrapped)(d.Channel.prototype.publish)||this._wrap(d.Channel.prototype,"publish",this.getPublishPatch.bind(this,l)),(0,n.isWrapped)(d.Channel.prototype.consume)||this._wrap(d.Channel.prototype,"consume",this.getConsumePatch.bind(this,l)),(0,n.isWrapped)(d.Channel.prototype.ack)||this._wrap(d.Channel.prototype,"ack",this.getAckPatch.bind(this,!1,s.EndOperation.Ack)),(0,n.isWrapped)(d.Channel.prototype.nack)||this._wrap(d.Channel.prototype,"nack",this.getAckPatch.bind(this,!0,s.EndOperation.Nack)),(0,n.isWrapped)(d.Channel.prototype.reject)||this._wrap(d.Channel.prototype,"reject",this.getAckPatch.bind(this,!0,s.EndOperation.Reject)),(0,n.isWrapped)(d.Channel.prototype.ackAll)||this._wrap(d.Channel.prototype,"ackAll",this.getAckAllPatch.bind(this,!1,s.EndOperation.AckAll)),(0,n.isWrapped)(d.Channel.prototype.nackAll)||this._wrap(d.Channel.prototype,"nackAll",this.getAckAllPatch.bind(this,!0,s.EndOperation.NackAll)),(0,n.isWrapped)(d.Channel.prototype.emit)||this._wrap(d.Channel.prototype,"emit",this.getChannelEmitPatch.bind(this)),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)||this._wrap(d.ConfirmChannel.prototype,"publish",this.getConfirmedPublishPatch.bind(this,l)),d}unpatchChannelModel(d){return(0,n.isWrapped)(d.Channel.prototype.publish)&&this._unwrap(d.Channel.prototype,"publish"),(0,n.isWrapped)(d.Channel.prototype.consume)&&this._unwrap(d.Channel.prototype,"consume"),(0,n.isWrapped)(d.Channel.prototype.ack)&&this._unwrap(d.Channel.prototype,"ack"),(0,n.isWrapped)(d.Channel.prototype.nack)&&this._unwrap(d.Channel.prototype,"nack"),(0,n.isWrapped)(d.Channel.prototype.reject)&&this._unwrap(d.Channel.prototype,"reject"),(0,n.isWrapped)(d.Channel.prototype.ackAll)&&this._unwrap(d.Channel.prototype,"ackAll"),(0,n.isWrapped)(d.Channel.prototype.nackAll)&&this._unwrap(d.Channel.prototype,"nackAll"),(0,n.isWrapped)(d.Channel.prototype.emit)&&this._unwrap(d.Channel.prototype,"emit"),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)&&this._unwrap(d.ConfirmChannel.prototype,"publish"),d}getConnectPatch(d){return function(_,p,h){return d.call(this,_,p,function(E,T){if(E==null){const S=(0,i.getConnectionAttributesFromUrl)(_),g=(0,i.getConnectionAttributesFromServer)(T);T[i.CONNECTION_ATTRIBUTES]={...S,...g}}h.apply(this,arguments)})}}getChannelEmitPatch(d){const l=this;return function(p){if(p==="close"){l.endAllSpansOnChannel(this,!0,s.EndOperation.ChannelClosed,void 0);const h=this[i.CHANNEL_CONSUME_TIMEOUT_TIMER];h&&clearInterval(h),this[i.CHANNEL_CONSUME_TIMEOUT_TIMER]=void 0}else p==="error"&&l.endAllSpansOnChannel(this,!0,s.EndOperation.ChannelError,void 0);return d.apply(this,arguments)}}getAckAllPatch(d,l,_){const p=this;return function(E){return p.endAllSpansOnChannel(this,d,l,E),_.apply(this,arguments)}}getAckPatch(d,l,_){const p=this;return function(E,T,S){const g=this,A=l===s.EndOperation.Reject?T:S,R=g[i.CHANNEL_SPANS_NOT_ENDED]??[],O=R.findIndex(C=>C.msg===E);if(O<0)p.endConsumerSpan(E,d,l,A);else if(l!==s.EndOperation.Reject&&T){for(let C=0;C<=O;C++)p.endConsumerSpan(R[C].msg,d,l,A);R.splice(0,O+1)}else p.endConsumerSpan(E,d,l,A),R.splice(O,1);return _.apply(this,arguments)}}getConsumePatch(d,l){const _=this;return function(h,E,T){const S=this;if(!Object.prototype.hasOwnProperty.call(S,i.CHANNEL_SPANS_NOT_ENDED)){const{consumeTimeoutMs:A}=_.getConfig();if(A){const R=setInterval(()=>{_.checkConsumeTimeoutOnChannel(S)},A);R.unref(),S[i.CHANNEL_CONSUME_TIMEOUT_TIMER]=R}S[i.CHANNEL_SPANS_NOT_ENDED]=[]}const g=function(A){if(!A)return E.call(this,A);const R=A.properties.headers??{};let O=e.propagation.extract(e.ROOT_CONTEXT,R);const C=A.fields?.exchange;let I;if(_._config.useLinksForConsume){const F=O?e.trace.getSpan(O)?.spanContext():void 0;O=void 0,F&&(I=[{context:F}])}const w=_.tracer.startSpan(`${h} process`,{kind:e.SpanKind.CONSUMER,attributes:{...S?.connection?.[i.CONNECTION_ATTRIBUTES],[o.ATTR_MESSAGING_DESTINATION]:C,[o.ATTR_MESSAGING_DESTINATION_KIND]:o.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[o.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:A.fields?.routingKey,[r.ATTR_MESSAGING_OPERATION]:o.MESSAGING_OPERATION_VALUE_PROCESS,[o.OLD_ATTR_MESSAGING_MESSAGE_ID]:A?.properties.messageId,[o.ATTR_MESSAGING_CONVERSATION_ID]:A?.properties.correlationId},links:I},O),{consumeHook:U}=_.getConfig();U&&(0,n.safeExecuteInTheMiddle)(()=>U(w,{moduleVersion:d,msg:A}),F=>{F&&e.diag.error("amqplib instrumentation: consumerHook error",F)},!0),T?.noAck||(S[i.CHANNEL_SPANS_NOT_ENDED].push({msg:A,timeOfConsume:(0,t.hrTime)()}),A[i.MESSAGE_STORED_SPAN]=w);const B=O||e.ROOT_CONTEXT;e.context.with(e.trace.setSpan(B,w),()=>{E.call(this,A)}),T?.noAck&&(_.callConsumeEndHook(w,A,!1,s.EndOperation.AutoAck),w.end())};return arguments[1]=g,l.apply(this,arguments)}}getConfirmedPublishPatch(d,l){const _=this;return function(h,E,T,S,g){const A=this,{span:R,modifiedOptions:O}=_.createPublishSpan(_,h,E,A,S),{publishHook:C}=_.getConfig();C&&(0,n.safeExecuteInTheMiddle)(()=>C(R,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:O,isConfirmChannel:!0}),B=>{B&&e.diag.error("amqplib instrumentation: publishHook error",B)},!0);const I=function(B,F){try{g?.call(this,B,F)}finally{const{publishConfirmHook:G}=_.getConfig();G&&(0,n.safeExecuteInTheMiddle)(()=>G(R,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:S,isConfirmChannel:!0,confirmError:B}),x=>{x&&e.diag.error("amqplib instrumentation: publishConfirmHook error",x)},!0),B&&R.setStatus({code:e.SpanStatusCode.ERROR,message:"message confirmation has been nack'ed"}),R.end()}},w=(0,i.markConfirmChannelTracing)(e.context.active()),U=[...arguments];return U[3]=O,U[4]=e.context.bind((0,i.unmarkConfirmChannelTracing)(e.trace.setSpan(w,R)),I),e.context.with(w,l.bind(this,...U))}}getPublishPatch(d,l){const _=this;return function(h,E,T,S){if((0,i.isConfirmChannelTracing)(e.context.active()))return l.apply(this,arguments);{const g=this,{span:A,modifiedOptions:R}=_.createPublishSpan(_,h,E,g,S),{publishHook:O}=_.getConfig();O&&(0,n.safeExecuteInTheMiddle)(()=>O(A,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:R,isConfirmChannel:!1}),w=>{w&&e.diag.error("amqplib instrumentation: publishHook error",w)},!0);const C=[...arguments];C[3]=R;const I=l.apply(this,C);return A.end(),I}}}createPublishSpan(d,l,_,p,h){const E=(0,i.normalizeExchange)(l),T=d.tracer.startSpan(`publish ${E}`,{kind:e.SpanKind.PRODUCER,attributes:{...p.connection[i.CONNECTION_ATTRIBUTES],[o.ATTR_MESSAGING_DESTINATION]:l,[o.ATTR_MESSAGING_DESTINATION_KIND]:o.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[o.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:_,[o.OLD_ATTR_MESSAGING_MESSAGE_ID]:h?.messageId,[o.ATTR_MESSAGING_CONVERSATION_ID]:h?.correlationId}}),S=h??{};return S.headers=S.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),T),S.headers),{span:T,modifiedOptions:S}}endConsumerSpan(d,l,_,p){const h=d[i.MESSAGE_STORED_SPAN];h&&(l!==!1&&h.setStatus({code:e.SpanStatusCode.ERROR,message:_!==s.EndOperation.ChannelClosed&&_!==s.EndOperation.ChannelError?`${_} called on message${p===!0?" with requeue":p===!1?" without requeue":""}`:_}),this.callConsumeEndHook(h,d,l,_),h.end(),d[i.MESSAGE_STORED_SPAN]=void 0)}endAllSpansOnChannel(d,l,_,p){(d[i.CHANNEL_SPANS_NOT_ENDED]??[]).forEach(E=>{this.endConsumerSpan(E.msg,l,_,p)}),d[i.CHANNEL_SPANS_NOT_ENDED]=[]}callConsumeEndHook(d,l,_,p){const{consumeEndHook:h}=this.getConfig();h&&(0,n.safeExecuteInTheMiddle)(()=>h(d,{msg:l,rejected:_,endOperation:p}),E=>{E&&e.diag.error("amqplib instrumentation: consumerEndHook error",E)},!0)}checkConsumeTimeoutOnChannel(d){const l=(0,t.hrTime)(),_=d[i.CHANNEL_SPANS_NOT_ENDED]??[];let p;const{consumeTimeoutMs:h}=this.getConfig();for(p=0;p<_.length;p++){const E=_[p],T=(0,t.hrTimeDuration)(E.timeOfConsume,l);if((0,t.hrTimeToMilliseconds)(T)<h)break;this.endConsumerSpan(E.msg,null,s.EndOperation.InstrumentationTimeout,!0)}_.splice(0,p)}}return Qa.AmqplibInstrumentation=u,Qa}var PO;function a3(){return PO||(PO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOperation=e.DEFAULT_CONFIG=e.AmqplibInstrumentation=void 0;var t=i3();Object.defineProperty(e,"AmqplibInstrumentation",{enumerable:!0,get:function(){return t.AmqplibInstrumentation}});var n=pL();Object.defineProperty(e,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_CONFIG}}),Object.defineProperty(e,"EndOperation",{enumerable:!0,get:function(){return n.EndOperation}})})(Kf)),Kf}var c3=a3();const hL="Amqplib",u3={consumeEndHook:e=>{Ot(e,"auto.amqplib.otel.consumer")},publishHook:e=>{Ot(e,"auto.amqplib.otel.publisher")}},l3=Ne(hL,()=>new c3.AmqplibInstrumentation(u3)),d3=(()=>({name:hL,setupOnce(){l3()}})),f3=d3,eT="VercelAI",MO=["generateText","streamText","generateObject","streamObject","embed","embedMany"];function _3(e){if(typeof e!="object"||e===null)return!1;const t=e;return"type"in t&&"error"in t&&"toolName"in t&&"toolCallId"in t&&t.type==="tool-error"&&t.error instanceof Error}function p3(e){if(typeof e!="object"||e===null||!("content"in e))return;const t=e;if(Array.isArray(t.content)){for(const n of t.content)if(_3(n)){const r=pB(n.toolCallId);if(r){const o=r.spanContext();lo(s=>{s.setContext("trace",{trace_id:o.traceId,span_id:o.spanId}),s.setTag("vercel.ai.tool.name",n.toolName),s.setTag("vercel.ai.tool.callId",n.toolCallId),s.setLevel("error"),Ve(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})}),hB(n.toolCallId)}else lo(o=>{o.setTag("vercel.ai.tool.name",n.toolName),o.setTag("vercel.ai.tool.callId",n.toolCallId),o.setLevel("error"),Ve(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})})}}}function h3(e,t,n,r){const o=e?.recordInputs!==void 0?e.recordInputs:t.recordInputs!==void 0?t.recordInputs:n===!0?!0:r,s=e?.recordOutputs!==void 0?e.recordOutputs:t.recordOutputs!==void 0?t.recordOutputs:n===!0?!0:r;return{recordInputs:o,recordOutputs:s}}class al extends bt{__init(){this._isPatched=!1}__init2(){this._callbacks=[]}constructor(t={}){super("@sentry/instrumentation-vercel-ai",Qe,t),al.prototype.__init.call(this),al.prototype.__init2.call(this)}init(){return new ft("ai",[">=3.0.0 <6"],this._patch.bind(this))}callWhenPatched(t){this._isPatched?t():this._callbacks.push(t)}_patch(t){this._isPatched=!0,this._callbacks.forEach(r=>r()),this._callbacks=[];const n=r=>new Proxy(r,{apply:(o,s,i)=>{const a=i[0].experimental_telemetry||{},c=a.isEnabled,u=Te(),f=u?.getIntegrationByName(eT),d=f?.options,l=f?!!u?.getOptions().sendDefaultPii:!1,{recordInputs:_,recordOutputs:p}=h3(d,a,c,l);return i[0].experimental_telemetry={...a,isEnabled:c!==void 0?c:!0,recordInputs:_,recordOutputs:p},_o(()=>Reflect.apply(o,s,i),h=>{h&&typeof h=="object"&&un(h,"_sentry_active_span",Vl())},()=>{},h=>{p3(h)})}});if(Object.prototype.toString.call(t)==="[object Module]"){for(const r of MO)t[r]=n(t[r]);return t}else{const r=MO.reduce((o,s)=>(o[s]=n(t[s]),o),{});return{...t,...r}}}}const E3=Ne(eT,()=>new al({}));function T3(e){return!!e.getIntegrationByName("Modules")?.getModules?.()?.ai}const S3=((e={})=>{let t;return{name:eT,options:e,setupOnce(){t=E3()},afterAllSetup(n){e.force??T3(n)?IR(n):t?.callWhenPatched(()=>IR(n))}}}),m3=S3,g3=[">=4.0.0 <7"];class A3 extends bt{constructor(t={}){super("@sentry/instrumentation-openai",Qe,t)}init(){return new ft("openai",g3,this._patch.bind(this))}_patch(t){let n=t;return n=this._patchClient(n,"OpenAI"),n=this._patchClient(n,"AzureOpenAI"),n}_patchClient(t,n){const r=t[n];if(!r)return t;const o=this.getConfig(),s=function(...i){if(NE(Zl))return Reflect.construct(r,i);const a=Reflect.construct(r,i),u=!!Te()?.getOptions().sendDefaultPii,f=o.recordInputs??u,d=o.recordOutputs??u;return jB(a,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(s,r),Object.setPrototypeOf(s.prototype,r.prototype);for(const i of Object.getOwnPropertyNames(r))if(!["length","name","prototype"].includes(i)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(s,i,a)}try{t[n]=s}catch{Object.defineProperty(t,n,{value:s,writable:!0,configurable:!0,enumerable:!0})}if(t.default===r)try{t.default=s}catch{Object.defineProperty(t,"default",{value:s,writable:!0,configurable:!0,enumerable:!0})}return t}}const R3=Ne(Zl,e=>new A3(e)),y3=((e={})=>({name:Zl,setupOnce(){R3(e)}})),N3=y3,O3=[">=0.19.2 <1.0.0"];class b3 extends bt{constructor(t={}){super("@sentry/instrumentation-anthropic-ai",Qe,t)}init(){return new ft("@anthropic-ai/sdk",O3,this._patch.bind(this))}_patch(t){const n=t.Anthropic,r=this.getConfig(),o=function(...s){if(NE(Ql))return Reflect.construct(n,s);const i=Reflect.construct(n,s),c=!!Te()?.getOptions().sendDefaultPii,u=r.recordInputs??c,f=r.recordOutputs??c;return lH(i,{recordInputs:u,recordOutputs:f})};Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,n.prototype);for(const s of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(s)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(o,s,i)}try{t.Anthropic=o}catch{Object.defineProperty(t,"Anthropic",{value:o,writable:!0,configurable:!0,enumerable:!0})}if(t.default===n)try{t.default=o}catch{Object.defineProperty(t,"default",{value:o,writable:!0,configurable:!0,enumerable:!0})}return t}}const C3=Ne(Ql,e=>new b3(e)),I3=((e={})=>({name:Ql,options:e,setupOnce(){C3(e)}})),P3=I3,vO=[">=0.10.0 <2"];class M3 extends bt{constructor(t={}){super("@sentry/instrumentation-google-genai",Qe,t)}init(){return new ft("@google/genai",vO,n=>this._patch(n),n=>n,[new qn("@google/genai/dist/node/index.cjs",vO,n=>this._patch(n),n=>n)])}_patch(t){const n=t.GoogleGenAI,r=this.getConfig();if(typeof n!="function")return t;const o=function(...s){if(NE(Jl))return Reflect.construct(n,s);const i=Reflect.construct(n,s),c=!!Te()?.getOptions().sendDefaultPii,u=r,f=u?.recordInputs??c,d=u?.recordOutputs??c;return yH(i,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,n.prototype);for(const s of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(s)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(o,s,i)}return VH(t,"GoogleGenAI",o),t}}const v3=Ne(Jl,e=>new M3(e)),w3=((e={})=>({name:Jl,setupOnce(){v3(e)}})),L3=w3,cu=[">=0.1.0 <2.0.0"];function D3(e,t){return e?Array.isArray(e)?e.includes(t)?e:[...e,t]:typeof e=="object"?[e,t]:e:[t]}function U3(e,t,n){return new Proxy(e,{apply(r,o,s){let a=s[1];(!a||typeof a!="object"||Array.isArray(a))&&(a={},s[1]=a);const c=a.callbacks,u=D3(c,t);return a.callbacks=u,Reflect.apply(r,o,s)}})}class k3 extends bt{constructor(t={}){super("@sentry/instrumentation-langchain",Qe,t)}init(){const t=[],n=["@langchain/anthropic","@langchain/openai","@langchain/google-genai","@langchain/mistralai","@langchain/google-vertexai","@langchain/groq"];for(const r of n)t.push(new ft(r,cu,this._patch.bind(this),o=>o,[new qn(`${r}/dist/index.cjs`,cu,this._patch.bind(this),o=>o)]));return t.push(new ft("langchain",cu,this._patch.bind(this),r=>r,[new qn("langchain/dist/chat_models/universal.cjs",cu,this._patch.bind(this),r=>r)])),t}_patch(t){MV([Zl,Ql,Jl]);const r=!!Te()?.getOptions().sendDefaultPii,o=this.getConfig(),s=o?.recordInputs??r,i=o?.recordOutputs??r,a=vH({recordInputs:s,recordOutputs:i});return this._patchRunnableMethods(t,a),t}_patchRunnableMethods(t,n){const r=["ChatAnthropic","ChatOpenAI","ChatGoogleGenerativeAI","ChatMistralAI","ChatVertexAI","ChatGroq","ConfigurableModel"],o=t.universal_exports??t,s=Object.values(o).find(c=>typeof c=="function"&&r.includes(c.name));if(!s)return;const i=s.prototype,a=["invoke","stream","batch"];for(const c of a){const u=i[c];typeof u=="function"&&(i[c]=U3(u,n))}}}const x3=Ne(Rv,e=>new k3(e)),G3=((e={})=>({name:Rv,setupOnce(){x3(e)}})),V3=G3,wO=[">=0.0.0 <2.0.0"];class $3 extends bt{constructor(t={}){super("@sentry/instrumentation-langgraph",Qe,t)}init(){return new ft("@langchain/langgraph",wO,this._patch.bind(this),n=>n,[new qn("@langchain/langgraph/dist/index.cjs",wO,this._patch.bind(this),n=>n)])}_patch(t){const r=!!Te()?.getOptions().sendDefaultPii,o=this.getConfig(),s=o.recordInputs??r,i=o.recordOutputs??r,a={recordInputs:s,recordOutputs:i};if(t.StateGraph&&typeof t.StateGraph=="function"){const c=t.StateGraph;c.prototype.compile=xH(c.prototype.compile,a)}return t}}const B3=Ne(Nv,e=>new $3(e)),H3=((e={})=>({name:Nv,setupOnce(){B3(e)}})),F3=H3;function Y3(e,t,n,r,o){let i=()=>{};const a=o.firestoreSpanCreationHook;typeof a=="function"&&(i=f=>{cr(()=>a(f),d=>{d&&b.diag.error(d?.message)},!0)});const c=new ft("@firebase/firestore",t,f=>LO(f,n,r,e,i)),u=["@firebase/firestore/dist/lite/index.node.cjs.js","@firebase/firestore/dist/lite/index.node.mjs.js","@firebase/firestore/dist/lite/index.rn.esm2017.js","@firebase/firestore/dist/lite/index.cjs.js"];for(const f of u)c.files.push(new qn(f,t,d=>LO(d,n,r,e,i),d=>EL(d,r)));return c}function LO(e,t,n,r,o){return EL(e,n),t(e,"addDoc",j3(r,o)),t(e,"getDocs",W3(r,o)),t(e,"setDoc",K3(r,o)),t(e,"deleteDoc",q3(r,o)),e}function EL(e,t){for(const n of["addDoc","getDocs","setDoc","deleteDoc"])Ll(e[n])&&t(e,n);return e}function j3(e,t){return function(r){return function(o,s){const i=id(e,"addDoc",o);return t(i),sd(i,()=>r(o,s))}}}function q3(e,t){return function(r){return function(o){const s=id(e,"deleteDoc",o.parent||o);return t(s),sd(s,()=>r(o))}}}function W3(e,t){return function(r){return function(o){const s=id(e,"getDocs",o);return t(s),sd(s,()=>r(o))}}}function K3(e,t){return function(r){return function(o,s,i){const a=id(e,"setDoc",o.parent||o);return t(a),sd(a,()=>typeof i<"u"?r(o,s,i):r(o,s))}}}function sd(e,t){return b.context.with(b.trace.setSpan(b.context.active(),e),()=>cr(()=>t(),n=>{n&&e.recordException(n),e.end()},!0))}function id(e,t,n){const r=e.startSpan(`${t} ${n.path}`,{kind:b.SpanKind.CLIENT});return Z3(r,n),r.setAttribute(Q.ATTR_DB_OPERATION_NAME,t),r}function z3(e){let t,n;if(typeof e.host=="string")if(e.host.startsWith("[")){if(e.host.endsWith("]"))t=e.host.replace(/^\[|\]$/g,"");else if(e.host.includes("]:")){const r=e.host.lastIndexOf(":");r!==-1&&(t=e.host.slice(1,r).replace(/^\[|\]$/g,""),n=e.host.slice(r+1))}}else if(Uo.isIPv6(e.host))t=e.host;else{const r=e.host.lastIndexOf(":");r!==-1?(t=e.host.slice(0,r),n=e.host.slice(r+1)):t=e.host}return{address:t,port:n?parseInt(n,10):void 0}}function Z3(e,t){const n=t.firestore.app,r=n.options,s=(t.firestore.toJSON()||{}).settings||{},i={[Q.ATTR_DB_COLLECTION_NAME]:t.path,[Q.ATTR_DB_NAMESPACE]:n.name,[Q.ATTR_DB_SYSTEM_NAME]:"firebase.firestore","firebase.firestore.type":t.type,"firebase.firestore.options.projectId":r.projectId,"firebase.firestore.options.appId":r.appId,"firebase.firestore.options.messagingSenderId":r.messagingSenderId,"firebase.firestore.options.storageBucket":r.storageBucket},{address:a,port:c}=z3(s);a&&(i[Q.ATTR_SERVER_ADDRESS]=a),c&&(i[Q.ATTR_SERVER_PORT]=c),e.setAttributes(i)}function X3(e,t,n,r,o){let s=()=>{},i=()=>{};const a=o.functions?.errorHook,c=o.functions?.requestHook,u=o.functions?.responseHook;typeof u=="function"&&(i=(l,_)=>{cr(()=>u(l,_),p=>{p&&b.diag.error(p?.message)},!0)}),typeof c=="function"&&(s=l=>{cr(()=>c(l),_=>{_&&b.diag.error(_?.message)},!0)});const f=new ft("firebase-functions",t);return[{name:"firebase-functions/lib/v2/providers/https.js",triggerType:"function"},{name:"firebase-functions/lib/v2/providers/firestore.js",triggerType:"firestore"},{name:"firebase-functions/lib/v2/providers/scheduler.js",triggerType:"scheduler"},{name:"firebase-functions/lib/v2/storage.js",triggerType:"storage"}].forEach(({name:l,triggerType:_})=>{f.files.push(new qn(l,t,p=>Q3(p,n,r,e,{requestHook:s,responseHook:i,errorHook:a},_),p=>TL(p,r)))}),f}function mt(e,t,n){return function(o){return function(...s){const i=typeof s[0]=="function"?s[0]:s[1],a=typeof s[0]=="function"?void 0:s[0];if(!i)return o.call(this,...s);const c=async function(...u){const f=process.env.FUNCTION_TARGET||process.env.K_SERVICE||"unknown",d=e.startSpan(`firebase.function.${n}`,{kind:b.SpanKind.SERVER}),l={"faas.name":f,"faas.trigger":n,"faas.provider":"firebase"};return process.env.GCLOUD_PROJECT&&(l["cloud.project_id"]=process.env.GCLOUD_PROJECT),process.env.EVENTARC_CLOUD_EVENT_SOURCE&&(l["cloud.event_source"]=process.env.EVENTARC_CLOUD_EVENT_SOURCE),d.setAttributes(l),t?.requestHook?.(d),b.context.with(b.trace.setSpan(b.context.active(),d),async()=>{let _,p;try{p=await i.apply(this,u)}catch(h){_=h}if(t?.responseHook?.(d,_),_&&d.recordException(_),d.end(),_)throw await t?.errorHook?.(d,_),_;return p})};return a?o.call(this,a,c):o.call(this,c)}}}function Q3(e,t,n,r,o,s){switch(TL(e,n),s){case"function":t(e,"onRequest",mt(r,o,"http.request")),t(e,"onCall",mt(r,o,"http.call"));break;case"firestore":t(e,"onDocumentCreated",mt(r,o,"firestore.document.created")),t(e,"onDocumentUpdated",mt(r,o,"firestore.document.updated")),t(e,"onDocumentDeleted",mt(r,o,"firestore.document.deleted")),t(e,"onDocumentWritten",mt(r,o,"firestore.document.written")),t(e,"onDocumentCreatedWithAuthContext",mt(r,o,"firestore.document.created")),t(e,"onDocumentUpdatedWithAuthContext",mt(r,o,"firestore.document.updated")),t(e,"onDocumentDeletedWithAuthContext",mt(r,o,"firestore.document.deleted")),t(e,"onDocumentWrittenWithAuthContext",mt(r,o,"firestore.document.written"));break;case"scheduler":t(e,"onSchedule",mt(r,o,"scheduler.scheduled"));break;case"storage":t(e,"onObjectFinalized",mt(r,o,"storage.object.finalized")),t(e,"onObjectArchived",mt(r,o,"storage.object.archived")),t(e,"onObjectDeleted",mt(r,o,"storage.object.deleted")),t(e,"onObjectMetadataUpdated",mt(r,o,"storage.object.metadataUpdated"));break}return e}function TL(e,t){const n=["onSchedule","onRequest","onCall","onObjectFinalized","onObjectArchived","onObjectDeleted","onObjectMetadataUpdated","onDocumentCreated","onDocumentUpdated","onDocumentDeleted","onDocumentWritten","onDocumentCreatedWithAuthContext","onDocumentUpdatedWithAuthContext","onDocumentDeletedWithAuthContext","onDocumentWrittenWithAuthContext"];for(const r of n)Ll(e[r])&&t(e,r);return e}const DO={},J3=[">=3.0.0 <5"],eZ=[">=6.0.0 <7"];class tZ extends bt{constructor(t=DO){super("@sentry/instrumentation-firebase",Qe,t)}setConfig(t={}){super.setConfig({...DO,...t})}init(){const t=[];return t.push(Y3(this.tracer,J3,this._wrap,this._unwrap,this.getConfig())),t.push(X3(this.tracer,eZ,this._wrap,this._unwrap,this.getConfig())),t}}const SL="Firebase",nZ={firestoreSpanCreationHook:e=>{Ot(e,"auto.firebase.otel.firestore"),e.setAttribute(Ee,"db.query")},functions:{requestHook:e=>{Ot(e,"auto.firebase.otel.functions"),e.setAttribute(Ee,"http.request")},errorHook:async(e,t)=>{t&&(Ve(t,{mechanism:{type:"auto.firebase.otel.functions",handled:!1}}),await $G(2e3))}}},rZ=Ne(SL,()=>new tZ(nZ)),oZ=(()=>({name:SL,setupOnce(){rZ()}})),sZ=oZ;function iZ(){return[qq(),zW(),iK(),Rz(),GK(),qK(),t2(),u2(),L2(),H2(),iz(),hz(),vz(),$z(),Zz(),r3(),TK(),f3(),NK(),V3(),F3(),m3(),N3(),P3(),L3(),q2(),sZ()]}const Zf=1e6;function aZ(e,t={}){e.getOptions().debug&&zj();const n=cZ(e,t);e.traceProvider=n}function cZ(e,t={}){const n=new gF({sampler:new cY(e),resource:wv().merge(vv({[Q.ATTR_SERVICE_NAME]:"node",[Q.SEMRESATTRS_SERVICE_NAMESPACE]:"sentry",[Q.ATTR_SERVICE_VERSION]:Qe})),forceFlushTimeoutMillis:500,spanProcessors:[new aY({timeout:uZ(e.getOptions().maxSpanWaitDuration)}),...t.spanProcessors||[]]});return b.trace.setGlobalTracerProvider(n),b.propagation.setGlobalPropagator(new DF),b.context.setGlobalContextManager(new Kj),n}function uZ(e){if(e!=null){if(e>Zf)return ho&&j.warn(`\`maxSpanWaitDuration\` is too high, using the maximum value of ${Zf}`),Zf;if(e<=0||Number.isNaN(e)){ho&&j.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.");return}return e}}function lZ(){return mw().filter(t=>t.name!=="Http"&&t.name!=="NodeFetch").concat(Nq(),Lq())}function dZ(e){return[...lZ(),...Xt(e)?iZ():[]]}function fZ(e={}){return _Z(e,dZ)}function _Z(e={},t){OE(e,"node");const n=pq({...e,defaultIntegrations:e.defaultIntegrations??t(e)});return n&&!e.skipOpenTelemetrySetup&&(aZ(n,{spanProcessors:e.openTelemetrySpanProcessors}),Eq()),n}function W(e,t,n){function r(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:i,traits:new Set},enumerable:!1}),a._zod.traits.has(e))return;a._zod.traits.add(e),t(a,c);const u=i.prototype,f=Object.keys(u);for(let d=0;d<f.length;d++){const l=f[d];l in a||(a[l]=u[l].bind(a))}}const o=n?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const u=n?.Parent?new s:this;r(u,a),(c=u._zod).deferred??(c.deferred=[]);for(const f of u._zod.deferred)f();return u}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>n?.Parent&&a instanceof n.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class Zo extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class mL extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const gL={};function Eo(e){return gL}function pZ(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function Ph(e,t){return typeof t=="bigint"?t.toString():t}function tT(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nT(e){return e==null}function rT(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function hZ(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let o=(r.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(r)){const c=r.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}const s=n>o?n:o,i=Number.parseInt(e.toFixed(s).replace(".","")),a=Number.parseInt(t.toFixed(s).replace(".",""));return i%a/10**s}const UO=Symbol("evaluating");function ke(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==UO)return r===void 0&&(r=UO,r=n()),r},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function No(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Oo(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function kO(e){return JSON.stringify(e)}function EZ(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const AL="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function cl(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const TZ=tT(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function bc(e){if(cl(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(cl(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function RL(e){return bc(e)?{...e}:Array.isArray(e)?[...e]:e}const SZ=new Set(["string","number","symbol"]);function ss(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function fr(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function fe(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function mZ(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const gZ={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function AZ(e,t){const n=e._zod.def,r=Oo(e._zod.def,{get shape(){const o={};for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(o[s]=n.shape[s])}return No(this,"shape",o),o},checks:[]});return fr(e,r)}function RZ(e,t){const n=e._zod.def,r=Oo(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete o[s]}return No(this,"shape",o),o},checks:[]});return fr(e,r)}function yZ(e,t){if(!bc(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const o=Oo(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return No(this,"shape",s),s},checks:[]});return fr(e,o)}function NZ(e,t){if(!bc(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return No(this,"shape",r),r},checks:e._zod.def.checks};return fr(e,n)}function OZ(e,t){const n=Oo(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return No(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return fr(e,n)}function bZ(e,t,n){const r=Oo(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(n)for(const i in n){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)s[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return No(this,"shape",s),s},checks:[]});return fr(t,r)}function CZ(e,t,n){const r=Oo(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(n)for(const i in n){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return No(this,"shape",s),s},checks:[]});return fr(t,r)}function $o(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function yL(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function uu(e){return typeof e=="string"?e:e?.message}function To(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const o=uu(e.inst?._zod.def?.error?.(e))??uu(t?.error?.(e))??uu(n.customError?.(e))??uu(n.localeError?.(e))??"Invalid input";r.message=o}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function oT(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Cc(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const NL=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,Ph,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},OL=W("$ZodError",NL),bL=W("$ZodError",NL,{Parent:Error});function IZ(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function PZ(e,t=n=>n.message){const n={_errors:[]},r=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>r({issues:i}));else if(s.code==="invalid_key")r({issues:s.issues});else if(s.code==="invalid_element")r({issues:s.issues});else if(s.path.length===0)n._errors.push(t(s));else{let i=n,a=0;for(;a<s.path.length;){const c=s.path[a];a===s.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(s))):i[c]=i[c]||{_errors:[]},i=i[c],a++}}};return r(e),n}const sT=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new Zo;if(i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>To(c,s,Eo())));throw AL(a,o?.callee),a}return i.value},iT=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>To(c,s,Eo())));throw AL(a,o?.callee),a}return i.value},ad=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new Zo;return s.issues.length?{success:!1,error:new(e??OL)(s.issues.map(i=>To(i,o,Eo())))}:{success:!0,data:s.value}},MZ=ad(bL),cd=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>To(i,o,Eo())))}:{success:!0,data:s.value}},vZ=cd(bL),wZ=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return sT(e)(t,n,o)},LZ=e=>(t,n,r)=>sT(e)(t,n,r),DZ=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return iT(e)(t,n,o)},UZ=e=>async(t,n,r)=>iT(e)(t,n,r),kZ=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return ad(e)(t,n,o)},xZ=e=>(t,n,r)=>ad(e)(t,n,r),GZ=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return cd(e)(t,n,o)},VZ=e=>async(t,n,r)=>cd(e)(t,n,r),$Z=/^[cC][^\s-]{8,}$/,BZ=/^[0-9a-z]+$/,HZ=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,FZ=/^[0-9a-vA-V]{20}$/,YZ=/^[A-Za-z0-9]{27}$/,jZ=/^[a-zA-Z0-9_-]{21}$/,qZ=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,WZ=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,xO=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,KZ=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,zZ="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function ZZ(){return new RegExp(zZ,"u")}const XZ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,QZ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,JZ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,e4=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,t4=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,CL=/^[A-Za-z0-9_-]*$/,n4=/^\+(?:[0-9]){6,14}[0-9]$/,IL="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",r4=new RegExp(`^${IL}$`);function PL(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function o4(e){return new RegExp(`^${PL(e)}$`)}function s4(e){const t=PL({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${IL}T(?:${r})$`)}const i4=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},a4=/^-?\d+$/,c4=/^-?\d+(?:\.\d+)?/,u4=/^[^A-Z]*$/,l4=/^[^a-z]*$/,vt=W("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),ML={number:"number",bigint:"bigint",object:"date"},vL=W("$ZodCheckLessThan",(e,t)=>{vt.init(e,t);const n=ML[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),wL=W("$ZodCheckGreaterThan",(e,t)=>{vt.init(e,t);const n=ML[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),d4=W("$ZodCheckMultipleOf",(e,t)=>{vt.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):hZ(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),f4=W("$ZodCheckNumberFormat",(e,t)=>{vt.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),r=n?"int":"number",[o,s]=gZ[t.format];e._zod.onattach.push(i=>{const a=i._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,n&&(a.pattern=a4)}),e._zod.check=i=>{const a=i.value;if(n){if(!Number.isInteger(a)){i.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:e})}}),_4=W("$ZodCheckMaxLength",(e,t)=>{var n;vt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!nT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const o=r.value;if(o.length<=t.maximum)return;const i=oT(o);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),p4=W("$ZodCheckMinLength",(e,t)=>{var n;vt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!nT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const o=r.value;if(o.length>=t.minimum)return;const i=oT(o);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),h4=W("$ZodCheckLengthEquals",(e,t)=>{var n;vt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!nT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=r=>{const o=r.value,s=o.length;if(s===t.length)return;const i=oT(o),a=s>t.length;r.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),ud=W("$ZodCheckStringFormat",(e,t)=>{var n,r;vt.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),E4=W("$ZodCheckRegex",(e,t)=>{ud.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),T4=W("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=u4),ud.init(e,t)}),S4=W("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=l4),ud.init(e,t)}),m4=W("$ZodCheckIncludes",(e,t)=>{vt.init(e,t);const n=ss(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),g4=W("$ZodCheckStartsWith",(e,t)=>{vt.init(e,t);const n=new RegExp(`^${ss(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),A4=W("$ZodCheckEndsWith",(e,t)=>{vt.init(e,t);const n=new RegExp(`.*${ss(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),R4=W("$ZodCheckOverwrite",(e,t)=>{vt.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class y4{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(i=>i),o=Math.min(...r.map(i=>i.length-i.trimStart().length)),s=r.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,n=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const N4={major:4,minor:1,patch:13},Ze=W("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=N4;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const o of r)for(const s of o._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,a,c)=>{let u=$o(i),f;for(const d of a){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(u)continue;const l=i.issues.length,_=d._zod.check(i);if(_ instanceof Promise&&c?.async===!1)throw new Zo;if(f||_ instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await _,i.issues.length!==l&&(u||(u=$o(i,l)))});else{if(i.issues.length===l)continue;u||(u=$o(i,l))}}return f?f.then(()=>i):i},s=(i,a,c)=>{if($o(i))return i.aborted=!0,i;const u=o(a,r,c);if(u instanceof Promise){if(c.async===!1)throw new Zo;return u.then(f=>e._zod.parse(f,c))}return e._zod.parse(u,c)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return u instanceof Promise?u.then(f=>s(f,i,a)):s(u,i,a)}const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new Zo;return c.then(u=>o(u,r,a))}return o(c,r,a)}}e["~standard"]={validate:o=>{try{const s=MZ(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return vZ(e,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),aT=W("$ZodString",(e,t)=>{Ze.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??i4(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),$e=W("$ZodStringFormat",(e,t)=>{ud.init(e,t),aT.init(e,t)}),O4=W("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=WZ),$e.init(e,t)}),b4=W("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=xO(r))}else t.pattern??(t.pattern=xO());$e.init(e,t)}),C4=W("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=KZ),$e.init(e,t)}),I4=W("$ZodURL",(e,t)=>{$e.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),o=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=o.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),P4=W("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=ZZ()),$e.init(e,t)}),M4=W("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=jZ),$e.init(e,t)}),v4=W("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=$Z),$e.init(e,t)}),w4=W("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=BZ),$e.init(e,t)}),L4=W("$ZodULID",(e,t)=>{t.pattern??(t.pattern=HZ),$e.init(e,t)}),D4=W("$ZodXID",(e,t)=>{t.pattern??(t.pattern=FZ),$e.init(e,t)}),U4=W("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=YZ),$e.init(e,t)}),k4=W("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=s4(t)),$e.init(e,t)}),x4=W("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=r4),$e.init(e,t)}),G4=W("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=o4(t)),$e.init(e,t)}),V4=W("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=qZ),$e.init(e,t)}),$4=W("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=XZ),$e.init(e,t),e._zod.bag.format="ipv4"}),B4=W("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=QZ),$e.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),H4=W("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=JZ),$e.init(e,t)}),F4=W("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=e4),$e.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[o,s]=r;if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function LL(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Y4=W("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=t4),$e.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{LL(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function j4(e){if(!CL.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return LL(n)}const q4=W("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=CL),$e.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{j4(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),W4=W("$ZodE164",(e,t)=>{t.pattern??(t.pattern=n4),$e.init(e,t)});function K4(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const z4=W("$ZodJWT",(e,t)=>{$e.init(e,t),e._zod.check=n=>{K4(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),DL=W("$ZodNumber",(e,t)=>{Ze.init(e,t),e._zod.pattern=e._zod.bag.pattern??c4,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),Z4=W("$ZodNumberFormat",(e,t)=>{f4.init(e,t),DL.init(e,t)}),X4=W("$ZodUnknown",(e,t)=>{Ze.init(e,t),e._zod.parse=n=>n}),Q4=W("$ZodNever",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function GO(e,t,n){e.issues.length&&t.issues.push(...yL(n,e.issues)),t.value[n]=e.value}const J4=W("$ZodArray",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},r);c instanceof Promise?s.push(c.then(u=>GO(u,n,i))):GO(c,n,i)}return s.length?Promise.all(s).then(()=>n):n}});function ul(e,t,n,r){e.issues.length&&t.issues.push(...yL(n,e.issues)),e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function UL(e){const t=Object.keys(e.shape);for(const r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=mZ(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function kL(e,t,n,r,o,s){const i=[],a=o.keySet,c=o.catchall._zod,u=c.def.type;for(const f in t){if(a.has(f))continue;if(u==="never"){i.push(f);continue}const d=c.run({value:t[f],issues:[]},r);d instanceof Promise?e.push(d.then(l=>ul(l,n,f,t))):ul(d,n,f,t)}return i.length&&n.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:s}),e.length?Promise.all(e).then(()=>n):n}const e9=W("$ZodObject",(e,t)=>{if(Ze.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const r=tT(()=>UL(t));ke(e._zod,"propValues",()=>{const a=t.shape,c={};for(const u in a){const f=a[u]._zod;if(f.values){c[u]??(c[u]=new Set);for(const d of f.values)c[u].add(d)}}return c});const o=cl,s=t.catchall;let i;e._zod.parse=(a,c)=>{i??(i=r.value);const u=a.value;if(!o(u))return a.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),a;a.value={};const f=[],d=i.shape;for(const l of i.keys){const p=d[l]._zod.run({value:u[l],issues:[]},c);p instanceof Promise?f.push(p.then(h=>ul(h,a,l,u))):ul(p,a,l,u)}return s?kL(f,u,a,c,r.value,e):f.length?Promise.all(f).then(()=>a):a}}),t9=W("$ZodObjectJIT",(e,t)=>{e9.init(e,t);const n=e._zod.parse,r=tT(()=>UL(t)),o=l=>{const _=new y4(["shape","payload","ctx"]),p=r.value,h=g=>{const A=kO(g);return`shape[${A}]._zod.run({ value: input[${A}], issues: [] }, ctx)`};_.write("const input = payload.value;");const E=Object.create(null);let T=0;for(const g of p.keys)E[g]=`key_${T++}`;_.write("const newResult = {};");for(const g of p.keys){const A=E[g],R=kO(g);_.write(`const ${A} = ${h(g)};`),_.write(`
        if (${A}.issues.length) {
          payload.issues = payload.issues.concat(${A}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${R}, ...iss.path] : [${R}]
          })));
        }
        
        
        if (${A}.value === undefined) {
          if (${R} in input) {
            newResult[${R}] = undefined;
          }
        } else {
          newResult[${R}] = ${A}.value;
        }
        
      `)}_.write("payload.value = newResult;"),_.write("return payload;");const S=_.compile();return(g,A)=>S(l,g,A)};let s;const i=cl,a=!gL.jitless,u=a&&TZ.value,f=t.catchall;let d;e._zod.parse=(l,_)=>{d??(d=r.value);const p=l.value;return i(p)?a&&u&&_?.async===!1&&_.jitless!==!0?(s||(s=o(t.shape)),l=s(l,_),f?kL([],p,l,_,d,e):l):n(l,_):(l.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),l)}});function VO(e,t,n,r){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!$o(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(s=>s.issues.map(i=>To(i,r,Eo())))}),t)}const n9=W("$ZodUnion",(e,t)=>{Ze.init(e,t),ke(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),ke(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),ke(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),ke(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${o.map(s=>rT(s.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(o,s)=>{if(n)return r(o,s);let i=!1;const a=[];for(const c of t.options){const u=c._zod.run({value:o.value,issues:[]},s);if(u instanceof Promise)a.push(u),i=!0;else{if(u.issues.length===0)return u;a.push(u)}}return i?Promise.all(a).then(c=>VO(c,o,e,s)):VO(a,o,e,s)}}),r9=W("$ZodIntersection",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{const o=n.value,s=t.left._zod.run({value:o,issues:[]},r),i=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,u])=>$O(n,c,u)):$O(n,s,i)}});function Mh(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(bc(e)&&bc(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const i=Mh(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],i=Mh(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[r,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function $O(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),$o(e))return e;const r=Mh(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const o9=W("$ZodEnum",(e,t)=>{Ze.init(e,t);const n=pZ(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(o=>SZ.has(typeof o)).map(o=>typeof o=="string"?ss(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return r.has(i)||o.issues.push({code:"invalid_value",values:n,input:i,inst:e}),o}}),s9=W("$ZodLiteral",(e,t)=>{if(Ze.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?ss(r):r?ss(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,o)=>{const s=r.value;return n.has(s)||r.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),r}}),i9=W("$ZodTransform",(e,t)=>{Ze.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new mL(e.constructor.name);const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(n.value=i,n));if(o instanceof Promise)throw new Zo;return n.value=o,n}});function BO(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const a9=W("$ZodOptional",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",e._zod.optout="optional",ke(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),ke(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${rT(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>BO(s,n.value)):BO(o,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),c9=W("$ZodNullable",(e,t)=>{Ze.init(e,t),ke(e._zod,"optin",()=>t.innerType._zod.optin),ke(e._zod,"optout",()=>t.innerType._zod.optout),ke(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${rT(n.source)}|null)$`):void 0}),ke(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),u9=W("$ZodDefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>HO(s,t)):HO(o,t)}});function HO(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const l9=W("$ZodPrefault",(e,t)=>{Ze.init(e,t),e._zod.optin="optional",ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),d9=W("$ZodNonOptional",(e,t)=>{Ze.init(e,t),ke(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>FO(s,e)):FO(o,e)}});function FO(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const f9=W("$ZodCatch",(e,t)=>{Ze.init(e,t),ke(e._zod,"optin",()=>t.innerType._zod.optin),ke(e._zod,"optout",()=>t.innerType._zod.optout),ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(i=>To(i,r,Eo()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>To(s,r,Eo()))},input:n.value}),n.issues=[]),n)}}),_9=W("$ZodPipe",(e,t)=>{Ze.init(e,t),ke(e._zod,"values",()=>t.in._zod.values),ke(e._zod,"optin",()=>t.in._zod.optin),ke(e._zod,"optout",()=>t.out._zod.optout),ke(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const s=t.out._zod.run(n,r);return s instanceof Promise?s.then(i=>lu(i,t.in,r)):lu(s,t.in,r)}const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>lu(s,t.out,r)):lu(o,t.out,r)}});function lu(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const p9=W("$ZodReadonly",(e,t)=>{Ze.init(e,t),ke(e._zod,"propValues",()=>t.innerType._zod.propValues),ke(e._zod,"values",()=>t.innerType._zod.values),ke(e._zod,"optin",()=>t.innerType?._zod?.optin),ke(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(YO):YO(o)}});function YO(e){return e.value=Object.freeze(e.value),e}const h9=W("$ZodCustom",(e,t)=>{vt.init(e,t),Ze.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>jO(s,n,r,e));jO(o,n,r,e)}});function jO(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(Cc(o))}}var qO;class E9{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const o={...r,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function T9(){return new E9}(qO=globalThis).__zod_globalRegistry??(qO.__zod_globalRegistry=T9());const du=globalThis.__zod_globalRegistry;function S9(e,t){return new e({type:"string",...fe(t)})}function m9(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...fe(t)})}function WO(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...fe(t)})}function g9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...fe(t)})}function A9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...fe(t)})}function R9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...fe(t)})}function y9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...fe(t)})}function N9(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...fe(t)})}function O9(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...fe(t)})}function b9(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...fe(t)})}function C9(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...fe(t)})}function I9(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...fe(t)})}function P9(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...fe(t)})}function M9(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...fe(t)})}function v9(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...fe(t)})}function w9(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...fe(t)})}function L9(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...fe(t)})}function D9(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...fe(t)})}function U9(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...fe(t)})}function k9(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...fe(t)})}function x9(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...fe(t)})}function G9(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...fe(t)})}function V9(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...fe(t)})}function $9(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...fe(t)})}function B9(e,t){return new e({type:"string",format:"date",check:"string_format",...fe(t)})}function H9(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...fe(t)})}function F9(e,t){return new e({type:"string",format:"duration",check:"string_format",...fe(t)})}function Y9(e,t){return new e({type:"number",checks:[],...fe(t)})}function j9(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...fe(t)})}function q9(e){return new e({type:"unknown"})}function W9(e,t){return new e({type:"never",...fe(t)})}function KO(e,t){return new vL({check:"less_than",...fe(t),value:e,inclusive:!1})}function Xf(e,t){return new vL({check:"less_than",...fe(t),value:e,inclusive:!0})}function zO(e,t){return new wL({check:"greater_than",...fe(t),value:e,inclusive:!1})}function Qf(e,t){return new wL({check:"greater_than",...fe(t),value:e,inclusive:!0})}function ZO(e,t){return new d4({check:"multiple_of",...fe(t),value:e})}function xL(e,t){return new _4({check:"max_length",...fe(t),maximum:e})}function ll(e,t){return new p4({check:"min_length",...fe(t),minimum:e})}function GL(e,t){return new h4({check:"length_equals",...fe(t),length:e})}function K9(e,t){return new E4({check:"string_format",format:"regex",...fe(t),pattern:e})}function z9(e){return new T4({check:"string_format",format:"lowercase",...fe(e)})}function Z9(e){return new S4({check:"string_format",format:"uppercase",...fe(e)})}function X9(e,t){return new m4({check:"string_format",format:"includes",...fe(t),includes:e})}function Q9(e,t){return new g4({check:"string_format",format:"starts_with",...fe(t),prefix:e})}function J9(e,t){return new A4({check:"string_format",format:"ends_with",...fe(t),suffix:e})}function Es(e){return new R4({check:"overwrite",tx:e})}function eX(e){return Es(t=>t.normalize(e))}function tX(){return Es(e=>e.trim())}function nX(){return Es(e=>e.toLowerCase())}function rX(){return Es(e=>e.toUpperCase())}function oX(){return Es(e=>EZ(e))}function sX(e,t,n){return new e({type:"array",element:t,...fe(n)})}function iX(e,t,n){return new e({type:"custom",check:"custom",fn:t,...fe(n)})}function aX(e){const t=cX(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Cc(r,n.value,t._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),n.issues.push(Cc(o))}},e(n.value,n)));return t}function cX(e,t){const n=new vt({check:"custom",...fe(t)});return n._zod.check=e,n}const uX=W("ZodISODateTime",(e,t)=>{k4.init(e,t),Ye.init(e,t)});function lX(e){return $9(uX,e)}const dX=W("ZodISODate",(e,t)=>{x4.init(e,t),Ye.init(e,t)});function fX(e){return B9(dX,e)}const _X=W("ZodISOTime",(e,t)=>{G4.init(e,t),Ye.init(e,t)});function pX(e){return H9(_X,e)}const hX=W("ZodISODuration",(e,t)=>{V4.init(e,t),Ye.init(e,t)});function EX(e){return F9(hX,e)}const TX=(e,t)=>{OL.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>PZ(e,n)},flatten:{value:n=>IZ(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,Ph,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,Ph,2)}},isEmpty:{get(){return e.issues.length===0}}})},Qt=W("ZodError",TX,{Parent:Error}),SX=sT(Qt),mX=iT(Qt),gX=ad(Qt),AX=cd(Qt),RX=wZ(Qt),yX=LZ(Qt),NX=DZ(Qt),OX=UZ(Qt),bX=kZ(Qt),CX=xZ(Qt),IX=GZ(Qt),PX=VZ(Qt),Je=W("ZodType",(e,t)=>(Ze.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(Oo(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),e.clone=(n,r)=>fr(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>SX(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>gX(e,n,r),e.parseAsync=async(n,r)=>mX(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>AX(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>RX(e,n,r),e.decode=(n,r)=>yX(e,n,r),e.encodeAsync=async(n,r)=>NX(e,n,r),e.decodeAsync=async(n,r)=>OX(e,n,r),e.safeEncode=(n,r)=>bX(e,n,r),e.safeDecode=(n,r)=>CX(e,n,r),e.safeEncodeAsync=async(n,r)=>IX(e,n,r),e.safeDecodeAsync=async(n,r)=>PX(e,n,r),e.refine=(n,r)=>e.check(gQ(n,r)),e.superRefine=n=>e.check(AQ(n)),e.overwrite=n=>e.check(Es(n)),e.optional=()=>eb(e),e.nullable=()=>tb(e),e.nullish=()=>eb(tb(e)),e.nonoptional=n=>_Q(e,n),e.array=()=>ld(e),e.or=n=>tQ([e,n]),e.and=n=>rQ(e,n),e.transform=n=>nb(e,aQ(n)),e.default=n=>lQ(e,n),e.prefault=n=>fQ(e,n),e.catch=n=>hQ(e,n),e.pipe=n=>nb(e,n),e.readonly=()=>SQ(e),e.describe=n=>{const r=e.clone();return du.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){return du.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return du.get(e);const r=e.clone();return du.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),VL=W("_ZodString",(e,t)=>{aT.init(e,t),Je.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(K9(...r)),e.includes=(...r)=>e.check(X9(...r)),e.startsWith=(...r)=>e.check(Q9(...r)),e.endsWith=(...r)=>e.check(J9(...r)),e.min=(...r)=>e.check(ll(...r)),e.max=(...r)=>e.check(xL(...r)),e.length=(...r)=>e.check(GL(...r)),e.nonempty=(...r)=>e.check(ll(1,...r)),e.lowercase=r=>e.check(z9(r)),e.uppercase=r=>e.check(Z9(r)),e.trim=()=>e.check(tX()),e.normalize=(...r)=>e.check(eX(...r)),e.toLowerCase=()=>e.check(nX()),e.toUpperCase=()=>e.check(rX()),e.slugify=()=>e.check(oX())}),MX=W("ZodString",(e,t)=>{aT.init(e,t),VL.init(e,t),e.email=n=>e.check(m9(vX,n)),e.url=n=>e.check(N9(wX,n)),e.jwt=n=>e.check(V9(WX,n)),e.emoji=n=>e.check(O9(LX,n)),e.guid=n=>e.check(WO(XO,n)),e.uuid=n=>e.check(g9(fu,n)),e.uuidv4=n=>e.check(A9(fu,n)),e.uuidv6=n=>e.check(R9(fu,n)),e.uuidv7=n=>e.check(y9(fu,n)),e.nanoid=n=>e.check(b9(DX,n)),e.guid=n=>e.check(WO(XO,n)),e.cuid=n=>e.check(C9(UX,n)),e.cuid2=n=>e.check(I9(kX,n)),e.ulid=n=>e.check(P9(xX,n)),e.base64=n=>e.check(k9(YX,n)),e.base64url=n=>e.check(x9(jX,n)),e.xid=n=>e.check(M9(GX,n)),e.ksuid=n=>e.check(v9(VX,n)),e.ipv4=n=>e.check(w9($X,n)),e.ipv6=n=>e.check(L9(BX,n)),e.cidrv4=n=>e.check(D9(HX,n)),e.cidrv6=n=>e.check(U9(FX,n)),e.e164=n=>e.check(G9(qX,n)),e.datetime=n=>e.check(lX(n)),e.date=n=>e.check(fX(n)),e.time=n=>e.check(pX(n)),e.duration=n=>e.check(EX(n))});function it(e){return S9(MX,e)}const Ye=W("ZodStringFormat",(e,t)=>{$e.init(e,t),VL.init(e,t)}),vX=W("ZodEmail",(e,t)=>{C4.init(e,t),Ye.init(e,t)}),XO=W("ZodGUID",(e,t)=>{O4.init(e,t),Ye.init(e,t)}),fu=W("ZodUUID",(e,t)=>{b4.init(e,t),Ye.init(e,t)}),wX=W("ZodURL",(e,t)=>{I4.init(e,t),Ye.init(e,t)}),LX=W("ZodEmoji",(e,t)=>{P4.init(e,t),Ye.init(e,t)}),DX=W("ZodNanoID",(e,t)=>{M4.init(e,t),Ye.init(e,t)}),UX=W("ZodCUID",(e,t)=>{v4.init(e,t),Ye.init(e,t)}),kX=W("ZodCUID2",(e,t)=>{w4.init(e,t),Ye.init(e,t)}),xX=W("ZodULID",(e,t)=>{L4.init(e,t),Ye.init(e,t)}),GX=W("ZodXID",(e,t)=>{D4.init(e,t),Ye.init(e,t)}),VX=W("ZodKSUID",(e,t)=>{U4.init(e,t),Ye.init(e,t)}),$X=W("ZodIPv4",(e,t)=>{$4.init(e,t),Ye.init(e,t)}),BX=W("ZodIPv6",(e,t)=>{B4.init(e,t),Ye.init(e,t)}),HX=W("ZodCIDRv4",(e,t)=>{H4.init(e,t),Ye.init(e,t)}),FX=W("ZodCIDRv6",(e,t)=>{F4.init(e,t),Ye.init(e,t)}),YX=W("ZodBase64",(e,t)=>{Y4.init(e,t),Ye.init(e,t)}),jX=W("ZodBase64URL",(e,t)=>{q4.init(e,t),Ye.init(e,t)}),qX=W("ZodE164",(e,t)=>{W4.init(e,t),Ye.init(e,t)}),WX=W("ZodJWT",(e,t)=>{z4.init(e,t),Ye.init(e,t)}),$L=W("ZodNumber",(e,t)=>{DL.init(e,t),Je.init(e,t),e.gt=(r,o)=>e.check(zO(r,o)),e.gte=(r,o)=>e.check(Qf(r,o)),e.min=(r,o)=>e.check(Qf(r,o)),e.lt=(r,o)=>e.check(KO(r,o)),e.lte=(r,o)=>e.check(Xf(r,o)),e.max=(r,o)=>e.check(Xf(r,o)),e.int=r=>e.check(QO(r)),e.safe=r=>e.check(QO(r)),e.positive=r=>e.check(zO(0,r)),e.nonnegative=r=>e.check(Qf(0,r)),e.negative=r=>e.check(KO(0,r)),e.nonpositive=r=>e.check(Xf(0,r)),e.multipleOf=(r,o)=>e.check(ZO(r,o)),e.step=(r,o)=>e.check(ZO(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function fc(e){return Y9($L,e)}const KX=W("ZodNumberFormat",(e,t)=>{Z4.init(e,t),$L.init(e,t)});function QO(e){return j9(KX,e)}const zX=W("ZodUnknown",(e,t)=>{X4.init(e,t),Je.init(e,t)});function JO(){return q9(zX)}const ZX=W("ZodNever",(e,t)=>{Q4.init(e,t),Je.init(e,t)});function XX(e){return W9(ZX,e)}const QX=W("ZodArray",(e,t)=>{J4.init(e,t),Je.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(ll(n,r)),e.nonempty=n=>e.check(ll(1,n)),e.max=(n,r)=>e.check(xL(n,r)),e.length=(n,r)=>e.check(GL(n,r)),e.unwrap=()=>e.element});function ld(e,t){return sX(QX,e,t)}const JX=W("ZodObject",(e,t)=>{t9.init(e,t),Je.init(e,t),ke(e,"shape",()=>t.shape),e.keyof=()=>dl(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:JO()}),e.loose=()=>e.clone({...e._zod.def,catchall:JO()}),e.strict=()=>e.clone({...e._zod.def,catchall:XX()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>yZ(e,n),e.safeExtend=n=>NZ(e,n),e.merge=n=>OZ(e,n),e.pick=n=>AZ(e,n),e.omit=n=>RZ(e,n),e.partial=(...n)=>bZ(BL,e,n[0]),e.required=(...n)=>CZ(HL,e,n[0])});function zn(e,t){const n={type:"object",shape:e??{},...fe(t)};return new JX(n)}const eQ=W("ZodUnion",(e,t)=>{n9.init(e,t),Je.init(e,t),e.options=t.options});function tQ(e,t){return new eQ({type:"union",options:e,...fe(t)})}const nQ=W("ZodIntersection",(e,t)=>{r9.init(e,t),Je.init(e,t)});function rQ(e,t){return new nQ({type:"intersection",left:e,right:t})}const vh=W("ZodEnum",(e,t)=>{o9.init(e,t),Je.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const i of r)if(n.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new vh({...t,checks:[],...fe(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const i of r)if(n.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new vh({...t,checks:[],...fe(o),entries:s})}});function dl(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new vh({type:"enum",entries:n,...fe(t)})}const oQ=W("ZodLiteral",(e,t)=>{s9.init(e,t),Je.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function sQ(e,t){return new oQ({type:"literal",values:Array.isArray(e)?e:[e],...fe(t)})}const iQ=W("ZodTransform",(e,t)=>{i9.init(e,t),Je.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new mL(e.constructor.name);n.addIssue=s=>{if(typeof s=="string")n.issues.push(Cc(s,n.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),n.issues.push(Cc(i))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function aQ(e){return new iQ({type:"transform",transform:e})}const BL=W("ZodOptional",(e,t)=>{a9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType});function eb(e){return new BL({type:"optional",innerType:e})}const cQ=W("ZodNullable",(e,t)=>{c9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType});function tb(e){return new cQ({type:"nullable",innerType:e})}const uQ=W("ZodDefault",(e,t)=>{u9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function lQ(e,t){return new uQ({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():RL(t)}})}const dQ=W("ZodPrefault",(e,t)=>{l9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType});function fQ(e,t){return new dQ({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():RL(t)}})}const HL=W("ZodNonOptional",(e,t)=>{d9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType});function _Q(e,t){return new HL({type:"nonoptional",innerType:e,...fe(t)})}const pQ=W("ZodCatch",(e,t)=>{f9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function hQ(e,t){return new pQ({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const EQ=W("ZodPipe",(e,t)=>{_9.init(e,t),Je.init(e,t),e.in=t.in,e.out=t.out});function nb(e,t){return new EQ({type:"pipe",in:e,out:t})}const TQ=W("ZodReadonly",(e,t)=>{p9.init(e,t),Je.init(e,t),e.unwrap=()=>e._zod.def.innerType});function SQ(e){return new TQ({type:"readonly",innerType:e})}const mQ=W("ZodCustom",(e,t)=>{h9.init(e,t),Je.init(e,t)});function gQ(e,t={}){return iX(mQ,e,t)}function AQ(e){return aX(e)}const RQ=dl(["ACTIVE","PAUSED","DELETED"]);zn({version:fc().optional(),id:it(),name:it(),prompt:it(),status:RQ,rrule:it().optional(),cwds:ld(it()),created_at:fc(),updated_at:fc()});const yQ={Dev:"dev",InternalAlpha:"internal-alpha",PublicBeta:"public-beta",Prod:"prod"},NQ=Object.values(yQ);NQ.join(", ");function we(e){return e==null?!1:e.kind==="ssh"||e.kind==="brix"}const OQ="codex.localEnvironmentConfigPath",bQ="__none__",CQ=["tool","run","debug","test"],IQ=["darwin","linux","win32"],PQ=zn({name:it(),icon:dl(CQ).nullable().catch(null),command:it(),platform:dl(IQ).optional()}),Jf=zn({script:it()}),MQ=zn({script:it(),darwin:Jf.optional(),linux:Jf.optional(),win32:Jf.optional()}),vQ=zn({version:fc().int().min(1).default(1),name:it(),setup:MQ,actions:ld(PQ).optional()}),wQ={error:!0,"thread/started":!0,"thread/name/updated":!1,"thread/tokenUsage/updated":!0,"turn/started":!0,"turn/completed":!0,"turn/diff/updated":!0,"turn/plan/updated":!0,"item/started":!0,"item/completed":!0,"rawResponseItem/completed":!1,"item/agentMessage/delta":!0,"item/plan/delta":!0,"item/commandExecution/outputDelta":!0,"item/commandExecution/terminalInteraction":!1,"item/fileChange/outputDelta":!0,"item/mcpToolCall/progress":!0,"mcpServer/oauthLogin/completed":!0,"account/updated":!0,"account/rateLimits/updated":!0,"app/list/updated":!0,"item/reasoning/summaryTextDelta":!0,"item/reasoning/summaryPartAdded":!0,"item/reasoning/textDelta":!0,"thread/compacted":!1,deprecationNotice:!0,configWarning:!0,"windows/worldWritableWarning":!1,"account/login/completed":!0,"model/rerouted":!0,authStatusChange:!1,loginChatGptComplete:!1,sessionConfigured:!1,"codex/event/session_configured":!1,"codex/event/task_started":!1,"codex/event/agent_reasoning":!1,"codex/event/agent_message":!1,"codex/event/task_complete":!1,"codex/event/mcp_tool_call_begin":!1,"codex/event/mcp_tool_call_end":!1,"codex/event/exec_command_begin":!1,"codex/event/exec_command_end":!1,"codex/event/exec_command_output_delta":!1,"codex/event/exec_approval_request":!1,"codex/event/apply_patch_approval_request":!1,"codex/event/background_event":!1,"codex/event/turn_diff":!1,"codex/event/get_history_entry_response":!1,"codex/event/agent_reasoning_delta":!1,"codex/event/agent_reasoning_section_break":!1,"codex/event/agent_message_delta":!1,"codex/event/stream_error":!1,"codex/event/error":!1,"codex/event/turn_aborted":!1,"codex/event/plan_delta":!1,"codex/event/plan_update":!1,"codex/event/patch_apply_begin":!1,"codex/event/patch_apply_end":!1,"codex/event/item_started":!1,"codex/event/item_completed":!1,"codex/event/user_message":!1,"codex/event/agent_reasoning_raw_content":!1,"codex/event/agent_reasoning_raw_content_delta":!1,"codex/event/web_search_begin":!1,"codex/event/web_search_end":!1,"codex/event/mcp_list_tools_response":!1,"codex/event/list_skills_response":!1,"codex/event/list_remote_skills_response":!1,"codex/event/remote_skill_downloaded":!1,"codex/event/list_custom_prompts_response":!1,"codex/event/raw_response_item":!1,"codex/event/agent_message_content_delta":!1,"codex/event/reasoning_content_delta":!1,"codex/event/reasoning_raw_content_delta":!1,"codex/event/warning":!1,"codex/event/undo_started":!1,"codex/event/undo_completed":!1,"codex/event/shutdown_complete":!1,"codex/event/entered_review_mode":!1,"codex/event/exited_review_mode":!1,"codex/event/view_image_tool_call":!1,"codex/event/mcp_startup_update":!1,"codex/event/mcp_startup_complete":!1,"codex/event/remote_task_created":!1,"codex/event/thread_rolled_back":!1,"codex/event/thread_name_updated":!1,"codex/event/collab_agent_spawn_begin":!1,"codex/event/collab_agent_spawn_end":!1,"codex/event/collab_agent_interaction_begin":!1,"codex/event/collab_agent_interaction_end":!1,"codex/event/collab_resume_begin":!1,"codex/event/collab_resume_end":!1,"codex/event/collab_waiting_begin":!1,"codex/event/collab_waiting_end":!1,"codex/event/collab_close_begin":!1,"codex/event/collab_close_end":!1,"codex/event/elicitation_request":!1,"codex/event/dynamic_tool_call_request":!1,"codex/event/request_user_input":!1,"codex/event/terminal_interaction":!1,"codex/event/token_count":!1,"codex/event/deprecation_notice":!1,"fuzzyFileSearch/sessionUpdated":!0,"fuzzyFileSearch/sessionCompleted":!0,"thread/archived":!1,"thread/unarchived":!1};Object.entries(wQ).filter(([,e])=>!e).map(([e])=>e);function ue(e){return{type:"ok",value:e}}function vo(e){return{type:"error",error:{message:e instanceof Error?e.message:String(e)}}}const LQ="https://17de4aef18bcd467f0a250b004f16737@o33249.ingest.us.sentry.io/4510507758977024",DQ="codex-desktop@";function UQ(e){return`${DQ}${e}`}function kQ(e){switch(e){case"dev":case"internal-alpha":case"public-beta":return!0;case"prod":return!1}}function xQ(e){return kQ(e)?1:0}var e_,rb;function GQ(){return rb||(rb=1,e_=function(){}),e_}var t_,ob;function bo(){if(ob)return t_;ob=1;var e=GQ()();return t_=function(t){return t!==e&&t!==null},t_}var n_,sb;function FL(){if(sb)return n_;sb=1;var e=bo(),t=Array.prototype.forEach,n=Object.create,r=function(o,s){var i;for(i in o)s[i]=o[i]};return n_=function(o){var s=n(null);return t.call(arguments,function(i){e(i)&&r(Object(i),s)}),s},n_}var r_,ib;function VQ(){return ib||(ib=1,r_=function(){var e=Math.sign;return typeof e!="function"?!1:e(10)===1&&e(-20)===-1}),r_}var o_,ab;function $Q(){return ab||(ab=1,o_=function(e){return e=Number(e),isNaN(e)||e===0?e:e>0?1:-1}),o_}var s_,cb;function BQ(){return cb||(cb=1,s_=VQ()()?Math.sign:$Q()),s_}var i_,ub;function HQ(){if(ub)return i_;ub=1;var e=BQ(),t=Math.abs,n=Math.floor;return i_=function(r){return isNaN(r)?0:(r=Number(r),r===0||!isFinite(r)?r:e(r)*n(t(r)))},i_}var a_,lb;function Co(){if(lb)return a_;lb=1;var e=HQ(),t=Math.max;return a_=function(n){return t(0,e(n))},a_}var c_,db;function YL(){if(db)return c_;db=1;var e=Co();return c_=function(t,n,r){var o;return isNaN(t)?(o=n,o>=0?r&&o?o-1:o:1):t===!1?!1:e(t)},c_}var u_,fb;function _r(){return fb||(fb=1,u_=function(e){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}),u_}var l_,_b;function Ts(){if(_b)return l_;_b=1;var e=bo();return l_=function(t){if(!e(t))throw new TypeError("Cannot use null or undefined");return t},l_}var d_,pb;function FQ(){if(pb)return d_;pb=1;var e=_r(),t=Ts(),n=Function.prototype.bind,r=Function.prototype.call,o=Object.keys,s=Object.prototype.propertyIsEnumerable;return d_=function(i,a){return function(c,u){var f,d=arguments[2],l=arguments[3];return c=Object(t(c)),e(u),f=o(c),l&&f.sort(typeof l=="function"?n.call(l,c):void 0),typeof i!="function"&&(i=f[i]),r.call(i,f,function(_,p){return s.call(c,_)?r.call(u,d,c[_],_,c,p):a})}},d_}var f_,hb;function dd(){return hb||(hb=1,f_=FQ()("forEach")),f_}var Eb={},Tb;function Io(){return Tb||(Tb=1),Eb}var __={exports:{}},p_,Sb;function YQ(){return Sb||(Sb=1,p_=function(){var e=Object.assign,t;return typeof e!="function"?!1:(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}),p_}var h_,mb;function jQ(){return mb||(mb=1,h_=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),h_}var E_,gb;function qQ(){if(gb)return E_;gb=1;var e=bo(),t=Object.keys;return E_=function(n){return t(e(n)?Object(n):n)},E_}var T_,Ab;function WQ(){return Ab||(Ab=1,T_=jQ()()?Object.keys:qQ()),T_}var S_,Rb;function KQ(){if(Rb)return S_;Rb=1;var e=WQ(),t=Ts(),n=Math.max;return S_=function(r,o){var s,i,a=n(arguments.length,2),c;for(r=Object(t(r)),c=function(u){try{r[u]=o[u]}catch(f){s||(s=f)}},i=1;i<a;++i)o=arguments[i],e(o).forEach(c);if(s!==void 0)throw s;return r},S_}var m_,yb;function jL(){return yb||(yb=1,m_=YQ()()?Object.assign:KQ()),m_}var g_,Nb;function zQ(){if(Nb)return g_;Nb=1;var e=bo(),t={function:!0,object:!0};return g_=function(n){return e(n)&&t[typeof n]||!1},g_}var Ob;function ZQ(){return Ob||(Ob=1,(function(e){var t=jL(),n=zQ(),r=bo(),o=Error.captureStackTrace;e.exports=function(s){var i=new Error(s),a=arguments[1],c=arguments[2];return r(c)||n(a)&&(c=a,a=null),r(c)&&t(i,c),r(a)&&(i.code=a),o&&o(i,e.exports),i}})(__)),__.exports}var _u={exports:{}},A_,bb;function qL(){if(bb)return A_;bb=1;var e=Ts(),t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.getOwnPropertySymbols;return A_=function(s,i){var a,c=Object(e(i));if(s=Object(e(s)),r(c).forEach(function(u){try{t(s,u,n(i,u))}catch(f){a=f}}),typeof o=="function"&&o(c).forEach(function(u){try{t(s,u,n(i,u))}catch(f){a=f}}),a!==void 0)throw a;return s},A_}var Cb;function WL(){if(Cb)return _u.exports;Cb=1;var e=Co(),t=function(i,a){return a},n,r,o,s;try{Object.defineProperty(t,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch{}return t.length===1?(n={configurable:!0,writable:!1,enumerable:!1},r=Object.defineProperty,_u.exports=function(i,a){return a=e(a),i.length===a?i:(n.value=a,r(i,"length",n))}):(s=qL(),o=(function(){var i=[];return function(a){var c,u=0;if(i[a])return i[a];for(c=[];a--;)c.push("a"+(++u).toString(36));return new Function("fn","return function ("+c.join(", ")+") { return fn.apply(this, arguments); };")}})(),_u.exports=function(i,a){var c;if(a=e(a),i.length===a)return i;c=o(a)(i);try{s(c,i)}catch{}return c}),_u.exports}var R_={exports:{}},y_,Ib;function KL(){if(Ib)return y_;Ib=1;var e=void 0;return y_=function(t){return t!==e&&t!==null},y_}var N_,Pb;function XQ(){if(Pb)return N_;Pb=1;var e=KL(),t={object:!0,function:!0,undefined:!0};return N_=function(n){return e(n)?hasOwnProperty.call(t,typeof n):!1},N_}var O_,Mb;function QQ(){if(Mb)return O_;Mb=1;var e=XQ();return O_=function(t){if(!e(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},O_}var b_,vb;function JQ(){if(vb)return b_;vb=1;var e=QQ();return b_=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!e(t)},b_}var C_,wb;function e5(){if(wb)return C_;wb=1;var e=JQ(),t=/^\s*class[\s{/}]/,n=Function.prototype.toString;return C_=function(r){return!(!e(r)||t.test(n.call(r)))},C_}var I_,Lb;function t5(){if(Lb)return I_;Lb=1;var e="razdwatrzy";return I_=function(){return typeof e.contains!="function"?!1:e.contains("dwa")===!0&&e.contains("foo")===!1},I_}var P_,Db;function n5(){if(Db)return P_;Db=1;var e=String.prototype.indexOf;return P_=function(t){return e.call(this,t,arguments[1])>-1},P_}var M_,Ub;function r5(){return Ub||(Ub=1,M_=t5()()?String.prototype.contains:n5()),M_}var kb;function Po(){if(kb)return R_.exports;kb=1;var e=KL(),t=e5(),n=jL(),r=FL(),o=r5(),s=R_.exports=function(i,a){var c,u,f,d,l;return arguments.length<2||typeof i!="string"?(d=a,a=i,i=null):d=arguments[2],e(i)?(c=o.call(i,"c"),u=o.call(i,"e"),f=o.call(i,"w")):(c=f=!0,u=!1),l={value:a,configurable:c,enumerable:u,writable:f},d?n(r(d),l):l};return s.gs=function(i,a,c){var u,f,d,l;return typeof i!="string"?(d=c,c=a,a=i,i=null):d=arguments[3],e(a)?t(a)?e(c)?t(c)||(d=c,c=void 0):c=void 0:(d=a,a=c=void 0):a=void 0,e(i)?(u=o.call(i,"c"),f=o.call(i,"e")):(u=!0,f=!1),l={get:a,set:c,configurable:u,enumerable:f},d?n(r(d),l):l},R_.exports}var pu={exports:{}},xb;function o5(){return xb||(xb=1,(function(e,t){var n=Po(),r=_r(),o=Function.prototype.apply,s=Function.prototype.call,i=Object.create,a=Object.defineProperty,c=Object.defineProperties,u=Object.prototype.hasOwnProperty,f={configurable:!0,enumerable:!1,writable:!0},d,l,_,p,h,E,T;d=function(S,g){var A;return r(g),u.call(this,"__ee__")?A=this.__ee__:(A=f.value=i(null),a(this,"__ee__",f),f.value=null),A[S]?typeof A[S]=="object"?A[S].push(g):A[S]=[A[S],g]:A[S]=g,this},l=function(S,g){var A,R;return r(g),R=this,d.call(this,S,A=function(){_.call(R,S,A),o.call(g,this,arguments)}),A.__eeOnceListener__=g,this},_=function(S,g){var A,R,O,C;if(r(g),!u.call(this,"__ee__"))return this;if(A=this.__ee__,!A[S])return this;if(R=A[S],typeof R=="object")for(C=0;O=R[C];++C)(O===g||O.__eeOnceListener__===g)&&(R.length===2?A[S]=R[C?0:1]:R.splice(C,1));else(R===g||R.__eeOnceListener__===g)&&delete A[S];return this},p=function(S){var g,A,R,O,C;if(u.call(this,"__ee__")&&(O=this.__ee__[S],!!O))if(typeof O=="object"){for(A=arguments.length,C=new Array(A-1),g=1;g<A;++g)C[g-1]=arguments[g];for(O=O.slice(),g=0;R=O[g];++g)o.call(R,this,C)}else switch(arguments.length){case 1:s.call(O,this);break;case 2:s.call(O,this,arguments[1]);break;case 3:s.call(O,this,arguments[1],arguments[2]);break;default:for(A=arguments.length,C=new Array(A-1),g=1;g<A;++g)C[g-1]=arguments[g];o.call(O,this,C)}},h={on:d,once:l,off:_,emit:p},E={on:n(d),once:n(l),off:n(_),emit:n(p)},T=c({},E),e.exports=t=function(S){return S==null?i(T):c(Object(S),E)},t.methods=h})(pu,pu.exports)),pu.exports}var v_,Gb;function s5(){return Gb||(Gb=1,v_=function(){var e=Array.from,t,n;return typeof e!="function"?!1:(t=["raz","dwa"],n=e(t),!!(n&&n!==t&&n[1]==="dwa"))}),v_}var w_,Vb;function i5(){return Vb||(Vb=1,w_=function(){return typeof globalThis!="object"||!globalThis?!1:globalThis.Array===Array}),w_}var L_,$b;function a5(){if($b)return L_;$b=1;var e=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return L_=(function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return e()}try{return __global__||e()}finally{delete Object.prototype.__global__}})(),L_}var D_,Bb;function fd(){return Bb||(Bb=1,D_=i5()()?globalThis:a5()),D_}var U_,Hb;function c5(){if(Hb)return U_;Hb=1;var e=fd(),t={object:!0,symbol:!0};return U_=function(){var n=e.Symbol,r;if(typeof n!="function")return!1;r=n("test symbol");try{String(r)}catch{return!1}return!(!t[typeof n.iterator]||!t[typeof n.toPrimitive]||!t[typeof n.toStringTag])},U_}var k_,Fb;function u5(){return Fb||(Fb=1,k_=function(e){return e?typeof e=="symbol"?!0:!e.constructor||e.constructor.name!=="Symbol"?!1:e[e.constructor.toStringTag]==="Symbol":!1}),k_}var x_,Yb;function zL(){if(Yb)return x_;Yb=1;var e=u5();return x_=function(t){if(!e(t))throw new TypeError(t+" is not a symbol");return t},x_}var G_,jb;function l5(){if(jb)return G_;jb=1;var e=Po(),t=Object.create,n=Object.defineProperty,r=Object.prototype,o=t(null);return G_=function(s){for(var i=0,a,c;o[s+(i||"")];)++i;return s+=i||"",o[s]=!0,a="@@"+s,n(r,a,e.gs(null,function(u){c||(c=!0,n(this,a,e(u)),c=!1)})),a},G_}var V_,qb;function d5(){if(qb)return V_;qb=1;var e=Po(),t=fd().Symbol;return V_=function(n){return Object.defineProperties(n,{hasInstance:e("",t&&t.hasInstance||n("hasInstance")),isConcatSpreadable:e("",t&&t.isConcatSpreadable||n("isConcatSpreadable")),iterator:e("",t&&t.iterator||n("iterator")),match:e("",t&&t.match||n("match")),replace:e("",t&&t.replace||n("replace")),search:e("",t&&t.search||n("search")),species:e("",t&&t.species||n("species")),split:e("",t&&t.split||n("split")),toPrimitive:e("",t&&t.toPrimitive||n("toPrimitive")),toStringTag:e("",t&&t.toStringTag||n("toStringTag")),unscopables:e("",t&&t.unscopables||n("unscopables"))})},V_}var $_,Wb;function f5(){if(Wb)return $_;Wb=1;var e=Po(),t=zL(),n=Object.create(null);return $_=function(r){return Object.defineProperties(r,{for:e(function(o){return n[o]?n[o]:n[o]=r(String(o))}),keyFor:e(function(o){var s;t(o);for(s in n)if(n[s]===o)return s})})},$_}var B_,Kb;function _5(){if(Kb)return B_;Kb=1;var e=Po(),t=zL(),n=fd().Symbol,r=l5(),o=d5(),s=f5(),i=Object.create,a=Object.defineProperties,c=Object.defineProperty,u,f,d;if(typeof n=="function")try{String(n()),d=!0}catch{}else n=null;return f=function(_){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return u(_)},B_=u=function l(_){var p;if(this instanceof l)throw new TypeError("Symbol is not a constructor");return d?n(_):(p=i(f.prototype),_=_===void 0?"":String(_),a(p,{__description__:e("",_),__name__:e("",r(_))}))},o(u),s(u),a(f.prototype,{constructor:e(u),toString:e("",function(){return this.__name__})}),a(u.prototype,{toString:e(function(){return"Symbol ("+t(this).__description__+")"}),valueOf:e(function(){return t(this)})}),c(u.prototype,u.toPrimitive,e("",function(){var l=t(this);return typeof l=="symbol"?l:l.toString()})),c(u.prototype,u.toStringTag,e("c","Symbol")),c(f.prototype,u.toStringTag,e("c",u.prototype[u.toStringTag])),c(f.prototype,u.toPrimitive,e("c",u.prototype[u.toPrimitive])),B_}var H_,zb;function p5(){return zb||(zb=1,H_=c5()()?fd().Symbol:_5()),H_}var F_,Zb;function h5(){if(Zb)return F_;Zb=1;var e=Object.prototype.toString,t=e.call((function(){return arguments})());return F_=function(n){return e.call(n)===t},F_}var Y_,Xb;function E5(){if(Xb)return Y_;Xb=1;var e=Object.prototype.toString,t=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);return Y_=function(n){return typeof n=="function"&&t(e.call(n))},Y_}var j_,Qb;function T5(){if(Qb)return j_;Qb=1;var e=Object.prototype.toString,t=e.call("");return j_=function(n){return typeof n=="string"||n&&typeof n=="object"&&(n instanceof String||e.call(n)===t)||!1},j_}var q_,Jb;function S5(){if(Jb)return q_;Jb=1;var e=p5().iterator,t=h5(),n=E5(),r=Co(),o=_r(),s=Ts(),i=bo(),a=T5(),c=Array.isArray,u=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},d=Object.defineProperty;return q_=function(l){var _=arguments[1],p=arguments[2],h,E,T,S,g,A,R,O,C,I;if(l=Object(s(l)),i(_)&&o(_),!this||this===Array||!n(this)){if(!_){if(t(l))return g=l.length,g!==1?Array.apply(null,l):(S=new Array(1),S[0]=l[0],S);if(c(l)){for(S=new Array(g=l.length),E=0;E<g;++E)S[E]=l[E];return S}}S=[]}else h=this;if(!c(l)){if((C=l[e])!==void 0){for(R=o(C).call(l),h&&(S=new h),O=R.next(),E=0;!O.done;)I=_?u.call(_,p,O.value,E):O.value,h?(f.value=I,d(S,E,f)):S[E]=I,O=R.next(),++E;g=E}else if(a(l)){for(g=l.length,h&&(S=new h),E=0,T=0;E<g;++E)I=l[E],E+1<g&&(A=I.charCodeAt(0),A>=55296&&A<=56319&&(I+=l[++E])),I=_?u.call(_,p,I,T):I,h?(f.value=I,d(S,T,f)):S[T]=I,++T;g=T}}if(g===void 0)for(g=r(l.length),h&&(S=new h(g)),E=0;E<g;++E)I=_?u.call(_,p,l[E],E):l[E],h?(f.value=I,d(S,E,f)):S[E]=I;return h&&(f.value=null,S.length=g),S},q_}var W_,eC;function cT(){return eC||(eC=1,W_=s5()()?Array.from:S5()),W_}var K_,tC;function m5(){if(tC)return K_;tC=1;var e=cT(),t=Array.isArray;return K_=function(n){return t(n)?n:e(n)},K_}var z_,nC;function g5(){if(nC)return z_;nC=1;var e=m5(),t=bo(),n=_r(),r=Array.prototype.slice,o;return o=function(s){return this.map(function(i,a){return i?i(s[a]):s[a]}).concat(r.call(s,this.length))},z_=function(s){return s=e(s),s.forEach(function(i){t(i)&&n(i)}),o.bind(s)},z_}var Z_,rC;function A5(){if(rC)return Z_;rC=1;var e=_r();return Z_=function(t){var n;return typeof t=="function"?{set:t,get:t}:(n={get:e(t.get)},t.set!==void 0?(n.set=e(t.set),t.delete&&(n.delete=e(t.delete)),t.clear&&(n.clear=e(t.clear)),n):(n.set=n.get,n))},Z_}var X_,oC;function R5(){if(oC)return X_;oC=1;var e=ZQ(),t=WL(),n=Po(),r=o5().methods,o=g5(),s=A5(),i=Function.prototype.apply,a=Function.prototype.call,c=Object.create,u=Object.defineProperties,f=r.on,d=r.emit;return X_=function(l,_,p){var h=c(null),E,T,S,g,A,R,O,C,I,w,U,B,F,G,x;return _!==!1?T=_:isNaN(l.length)?T=1:T=l.length,p.normalizer&&(w=s(p.normalizer),S=w.get,g=w.set,A=w.delete,R=w.clear),p.resolvers!=null&&(x=o(p.resolvers)),S?G=t(function(Y){var v,P,H=arguments;if(x&&(H=x(H)),v=S(H),v!==null&&hasOwnProperty.call(h,v))return U&&E.emit("get",v,H,this),h[v];if(H.length===1?P=a.call(l,this,H[0]):P=i.call(l,this,H),v===null){if(v=S(H),v!==null)throw e("Circular invocation","CIRCULAR_INVOCATION");v=g(H)}else if(hasOwnProperty.call(h,v))throw e("Circular invocation","CIRCULAR_INVOCATION");return h[v]=P,B&&E.emit("set",v,null,P),P},T):_===0?G=function(){var Y;if(hasOwnProperty.call(h,"data"))return U&&E.emit("get","data",arguments,this),h.data;if(arguments.length?Y=i.call(l,this,arguments):Y=a.call(l,this),hasOwnProperty.call(h,"data"))throw e("Circular invocation","CIRCULAR_INVOCATION");return h.data=Y,B&&E.emit("set","data",null,Y),Y}:G=function(Y){var v,P=arguments,H;if(x&&(P=x(arguments)),H=String(P[0]),hasOwnProperty.call(h,H))return U&&E.emit("get",H,P,this),h[H];if(P.length===1?v=a.call(l,this,P[0]):v=i.call(l,this,P),hasOwnProperty.call(h,H))throw e("Circular invocation","CIRCULAR_INVOCATION");return h[H]=v,B&&E.emit("set",H,null,v),v},E={original:l,memoized:G,profileName:p.profileName,get:function(Y){return x&&(Y=x(Y)),S?S(Y):String(Y[0])},has:function(Y){return hasOwnProperty.call(h,Y)},delete:function(Y){var v;hasOwnProperty.call(h,Y)&&(A&&A(Y),v=h[Y],delete h[Y],F&&E.emit("delete",Y,v))},clear:function(){var Y=h;R&&R(),h=c(null),E.emit("clear",Y)},on:function(Y,v){return Y==="get"?U=!0:Y==="set"?B=!0:Y==="delete"&&(F=!0),f.call(this,Y,v)},emit:d,updateEnv:function(){l=E.original}},S?O=t(function(Y){var v,P=arguments;x&&(P=x(P)),v=S(P),v!==null&&E.delete(v)},T):_===0?O=function(){return E.delete("data")}:O=function(Y){return x&&(Y=x(arguments)[0]),E.delete(Y)},C=t(function(){var Y,v=arguments;return _===0?h.data:(x&&(v=x(v)),S?Y=S(v):Y=String(v[0]),h[Y])}),I=t(function(){var Y,v=arguments;return _===0?E.has("data"):(x&&(v=x(v)),S?Y=S(v):Y=String(v[0]),Y===null?!1:E.has(Y))}),u(G,{__memoized__:n(!0),delete:n(O),clear:n(E.clear),_get:n(C),_has:n(I)}),E},X_}var Q_,sC;function y5(){if(sC)return Q_;sC=1;var e=_r(),t=dd(),n=Io(),r=R5(),o=YL();return Q_=function s(i){var a,c,u;if(e(i),a=Object(arguments[1]),a.async&&a.promise)throw new Error("Options 'async' and 'promise' cannot be used together");return hasOwnProperty.call(i,"__memoized__")&&!a.force?i:(c=o(a.length,i.length,a.async&&n.async),u=r(i,c,a),t(n,function(f,d){a[d]&&f(a[d],u,a)}),s.__profiler__&&s.__profiler__(u),u.updateEnv(),u.memoized)},Q_}var J_,iC;function N5(){return iC||(iC=1,J_=function(e){var t,n,r=e.length;if(!r)return"";for(t=String(e[n=0]);--r;)t+=""+e[++n];return t}),J_}var ep,aC;function O5(){return aC||(aC=1,ep=function(e){return e?function(t){for(var n=String(t[0]),r=0,o=e;--o;)n+=""+t[++r];return n}:function(){return""}}),ep}var tp,cC;function b5(){return cC||(cC=1,tp=function(){var e=Number.isNaN;return typeof e!="function"?!1:!e({})&&e(NaN)&&!e(34)}),tp}var np,uC;function C5(){return uC||(uC=1,np=function(e){return e!==e}),np}var rp,lC;function I5(){return lC||(lC=1,rp=b5()()?Number.isNaN:C5()),rp}var op,dC;function uT(){if(dC)return op;dC=1;var e=I5(),t=Co(),n=Ts(),r=Array.prototype.indexOf,o=Object.prototype.hasOwnProperty,s=Math.abs,i=Math.floor;return op=function(a){var c,u,f,d;if(!e(a))return r.apply(this,arguments);for(u=t(n(this).length),f=arguments[1],isNaN(f)?f=0:f>=0?f=i(f):f=t(this.length)-i(s(f)),c=f;c<u;++c)if(o.call(this,c)&&(d=this[c],e(d)))return c;return-1},op}var sp,fC;function P5(){if(fC)return sp;fC=1;var e=uT(),t=Object.create;return sp=function(){var n=0,r=[],o=t(null);return{get:function(s){var i=0,a=r,c,u=s.length;if(u===0)return a[u]||null;if(a=a[u]){for(;i<u-1;){if(c=e.call(a[0],s[i]),c===-1)return null;a=a[1][c],++i}return c=e.call(a[0],s[i]),c===-1?null:a[1][c]||null}return null},set:function(s){var i=0,a=r,c,u=s.length;if(u===0)a[u]=++n;else{for(a[u]||(a[u]=[[],[]]),a=a[u];i<u-1;)c=e.call(a[0],s[i]),c===-1&&(c=a[0].push(s[i])-1,a[1].push([[],[]])),a=a[1][c],++i;c=e.call(a[0],s[i]),c===-1&&(c=a[0].push(s[i])-1),a[1][c]=++n}return o[n]=s,n},delete:function(s){var i=0,a=r,c,u=o[s],f=u.length,d=[];if(f===0)delete a[f];else if(a=a[f]){for(;i<f-1;){if(c=e.call(a[0],u[i]),c===-1)return;d.push(a,c),a=a[1][c],++i}if(c=e.call(a[0],u[i]),c===-1)return;for(s=a[1][c],a[0].splice(c,1),a[1].splice(c,1);!a[0].length&&d.length;)c=d.pop(),a=d.pop(),a[0].splice(c,1),a[1].splice(c,1)}delete o[s]},clear:function(){r=[],o=t(null)}}},sp}var ip,_C;function M5(){if(_C)return ip;_C=1;var e=uT();return ip=function(){var t=0,n=[],r=[];return{get:function(o){var s=e.call(n,o[0]);return s===-1?null:r[s]},set:function(o){return n.push(o[0]),r.push(++t),t},delete:function(o){var s=e.call(r,o);s!==-1&&(n.splice(s,1),r.splice(s,1))},clear:function(){n=[],r=[]}}},ip}var ap,pC;function v5(){if(pC)return ap;pC=1;var e=uT(),t=Object.create;return ap=function(n){var r=0,o=[[],[]],s=t(null);return{get:function(i){for(var a=0,c=o,u;a<n-1;){if(u=e.call(c[0],i[a]),u===-1)return null;c=c[1][u],++a}return u=e.call(c[0],i[a]),u===-1?null:c[1][u]||null},set:function(i){for(var a=0,c=o,u;a<n-1;)u=e.call(c[0],i[a]),u===-1&&(u=c[0].push(i[a])-1,c[1].push([[],[]])),c=c[1][u],++a;return u=e.call(c[0],i[a]),u===-1&&(u=c[0].push(i[a])-1),c[1][u]=++r,s[r]=i,r},delete:function(i){for(var a=0,c=o,u,f=[],d=s[i];a<n-1;){if(u=e.call(c[0],d[a]),u===-1)return;f.push(c,u),c=c[1][u],++a}if(u=e.call(c[0],d[a]),u!==-1){for(i=c[1][u],c[0].splice(u,1),c[1].splice(u,1);!c[0].length&&f.length;)u=f.pop(),c=f.pop(),c[0].splice(u,1),c[1].splice(u,1);delete s[i]}},clear:function(){o=[[],[]],s=t(null)}}},ap}var hC={},cp,EC;function ZL(){if(EC)return cp;EC=1;var e=_r(),t=dd(),n=Function.prototype.call;return cp=function(r,o){var s={},i=arguments[2];return e(o),t(r,function(a,c,u,f){s[c]=n.call(o,i,a,c,u,f)}),s},cp}var up,TC;function lT(){if(TC)return up;TC=1;var e=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");return n},t=function(n){var r=document.createTextNode(""),o,s,i=0;return new n(function(){var a;if(o)s&&(o=s.concat(o));else{if(!s)return;o=s}if(s=o,o=null,typeof s=="function"){a=s,s=null,a();return}for(r.data=i=++i%2;s;)a=s.shift(),s.length||(s=null),a()}).observe(r,{characterData:!0}),function(a){if(e(a),o){typeof o=="function"?o=[o,a]:o.push(a);return}o=a,r.data=i=++i%2}};return up=(function(){if(typeof process=="object"&&process&&typeof process.nextTick=="function")return process.nextTick;if(typeof queueMicrotask=="function")return function(n){queueMicrotask(e(n))};if(typeof document=="object"&&document){if(typeof MutationObserver=="function")return t(MutationObserver);if(typeof WebKitMutationObserver=="function")return t(WebKitMutationObserver)}return typeof setImmediate=="function"?function(n){setImmediate(e(n))}:typeof setTimeout=="function"||typeof setTimeout=="object"?function(n){setTimeout(e(n),0)}:null})(),up}var SC;function w5(){if(SC)return hC;SC=1;var e=cT(),t=ZL(),n=qL(),r=WL(),o=lT(),s=Array.prototype.slice,i=Function.prototype.apply,a=Object.create;return Io().async=function(c,u){var f=a(null),d=a(null),l=u.memoized,_=u.original,p,h,E;u.memoized=r(function(T){var S=arguments,g=S[S.length-1];return typeof g=="function"&&(p=g,S=s.call(S,0,-1)),l.apply(h=this,E=S)},l);try{n(u.memoized,l)}catch{}u.on("get",function(T){var S,g,A;if(p){if(f[T]){typeof f[T]=="function"?f[T]=[f[T],p]:f[T].push(p),p=null;return}S=p,g=h,A=E,p=h=E=null,o(function(){var R;hasOwnProperty.call(d,T)?(R=d[T],u.emit("getasync",T,A,g),i.call(S,R.context,R.args)):(p=S,h=g,E=A,l.apply(g,A))})}}),u.original=function(){var T,S,g,A;return p?(T=e(arguments),S=function R(O){var C,I,w=R.id;if(w==null){o(i.bind(R,this,arguments));return}if(delete R.id,C=f[w],delete f[w],!!C)return I=e(arguments),u.has(w)&&(O?u.delete(w):(d[w]={context:this,args:I},u.emit("setasync",w,typeof C=="function"?1:C.length))),typeof C=="function"?A=i.call(C,this,I):C.forEach(function(U){A=i.call(U,this,I)},this),A},g=p,p=h=E=null,T.push(S),A=i.call(_,this,T),S.cb=g,p=S,A):i.call(_,this,arguments)},u.on("set",function(T){if(!p){u.delete(T);return}f[T]?typeof f[T]=="function"?f[T]=[f[T],p.cb]:f[T].push(p.cb):f[T]=p.cb,delete p.cb,p.id=T,p=null}),u.on("delete",function(T){var S;hasOwnProperty.call(f,T)||d[T]&&(S=d[T],delete d[T],u.emit("deleteasync",T,s.call(S.args,1)))}),u.on("clear",function(){var T=d;d=a(null),u.emit("clearasync",t(T,function(S){return s.call(S.args,1)}))})},hC}var mC={},lp,gC;function L5(){if(gC)return lp;gC=1;var e=Array.prototype.forEach,t=Object.create;return lp=function(n){var r=t(null);return e.call(arguments,function(o){r[o]=!0}),r},lp}var dp,AC;function XL(){return AC||(AC=1,dp=function(e){return typeof e=="function"}),dp}var fp,RC;function D5(){if(RC)return fp;RC=1;var e=XL();return fp=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{throw new TypeError("Passed argument cannot be stringifed")}},fp}var _p,yC;function U5(){if(yC)return _p;yC=1;var e=Ts(),t=D5();return _p=function(n){return t(e(n))},_p}var pp,NC;function k5(){if(NC)return pp;NC=1;var e=XL();return pp=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{return"<Non-coercible to string value>"}},pp}var hp,OC;function x5(){if(OC)return hp;OC=1;var e=k5(),t=/[\n\r\u2028\u2029]/g;return hp=function(n){var r=e(n);return r.length>100&&(r=r.slice(0,99)+""),r=r.replace(t,function(o){return JSON.stringify(o).slice(1,-1)}),r},hp}var hu={exports:{}},bC;function QL(){if(bC)return hu.exports;bC=1,hu.exports=e,hu.exports.default=e;function e(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}return hu.exports}var CC;function G5(){if(CC)return mC;CC=1;var e=ZL(),t=L5(),n=U5(),r=x5(),o=QL(),s=lT(),i=Object.create,a=t("then","then:finally","done","done:finally");return Io().promise=function(c,u){var f=i(null),d=i(null),l=i(null);if(c===!0)c=null;else if(c=n(c),!a[c])throw new TypeError("'"+r(c)+"' is not valid promise mode");u.on("set",function(_,p,h){var E=!1;if(!o(h)){d[_]=h,u.emit("setasync",_,1);return}f[_]=1,l[_]=h;var T=function(R){var O=f[_];if(E)throw new Error(`Memoizee error: Detected unordered then|done & finally resolution, which in turn makes proper detection of success/failure impossible (when in 'done:finally' mode)
Consider to rely on 'then' or 'done' mode instead.`);O&&(delete f[_],d[_]=R,u.emit("setasync",_,O))},S=function(){E=!0,f[_]&&(delete f[_],delete l[_],u.delete(_))},g=c;if(g||(g="then"),g==="then"){var A=function(){s(S)};h=h.then(function(R){s(T.bind(this,R))},A),typeof h.finally=="function"&&h.finally(A)}else if(g==="done"){if(typeof h.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done' mode");h.done(T,S)}else if(g==="done:finally"){if(typeof h.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done:finally' mode");if(typeof h.finally!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'finally' in 'done:finally' mode");h.done(T),h.finally(S)}}),u.on("get",function(_,p,h){var E;if(f[_]){++f[_];return}E=l[_];var T=function(){u.emit("getasync",_,p,h)};o(E)?typeof E.done=="function"?E.done(T):E.then(function(){s(T)}):T()}),u.on("delete",function(_){if(delete l[_],f[_]){delete f[_];return}if(hasOwnProperty.call(d,_)){var p=d[_];delete d[_],u.emit("deleteasync",_,[p])}}),u.on("clear",function(){var _=d;d=i(null),f=i(null),l=i(null),u.emit("clearasync",e(_,function(p){return[p]}))})},mC}var IC={},PC;function V5(){if(PC)return IC;PC=1;var e=_r(),t=dd(),n=Io(),r=Function.prototype.apply;return n.dispose=function(o,s,i){var a;if(e(o),i.async&&n.async||i.promise&&n.promise){s.on("deleteasync",a=function(c,u){r.call(o,null,u)}),s.on("clearasync",function(c){t(c,function(u,f){a(f,u)})});return}s.on("delete",a=function(c,u){o(u)}),s.on("clear",function(c){t(c,function(u,f){a(f,u)})})},IC}var MC={},Ep,vC;function $5(){return vC||(vC=1,Ep=2147483647),Ep}var Tp,wC;function B5(){if(wC)return Tp;wC=1;var e=Co(),t=$5();return Tp=function(n){if(n=e(n),n>t)throw new TypeError(n+" exceeds maximum possible timeout");return n},Tp}var LC;function H5(){if(LC)return MC;LC=1;var e=cT(),t=dd(),n=lT(),r=QL(),o=B5(),s=Io(),i=Function.prototype,a=Math.max,c=Math.min,u=Object.create;return s.maxAge=function(f,d,l){var _,p,h,E;f=o(f),f&&(_=u(null),p=l.async&&s.async||l.promise&&s.promise?"async":"",d.on("set"+p,function(T){_[T]=setTimeout(function(){d.delete(T)},f),typeof _[T].unref=="function"&&_[T].unref(),E&&(E[T]&&E[T]!=="nextTick"&&clearTimeout(E[T]),E[T]=setTimeout(function(){delete E[T]},h),typeof E[T].unref=="function"&&E[T].unref())}),d.on("delete"+p,function(T){clearTimeout(_[T]),delete _[T],E&&(E[T]!=="nextTick"&&clearTimeout(E[T]),delete E[T])}),l.preFetch&&(l.preFetch===!0||isNaN(l.preFetch)?h=.333:h=a(c(Number(l.preFetch),1),0),h&&(E={},h=(1-h)*f,d.on("get"+p,function(T,S,g){E[T]||(E[T]="nextTick",n(function(){var A;E[T]==="nextTick"&&(delete E[T],d.delete(T),l.async&&(S=e(S),S.push(i)),A=d.memoized.apply(g,S),l.promise&&r(A)&&(typeof A.done=="function"?A.done(i,i):A.then(i,i)))}))}))),d.on("clear"+p,function(){t(_,function(T){clearTimeout(T)}),_={},E&&(t(E,function(T){T!=="nextTick"&&clearTimeout(T)}),E={})}))},MC}var DC={},Sp,UC;function F5(){if(UC)return Sp;UC=1;var e=Co(),t=Object.create,n=Object.prototype.hasOwnProperty;return Sp=function(r){var o=0,s=1,i=t(null),a=t(null),c=0,u;return r=e(r),{hit:function(f){var d=a[f],l=++c;if(i[l]=f,a[f]=l,!d)return++o,o<=r?void 0:(f=i[s],u(f),f);if(delete i[d],s===d)for(;!n.call(i,++s););},delete:u=function(f){var d=a[f];if(d&&(delete i[d],delete a[f],--o,s===d)){if(!o){c=0,s=1;return}for(;!n.call(i,++s););}},clear:function(){o=0,s=1,i=t(null),a=t(null),c=0}}},Sp}var kC;function Y5(){if(kC)return DC;kC=1;var e=Co(),t=F5(),n=Io();return n.max=function(r,o,s){var i,a,c;r=e(r),r&&(a=t(r),i=s.async&&n.async||s.promise&&n.promise?"async":"",o.on("set"+i,c=function(u){u=a.hit(u),u!==void 0&&o.delete(u)}),o.on("get"+i,c),o.on("delete"+i,a.delete),o.on("clear"+i,a.clear))},DC}var xC={},GC;function j5(){if(GC)return xC;GC=1;var e=Po(),t=Io(),n=Object.create,r=Object.defineProperties;return t.refCounter=function(o,s,i){var a,c;a=n(null),c=i.async&&t.async||i.promise&&t.promise?"async":"",s.on("set"+c,function(u,f){a[u]=f||1}),s.on("get"+c,function(u){++a[u]}),s.on("delete"+c,function(u){delete a[u]}),s.on("clear"+c,function(){a={}}),r(s.memoized,{deleteRef:e(function(){var u=s.get(arguments);return u===null||!a[u]?null:--a[u]?!1:(s.delete(u),!0)}),getRefCount:e(function(){var u=s.get(arguments);return u===null||!a[u]?0:a[u]})})},xC}var mp,VC;function q5(){if(VC)return mp;VC=1;var e=FL(),t=YL(),n=y5();return mp=function(r){var o=e(arguments[1]),s;return o.normalizer||(s=o.length=t(o.length,r.length,o.async),s!==0&&(o.primitive?s===!1?o.normalizer=N5():s>1&&(o.normalizer=O5()(s)):s===!1?o.normalizer=P5()():s===1?o.normalizer=M5()():o.normalizer=v5()(s))),o.async&&w5(),o.promise&&G5(),o.dispose&&V5(),o.maxAge&&H5(),o.max&&Y5(),o.refCounter&&j5(),n(r,o)},mp}var W5=q5();const Xo=Ol(W5);class K5{constructor(t){this.i=0,this.string=t,this.whitespace=` 	\r
`,this.quotes=`'"`,this.escapes="\\",this.escapedQuotes='"',this.ansiCQuotes=!0,this.localeQuotes=!0,this.debug=!1}readChar(){return this.string.charAt(this.i++)}processEscapes(t,n,r){if(!r&&!this.escapedQuotes.includes(n))return t;const o="["+this.escapes.replace(/(.)/g,"\\$1")+"]";if(!r&&this.escapedQuotes.includes(n)){const s=new RegExp(o+"("+o+"|\\"+n+")","g");return t.replace(s,"$1")}if(r){const s={"([\\\\'\"?])":a=>a,a:()=>"\x07",b:()=>"\b","e|E":()=>"\x1B",f:()=>"\f",n:()=>`
`,r:()=>"\r",t:()=>"	",v:()=>"\v","([0-7]{1,3})":a=>String.fromCharCode(parseInt(a,8)),"x([0-9a-fA-F]{1,2})":a=>String.fromCharCode(parseInt(a,16)),"u([0-9a-fA-F]{1,4})":a=>String.fromCharCode(parseInt(a,16)),"U([0-9a-fA-F]{1,8})":a=>String.fromCharCode(parseInt(a,16)),"c(.)":a=>a==="?"?"":a==="@"?"\0":String.fromCharCode(a.charCodeAt(0)&31)},i=new RegExp(o+"("+Object.keys(s).join("|")+")","g");return t.replace(i,function(a,c){for(const u in s){const f=new RegExp("^"+u+"$").exec(c);if(f!==null)return s[u].apply(null,f.slice(1))}})}}*[Symbol.iterator](){let t=!1,n=!1,r=!1,o=-2,s;for(this.debug&&console.log("full input:",">"+this.string+"<");;){const i=this.i,a=this.readChar();if(this.debug&&console.log("position:",i,"input:",">"+a+"<","accumulated:",s,"inQuote:",t,"inDollarQuote:",n,"lastDollar:",o,"escaped:",r),a===""){if(t)throw new Error("Got EOF while in a quoted string");if(r)throw new Error("Got EOF while in an escape sequence");s!==void 0&&(yield s);return}if(r){a===`
`||(t?s=(s||"")+r+a:s=(s||"")+a),r=!1;continue}if(this.escapes.includes(a)&&(!t||n!==!1||this.escapedQuotes.includes(t))){r=a;continue}if(t!==!1){if(a===t){s=this.processEscapes(s,t,n==="'"),t=!1,n=!1;continue}s=(s||"")+a;continue}if(this.quotes.includes(a)){t=a,o===i-1&&(a==="'"&&!this.ansiCQuotes||a==='"'&&!this.localeQuotes||(n=a)),s=s||"",n!==!1&&(s=s.slice(0,-1));continue}if(t===!1&&a==="$"&&(o=i),this.whitespace.includes(a)){s!==void 0&&(yield s),s=void 0;continue}s=(s||"")+a}}}function z5(e){return Array.from(new K5(e))}function Nt(e){return e===""?"''":/[^\w@%\-+=:,./]/.test(e)?("'"+e.replace(/('+)/g,`'"$1"'`)+"'").replace(/^''|''$/g,""):e}function Z5(e){if(!Array.isArray(e))throw new TypeError("args should be an array");return e.map(Nt).join(" ")}function X5(e){if(!e.startsWith("["))return{loggerName:null,message:e};const t=e.indexOf("]");if(t===-1)return{loggerName:null,message:e};if(e[t+1]!==" ")return{loggerName:null,message:e};const n=e.slice(1,t).trim();if(!n)return{loggerName:null,message:e};const r=e.slice(t+2);return{loggerName:n,message:r}}const JL={safe:{},sensitive:{}};function fl(e){return e==null?JL:{safe:e.safe,sensitive:e.sensitive??{}}}class eD{buffer=[];maxBufferSize=500;hasLoggedDroppedLogMessage=!1;push(t){if(this.buffer.length>=this.maxBufferSize){this.hasLoggedDroppedLogMessage||(this.hasLoggedDroppedLogMessage=!0,this.buffer.push({level:"warning",message:"Dropped buffered log message after maxBufferSize was reached",tags:JL}));return}this.buffer.push(t)}createLogMethod(t){return(n,r)=>{this.push({level:t,message:n,tags:fl(r)})}}trace=this.createLogMethod("trace");debug=this.createLogMethod("debug");info=this.createLogMethod("info");warning=this.createLogMethod("warning");error=this.createLogMethod("error");log=(t,n,r)=>{this.push({level:t,message:n,tags:fl(r)})};flushTo(t){for(const n of this.buffer)t.log(n.level,n.message,n.tags);this.buffer.length=0}dispose(){this.buffer=[]}}let Iu=new eD,$C=!1;function Q5(e){if($C&&process.env.NODE_ENV!=="test")throw new Error("Logger already set");$C=!0,Iu instanceof eD&&Iu.flushTo(e),Iu=e}function Ic(){return Iu}function J5(e){if(typeof e=="string")return e.length===0||/\s/.test(e)?JSON.stringify(e):e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(e==null)return typeof e>"u"?"undefined":"null";try{const t=JSON.stringify(e);if(t!=null)return t}catch{}return String(e)}function e6(e,t){return e==="error"&&t instanceof Error}function t6(e){const t={};for(const[n,r]of Object.entries(e)){if(e6(n,r)){t.errorName=r.name,t.errorMessage=r.message,t.errorStack=r.stack,r.code!=null&&(t.errorCode=r.code);continue}t[n]=r}return t}function n6(e){const t=t6(e);return Object.keys(t).sort((r,o)=>r.localeCompare(o)).map(r=>{const o=t[r];return`${r}=${J5(o)}`}).join(" ")}function _d(e){const t=`[${e}] `,n=(o,s,i)=>{Ic().log(o,`${t}${s}`,fl(i))},r=o=>(s,i)=>{n(o,s,i)};return{trace:r("trace"),debug:r("debug"),info:r("info"),warning:r("warning"),error:r("error"),log:(o,s,i)=>{n(o,s,i)},dispose:()=>{Ic().dispose()}}}function Ct(e){let t=null;return()=>(t||(t=_d(e)),t)}function tD(e){const t=Date.now(),n=_d(e),r=(o,s)=>[`[${((Date.now()-t)/1e3).toFixed(3)}] ${o}`,fl(s)];return{trace:(o,s)=>{const[i,a]=r(o,s);n.trace(i,a)},debug:(o,s)=>{const[i,a]=r(o,s);n.debug(i,a)},info:(o,s)=>{const[i,a]=r(o,s);n.info(i,a)},warning:(o,s)=>{const[i,a]=r(o,s);n.warning(i,a)},error:(o,s)=>{const[i,a]=r(o,s);n.error(i,a)},log:(o,s,i)=>{const[a,c]=r(s,i);n.log(o,a,c)},dispose:()=>{n.dispose()}}}var Un={},BC;function r6(){if(BC)return Un;BC=1;var e=Un&&Un.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(Un,"__esModule",{value:!0}),Un.RateLimit=Un.Sema=void 0;const t=e(wc);function n(d,l,_,p,h){for(let E=0;E<h;++E)_[E+p]=d[E+l],d[E+l]=void 0}function r(d){return d=d>>>0,d=d-1,d=d|d>>1,d=d|d>>2,d=d|d>>4,d=d|d>>8,d=d|d>>16,d+1}function o(d){return r(Math.min(Math.max(16,d),1073741824))}class s{constructor(l){this._capacity=o(l),this._length=0,this._front=0,this.arr=[]}push(l){const _=this._length;this.checkCapacity(_+1);const p=this._front+_&this._capacity-1;return this.arr[p]=l,this._length=_+1,_+1}pop(){const l=this._length;if(l===0)return;const _=this._front+l-1&this._capacity-1,p=this.arr[_];return this.arr[_]=void 0,this._length=l-1,p}shift(){const l=this._length;if(l===0)return;const _=this._front,p=this.arr[_];return this.arr[_]=void 0,this._front=_+1&this._capacity-1,this._length=l-1,p}get length(){return this._length}checkCapacity(l){this._capacity<l&&this.resizeTo(o(this._capacity*1.5+16))}resizeTo(l){const _=this._capacity;this._capacity=l;const p=this._front,h=this._length;if(p+h>_){const E=p+h&_-1;n(this.arr,0,this.arr,_,E)}}}class i extends t.default{}function a(d){return typeof d=="function"}function c(){return"1"}class u{constructor(l,{initFn:_=c,pauseFn:p,resumeFn:h,capacity:E=10}={}){if(a(p)!==a(h))throw new Error("pauseFn and resumeFn must be both set for pausing");this.nrTokens=l,this.free=new s(l),this.waiting=new s(E),this.releaseEmitter=new i,this.noTokens=_===c,this.pauseFn=p,this.resumeFn=h,this.paused=!1,this.releaseEmitter.on("release",T=>{const S=this.waiting.shift();S?S.resolve(T):(this.resumeFn&&this.paused&&(this.paused=!1,this.resumeFn()),this.free.push(T))});for(let T=0;T<l;T++)this.free.push(_())}tryAcquire(){return this.free.pop()}async acquire(){let l=this.tryAcquire();return l!==void 0?l:new Promise((_,p)=>{this.pauseFn&&!this.paused&&(this.paused=!0,this.pauseFn()),this.waiting.push({resolve:_,reject:p})})}release(l){this.releaseEmitter.emit("release",this.noTokens?"1":l)}drain(){const l=new Array(this.nrTokens);for(let _=0;_<this.nrTokens;_++)l[_]=this.acquire();return Promise.all(l)}nrWaiting(){return this.waiting.length}}Un.Sema=u;function f(d,{timeUnit:l=1e3,uniformDistribution:_=!1}={}){const p=new u(_?1:d),h=_?l/d:l;return async function(){await p.acquire(),setTimeout(()=>p.release(),h)}}return Un.RateLimit=f,Un}var nD=r6();class rD{constructor(t,n=[],r=[],o){this.child=t,this.stdoutChunks=n,this.stderrChunks=r,this.promise=o.then(({code:s,signal:i})=>({type:"resolve",code:s,signal:i}),s=>({type:"reject",error:s}))}result=null;promise;check(){return this.wait().then(({stdout:t,stderr:n,code:r,signal:o})=>{if(r===0)return{stdout:t,stderr:n};throw new Error(`process exited with code ${r}, signal ${o}`)})}wait(){return this.promise.then(t=>{switch(t.type){case"resolve":{const{code:n,signal:r}=t;return{stdout:Buffer.concat(this.stdoutChunks).toString("utf8"),stderr:Buffer.concat(this.stderrChunks).toString("utf8"),code:n,signal:r}}case"reject":throw t.error}})}getStdout(){return Buffer.concat(this.stdoutChunks)}getStderr(){return Buffer.concat(this.stderrChunks)}getExitCode(){return this.result?.type==="resolve"?this.result.code:null}isDone(){return this.result!=null}kill(){this.child.kill()}}const o6={startSpan:(e,t)=>t()};let oD=o6;function s6(e){oD=e}function i6(){return oD}function dT(e,t){return i6().startSpan(e,t)}let _l;function a6(e){if(_l)throw new Error("shouldSpawnInsideWsl already set");_l=e}function c6(){if(!_l){if(process.env.NODE_ENV==="test"||process.env.VITEST!=null)return!1;throw new Error("shouldSpawnInsideWsl not set")}return _l()}function u6(){const e=Ic(),t=l6(e);if(!t)return;if(_6(t))return wh(t);if(f6(t))return wh(p6(t));const n=d6(t,e);if(n)return n;e.warning("[resolveCodexHomeFromWsl] Unable to translate Linux path",{safe:{},sensitive:{linuxPath:t}})}function l6(e){return sD(["/usr/bin/env","bash","-lc",'printf %s "${CODEX_HOME:-$HOME/.codex}"'],"readCodexHomePathFromWslEnv",e)}function d6(e,t){const n=sD(["wslpath","-w",e],`resolveCodexHomeFromWsl:wslpath(${e})`,t);return n?wh(n):void 0}function sD(e,t,n){try{const r=Lc.spawnSync("wsl.exe",e,{encoding:"utf8",windowsHide:!0});if(r.error){n.debug("WSL command error",{safe:{context:t},sensitive:{error:r.error}});return}if(r.status!==0){n.debug("WSL command non-zero exit",{safe:{context:t},sensitive:{status:r.status,stderr:r.stderr?.toString()??""}});return}const o=r.stdout?.toString().trim();if(!o){n.warning("WSL command returned empty output",{safe:{context:t},sensitive:{}});return}return o}catch(r){n.warning("WSL command unexpected error",{safe:{context:t},sensitive:{error:r}});return}}function wh(e){return e.replace(/\//g,"\\")}function f6(e){return/^\/mnt\/[a-zA-Z]\//.test(e)?!0:/^\\{1,2}mnt\\[a-zA-Z]\\/.test(e)}function _6(e){return!!(/^[a-zA-Z]:[\\/]/.test(e)||/^\\\\/.test(e))}function p6(e){const t=e.match(/^\/mnt\/([a-zA-Z])\/(.*)$/);if(t){const o=t[1].toUpperCase(),s=t[2].replace(/\//g,"\\");return`${o}:\\${s}`}const n=e.match(/^\\{1,2}[Mm][Nn][Tt]\\([a-zA-Z])\\(.*)$/i);if(n){const o=n[1].toUpperCase(),s=n[2].replace(/[\\/]/g,"\\");return`${o}:\\${s}`}const r=e.match(/^C:\\mnt\\c(.*)$/i);return r?`C:\\${r[1].replace(/^([\\/])+/,"").replace(/[\\/]/g,"\\")}`:e.replace(/\//g,"\\")}function iD(e){if(/^(\\\\|\/\/)(wsl\$|wsl\.localhost)/i.test(e)){const r=e.replace(/^((\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]+)/i,"").split(/[\\/]/);r.shift();const o=r.join("/").replace(/\\/g,"/");return o.length===0?"/":o.startsWith("/")?o:`/${o}`}if(e.startsWith("/"))return e;const t=e.match(/^([a-zA-Z]):[\\/](.*)$/);if(t){const n=t[1].toLowerCase(),r=t[2].replace(/\\/g,"/");return`/mnt/${n}/${r}`}return e.replace(/\\/g,"/")}const aD=Ct("spawn-async");function cD(e){const t=e[0]??"process";return t==="git"&&e[1]?{op:"git.exec",name:`git ${e[1]}`}:{op:"process.exec",name:t}}function uD({args:e,cwd:t,env:n,signal:r,stdoutChunkHandler:o,stderrChunkHandler:s,onExitHandler:i}){if(c6())return aD().info("Spawning process inside WSL"),h6(e,t,n?E6(n):void 0,r,o,s);const a=e[0],c=e.slice(1),u={cwd:t,env:{...process.env,...n},stdio:["ignore","pipe","pipe"]},f=Lc.spawn(a,c,u),d=[],l=[],_=new Promise((h,E)=>{const T=lD(f,r);f.stdout?.on("data",S=>{d.push(S),o?.(S)}),f.stderr?.on("data",S=>{l.push(S),s?.(S)}),f.on("close",(S,g)=>{i?.(),T?.(),h({code:S,signal:g})}),f.on("error",S=>{i?.(),T?.(),E(S)})}),p=cD(e);return new rD(f,d,l,dT(p,()=>_))}function h6(e,t,n,r,o,s){const i=t?iD(t):".",a=["RUST_LOG=warn"];n&&a.push(...T6(n));const c=["-d","Ubuntu"];c.push("--cd",i),c.push("--exec","/usr/bin/env",...a,...e);const u={env:{...process.env},stdio:["ignore","pipe","pipe"]};aD().debug("Spawning process inside WSL",{safe:{command:`wsl.exe ${c.join(" ")}`},sensitive:{}});const f=Lc.spawn("wsl.exe",c,u),d=[],l=[],_=new Promise((h,E)=>{const T=lD(f,r);f.stdout?.on("data",S=>{d.push(S),o?.(S)}),f.stderr?.on("data",S=>{l.push(S),s?.(S)}),f.on("close",(S,g)=>{T?.(),h({code:S,signal:g})}),f.on("error",S=>{T?.(),E(S)})}),p=cD(e);return new rD(f,d,l,dT(p,()=>_))}function lD(e,t){if(!t)return;const n=()=>{e.kill()};return t.addEventListener("abort",n),t.aborted&&n(),()=>{t.removeEventListener("abort",n)}}function E6(e){const t={};for(const[n,r]of Object.entries(e))r!=null&&process.env[n]!==r&&(t[n]=r);return t}function T6(e){const t=[];for(const[n,r]of Object.entries(e)){const o=S6(r)?iD(r):r;t.push(`${n}=${o}`)}return t}function S6(e){return e.includes(";")?!1:!!(/^(?:[a-zA-Z]:[\\/]|\\\\|\/\/)/.test(e)||/^(\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]/i.test(e))}const m6=4,g6=1e3,gp=new Map,Ap=Ct("spawn-remote-async");function A6(e){const t=[];for(const[n,r]of Object.entries(e))r!=null&&t.push(`${n}=${Nt(r)}`);return t}function R6(e){return gp.has(e)||gp.set(e,new nD.Sema(m6)),gp.get(e)}class y6{constructor(t,n){this.semaphore=t,this.timeout=n}releaseTimeout=null;released=!1;async acquire(){await this.semaphore.acquire(),this.releaseTimeout=setTimeout(()=>{this.release()},this.timeout)}release(){this.released||(this.released=!0,this.releaseTimeout&&clearTimeout(this.releaseTimeout),this.semaphore.release())}}async function pr({hostConfig:e,args:t,env:n,signal:r,timeoutMs:o,noConcurrencyLimit:s,stdoutChunkHandler:i,stderrChunkHandler:a}){const c=n?A6(n):[],u=[...e.terminal_command,"--",...c,...t];let f=null;if(!s){const p=R6(e.id);f=new y6(p,g6),await f.acquire()}let d=!1,l=null;const _=uD({args:u,signal:r,stdoutChunkHandler:i,stderrChunkHandler:a,onExitHandler:()=>{d=!0,l&&clearTimeout(l),f&&f.release()}});return o!=null&&(l=setTimeout(()=>{_.kill()},o),d&&l&&(clearTimeout(l),l=null)),_}async function kn({hostConfig:e,args:t,errorOnNonZeroExitCode:n=!0}){const r=crypto.randomUUID().slice(0,8);Ap().debug("Spawning remote process",{safe:{requestId:r,argsCount:t.length},sensitive:{args:t}});const o=await pr({hostConfig:e,args:t}),{stdout:s,stderr:i,code:a}=await o.wait();if(a!==0){if(Ap().debug("Remote process exited with non-zero code",{safe:{requestId:r,code:a},sensitive:{stderr:i}}),n)throw new Error(`Process errored with code ${a} stderr=${i}`)}else Ap().debug("Remote process exited successfully",{safe:{requestId:r,code:a},sensitive:{}});return{stdout:s,stderr:i,code:a}}const N6=6e4,O6=60*N6,fT=24*O6;function b6(e){const{preferWsl:t=!1}=e,n=Ic();if(t&&process.platform==="win32"){const r=u6();if(r)return r;n.info("[resolveCodexHome] Falling back to host home directory because WSL CODEX_HOME could not be resolved")}return process.env.CODEX_HOME??yP.join(Ut.homedir(),".codex")}const dD=Xo(async e=>{const t=typeof e=="string"?I6(e):e;return C6(t)},{length:1,normalizer:([e])=>typeof e=="string"?e:e.id,promise:!0,maxAge:fT});async function C6(e){const t=Ic(),r=["sh","-lc",Nt('if [ -n "$CODEX_HOME" ]; then printf "%s" "$CODEX_HOME"; else printf "%s" "$HOME/.codex"; fi')];let o,s=!1;const i=setTimeout(()=>{s=!0,o?.kill()},1e4);try{o=await pr({hostConfig:e,args:r});const{stdout:a,stderr:c,code:u}=await o.wait();if(clearTimeout(i),s)throw t.warning("[resolveRemoteSshCodexHome] timed out"),new Error("resolveRemoteSshCodexHome timed out");if(u!==0)throw new Error(`[resolveRemoteSshCodexHome] failed (${u}): ${c||a}`);return a.trim()}catch(a){throw clearTimeout(i),t.warning("[resolveRemoteSshCodexHome] error",{safe:{},sensitive:{error:a}}),a}}function I6(e){return{id:e,display_name:e,kind:"ssh",codex_cli_command:[],terminal_command:z5(e)}}const Ke={async readFile(e,t){if(we(t)){const{stdout:n}=await kn({hostConfig:t,args:["cat",e]});return n}return pe.promises.readFile(e,"utf-8")},async readFileBase64(e,t){if(we(t)){const{stdout:n}=await kn({hostConfig:t,args:["base64",e]});return Buffer.from(n,"base64")}return pe.promises.readFile(e,"base64")},async writeFile(e,t,n){if(we(n)){await kn({hostConfig:n,args:["sh","-c",Nt(`cat > ${e} << "EOF"
${t}
EOF`)]});return}await pe.promises.writeFile(e,t,"utf8")},async mkdir(e,t={},n){if(we(n)){const r=["mkdir"];t.recursive!==!1&&r.push("-p"),r.push(e),await kn({hostConfig:n,args:r});return}await pe.promises.mkdir(e,{recursive:t.recursive??!0})},async stat(e,t){if(!we(t))return pe.promises.stat(e);const{stdout:n,code:r}=await kn({hostConfig:t,args:["sh","-c",Nt('if [ -d "$1" ]; then echo "dir"; elif [ -f "$1" ]; then echo "file"; elif [ -L "$1" ]; then echo "link"; else exit 1; fi'),"sh",e],errorOnNonZeroExitCode:!1});if(r===1)throw new Error(`File not found: ${e}`);const o=n.trim();return{isDirectory:()=>o==="dir",isFile:()=>o==="file"||o==="link"}},async readdir(e,t){if(we(t)){const{stdout:n}=await kn({hostConfig:t,args:["sh","-c",Nt('ls -A "$1"'),"sh",e]});return n.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0)}return pe.promises.readdir(e)},async rm(e,t={},n){if(we(n)){const r=["rm"];t.recursive!==!1&&r.push("-r"),t.force!==!1&&r.push("-f"),r.push(e),await kn({hostConfig:n,args:r});return}await pe.promises.rm(e,{recursive:t.recursive??!0,force:t.force??!0})},async copyFile(e,t,n){if(we(n)){await kn({hostConfig:n,args:["cp",e,t]});return}await pe.promises.copyFile(e,t)},async cp(e,t,n={},r){if(we(r)){const o=["cp"];n.recursive&&o.push("-R"),o.push(e,t),await kn({hostConfig:r,args:o});return}await pe.promises.cp(e,t,{recursive:n.recursive??!1})}};function It(e){return we(e)?ce.posix:ce}class P6{handlers=new Set;subscribe(t){return this.handlers.add(t),{dispose:()=>{this.handlers.delete(t)}}}emit(t,n=Date.now()){for(const r of this.handlers)r({type:t,at:n})}}const M6=["IN_PROGRESS","PENDING_REVIEW"],v6=["IN_PROGRESS","PENDING_REVIEW","ACCEPTED","ARCHIVED"],fD=e=>`(${e.map(t=>`'${t}'`).join(", ")})`;fD(M6);fD(v6);var Lh=["MO","TU","WE","TH","FR","SA","SU"],At=(function(){function e(t,n){if(n===0)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=n}return e.fromStr=function(t){return new e(Lh.indexOf(t))},e.prototype.nth=function(t){return this.n===t?this:new e(this.weekday,t)},e.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},e.prototype.toString=function(){var t=Lh[this.weekday];return this.n&&(t=(this.n>0?"+":"")+String(this.n)+t),t},e.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},e})(),Xe=function(e){return e!=null},En=function(e){return typeof e=="number"},HC=function(e){return typeof e=="string"&&Lh.includes(e)},Gt=Array.isArray,Pn=function(e,t){t===void 0&&(t=e),arguments.length===1&&(t=e,e=0);for(var n=[],r=e;r<t;r++)n.push(r);return n},be=function(e,t){var n=0,r=[];if(Gt(e))for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},w6=function(e){return Gt(e)?e:[e]};function wo(e,t,n){n===void 0&&(n=" ");var r=String(e);return t=t>>0,r.length>t?String(r):(t=t-r.length,t>n.length&&(n+=be(n,t/n.length)),n.slice(0,t)+String(r))}var L6=function(e,t,n){var r=e.split(t);return n?r.slice(0,n).concat([r.slice(n).join(t)]):r},Ft=function(e,t){var n=e%t;return n*t<0?n+t:n},Rp=function(e,t){return{div:Math.floor(e/t),mod:Ft(e,t)}},gn=function(e){return!Xe(e)||e.length===0},ot=function(e){return!gn(e)},Ue=function(e,t){return ot(e)&&e.indexOf(t)!==-1},So=function(e,t,n,r,o,s){return r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=0),new Date(Date.UTC(e,t-1,n,r,o,s))},D6=[31,28,31,30,31,30,31,31,30,31,30,31],_D=1e3*60*60*24,pD=9999,hD=So(1970,1,1),U6=[6,0,1,2,3,4,5],_c=function(e){return e%4===0&&e%100!==0||e%400===0},ED=function(e){return e instanceof Date},cc=function(e){return ED(e)&&!isNaN(e.getTime())},k6=function(e,t){var n=e.getTime(),r=t.getTime(),o=n-r;return Math.round(o/_D)},Dh=function(e){return k6(e,hD)},TD=function(e){return new Date(hD.getTime()+e*_D)},x6=function(e){var t=e.getUTCMonth();return t===1&&_c(e.getUTCFullYear())?29:D6[t]},is=function(e){return U6[e.getUTCDay()]},FC=function(e,t){var n=So(e,t+1,1);return[is(n),x6(n)]},SD=function(e,t){return t=t||e,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},Uh=function(e){var t=new Date(e.getTime());return t},YC=function(e){for(var t=[],n=0;n<e.length;n++)t.push(Uh(e[n]));return t},Pc=function(e){e.sort(function(t,n){return t.getTime()-n.getTime()})},_T=function(e,t){t===void 0&&(t=!0);var n=new Date(e);return[wo(n.getUTCFullYear().toString(),4,"0"),wo(n.getUTCMonth()+1,2,"0"),wo(n.getUTCDate(),2,"0"),"T",wo(n.getUTCHours(),2,"0"),wo(n.getUTCMinutes(),2,"0"),wo(n.getUTCSeconds(),2,"0"),t?"Z":""].join("")},pT=function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,n=t.exec(e);if(!n)throw new Error("Invalid UNTIL value: ".concat(e));return new Date(Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[5],10)||0,parseInt(n[6],10)||0,parseInt(n[7],10)||0))},jC=function(e,t){var n=e.toLocaleString("sv-SE",{timeZone:t});return n.replace(" ","T")+"Z"},G6=function(e,t){var n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(jC(e,n)),o=new Date(jC(e,t??"UTC")),s=o.getTime()-r.getTime();return new Date(e.getTime()-s)},Bo=(function(){function e(t,n){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=n,t==="between"?(this.maxDate=n.inc?n.before:new Date(n.before.getTime()-1),this.minDate=n.inc?n.after:new Date(n.after.getTime()+1)):t==="before"?this.maxDate=n.inc?n.dt:new Date(n.dt.getTime()-1):t==="after"&&(this.minDate=n.inc?n.dt:new Date(n.dt.getTime()+1))}return e.prototype.accept=function(t){++this.total;var n=this.minDate&&t<this.minDate,r=this.maxDate&&t>this.maxDate;if(this.method==="between"){if(n)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return n?!0:(this.add(t),!1);return this.add(t)},e.prototype.add=function(t){return this._result.push(t),!0},e.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;case"before":case"after":default:return t.length?t[t.length-1]:null}},e.prototype.clone=function(){return new e(this.method,this.args)},e})(),yp={exports:{}},qC;function V6(){return qC||(qC=1,(function(e){var t,n,r,o,s,i,a,c,u,f,d,l,_,p,h,E,T,S,g,A,R,O,C,I,w,U,B,F,G,x,Y,v;(function(P){var H=typeof sn=="object"?sn:typeof self=="object"?self:typeof this=="object"?this:{};P(J(H,J(e.exports)));function J(se,ne){return se!==H&&(typeof Object.create=="function"?Object.defineProperty(se,"__esModule",{value:!0}):se.__esModule=!0),function(M,L){return se[M]=ne?ne(M,L):L}}})(function(P){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,L){M.__proto__=L}||function(M,L){for(var V in L)Object.prototype.hasOwnProperty.call(L,V)&&(M[V]=L[V])};t=function(M,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");H(M,L);function V(){this.constructor=M}M.prototype=L===null?Object.create(L):(V.prototype=L.prototype,new V)},n=Object.assign||function(M){for(var L,V=1,$=arguments.length;V<$;V++){L=arguments[V];for(var K in L)Object.prototype.hasOwnProperty.call(L,K)&&(M[K]=L[K])}return M},r=function(M,L){var V={};for(var $ in M)Object.prototype.hasOwnProperty.call(M,$)&&L.indexOf($)<0&&(V[$]=M[$]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var K=0,$=Object.getOwnPropertySymbols(M);K<$.length;K++)L.indexOf($[K])<0&&Object.prototype.propertyIsEnumerable.call(M,$[K])&&(V[$[K]]=M[$[K]]);return V},o=function(M,L,V,$){var K=arguments.length,X=K<3?L:$===null?$=Object.getOwnPropertyDescriptor(L,V):$,D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(M,L,V,$);else for(var k=M.length-1;k>=0;k--)(D=M[k])&&(X=(K<3?D(X):K>3?D(L,V,X):D(L,V))||X);return K>3&&X&&Object.defineProperty(L,V,X),X},s=function(M,L){return function(V,$){L(V,$,M)}},i=function(M,L,V,$,K,X){function D(De){if(De!==void 0&&typeof De!="function")throw new TypeError("Function expected");return De}for(var k=$.kind,z=k==="getter"?"get":k==="setter"?"set":"value",q=!L&&M?$.static?M:M.prototype:null,ee=L||(q?Object.getOwnPropertyDescriptor(q,$.name):{}),re,_e=!1,ie=V.length-1;ie>=0;ie--){var le={};for(var Se in $)le[Se]=Se==="access"?{}:$[Se];for(var Se in $.access)le.access[Se]=$.access[Se];le.addInitializer=function(De){if(_e)throw new TypeError("Cannot add initializers after decoration has completed");X.push(D(De||null))};var ve=(0,V[ie])(k==="accessor"?{get:ee.get,set:ee.set}:ee[z],le);if(k==="accessor"){if(ve===void 0)continue;if(ve===null||typeof ve!="object")throw new TypeError("Object expected");(re=D(ve.get))&&(ee.get=re),(re=D(ve.set))&&(ee.set=re),(re=D(ve.init))&&K.unshift(re)}else(re=D(ve))&&(k==="field"?K.unshift(re):ee[z]=re)}q&&Object.defineProperty(q,$.name,ee),_e=!0},a=function(M,L,V){for(var $=arguments.length>2,K=0;K<L.length;K++)V=$?L[K].call(M,V):L[K].call(M);return $?V:void 0},c=function(M){return typeof M=="symbol"?M:"".concat(M)},u=function(M,L,V){return typeof L=="symbol"&&(L=L.description?"[".concat(L.description,"]"):""),Object.defineProperty(M,"name",{configurable:!0,value:V?"".concat(V," ",L):L})},f=function(M,L){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(M,L)},d=function(M,L,V,$){function K(X){return X instanceof V?X:new V(function(D){D(X)})}return new(V||(V=Promise))(function(X,D){function k(ee){try{q($.next(ee))}catch(re){D(re)}}function z(ee){try{q($.throw(ee))}catch(re){D(re)}}function q(ee){ee.done?X(ee.value):K(ee.value).then(k,z)}q(($=$.apply(M,L||[])).next())})},l=function(M,L){var V={label:0,sent:function(){if(X[0]&1)throw X[1];return X[1]},trys:[],ops:[]},$,K,X,D=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return D.next=k(0),D.throw=k(1),D.return=k(2),typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function k(q){return function(ee){return z([q,ee])}}function z(q){if($)throw new TypeError("Generator is already executing.");for(;D&&(D=0,q[0]&&(V=0)),V;)try{if($=1,K&&(X=q[0]&2?K.return:q[0]?K.throw||((X=K.return)&&X.call(K),0):K.next)&&!(X=X.call(K,q[1])).done)return X;switch(K=0,X&&(q=[q[0]&2,X.value]),q[0]){case 0:case 1:X=q;break;case 4:return V.label++,{value:q[1],done:!1};case 5:V.label++,K=q[1],q=[0];continue;case 7:q=V.ops.pop(),V.trys.pop();continue;default:if(X=V.trys,!(X=X.length>0&&X[X.length-1])&&(q[0]===6||q[0]===2)){V=0;continue}if(q[0]===3&&(!X||q[1]>X[0]&&q[1]<X[3])){V.label=q[1];break}if(q[0]===6&&V.label<X[1]){V.label=X[1],X=q;break}if(X&&V.label<X[2]){V.label=X[2],V.ops.push(q);break}X[2]&&V.ops.pop(),V.trys.pop();continue}q=L.call(M,V)}catch(ee){q=[6,ee],K=0}finally{$=X=0}if(q[0]&5)throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}},_=function(M,L){for(var V in M)V!=="default"&&!Object.prototype.hasOwnProperty.call(L,V)&&G(L,M,V)},G=Object.create?(function(M,L,V,$){$===void 0&&($=V);var K=Object.getOwnPropertyDescriptor(L,V);(!K||("get"in K?!L.__esModule:K.writable||K.configurable))&&(K={enumerable:!0,get:function(){return L[V]}}),Object.defineProperty(M,$,K)}):(function(M,L,V,$){$===void 0&&($=V),M[$]=L[V]}),p=function(M){var L=typeof Symbol=="function"&&Symbol.iterator,V=L&&M[L],$=0;if(V)return V.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&$>=M.length&&(M=void 0),{value:M&&M[$++],done:!M}}};throw new TypeError(L?"Object is not iterable.":"Symbol.iterator is not defined.")},h=function(M,L){var V=typeof Symbol=="function"&&M[Symbol.iterator];if(!V)return M;var $=V.call(M),K,X=[],D;try{for(;(L===void 0||L-- >0)&&!(K=$.next()).done;)X.push(K.value)}catch(k){D={error:k}}finally{try{K&&!K.done&&(V=$.return)&&V.call($)}finally{if(D)throw D.error}}return X},E=function(){for(var M=[],L=0;L<arguments.length;L++)M=M.concat(h(arguments[L]));return M},T=function(){for(var M=0,L=0,V=arguments.length;L<V;L++)M+=arguments[L].length;for(var $=Array(M),K=0,L=0;L<V;L++)for(var X=arguments[L],D=0,k=X.length;D<k;D++,K++)$[K]=X[D];return $},S=function(M,L,V){if(V||arguments.length===2)for(var $=0,K=L.length,X;$<K;$++)(X||!($ in L))&&(X||(X=Array.prototype.slice.call(L,0,$)),X[$]=L[$]);return M.concat(X||Array.prototype.slice.call(L))},g=function(M){return this instanceof g?(this.v=M,this):new g(M)},A=function(M,L,V){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=V.apply(M,L||[]),K,X=[];return K=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),k("next"),k("throw"),k("return",D),K[Symbol.asyncIterator]=function(){return this},K;function D(ie){return function(le){return Promise.resolve(le).then(ie,re)}}function k(ie,le){$[ie]&&(K[ie]=function(Se){return new Promise(function(ve,De){X.push([ie,Se,ve,De])>1||z(ie,Se)})},le&&(K[ie]=le(K[ie])))}function z(ie,le){try{q($[ie](le))}catch(Se){_e(X[0][3],Se)}}function q(ie){ie.value instanceof g?Promise.resolve(ie.value.v).then(ee,re):_e(X[0][2],ie)}function ee(ie){z("next",ie)}function re(ie){z("throw",ie)}function _e(ie,le){ie(le),X.shift(),X.length&&z(X[0][0],X[0][1])}},R=function(M){var L,V;return L={},$("next"),$("throw",function(K){throw K}),$("return"),L[Symbol.iterator]=function(){return this},L;function $(K,X){L[K]=M[K]?function(D){return(V=!V)?{value:g(M[K](D)),done:!1}:X?X(D):D}:X}},O=function(M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L=M[Symbol.asyncIterator],V;return L?L.call(M):(M=typeof p=="function"?p(M):M[Symbol.iterator](),V={},$("next"),$("throw"),$("return"),V[Symbol.asyncIterator]=function(){return this},V);function $(X){V[X]=M[X]&&function(D){return new Promise(function(k,z){D=M[X](D),K(k,z,D.done,D.value)})}}function K(X,D,k,z){Promise.resolve(z).then(function(q){X({value:q,done:k})},D)}},C=function(M,L){return Object.defineProperty?Object.defineProperty(M,"raw",{value:L}):M.raw=L,M};var J=Object.create?(function(M,L){Object.defineProperty(M,"default",{enumerable:!0,value:L})}):function(M,L){M.default=L},se=function(M){return se=Object.getOwnPropertyNames||function(L){var V=[];for(var $ in L)Object.prototype.hasOwnProperty.call(L,$)&&(V[V.length]=$);return V},se(M)};I=function(M){if(M&&M.__esModule)return M;var L={};if(M!=null)for(var V=se(M),$=0;$<V.length;$++)V[$]!=="default"&&G(L,M,V[$]);return J(L,M),L},w=function(M){return M&&M.__esModule?M:{default:M}},U=function(M,L,V,$){if(V==="a"&&!$)throw new TypeError("Private accessor was defined without a getter");if(typeof L=="function"?M!==L||!$:!L.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return V==="m"?$:V==="a"?$.call(M):$?$.value:L.get(M)},B=function(M,L,V,$,K){if($==="m")throw new TypeError("Private method is not writable");if($==="a"&&!K)throw new TypeError("Private accessor was defined without a setter");if(typeof L=="function"?M!==L||!K:!L.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return $==="a"?K.call(M,V):K?K.value=V:L.set(M,V),V},F=function(M,L){if(L===null||typeof L!="object"&&typeof L!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof M=="function"?L===M:M.has(L)},x=function(M,L,V){if(L!=null){if(typeof L!="object"&&typeof L!="function")throw new TypeError("Object expected.");var $,K;if(V){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");$=L[Symbol.asyncDispose]}if($===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");$=L[Symbol.dispose],V&&(K=$)}if(typeof $!="function")throw new TypeError("Object not disposable.");K&&($=function(){try{K.call(this)}catch(X){return Promise.reject(X)}}),M.stack.push({value:L,dispose:$,async:V})}else V&&M.stack.push({async:!0});return L};var ne=typeof SuppressedError=="function"?SuppressedError:function(M,L,V){var $=new Error(V);return $.name="SuppressedError",$.error=M,$.suppressed=L,$};Y=function(M){function L(X){M.error=M.hasError?new ne(X,M.error,"An error was suppressed during disposal."):X,M.hasError=!0}var V,$=0;function K(){for(;V=M.stack.pop();)try{if(!V.async&&$===1)return $=0,M.stack.push(V),Promise.resolve().then(K);if(V.dispose){var X=V.dispose.call(V.value);if(V.async)return $|=2,Promise.resolve(X).then(K,function(D){return L(D),K()})}else $|=1}catch(D){L(D)}if($===1)return M.hasError?Promise.reject(M.error):Promise.resolve();if(M.hasError)throw M.error}return K()},v=function(M,L){return typeof M=="string"&&/^\.\.?\//.test(M)?M.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(V,$,K,X,D){return $?L?".jsx":".js":K&&(!X||!D)?V:K+X+"."+D.toLowerCase()+"js"}):M},P("__extends",t),P("__assign",n),P("__rest",r),P("__decorate",o),P("__param",s),P("__esDecorate",i),P("__runInitializers",a),P("__propKey",c),P("__setFunctionName",u),P("__metadata",f),P("__awaiter",d),P("__generator",l),P("__exportStar",_),P("__createBinding",G),P("__values",p),P("__read",h),P("__spread",E),P("__spreadArrays",T),P("__spreadArray",S),P("__await",g),P("__asyncGenerator",A),P("__asyncDelegator",R),P("__asyncValues",O),P("__makeTemplateObject",C),P("__importStar",I),P("__importDefault",w),P("__classPrivateFieldGet",U),P("__classPrivateFieldSet",B),P("__classPrivateFieldIn",F),P("__addDisposableResource",x),P("__disposeResources",Y),P("__rewriteRelativeImportExtension",v)})})(yp)),yp.exports}var $6=V6();const B6=Ol($6),{__extends:hT,__assign:ln,__rest:tne,__decorate:nne,__param:rne,__esDecorate:one,__runInitializers:sne,__propKey:ine,__setFunctionName:ane,__metadata:cne,__awaiter:une,__generator:lne,__exportStar:dne,__createBinding:fne,__values:_ne,__read:pne,__spread:hne,__spreadArrays:Ene,__spreadArray:te,__await:Tne,__asyncGenerator:Sne,__asyncDelegator:mne,__asyncValues:gne,__makeTemplateObject:Ane,__importStar:Rne,__importDefault:yne,__classPrivateFieldGet:Nne,__classPrivateFieldSet:One,__classPrivateFieldIn:bne,__addDisposableResource:Cne,__disposeResources:Ine,__rewriteRelativeImportExtension:Pne}=B6;var WC=(function(e){hT(t,e);function t(n,r,o){var s=e.call(this,n,r)||this;return s.iterator=o,s}return t.prototype.add=function(n){return this.iterator(n,this._result.length)?(this._result.push(n),!0):!1},t})(Bo),pl={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},KC=function(e,t){return e.indexOf(t)!==-1},H6=function(e){return e.toString()},F6=function(e,t,n){return"".concat(t," ").concat(n,", ").concat(e)},Zn=(function(){function e(t,n,r,o){if(n===void 0&&(n=H6),r===void 0&&(r=pl),o===void 0&&(o=F6),this.text=[],this.language=r||pl,this.gettext=n,this.dateFormatter=o,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday){var s=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);s.sort(function(f,d){return f-d}),i.sort(function(f,d){return d-f}),this.bymonthday=s.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(Xe(this.origOptions.byweekday)){var a=Gt(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(a);this.byweekday={allWeeks:a.filter(function(f){return!f.n}),someWeeks:a.filter(function(f){return!!f.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var u=function(f,d){return f.weekday-d.weekday};this.byweekday.allWeeks.sort(u),this.byweekday.someWeeks.sort(u),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return e.isFullyConvertible=function(t){var n=!0;if(!(t.options.freq in e.IMPLEMENTED)||t.origOptions.until&&t.origOptions.count)return!1;for(var r in t.origOptions){if(KC(["dtstart","tzid","wkst","freq"],r))return!0;if(!KC(e.IMPLEMENTED[t.options.freq],r))return!1}return n},e.prototype.isFullyConvertible=function(){return e.isFullyConvertible(this.rrule)},e.prototype.toString=function(){var t=this.gettext;if(!(this.options.freq in e.IMPLEMENTED))return t("RRule error: Unable to fully convert this rrule to text");if(this.text=[t("every")],this[he.FREQUENCIES[this.options.freq]](),this.options.until){this.add(t("until"));var n=this.options.until;this.add(this.dateFormatter(n.getUTCFullYear(),this.language.monthNames[n.getUTCMonth()],n.getUTCDate()))}else this.options.count&&this.add(t("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?t("times"):t("time"));return this.isFullyConvertible()||this.add(t("(~ approximate)")),this.text.join("")},e.prototype.HOURLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},e.prototype.MINUTELY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},e.prototype.DAILY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},e.prototype.WEEKLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(this.options.interval===1&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},e.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},e.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},e.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},e.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},e.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},e.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},e.prototype.nth=function(t){t=parseInt(t.toString(),10);var n,r=this.gettext;if(t===-1)return r("last");var o=Math.abs(t);switch(o){case 1:case 21:case 31:n=o+r("st");break;case 2:case 22:n=o+r("nd");break;case 3:case 23:n=o+r("rd");break;default:n=o+r("th")}return t<0?n+" "+r("last"):n},e.prototype.monthtext=function(t){return this.language.monthNames[t-1]},e.prototype.weekdaytext=function(t){var n=En(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[n]},e.prototype.plural=function(t){return t%100!==1},e.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},e.prototype.list=function(t,n,r,o){var s=this;o===void 0&&(o=","),Gt(t)||(t=[t]);var i=function(c,u,f){for(var d="",l=0;l<c.length;l++)l!==0&&(l===c.length-1?d+=" "+f+" ":d+=u+" "),d+=c[l];return d};n=n||function(c){return c.toString()};var a=function(c){return n&&n.call(s,c)};return r?i(t.map(a),o,r):t.map(a).join(o+" ")},e})(),Y6=(function(){function e(t){this.done=!0,this.rules=t}return e.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},e.prototype.isDone=function(){return this.done&&this.symbol===null},e.prototype.nextSymbol=function(){var t,n;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;t=null;for(var o in this.rules){r=this.rules[o];var s=r.exec(this.text);s&&(t===null||s[0].length>t[0].length)&&(t=s,n=o)}if(t!=null&&(this.text=this.text.substr(t[0].length),this.text===""&&(this.done=!0)),t==null){this.done=!0,this.symbol=null,this.value=null;return}}while(n==="SKIP");return this.symbol=n,this.value=t,!0},e.prototype.accept=function(t){if(this.symbol===t){if(this.value){var n=this.value;return this.nextSymbol(),n}return this.nextSymbol(),!0}return!1},e.prototype.acceptNumber=function(){return this.accept("number")},e.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},e})();function mD(e,t){t===void 0&&(t=pl);var n={},r=new Y6(t.tokens);if(!r.start(e))return null;return o(),n;function o(){r.expect("every");var l=r.acceptNumber();if(l&&(n.interval=parseInt(l[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":n.freq=he.DAILY,r.nextSymbol()&&(i(),d());break;case"weekday(s)":n.freq=he.WEEKLY,n.byweekday=[he.MO,he.TU,he.WE,he.TH,he.FR],r.nextSymbol(),i(),d();break;case"week(s)":n.freq=he.WEEKLY,r.nextSymbol()&&(s(),i(),d());break;case"hour(s)":n.freq=he.HOURLY,r.nextSymbol()&&(s(),d());break;case"minute(s)":n.freq=he.MINUTELY,r.nextSymbol()&&(s(),d());break;case"month(s)":n.freq=he.MONTHLY,r.nextSymbol()&&(s(),d());break;case"year(s)":n.freq=he.YEARLY,r.nextSymbol()&&(s(),d());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":n.freq=he.WEEKLY;var _=r.symbol.substr(0,2).toUpperCase();if(n.byweekday=[he[_]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=c();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");n.byweekday.push(he[p]),r.nextSymbol()}i(),f(),d();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(n.freq=he.YEARLY,n.bymonth=[a()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var h=a();if(!h)throw new Error("Unexpected symbol "+r.symbol+", expected month");n.bymonth.push(h),r.nextSymbol()}s(),d();break;default:throw new Error("Unknown symbol")}}function s(){var l=r.accept("on"),_=r.accept("the");if(l||_)do{var p=u(),h=c(),E=a();if(p)h?(r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(he[h].nth(p))):(n.bymonthday||(n.bymonthday=[]),n.bymonthday.push(p),r.accept("day(s)"));else if(h)r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(he[h]);else if(r.symbol==="weekday(s)")r.nextSymbol(),n.byweekday||(n.byweekday=[he.MO,he.TU,he.WE,he.TH,he.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var T=r.acceptNumber();if(!T)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(n.byweekno=[parseInt(T[0],10)];r.accept("comma");){if(T=r.acceptNumber(),!T)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.byweekno.push(parseInt(T[0],10))}}else if(E)r.nextSymbol(),n.bymonth||(n.bymonth=[]),n.bymonth.push(E);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function i(){var l=r.accept("at");if(l)do{var _=r.acceptNumber();if(!_)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(n.byhour=[parseInt(_[0],10)];r.accept("comma");){if(_=r.acceptNumber(),!_)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");n.byhour.push(parseInt(_[0],10))}}while(r.accept("comma")||r.accept("at"))}function a(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function u(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var l=parseInt(r.value[1],10);if(l<-366||l>366)throw new Error("Nth out of range: "+l);return r.nextSymbol(),r.accept("last")?-l:l;default:return!1}}function f(){r.accept("on"),r.accept("the");var l=u();if(l)for(n.bymonthday=[l],r.nextSymbol();r.accept("comma");){if(l=u(),!l)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.bymonthday.push(l),r.nextSymbol()}}function d(){if(r.symbol==="until"){var l=Date.parse(r.text);if(!l)throw new Error("Cannot parse until date:"+r.text);n.until=new Date(l)}else r.accept("for")&&(n.count=parseInt(r.value[0],10),r.expect("number"))}}var Ce;(function(e){e[e.YEARLY=0]="YEARLY",e[e.MONTHLY=1]="MONTHLY",e[e.WEEKLY=2]="WEEKLY",e[e.DAILY=3]="DAILY",e[e.HOURLY=4]="HOURLY",e[e.MINUTELY=5]="MINUTELY",e[e.SECONDLY=6]="SECONDLY"})(Ce||(Ce={}));function ET(e){return e<Ce.HOURLY}var j6=function(e,t){return t===void 0&&(t=pl),new he(mD(e,t)||void 0)},Ss=["count","until","interval","byweekday","bymonthday","bymonth"];Zn.IMPLEMENTED=[];Zn.IMPLEMENTED[Ce.HOURLY]=Ss;Zn.IMPLEMENTED[Ce.MINUTELY]=Ss;Zn.IMPLEMENTED[Ce.DAILY]=["byhour"].concat(Ss);Zn.IMPLEMENTED[Ce.WEEKLY]=Ss;Zn.IMPLEMENTED[Ce.MONTHLY]=Ss;Zn.IMPLEMENTED[Ce.YEARLY]=["byweekno","byyearday"].concat(Ss);var q6=function(e,t,n,r){return new Zn(e,t,n,r).toString()},W6=Zn.isFullyConvertible,hl=(function(){function e(t,n,r,o){this.hour=t,this.minute=n,this.second=r,this.millisecond=o||0}return e.prototype.getHours=function(){return this.hour},e.prototype.getMinutes=function(){return this.minute},e.prototype.getSeconds=function(){return this.second},e.prototype.getMilliseconds=function(){return this.millisecond},e.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},e})(),K6=(function(e){hT(t,e);function t(n,r,o,s,i,a,c){var u=e.call(this,s,i,a,c)||this;return u.year=n,u.month=r,u.day=o,u}return t.fromDate=function(n){return new this(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.valueOf()%1e3)},t.prototype.getWeekday=function(){return is(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(n){this.year+=n},t.prototype.addMonths=function(n){if(this.month+=n,this.month>12){var r=Math.floor(this.month/12),o=Ft(this.month,12);this.month=o,this.year+=r,this.month===0&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(n,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+n*7:this.day+=-(this.getWeekday()-r)+n*7,this.fixDay()},t.prototype.addDaily=function(n){this.day+=n,this.fixDay()},t.prototype.addHours=function(n,r,o){for(r&&(this.hour+=Math.floor((23-this.hour)/n)*n);;){this.hour+=n;var s=Rp(this.hour,24),i=s.div,a=s.mod;if(i&&(this.hour=a,this.addDaily(i)),gn(o)||Ue(o,this.hour))break}},t.prototype.addMinutes=function(n,r,o,s){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/n)*n);;){this.minute+=n;var i=Rp(this.minute,60),a=i.div,c=i.mod;if(a&&(this.minute=c,this.addHours(a,!1,o)),(gn(o)||Ue(o,this.hour))&&(gn(s)||Ue(s,this.minute)))break}},t.prototype.addSeconds=function(n,r,o,s,i){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/n)*n);;){this.second+=n;var a=Rp(this.second,60),c=a.div,u=a.mod;if(c&&(this.second=u,this.addMinutes(c,!1,o,s)),(gn(o)||Ue(o,this.hour))&&(gn(s)||Ue(s,this.minute))&&(gn(i)||Ue(i,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var n=FC(this.year,this.month-1)[1];if(!(this.day<=n))for(;this.day>n;){if(this.day-=n,++this.month,this.month===13&&(this.month=1,++this.year,this.year>pD))return;n=FC(this.year,this.month-1)[1]}}},t.prototype.add=function(n,r){var o=n.freq,s=n.interval,i=n.wkst,a=n.byhour,c=n.byminute,u=n.bysecond;switch(o){case Ce.YEARLY:return this.addYears(s);case Ce.MONTHLY:return this.addMonths(s);case Ce.WEEKLY:return this.addWeekly(s,i);case Ce.DAILY:return this.addDaily(s);case Ce.HOURLY:return this.addHours(s,r,a);case Ce.MINUTELY:return this.addMinutes(s,r,a,c);case Ce.SECONDLY:return this.addSeconds(s,r,a,c,u)}},t})(hl);function gD(e){for(var t=[],n=Object.keys(e),r=0,o=n;r<o.length;r++){var s=o[r];Ue(NJ,s)||t.push(s),ED(e[s])&&!cc(e[s])&&t.push(s)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return ln({},e)}function z6(e){var t=ln(ln({},TT),gD(e));if(Xe(t.byeaster)&&(t.freq=he.YEARLY),!(Xe(t.freq)&&he.FREQUENCIES[t.freq]))throw new Error("Invalid frequency: ".concat(t.freq," ").concat(e.freq));if(t.dtstart||(t.dtstart=new Date(new Date().setMilliseconds(0))),Xe(t.wkst)?En(t.wkst)||(t.wkst=t.wkst.weekday):t.wkst=he.MO.weekday,Xe(t.bysetpos)){En(t.bysetpos)&&(t.bysetpos=[t.bysetpos]);for(var n=0;n<t.bysetpos.length;n++){var r=t.bysetpos[n];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(t.byweekno||ot(t.byweekno)||ot(t.byyearday)||t.bymonthday||ot(t.bymonthday)||Xe(t.byweekday)||Xe(t.byeaster)))switch(t.freq){case he.YEARLY:t.bymonth||(t.bymonth=t.dtstart.getUTCMonth()+1),t.bymonthday=t.dtstart.getUTCDate();break;case he.MONTHLY:t.bymonthday=t.dtstart.getUTCDate();break;case he.WEEKLY:t.byweekday=[is(t.dtstart)];break}if(Xe(t.bymonth)&&!Gt(t.bymonth)&&(t.bymonth=[t.bymonth]),Xe(t.byyearday)&&!Gt(t.byyearday)&&En(t.byyearday)&&(t.byyearday=[t.byyearday]),!Xe(t.bymonthday))t.bymonthday=[],t.bynmonthday=[];else if(Gt(t.bymonthday)){for(var o=[],s=[],n=0;n<t.bymonthday.length;n++){var r=t.bymonthday[n];r>0?o.push(r):r<0&&s.push(r)}t.bymonthday=o,t.bynmonthday=s}else t.bymonthday<0?(t.bynmonthday=[t.bymonthday],t.bymonthday=[]):(t.bynmonthday=[],t.bymonthday=[t.bymonthday]);if(Xe(t.byweekno)&&!Gt(t.byweekno)&&(t.byweekno=[t.byweekno]),!Xe(t.byweekday))t.bynweekday=null;else if(En(t.byweekday))t.byweekday=[t.byweekday],t.bynweekday=null;else if(HC(t.byweekday))t.byweekday=[At.fromStr(t.byweekday).weekday],t.bynweekday=null;else if(t.byweekday instanceof At)!t.byweekday.n||t.freq>he.MONTHLY?(t.byweekday=[t.byweekday.weekday],t.bynweekday=null):(t.bynweekday=[[t.byweekday.weekday,t.byweekday.n]],t.byweekday=null);else{for(var i=[],a=[],n=0;n<t.byweekday.length;n++){var c=t.byweekday[n];if(En(c)){i.push(c);continue}else if(HC(c)){i.push(At.fromStr(c).weekday);continue}!c.n||t.freq>he.MONTHLY?i.push(c.weekday):a.push([c.weekday,c.n])}t.byweekday=ot(i)?i:null,t.bynweekday=ot(a)?a:null}return Xe(t.byhour)?En(t.byhour)&&(t.byhour=[t.byhour]):t.byhour=t.freq<he.HOURLY?[t.dtstart.getUTCHours()]:null,Xe(t.byminute)?En(t.byminute)&&(t.byminute=[t.byminute]):t.byminute=t.freq<he.MINUTELY?[t.dtstart.getUTCMinutes()]:null,Xe(t.bysecond)?En(t.bysecond)&&(t.bysecond=[t.bysecond]):t.bysecond=t.freq<he.SECONDLY?[t.dtstart.getUTCSeconds()]:null,{parsedOptions:t}}function Z6(e){var t=e.dtstart.getTime()%1e3;if(!ET(e.freq))return[];var n=[];return e.byhour.forEach(function(r){e.byminute.forEach(function(o){e.bysecond.forEach(function(s){n.push(new hl(r,o,s,t))})})}),n}function kh(e){var t=e.split(`
`).map(X6).filter(function(n){return n!==null});return ln(ln({},t[0]),t[1])}function El(e){var t={},n=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(e);if(!n)return t;var r=n[1],o=n[2];return r&&(t.tzid=r),t.dtstart=pT(o),t}function X6(e){if(e=e.replace(/^\s+|\s+$/,""),!e.length)return null;var t=/^([A-Z]+?)[:;]/.exec(e.toUpperCase());if(!t)return zC(e);var n=t[1];switch(n.toUpperCase()){case"RRULE":case"EXRULE":return zC(e);case"DTSTART":return El(e);default:throw new Error("Unsupported RFC prop ".concat(n," in ").concat(e))}}function zC(e){var t=e.replace(/^RRULE:/i,""),n=El(t),r=e.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(o){var s=o.split("="),i=s[0],a=s[1];switch(i.toUpperCase()){case"FREQ":n.freq=Ce[a.toUpperCase()];break;case"WKST":n.wkst=an[a.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=Q6(a),u=i.toLowerCase();n[u]=c;break;case"BYWEEKDAY":case"BYDAY":n.byweekday=J6(a);break;case"DTSTART":case"TZID":var f=El(e);n.tzid=f.tzid,n.dtstart=f.dtstart;break;case"UNTIL":n.until=pT(a);break;case"BYEASTER":n.byeaster=Number(a);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),n}function Q6(e){if(e.indexOf(",")!==-1){var t=e.split(",");return t.map(ZC)}return ZC(e)}function ZC(e){return/^[+-]?\d+$/.test(e)?Number(e):e}function J6(e){var t=e.split(",");return t.map(function(n){if(n.length===2)return an[n];var r=n.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(n));var o=Number(r[1]),s=r[2],i=an[s].weekday;return new At(i,o)})}var Tl=(function(){function e(t,n){if(isNaN(t.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=t,this.tzid=n}return Object.defineProperty(e.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var t=_T(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(t):";TZID=".concat(this.tzid,":").concat(t)},e.prototype.getTime=function(){return this.date.getTime()},e.prototype.rezonedDate=function(){return this.isUTC?this.date:G6(this.date,this.tzid)},e})();function xh(e){for(var t=[],n="",r=Object.keys(e),o=Object.keys(TT),s=0;s<r.length;s++)if(r[s]!=="tzid"&&Ue(o,r[s])){var i=r[s].toUpperCase(),a=e[r[s]],c="";if(!(!Xe(a)||Gt(a)&&!a.length)){switch(i){case"FREQ":c=he.FREQUENCIES[e.freq];break;case"WKST":En(a)?c=new At(a).toString():c=a.toString();break;case"BYWEEKDAY":i="BYDAY",c=w6(a).map(function(_){return _ instanceof At?_:Gt(_)?new At(_[0],_[1]):new At(_)}).toString();break;case"DTSTART":n=eJ(a,e.tzid);break;case"UNTIL":c=_T(a,!e.tzid);break;default:if(Gt(a)){for(var u=[],f=0;f<a.length;f++)u[f]=String(a[f]);c=u.toString()}else c=String(a)}c&&t.push([i,c])}}var d=t.map(function(_){var p=_[0],h=_[1];return"".concat(p,"=").concat(h.toString())}).join(";"),l="";return d!==""&&(l="RRULE:".concat(d)),[n,l].filter(function(_){return!!_}).join(`
`)}function eJ(e,t){return e?"DTSTART"+new Tl(new Date(e),t).toString():""}function tJ(e,t){return Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every(function(n,r){return n.getTime()===t[r].getTime()}):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():e===t}var nJ=(function(){function e(){this.all=!1,this.before=[],this.after=[],this.between=[]}return e.prototype._cacheAdd=function(t,n,r){n&&(n=n instanceof Date?Uh(n):YC(n)),t==="all"?this.all=n:(r._value=n,this[t].push(r))},e.prototype._cacheGet=function(t,n){var r=!1,o=n?Object.keys(n):[],s=function(f){for(var d=0;d<o.length;d++){var l=o[d];if(!tJ(n[l],f[l]))return!0}return!1},i=this[t];if(t==="all")r=this.all;else if(Gt(i))for(var a=0;a<i.length;a++){var c=i[a];if(!(o.length&&s(c))){r=c._value;break}}if(!r&&this.all){for(var u=new Bo(t,n),a=0;a<this.all.length&&u.accept(this.all[a]);a++);r=u.getValue(),this._cacheAdd(t,r,n)}return Gt(r)?YC(r):r instanceof Date?Uh(r):r},e})(),rJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],be(1,31),!0),be(2,28),!0),be(3,31),!0),be(4,30),!0),be(5,31),!0),be(6,30),!0),be(7,31),!0),be(8,31),!0),be(9,30),!0),be(10,31),!0),be(11,30),!0),be(12,31),!0),be(1,7),!0),oJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],be(1,31),!0),be(2,29),!0),be(3,31),!0),be(4,30),!0),be(5,31),!0),be(6,30),!0),be(7,31),!0),be(8,31),!0),be(9,30),!0),be(10,31),!0),be(11,30),!0),be(12,31),!0),be(1,7),!0),sJ=Pn(1,29),iJ=Pn(1,30),or=Pn(1,31),lt=Pn(1,32),aJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],lt,!0),iJ,!0),lt,!0),or,!0),lt,!0),or,!0),lt,!0),lt,!0),or,!0),lt,!0),or,!0),lt,!0),lt.slice(0,7),!0),cJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],lt,!0),sJ,!0),lt,!0),or,!0),lt,!0),or,!0),lt,!0),lt,!0),or,!0),lt,!0),or,!0),lt,!0),lt.slice(0,7),!0),uJ=Pn(-28,0),lJ=Pn(-29,0),sr=Pn(-30,0),dt=Pn(-31,0),dJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],dt,!0),lJ,!0),dt,!0),sr,!0),dt,!0),sr,!0),dt,!0),dt,!0),sr,!0),dt,!0),sr,!0),dt,!0),dt.slice(0,7),!0),fJ=te(te(te(te(te(te(te(te(te(te(te(te(te([],dt,!0),uJ,!0),dt,!0),sr,!0),dt,!0),sr,!0),dt,!0),dt,!0),sr,!0),dt,!0),sr,!0),dt,!0),dt.slice(0,7),!0),_J=[0,31,60,91,121,152,182,213,244,274,305,335,366],pJ=[0,31,59,90,120,151,181,212,243,273,304,334,365],XC=(function(){for(var e=[],t=0;t<55;t++)e=e.concat(Pn(7));return e})();function hJ(e,t){var n=So(e,1,1),r=_c(e)?366:365,o=_c(e+1)?366:365,s=Dh(n),i=is(n),a=ln(ln({yearlen:r,nextyearlen:o,yearordinal:s,yearweekday:i},EJ(e)),{wnomask:null});if(gn(t.byweekno))return a;a.wnomask=be(0,r+7);var c,u,f=c=Ft(7-i+t.wkst,7);f>=4?(f=0,u=a.yearlen+Ft(i-t.wkst,7)):u=r-f;for(var d=Math.floor(u/7),l=Ft(u,7),_=Math.floor(d+l/4),p=0;p<t.byweekno.length;p++){var h=t.byweekno[p];if(h<0&&(h+=_+1),h>0&&h<=_){var E=void 0;h>1?(E=f+(h-1)*7,f!==c&&(E-=7-c)):E=f;for(var T=0;T<7&&(a.wnomask[E]=1,E++,a.wdaymask[E]!==t.wkst);T++);}}if(Ue(t.byweekno,1)){var E=f+_*7;if(f!==c&&(E-=7-c),E<r)for(var p=0;p<7&&(a.wnomask[E]=1,E+=1,a.wdaymask[E]!==t.wkst);p++);}if(f){var S=void 0;if(Ue(t.byweekno,-1))S=-1;else{var g=is(So(e-1,1,1)),A=Ft(7-g.valueOf()+t.wkst,7),R=_c(e-1)?366:365,O=void 0;A>=4?(A=0,O=R+Ft(g-t.wkst,7)):O=r-f,S=Math.floor(52+Ft(O,7)/4)}if(Ue(t.byweekno,S))for(var E=0;E<f;E++)a.wnomask[E]=1}return a}function EJ(e){var t=_c(e)?366:365,n=So(e,1,1),r=is(n);return t===365?{mmask:rJ,mdaymask:cJ,nmdaymask:fJ,wdaymask:XC.slice(r),mrange:pJ}:{mmask:oJ,mdaymask:aJ,nmdaymask:dJ,wdaymask:XC.slice(r),mrange:_J}}function TJ(e,t,n,r,o,s){var i={lastyear:e,lastmonth:t,nwdaymask:[]},a=[];if(s.freq===he.YEARLY)if(gn(s.bymonth))a=[[0,n]];else for(var c=0;c<s.bymonth.length;c++)t=s.bymonth[c],a.push(r.slice(t-1,t+1));else s.freq===he.MONTHLY&&(a=[r.slice(t-1,t+1)]);if(gn(a))return i;i.nwdaymask=be(0,n);for(var c=0;c<a.length;c++)for(var u=a[c],f=u[0],d=u[1]-1,l=0;l<s.bynweekday.length;l++){var _=void 0,p=s.bynweekday[l],h=p[0],E=p[1];E<0?(_=d+(E+1)*7,_-=Ft(o[_]-h,7)):(_=f+(E-1)*7,_+=Ft(7-o[_]+h,7)),f<=_&&_<=d&&(i.nwdaymask[_]=1)}return i}function SJ(e,t){t===void 0&&(t=0);var n=e%19,r=Math.floor(e/100),o=e%100,s=Math.floor(r/4),i=r%4,a=Math.floor((r+8)/25),c=Math.floor((r-a+1)/3),u=Math.floor(19*n+r-s-c+15)%30,f=Math.floor(o/4),d=o%4,l=Math.floor(32+2*i+2*f-u-d)%7,_=Math.floor((n+11*u+22*l)/451),p=Math.floor((u+l-7*_+114)/31),h=(u+l-7*_+114)%31+1,E=Date.UTC(e,p-1,h+t),T=Date.UTC(e,0,1);return[Math.ceil((E-T)/(1e3*60*60*24))]}var mJ=(function(){function e(t){this.options=t}return e.prototype.rebuild=function(t,n){var r=this.options;if(t!==this.lastyear&&(this.yearinfo=hJ(t,r)),ot(r.bynweekday)&&(n!==this.lastmonth||t!==this.lastyear)){var o=this.yearinfo,s=o.yearlen,i=o.mrange,a=o.wdaymask;this.monthinfo=TJ(t,n,s,i,a,r)}Xe(r.byeaster)&&(this.eastermask=SJ(t,r.byeaster))},Object.defineProperty(e.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),e.prototype.ydayset=function(){return[Pn(this.yearlen),0,this.yearlen]},e.prototype.mdayset=function(t,n){for(var r=this.mrange[n-1],o=this.mrange[n],s=be(null,this.yearlen),i=r;i<o;i++)s[i]=i;return[s,r,o]},e.prototype.wdayset=function(t,n,r){for(var o=be(null,this.yearlen+7),s=Dh(So(t,n,r))-this.yearordinal,i=s,a=0;a<7&&(o[s]=s,++s,this.wdaymask[s]!==this.options.wkst);a++);return[o,i,s]},e.prototype.ddayset=function(t,n,r){var o=be(null,this.yearlen),s=Dh(So(t,n,r))-this.yearordinal;return o[s]=s,[o,s,s+1]},e.prototype.htimeset=function(t,n,r,o){var s=this,i=[];return this.options.byminute.forEach(function(a){i=i.concat(s.mtimeset(t,a,r,o))}),Pc(i),i},e.prototype.mtimeset=function(t,n,r,o){var s=this.options.bysecond.map(function(i){return new hl(t,n,i,o)});return Pc(s),s},e.prototype.stimeset=function(t,n,r,o){return[new hl(t,n,r,o)]},e.prototype.getdayset=function(t){switch(t){case Ce.YEARLY:return this.ydayset.bind(this);case Ce.MONTHLY:return this.mdayset.bind(this);case Ce.WEEKLY:return this.wdayset.bind(this);case Ce.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},e.prototype.gettimeset=function(t){switch(t){case Ce.HOURLY:return this.htimeset.bind(this);case Ce.MINUTELY:return this.mtimeset.bind(this);case Ce.SECONDLY:return this.stimeset.bind(this)}},e})();function gJ(e,t,n,r,o,s){for(var i=[],a=0;a<e.length;a++){var c=void 0,u=void 0,f=e[a];f<0?(c=Math.floor(f/t.length),u=Ft(f,t.length)):(c=Math.floor((f-1)/t.length),u=Ft(f-1,t.length));for(var d=[],l=n;l<r;l++){var _=s[l];Xe(_)&&d.push(_)}var p=void 0;c<0?p=d.slice(c)[0]:p=d[c];var h=t[u],E=TD(o.yearordinal+p),T=SD(E,h);Ue(i,T)||i.push(T)}return Pc(i),i}function AD(e,t){var n=t.dtstart,r=t.freq,o=t.interval,s=t.until,i=t.bysetpos,a=t.count;if(a===0||o===0)return xn(e);var c=K6.fromDate(n),u=new mJ(t);u.rebuild(c.year,c.month);for(var f=yJ(u,c,t);;){var d=u.getdayset(r)(c.year,c.month,c.day),l=d[0],_=d[1],p=d[2],h=RJ(l,_,p,u,t);if(ot(i))for(var E=gJ(i,f,_,p,u,l),T=0;T<E.length;T++){var S=E[T];if(s&&S>s)return xn(e);if(S>=n){var g=QC(S,t);if(!e.accept(g)||a&&(--a,!a))return xn(e)}}else for(var T=_;T<p;T++){var A=l[T];if(Xe(A))for(var R=TD(u.yearordinal+A),O=0;O<f.length;O++){var C=f[O],S=SD(R,C);if(s&&S>s)return xn(e);if(S>=n){var g=QC(S,t);if(!e.accept(g)||a&&(--a,!a))return xn(e)}}}if(t.interval===0||(c.add(t,h),c.year>pD))return xn(e);ET(r)||(f=u.gettimeset(r)(c.hour,c.minute,c.second,0)),u.rebuild(c.year,c.month)}}function AJ(e,t,n){var r=n.bymonth,o=n.byweekno,s=n.byweekday,i=n.byeaster,a=n.bymonthday,c=n.bynmonthday,u=n.byyearday;return ot(r)&&!Ue(r,e.mmask[t])||ot(o)&&!e.wnomask[t]||ot(s)&&!Ue(s,e.wdaymask[t])||ot(e.nwdaymask)&&!e.nwdaymask[t]||i!==null&&!Ue(e.eastermask,t)||(ot(a)||ot(c))&&!Ue(a,e.mdaymask[t])&&!Ue(c,e.nmdaymask[t])||ot(u)&&(t<e.yearlen&&!Ue(u,t+1)&&!Ue(u,-e.yearlen+t)||t>=e.yearlen&&!Ue(u,t+1-e.yearlen)&&!Ue(u,-e.nextyearlen+t-e.yearlen))}function QC(e,t){return new Tl(e,t.tzid).rezonedDate()}function xn(e){return e.getValue()}function RJ(e,t,n,r,o){for(var s=!1,i=t;i<n;i++){var a=e[i];s=AJ(r,a,o),s&&(e[a]=null)}return s}function yJ(e,t,n){var r=n.freq,o=n.byhour,s=n.byminute,i=n.bysecond;return ET(r)?Z6(n):r>=he.HOURLY&&ot(o)&&!Ue(o,t.hour)||r>=he.MINUTELY&&ot(s)&&!Ue(s,t.minute)||r>=he.SECONDLY&&ot(i)&&!Ue(i,t.second)?[]:e.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}var an={MO:new At(0),TU:new At(1),WE:new At(2),TH:new At(3),FR:new At(4),SA:new At(5),SU:new At(6)},TT={freq:Ce.YEARLY,dtstart:null,interval:1,wkst:an.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},NJ=Object.keys(TT),he=(function(){function e(t,n){t===void 0&&(t={}),n===void 0&&(n=!1),this._cache=n?null:new nJ,this.origOptions=gD(t);var r=z6(t).parsedOptions;this.options=r}return e.parseText=function(t,n){return mD(t,n)},e.fromText=function(t,n){return j6(t,n)},e.fromString=function(t){return new e(e.parseString(t)||void 0)},e.prototype._iter=function(t){return AD(t,this.options)},e.prototype._cacheGet=function(t,n){return this._cache?this._cache._cacheGet(t,n):!1},e.prototype._cacheAdd=function(t,n,r){if(this._cache)return this._cache._cacheAdd(t,n,r)},e.prototype.all=function(t){if(t)return this._iter(new WC("all",{},t));var n=this._cacheGet("all");return n===!1&&(n=this._iter(new Bo("all",{})),this._cacheAdd("all",n)),n},e.prototype.between=function(t,n,r,o){if(r===void 0&&(r=!1),!cc(t)||!cc(n))throw new Error("Invalid date passed in to RRule.between");var s={before:n,after:t,inc:r};if(o)return this._iter(new WC("between",s,o));var i=this._cacheGet("between",s);return i===!1&&(i=this._iter(new Bo("between",s)),this._cacheAdd("between",i,s)),i},e.prototype.before=function(t,n){if(n===void 0&&(n=!1),!cc(t))throw new Error("Invalid date passed in to RRule.before");var r={dt:t,inc:n},o=this._cacheGet("before",r);return o===!1&&(o=this._iter(new Bo("before",r)),this._cacheAdd("before",o,r)),o},e.prototype.after=function(t,n){if(n===void 0&&(n=!1),!cc(t))throw new Error("Invalid date passed in to RRule.after");var r={dt:t,inc:n},o=this._cacheGet("after",r);return o===!1&&(o=this._iter(new Bo("after",r)),this._cacheAdd("after",o,r)),o},e.prototype.count=function(){return this.all().length},e.prototype.toString=function(){return xh(this.origOptions)},e.prototype.toText=function(t,n,r){return q6(this,t,n,r)},e.prototype.isFullyConvertibleToText=function(){return W6(this)},e.prototype.clone=function(){return new e(this.origOptions)},e.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],e.YEARLY=Ce.YEARLY,e.MONTHLY=Ce.MONTHLY,e.WEEKLY=Ce.WEEKLY,e.DAILY=Ce.DAILY,e.HOURLY=Ce.HOURLY,e.MINUTELY=Ce.MINUTELY,e.SECONDLY=Ce.SECONDLY,e.MO=an.MO,e.TU=an.TU,e.WE=an.WE,e.TH=an.TH,e.FR=an.FR,e.SA=an.SA,e.SU=an.SU,e.parseString=kh,e.optionsToString=xh,e})();function OJ(e,t,n,r,o,s){var i={},a=e.accept;function c(l,_){n.forEach(function(p){p.between(l,_,!0).forEach(function(h){i[Number(h)]=!0})})}o.forEach(function(l){var _=new Tl(l,s).rezonedDate();i[Number(_)]=!0}),e.accept=function(l){var _=Number(l);return isNaN(_)?a.call(this,l):!i[_]&&(c(new Date(_-1),new Date(_+1)),!i[_])?(i[_]=!0,a.call(this,l)):!0},e.method==="between"&&(c(e.args.after,e.args.before),e.accept=function(l){var _=Number(l);return i[_]?!0:(i[_]=!0,a.call(this,l))});for(var u=0;u<r.length;u++){var f=new Tl(r[u],s).rezonedDate();if(!e.accept(new Date(f.getTime())))break}t.forEach(function(l){AD(e,l.options)});var d=e._result;switch(Pc(d),e.method){case"all":case"between":return d;case"before":return d.length&&d[d.length-1]||null;case"after":default:return d.length&&d[0]||null}}var JC={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function bJ(e,t){var n=[],r=[],o=[],s=[],i=El(e),a=i.dtstart,c=i.tzid,u=vJ(e,t.unfold);return u.forEach(function(f){var d;if(f){var l=MJ(f),_=l.name,p=l.parms,h=l.value;switch(_.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));n.push(kh(f));break;case"RDATE":var E=(d=/RDATE(?:;TZID=([^:=]+))?/i.exec(f))!==null&&d!==void 0?d:[],T=E[1];T&&!c&&(c=T),r=r.concat(tI(h,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));o.push(kh(h));break;case"EXDATE":s=s.concat(tI(h,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+_)}}}),{dtstart:a,tzid:c,rrulevals:n,rdatevals:r,exrulevals:o,exdatevals:s}}function CJ(e,t){var n=bJ(e,t),r=n.rrulevals,o=n.rdatevals,s=n.exrulevals,i=n.exdatevals,a=n.dtstart,c=n.tzid,u=t.cache===!1;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||o.length||s.length||i.length){var f=new LJ(u);return f.dtstart(a),f.tzid(c||void 0),r.forEach(function(l){f.rrule(new he(Np(l,a,c),u))}),o.forEach(function(l){f.rdate(l)}),s.forEach(function(l){f.exrule(new he(Np(l,a,c),u))}),i.forEach(function(l){f.exdate(l)}),t.compatible&&t.dtstart&&f.rdate(a),f}var d=r[0]||{};return new he(Np(d,d.dtstart||t.dtstart||a,d.tzid||t.tzid||c),u)}function eI(e,t){return t===void 0&&(t={}),CJ(e,IJ(t))}function Np(e,t,n){return ln(ln({},e),{dtstart:t,tzid:n})}function IJ(e){var t=[],n=Object.keys(e),r=Object.keys(JC);if(n.forEach(function(o){Ue(r,o)||t.push(o)}),t.length)throw new Error("Invalid options: "+t.join(", "));return ln(ln({},JC),e)}function PJ(e){if(e.indexOf(":")===-1)return{name:"RRULE",value:e};var t=L6(e,":",1),n=t[0],r=t[1];return{name:n,value:r}}function MJ(e){var t=PJ(e),n=t.name,r=t.value,o=n.split(";");if(!o)throw new Error("empty property name");return{name:o[0].toUpperCase(),parms:o.slice(1),value:r}}function vJ(e,t){if(t===void 0&&(t=!1),e=e&&e.trim(),!e)throw new Error("Invalid empty string");if(!t)return e.split(/\s/);for(var n=e.split(`
`),r=0;r<n.length;){var o=n[r]=n[r].replace(/\s+$/g,"");o?r>0&&o[0]===" "?(n[r-1]+=o.slice(1),n.splice(r,1)):r+=1:n.splice(r,1)}return n}function wJ(e){e.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)})}function tI(e,t){return wJ(t),e.split(",").map(function(n){return pT(n)})}function nI(e){var t=this;return function(n){if(n!==void 0&&(t["_".concat(e)]=n),t["_".concat(e)]!==void 0)return t["_".concat(e)];for(var r=0;r<t._rrule.length;r++){var o=t._rrule[r].origOptions[e];if(o)return o}}}var LJ=(function(e){hT(t,e);function t(n){n===void 0&&(n=!1);var r=e.call(this,{},n)||this;return r.dtstart=nI.apply(r,["dtstart"]),r.tzid=nI.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return t.prototype._iter=function(n){return OJ(n,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(n){rI(n,this._rrule)},t.prototype.exrule=function(n){rI(n,this._exrule)},t.prototype.rdate=function(n){oI(n,this._rdate)},t.prototype.exdate=function(n){oI(n,this._exdate)},t.prototype.rrules=function(){return this._rrule.map(function(n){return eI(n.toString())})},t.prototype.exrules=function(){return this._exrule.map(function(n){return eI(n.toString())})},t.prototype.rdates=function(){return this._rdate.map(function(n){return new Date(n.getTime())})},t.prototype.exdates=function(){return this._exdate.map(function(n){return new Date(n.getTime())})},t.prototype.valueOf=function(){var n=[];return!this._rrule.length&&this._dtstart&&(n=n.concat(xh({dtstart:this._dtstart}))),this._rrule.forEach(function(r){n=n.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){n=n.concat(r.toString().split(`
`).map(function(o){return o.replace(/^RRULE:/,"EXRULE:")}).filter(function(o){return!/^DTSTART/.test(o)}))}),this._rdate.length&&n.push(sI("RDATE",this._rdate,this.tzid())),this._exdate.length&&n.push(sI("EXDATE",this._exdate,this.tzid())),n},t.prototype.toString=function(){return this.valueOf().join(`
`)},t.prototype.clone=function(){var n=new t(!!this._cache);return this._rrule.forEach(function(r){return n.rrule(r.clone())}),this._exrule.forEach(function(r){return n.exrule(r.clone())}),this._rdate.forEach(function(r){return n.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return n.exdate(new Date(r.getTime()))}),n},t})(he);function rI(e,t){if(!(e instanceof he))throw new TypeError(String(e)+" is not RRule instance");Ue(t.map(String),String(e))||t.push(e)}function oI(e,t){if(!(e instanceof Date))throw new TypeError(String(e)+" is not Date instance");Ue(t.map(Number),Number(e))||(t.push(e),Pc(t))}function sI(e,t,n){var r=!n||n.toUpperCase()==="UTC",o=r?"".concat(e,":"):"".concat(e,";TZID=").concat(n,":"),s=t.map(function(i){return _T(i.valueOf(),r)}).join(",");return"".concat(o).concat(s)}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function DJ(e,t){let n=e.slice(0,t).split(/\r\n|\n|\r/g);return[n.length,n.pop().length+1]}function UJ(e,t,n){let r=e.split(/\r\n|\n|\r/g),o="",s=(Math.log10(t+1)|0)+1;for(let i=t-1;i<=t+1;i++){let a=r[i-1];a&&(o+=i.toString().padEnd(s," "),o+=":  ",o+=a,o+=`
`,i===t&&(o+=" ".repeat(s+n+2),o+=`^
`))}return o}class Re extends Error{line;column;codeblock;constructor(t,n){const[r,o]=DJ(n.toml,n.ptr),s=UJ(n.toml,r,o);super(`Invalid TOML document: ${t}

${s}`,n),this.line=r,this.column=o,this.codeblock=s}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function kJ(e,t){let n=0;for(;e[t-++n]==="\\";);return--n&&n%2}function Sl(e,t=0,n=e.length){let r=e.indexOf(`
`,t);return e[r-1]==="\r"&&r--,r<=n?r:-1}function ST(e,t){for(let n=t;n<e.length;n++){let r=e[n];if(r===`
`)return n;if(r==="\r"&&e[n+1]===`
`)return n+1;if(r<" "&&r!=="	"||r==="")throw new Re("control characters are not allowed in comments",{toml:e,ptr:t})}return e.length}function Yn(e,t,n,r){let o;for(;(o=e[t])===" "||o==="	"||!n&&(o===`
`||o==="\r"&&e[t+1]===`
`);)t++;return r||o!=="#"?t:Yn(e,ST(e,t),n)}function iI(e,t,n,r,o=!1){if(!r)return t=Sl(e,t),t<0?e.length:t;for(let s=t;s<e.length;s++){let i=e[s];if(i==="#")s=Sl(e,s);else{if(i===n)return s+1;if(i===r||o&&(i===`
`||i==="\r"&&e[s+1]===`
`))return s}}throw new Re("cannot find end of structure",{toml:e,ptr:t})}function RD(e,t){let n=e[t],r=n===e[t+1]&&e[t+1]===e[t+2]?e.slice(t,t+3):n;t+=r.length-1;do t=e.indexOf(r,++t);while(t>-1&&n!=="'"&&kJ(e,t));return t>-1&&(t+=r.length,r.length>1&&(e[t]===n&&t++,e[t]===n&&t++)),t}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let xJ=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class Ho extends Date{#e=!1;#t=!1;#r=null;constructor(t){let n=!0,r=!0,o="Z";if(typeof t=="string"){let s=t.match(xJ);s?(s[1]||(n=!1,t=`0000-01-01T${t}`),r=!!s[2],r&&t[10]===" "&&(t=t.replace(" ","T")),s[2]&&+s[2]>23?t="":(o=s[3]||null,t=t.toUpperCase(),!o&&r&&(t+="Z"))):t=""}super(t),isNaN(this.getTime())||(this.#e=n,this.#t=r,this.#r=o)}isDateTime(){return this.#e&&this.#t}isLocal(){return!this.#e||!this.#t||!this.#r}isDate(){return this.#e&&!this.#t}isTime(){return this.#t&&!this.#e}isValid(){return this.#e||this.#t}toISOString(){let t=super.toISOString();if(this.isDate())return t.slice(0,10);if(this.isTime())return t.slice(11,23);if(this.#r===null)return t.slice(0,-1);if(this.#r==="Z")return t;let n=+this.#r.slice(1,3)*60+ +this.#r.slice(4,6);return n=this.#r[0]==="-"?n:-n,new Date(this.getTime()-n*6e4).toISOString().slice(0,-1)+this.#r}static wrapAsOffsetDateTime(t,n="Z"){let r=new Ho(t);return r.#r=n,r}static wrapAsLocalDateTime(t){let n=new Ho(t);return n.#r=null,n}static wrapAsLocalDate(t){let n=new Ho(t);return n.#t=!1,n.#r=null,n}static wrapAsLocalTime(t){let n=new Ho(t);return n.#e=!1,n.#r=null,n}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let GJ=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,VJ=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,$J=/^[+-]?0[0-9_]/,BJ=/^[0-9a-f]{4,8}$/i,aI={b:"\b",t:"	",n:`
`,f:"\f",r:"\r",'"':'"',"\\":"\\"};function yD(e,t=0,n=e.length){let r=e[t]==="'",o=e[t++]===e[t]&&e[t]===e[t+1];o&&(n-=2,e[t+=2]==="\r"&&t++,e[t]===`
`&&t++);let s=0,i,a="",c=t;for(;t<n-1;){let u=e[t++];if(u===`
`||u==="\r"&&e[t]===`
`){if(!o)throw new Re("newlines are not allowed in strings",{toml:e,ptr:t-1})}else if(u<" "&&u!=="	"||u==="")throw new Re("control characters are not allowed in strings",{toml:e,ptr:t-1});if(i){if(i=!1,u==="u"||u==="U"){let f=e.slice(t,t+=u==="u"?4:8);if(!BJ.test(f))throw new Re("invalid unicode escape",{toml:e,ptr:s});try{a+=String.fromCodePoint(parseInt(f,16))}catch{throw new Re("invalid unicode escape",{toml:e,ptr:s})}}else if(o&&(u===`
`||u===" "||u==="	"||u==="\r")){if(t=Yn(e,t-1,!0),e[t]!==`
`&&e[t]!=="\r")throw new Re("invalid escape: only line-ending whitespace may be escaped",{toml:e,ptr:s});t=Yn(e,t)}else if(u in aI)a+=aI[u];else throw new Re("unrecognized escape sequence",{toml:e,ptr:s});c=t}else!r&&u==="\\"&&(s=t-1,i=!0,a+=e.slice(c,s))}return a+e.slice(c,n-1)}function HJ(e,t,n,r){if(e==="true")return!0;if(e==="false")return!1;if(e==="-inf")return-1/0;if(e==="inf"||e==="+inf")return 1/0;if(e==="nan"||e==="+nan"||e==="-nan")return NaN;if(e==="-0")return r?0n:0;let o=GJ.test(e);if(o||VJ.test(e)){if($J.test(e))throw new Re("leading zeroes are not allowed",{toml:t,ptr:n});e=e.replace(/_/g,"");let i=+e;if(isNaN(i))throw new Re("invalid number",{toml:t,ptr:n});if(o){if((o=!Number.isSafeInteger(i))&&!r)throw new Re("integer value cannot be represented losslessly",{toml:t,ptr:n});(o||r===!0)&&(i=BigInt(e))}return i}const s=new Ho(e);if(!s.isValid())throw new Re("invalid value",{toml:t,ptr:n});return s}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function FJ(e,t,n,r){let o=e.slice(t,n),s=o.indexOf("#");s>-1&&(ST(e,s),o=o.slice(0,s));let i=o.trimEnd();if(!r){let a=o.indexOf(`
`,i.length);if(a>-1)throw new Re("newlines are not allowed in inline tables",{toml:e,ptr:t+a})}return[i,s]}function mT(e,t,n,r,o){if(r===0)throw new Re("document contains excessively nested structures. aborting.",{toml:e,ptr:t});let s=e[t];if(s==="["||s==="{"){let[c,u]=s==="["?qJ(e,t,r,o):jJ(e,t,r,o),f=n?iI(e,u,",",n):u;if(u-f&&n==="}"){let d=Sl(e,u,f);if(d>-1)throw new Re("newlines are not allowed in inline tables",{toml:e,ptr:d})}return[c,f]}let i;if(s==='"'||s==="'"){i=RD(e,t);let c=yD(e,t,i);if(n){if(i=Yn(e,i,n!=="]"),e[i]&&e[i]!==","&&e[i]!==n&&e[i]!==`
`&&e[i]!=="\r")throw new Re("unexpected character encountered",{toml:e,ptr:i});i+=+(e[i]===",")}return[c,i]}i=iI(e,t,",",n);let a=FJ(e,t,i-+(e[i-1]===","),n==="]");if(!a[0])throw new Re("incomplete key-value declaration: no value specified",{toml:e,ptr:t});return n&&a[1]>-1&&(i=Yn(e,t+a[1]),i+=+(e[i]===",")),[HJ(a[0],e,t,o),i]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let YJ=/^[a-zA-Z0-9-_]+[ \t]*$/;function Gh(e,t,n="="){let r=t-1,o=[],s=e.indexOf(n,t);if(s<0)throw new Re("incomplete key-value: cannot find end of key",{toml:e,ptr:t});do{let i=e[t=++r];if(i!==" "&&i!=="	")if(i==='"'||i==="'"){if(i===e[t+1]&&i===e[t+2])throw new Re("multiline strings are not allowed in keys",{toml:e,ptr:t});let a=RD(e,t);if(a<0)throw new Re("unfinished string encountered",{toml:e,ptr:t});r=e.indexOf(".",a);let c=e.slice(a,r<0||r>s?s:r),u=Sl(c);if(u>-1)throw new Re("newlines are not allowed in keys",{toml:e,ptr:t+r+u});if(c.trimStart())throw new Re("found extra tokens after the string part",{toml:e,ptr:a});if(s<a&&(s=e.indexOf(n,a),s<0))throw new Re("incomplete key-value: cannot find end of key",{toml:e,ptr:t});o.push(yD(e,t,a))}else{r=e.indexOf(".",t);let a=e.slice(t,r<0||r>s?s:r);if(!YJ.test(a))throw new Re("only letter, numbers, dashes and underscores are allowed in keys",{toml:e,ptr:t});o.push(a.trimEnd())}}while(r+1&&r<s);return[o,Yn(e,s+1,!0,!0)]}function jJ(e,t,n,r){let o={},s=new Set,i,a=0;for(t++;(i=e[t++])!=="}"&&i;){let c={toml:e,ptr:t-1};if(i===`
`)throw new Re("newlines are not allowed in inline tables",c);if(i==="#")throw new Re("inline tables cannot contain comments",c);if(i===",")throw new Re("expected key-value, found comma",c);if(i!==" "&&i!=="	"){let u,f=o,d=!1,[l,_]=Gh(e,t-1);for(let E=0;E<l.length;E++){if(E&&(f=d?f[u]:f[u]={}),u=l[E],(d=Object.hasOwn(f,u))&&(typeof f[u]!="object"||s.has(f[u])))throw new Re("trying to redefine an already defined value",{toml:e,ptr:t});!d&&u==="__proto__"&&Object.defineProperty(f,u,{enumerable:!0,configurable:!0,writable:!0})}if(d)throw new Re("trying to redefine an already defined value",{toml:e,ptr:t});let[p,h]=mT(e,_,"}",n-1,r);s.add(p),f[u]=p,t=h,a=e[t-1]===","?t-1:0}}if(a)throw new Re("trailing commas are not allowed in inline tables",{toml:e,ptr:a});if(!i)throw new Re("unfinished table encountered",{toml:e,ptr:t});return[o,t]}function qJ(e,t,n,r){let o=[],s;for(t++;(s=e[t++])!=="]"&&s;){if(s===",")throw new Re("expected value, found comma",{toml:e,ptr:t-1});if(s==="#")t=ST(e,t);else if(s!==" "&&s!=="	"&&s!==`
`&&s!=="\r"){let i=mT(e,t-1,"]",n-1,r);o.push(i[0]),t=i[1]}}if(!s)throw new Re("unfinished array encountered",{toml:e,ptr:t});return[o,t]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function cI(e,t,n,r){let o=t,s=n,i,a=!1,c;for(let u=0;u<e.length;u++){if(u){if(o=a?o[i]:o[i]={},s=(c=s[i]).c,r===0&&(c.t===1||c.t===2))return null;if(c.t===2){let f=o.length-1;o=o[f],s=s[f].c}}if(i=e[u],(a=Object.hasOwn(o,i))&&s[i]?.t===0&&s[i]?.d)return null;a||(i==="__proto__"&&(Object.defineProperty(o,i,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(s,i,{enumerable:!0,configurable:!0,writable:!0})),s[i]={t:u<e.length-1&&r===2?3:r,d:!1,i:0,c:{}})}if(c=s[i],c.t!==r&&!(r===1&&c.t===3)||(r===2&&(c.d||(c.d=!0,o[i]=[]),o[i].push(o={}),c.c[c.i++]=c={t:1,d:!1,i:0,c:{}}),c.d))return null;if(c.d=!0,r===1)o=a?o[i]:o[i]={};else if(r===0&&a)return null;return[i,o,c.c]}function WJ(e,{maxDepth:t=1e3,integersAsBigInt:n}={}){let r={},o={},s=r,i=o;for(let a=Yn(e,0);a<e.length;){if(e[a]==="["){let c=e[++a]==="[",u=Gh(e,a+=+c,"]");if(c){if(e[u[1]-1]!=="]")throw new Re("expected end of table declaration",{toml:e,ptr:u[1]-1});u[1]++}let f=cI(u[0],r,o,c?2:1);if(!f)throw new Re("trying to redefine an already defined table or value",{toml:e,ptr:a});i=f[2],s=f[1],a=u[1]}else{let c=Gh(e,a),u=cI(c[0],s,i,0);if(!u)throw new Re("trying to redefine an already defined table or value",{toml:e,ptr:a});let f=mT(e,c[1],void 0,t,n);u[1][u[0]]=f[0],a=f[1]}if(a=Yn(e,a,!0),e[a]&&e[a]!==`
`&&e[a]!=="\r")throw new Re("each key-value declaration must be followed by an end-of-line",{toml:e,ptr:a});a=Yn(e,a)}return r}function KJ(e,t,n,r){const o=X5(t),s={message:o.message,status:zJ(e),source:n.source,service:n.source,env:n.env,date:Date.now(),logger:{name:o.loggerName??"app"},"codex.app_session_id":n.codexAppSessionId,usr:n.userInfo};return r!=null&&Object.assign(s,r),ZJ(s,n.buildInfo),s}function zJ(e){switch(e){case"trace":case"debug":return"debug";case"info":return"info";case"warning":return"warn";case"error":return"error"}}function ZJ(e,t){Op(e,"build_number",t.buildNumber),Op(e,"version",t.version),Op(e,"app_version",t.version)}function Op(e,t,n){n!=null&&(e[t]=n)}const XJ=5e3,QJ=50,JJ=64e3;class e8{onFlush;flushIntervalMs;maxBatchSize;maxBatchBytes;buffer=[];bufferBytes=0;flushTimeout=null;constructor(t){this.onFlush=t.onFlush,this.flushIntervalMs=t.flushIntervalMs??XJ,this.maxBatchSize=t.maxBatchSize??QJ,this.maxBatchBytes=t.maxBatchBytes??JJ}enqueue(t){if(this.buffer.push(t),this.bufferBytes+=t.length,this.buffer.length>=this.maxBatchSize||this.bufferBytes>=this.maxBatchBytes){this.flush();return}this.scheduleFlush()}flushNow(){this.flush()}scheduleFlush(){this.flushTimeout==null&&(this.flushTimeout=setTimeout(()=>{this.flush()},this.flushIntervalMs))}flush(){if(this.buffer.length===0){this.clearFlushTimeout();return}const t=this.buffer.splice(0,this.buffer.length);this.bufferBytes=0,this.clearFlushTimeout(),this.onFlush(t)}clearFlushTimeout(){this.flushTimeout!=null&&(clearTimeout(this.flushTimeout),this.flushTimeout=null)}}const t8="https://chat.openai.com/ces/v1/telemetry/intake",n8="dummy-token",r8="browser",o8=2e3,s8=3e4,i8=5;class a8{options;reportFailure;batcher;queue=[];inFlightSend=null;retryTimeout=null;retryAttempts=0;disabled=!1;reportedDisabledReason=!1;fetchImpl;userInfo=null;constructor(t){this.options=t,this.reportFailure=t.reportFailure,this.fetchImpl=t.fetchImpl??fetch,this.batcher=new e8({onFlush:n=>this.enqueueBatch(n)})}setUserInfo(t){this.userInfo=t}log(t,n,r){const o=KJ(t,n,{buildInfo:this.options.buildInfo,userInfo:this.userInfo,codexAppSessionId:this.options.codexAppSessionId,source:this.options.source,env:this.options.env},r);this.batcher.enqueue(JSON.stringify(o))}flushNow(){this.batcher.flushNow(),this.drainQueue()}enqueueBatch(t){this.disabled||t.length!==0&&(this.queue.push({requestId:Sc.randomUUID(),events:t}),this.drainQueue())}async drainQueue(){if(this.disabled){this.queue.length=0;return}if(this.inFlightSend!=null||this.retryTimeout!=null)return;const t=this.queue[0];if(t==null)return;const n=t.events.join(`
`);this.inFlightSend=(async()=>{try{await this.send(n,t.requestId),this.queue.shift(),this.retryAttempts=0}catch{if(this.disabled){this.queue.length=0;return}this.scheduleRetry()}finally{this.inFlightSend=null,this.drainQueue()}})()}scheduleRetry(){if(this.retryTimeout!=null)return;if(this.retryAttempts>=i8){this.queue.shift(),this.retryAttempts=0,this.drainQueue();return}this.retryAttempts+=1;const t=Math.min(s8,o8*Math.pow(2,this.retryAttempts-1));this.retryTimeout=setTimeout(()=>{this.retryTimeout=null,this.drainQueue()},t)}disableWithFailure(t){this.disabled=!0,!this.reportedDisabledReason&&(this.reportedDisabledReason=!0,this.reportFailure(t))}async send(t,n){const r=c8(n),o=await this.fetchImpl(r,{method:"POST",headers:{"content-type":"text/plain","x-request-id":n},body:Buffer.from(t)});if(!o.ok){const s=await o.text();if(o.status>=400&&o.status<500)return(o.status===401||o.status===403)&&this.disableWithFailure({type:"disabled",reason:"invalid_client_token",status:o.status,body:s}),o.status;throw new Error(`[datadog] non-2xx response (${o.status})`)}return o.status}}function c8(e){const n=`/api/v2/logs?${new URLSearchParams({ddsource:"browser","dd-api-key":n8,"dd-evp-origin":r8,"dd-request-id":e}).toString()}`;return`${t8}?ddforward=${encodeURIComponent(n)}`}function bp(e,t){let n=null,r=null;const o=((...s)=>{r=s,n&&clearTimeout(n),n=setTimeout(()=>{n=null;const i=r;r=null,i&&e(...i)},t)});return o.cancel=()=>{n&&(clearTimeout(n),n=null),r=null},o}function u8(e){const t=(n,r,o)=>{const s=typeof n=="string"?new Error(n):n;try{e(s,r,o)}catch{}};return{report:t,reportNonFatal:(n,r)=>t(n,"non-fatal",r),reportFatal:(n,r)=>t(n,"fatal",r)}}async function l8(e,t){let n;try{const o=await Ke.readFile(e,t);n=WJ(o),n=d8(n)}catch(o){return{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Failed to parse environment config at ${e}: ${String(o)}`)}}const r=vQ.safeParse(n);return r.success?{configPath:e,cwdRelativeToGitRoot:await h8(e,t),type:"success",environment:_8(r.data)}:{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Invalid environment config at ${e}: ${r.error.toString()}`)}}function d8(e){return!ND(e)||!Array.isArray(e.actions)?e:{...e,actions:e.actions.filter(t=>f8(t))}}function f8(e){return!ND(e)||typeof e.name!="string"||typeof e.command!="string"?!1:e.name.trim().length>0&&e.command.trim().length>0}function ND(e){return typeof e=="object"&&e!=null&&!Array.isArray(e)}function _8(e){return{...e,name:e.name.trim(),setup:p8(e.setup),actions:e.actions?e.actions.map(t=>({...t,name:t.name.trim(),command:t.command.trim()})):void 0}}function p8(e){return{...e,script:e.script.trim(),darwin:e.darwin?{script:e.darwin.script.trim()}:void 0,linux:e.linux?{script:e.linux.script.trim()}:void 0,win32:e.win32?{script:e.win32.script.trim()}:void 0}}async function h8(e,t){const n=It(t),r=await E8(e,t);let o=r;for(;o!==n.dirname(o)&&!await OD(o,t);)o=n.dirname(o);const s=n.relative(o,r);return s===""?".":s}async function OD(e,t){const n=It(t);try{const r=await Ke.stat(n.join(e,".git"),t);return r.isDirectory()||r.isFile()}catch{return!1}}async function E8(e,t){const n=It(t);let r=n.dirname(e);for(;r!==n.dirname(r);){if(await T8(r,t))return r;if(await OD(r,t))return r;r=n.dirname(r)}return e}async function T8(e,t){const n=It(t);try{const r=await Ke.stat(n.join(e,".codex"),t);return r.isDirectory()||r.isFile()}catch{return!1}}const Lo=Ct("git");async function oe(e,t,n,r={}){const{env:o,signal:s,timeoutMs:i,onStdoutRaw:a,onStderrRaw:c,maxOutputBytes:u,trim:f=!0,allowedNonZeroExitCodes:d}=r,l={LC_MESSAGES:"C",LANGUAGE:"C",GIT_TERMINAL_PROMPT:"0",...o},_=S8(e,t,n),p=Z5(_),h=t[0],E=crypto.randomUUID().slice(0,8),T=Date.now(),S=we(n),g={id:E,startTimeMs:T,isRemote:S,subcommand:h,allowedNonZeroExitCodes:d?.join(",")},A={command:p,commandArgs:_,cwd:e};let R=0,O=0;if(s&&s.aborted)return Lo().warning("git.command.complete",{safe:{requestId:E,subcommand:h,argsCount:t.length,isRemote:S,success:!1,failureReason:"abortedBeforeStart"},sensitive:{}}),{command:p,success:!1,code:null,stdout:"",stdoutBytes:R,stderr:"git process aborted",stderrBytes:O};let C=!1,I=!1,w,U=0;Lo().debug("git.command.start",{safe:g,sensitive:A});let B,F="",G="",x=null;const Y=(H,J)=>{U+=J.length,H==="stdout"?R+=J.length:O+=J.length,u!=null&&U>u&&w==null&&(w={stream:H,limitBytes:u},B.kill()),H==="stdout"?a?.(J):c?.(J)};try{if(S){const H=Nt(p);B=await pr({hostConfig:n,args:["bash","-lc",H],env:l,stdoutChunkHandler:J=>Y("stdout",J),stderrChunkHandler:J=>Y("stderr",J)})}else B=uD({args:_,cwd:e,env:{...process.env,...l},stdoutChunkHandler:H=>Y("stdout",H),stderrChunkHandler:H=>Y("stderr",H)})}catch(H){Lo().warning("git.command.complete",{safe:{...g,failureReason:"spawnFailed",durationMs:Date.now()-T},sensitive:A});const J=H instanceof Error?H.message:"Failed to start git process";return{command:p,success:!1,code:null,stdout:"",stdoutBytes:R,stderr:J,stderrBytes:O}}const v=()=>{I=!0,B.kill()};s&&(s.addEventListener("abort",v),s.aborted&&v());const P=i!=null?setTimeout(()=>{C=!0,B.kill()},i):null;try{const{stdout:H,stderr:J,code:se}=await B.wait();if(F=f?H.trim():H,G=f?J.trim():J,x=se,P&&clearTimeout(P),s&&s.removeEventListener("abort",v),I)return{command:p,success:!1,code:x,stdout:F,stdoutBytes:R,stderr:G?`${G}
git process aborted`:"git process aborted",stderrBytes:O,outputLimitExceeded:w,process:B};const ne=w==null&&x!=null&&(x===0||Array.isArray(d)&&d.includes(x));if(ne)Lo().debug("git.command.complete",{safe:{...g,success:!0,...x!=null?{exitCode:x}:{},durationMs:Date.now()-T,aborted:I,timedOut:C},sensitive:A});else{const M=w!=null?"output_limit_exceeded":C?"timed_out":I?"aborted":"command_failed";Lo().warning("git.command.complete",{safe:{...g,failureReason:M,...x!=null?{exitCode:x}:{},durationMs:Date.now()-T,aborted:I,timedOut:C,...w!=null?{outputLimitStream:w.stream,outputLimitMaxBytes:w.limitBytes}:{},...d!=null&&d.length>0?{allowedNonZeroExitCodes:d.join(",")}:{}},sensitive:A})}return{command:p,success:ne,code:x,stdout:F,stdoutBytes:R,stderr:C?`${G}git process timed out after ${i}ms`:G,stderrBytes:O,outputLimitExceeded:w,process:B}}catch(H){P&&clearTimeout(P),s&&s.removeEventListener("abort",v);const J=H instanceof Error?H.message:String(H);Lo().warning("git.command.complete",{safe:{...g,failureReason:"waitFailed",durationMs:Date.now()-T,aborted:I,timedOut:C},sensitive:A});const se=B?.getStdout().toString("utf8")??F,ne=B?.getStderr().toString("utf8")??(J?`${G}${J}`:G);return{command:p,success:!1,code:x,stdout:se,stdoutBytes:Buffer.byteLength(se,"utf8"),stderr:ne,stderrBytes:Buffer.byteLength(ne,"utf8"),outputLimitExceeded:w,process:B}}}function S8(e,t,n){return we(n)?["git","--no-optional-locks","-C",e,...t]:["git","--no-optional-locks",...t]}async function pd(e,t=null){const n=It(t),{success:r,stdout:o}=await oe(e,["rev-parse","--git-dir"],t,{allowedNonZeroExitCodes:[128]});return!r||!o?null:n.isAbsolute(o)?o:n.resolve(e,o)}async function gT(e,t,n=null){if(t)try{const r=It(n).join(t,CD);if((await Ke.stat(r,n)).isFile())return!0}catch{}return we(n)?!1:m8(e)}async function m8(e){try{const t=await Ke.stat(e,null);return t.birthtimeMs>0?t.birthtimeMs<g8:!0}catch{return!1}}async function bD(e,t=null){try{const n=It(t),r=await pd(e,t);if(!r)return{success:!1,error:new Error("Failed to resolve worktree git directory")};const o=n.join(r,CD);return await Ke.writeFile(o,"",t),{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n:new Error("Failed to mark worktree")}}}const CD="codex-managed",g8=new Date("2026-01-29T00:00:00").getTime(),Fo=5*1024*1024,uI=32*1024*1024,lI=64*1024*1024,pc="origin",A8=["-c","diff.mnemonicPrefix=false","-c","diff.noprefix=false","-c","core.quotePath=false"],R8=["diff","--no-ext-diff","--no-textconv","--color=never","--src-prefix=a/","--dst-prefix=b/"],y8=8;async function ID(e,t,n){if(!t.success)return{success:!1,error:{type:"unknown"}};const r=t.paths,o=[],s=Array.from({length:r.length},()=>{});let i=0,a=0,c=!1,u=null,f=0;const d=T=>{c||(c=!0,u=T)},l=T=>{T.trim().length===0||c||o.push(T)},_=()=>{if(!c)for(;a<s.length;){const T=s[a];if(T===void 0)return;if(a+=1,!(T==null||T.trim().length===0)&&(l(T),c))return}},p=()=>{if(c||i>=r.length)return null;const T=r[i],S=i;return i+=1,{index:S,path:T}},h=async()=>{if(c)return;const T=p();if(T==null)return;const S=await e(T.path,n);if(S.type==="error"){d(S.error);return}const g=f+(S.unifiedDiffBytes??S.unifiedDiff.length);if(g>lI){d({type:"diff-too-large",limitBytes:lI});return}f=g,s[T.index]=S.unifiedDiff.trim().length>0?S.unifiedDiff:null,_(),await h()},E=Math.min(y8,r.length);return await Promise.all(Array.from({length:E},()=>h())),u?{success:!1,error:u}:{success:!0,sections:o}}async function Vh(e,t,n,{includePaths:r}={}){const o=await t.getWorktreeRepository(e,n);if(!o)return{type:"error",error:{type:"unknown"}};const s=await o.getUntrackedPaths(r),i=await ID(o.getUntrackedDiff,s);if(!i.success)return{type:"error",error:i.error};const a=i.sections.length>0?i.sections.map(c=>N8(c)).join(`
`):"";return{type:"success",unifiedDiff:a,unifiedDiffBytes:Buffer.byteLength(a,"utf8")}}function N8(e){return e.replace(/[\r\n]+$/,"")}async function hd(e,t,n){const{success:r,stdout:o}=await oe(e,["rev-parse","--git-dir"],t,{signal:n});return!r||!o?null:ce.isAbsolute(o)?o:ce.join(e,o)}const O8=Ct("git");async function AT(e,t,n){if(!we(t)&&!pe.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:o,stderr:s,code:i}=await oe(e,["rev-parse","--show-toplevel"],t,{allowedNonZeroExitCodes:[128],signal:n});if(r&&o)return o;if(i===128&&s.toLowerCase().includes("not a git repository"))return null;throw O8().debug("[getGitRoot] failed to resolve git root",{safe:{stderr:s,stdout:o},sensitive:{}}),new Error(`Failed to resolve git root: ${s||o||"Unknown error"}`)}function Fc(e){return e?.outputLimitExceeded?{type:"diff-too-large",limitBytes:e.outputLimitExceeded.limitBytes}:{type:"unknown"}}async function jn(e,t,n,r={}){const{binary:o=!1,maxOutputBytes:s,...i}=r,a=s==null?uI:Math.min(s,uI);return oe(e,[...A8,...R8,...o?["--binary"]:[],...t],n,{...i,maxOutputBytes:a})}const Cp=Ct("git");function dI(e){return{command:e.command,success:e.success,code:e.code,stdout:e.stdout,stderr:e.stderr,outputLimitExceeded:e.outputLimitExceeded}}async function PD(e,t,n){const r=await hd(e,t,n);if(!r)return{type:"error",error:{type:"unknown"}};let o=null;try{o=await pe.promises.mkdtemp(ce.join(mo.tmpdir(),"codex-git-index"));const s=ce.join(r,"index"),i=ce.join(o,"index");await pe.promises.copyFile(s,i).catch(f=>{if(f.code!=="ENOENT")throw f});const a={GIT_INDEX_FILE:i},c=await oe(e,["add","-u"],t,{env:a,signal:n});if(!c.success)return Cp().warning("Failed to stage uncommitted diff",{safe:{},sensitive:{...dI(c)}}),{type:"error",error:{type:"unknown"}};const u=await jn(e,["--cached"],t,{trim:!1,allowedNonZeroExitCodes:[0,1],env:a,signal:n});return u.outputLimitExceeded||!u.success?(Cp().warning("Failed to collect uncommitted diff",{safe:{},sensitive:{...dI(u)}}),{type:"error",error:Fc(u)}):{type:"success",unifiedDiff:u.stdout,unifiedDiffBytes:u.stdoutBytes}}catch(s){return Cp().error("failed to collect tracked uncommitted diff",{safe:{},sensitive:{error:s}}),{type:"error",error:{type:"unknown"}}}finally{o&&await pe.promises.rm(o,{recursive:!0,force:!0})}}async function b8(e,t,n,r){const o=await AT(e,n,r),[s,i]=await Promise.all([PD(e,n,r),o?Vh(o,t,n):Promise.resolve({type:"error",error:{type:"unknown"}})]);if(s.type!=="success"||i.type!=="success")return{type:"error",error:{type:"unknown"}};const a=C8([s.unifiedDiff,i.unifiedDiff]);return{type:"success",unifiedDiff:a,unifiedDiffBytes:Buffer.byteLength(a,"utf8")}}function C8(e){const t=e.map(r=>I8(r)).filter(r=>r.length>0);if(t.length===0)return"";const n=t.join(`
`);return n.endsWith(`
`)?n:`${n}
`}function I8(e){return e.replace(/[\r\n]+$/,"")}async function On(e,t,n){const{success:r,stdout:o}=await oe(e,["rev-parse","--abbrev-ref","HEAD"],t,{signal:n});if(r&&o&&o!=="HEAD")return o;const s=await oe(e,["symbolic-ref","--quiet","--short","HEAD"],t,{signal:n});return s.success&&s.stdout?s.stdout:null}async function MD(e,t=pc,n,r){const o=await oe(e,["symbolic-ref","--quiet",`refs/remotes/${t}/HEAD`],n,{signal:r});if(o.success&&o.stdout){const a=o.stdout.split("/");return a[a.length-1]??null}const s=await oe(e,["remote","show",t],n,{timeoutMs:1e4,signal:r});if(!s.success||!s.stdout)return null;const i=/HEAD branch:\s*(.+)/.exec(s.stdout);return i?i[1].trim():null}async function vD(e,t,n,r,o){const s=await oe(e,["rev-list","--left-right","--count",`${t}...${n}`],r,{allowedNonZeroExitCodes:[128,1],signal:o});if(!s.success||!s.stdout)return null;const i=P8(s.stdout);if(!i)return null;let a="equal";return i.leftAhead>0&&i.rightAhead>0?a="diverged":i.leftAhead>0?a="left-ahead":i.rightAhead>0&&(a="right-ahead"),{leftAhead:i.leftAhead,rightAhead:i.rightAhead,state:a}}function P8(e){const t=e.trim();if(!t)return null;const n=t.split(/\s+/);if(n.length<2)return null;const r=Number.parseInt(n[0]??"",10),o=Number.parseInt(n[1]??"",10);return!Number.isFinite(r)||!Number.isFinite(o)?null:{leftAhead:r,rightAhead:o}}async function M8(e,t,n,r){const o=await oe(e,["rev-parse","--abbrev-ref","--symbolic-full-name",`${t}@{u}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});return o.success&&o.stdout?o.stdout:null}async function v8(e,t,n,r,o){const s=async f=>{const d=await M8(e,f,r,o);return d&&(await vD(e,f,d,r,o))?.state==="right-ahead"?d:f},i=async()=>t.type==="branch"?s(t.branchName):await On(e,r,o)??await MD(e,pc,r,o)??"HEAD",a=async()=>{if(t.type!=="working-tree")return null;const f=await b8(e,n,r,o);return f.type==="error"?null:f.unifiedDiff},[c,u]=await Promise.all([i(),a()]);return{startingRef:c,startingDiff:u}}function w8(e){return e?.id??"local"}function Yc(e){return Sc.createHash("sha1").update(e).digest("hex")}const hc=Ct("git"),L8=3,fI=new Map;function D8(e){const t=w8(e),n=fI.get(t);if(n)return n;const r=new nD.Sema(L8);return fI.set(t,r),r}async function so(e,t,n=!1,r){const o=Yc(e),s=D8(t);await s.acquire();try{hc().info("[worktree-delete] start",{safe:{worktreeId:o,force:n,hasHostConfig:t!=null},sensitive:{}});const i=["worktree","remove"];n&&i.push("--force"),i.push(e);const a=await oe(e,i,t,{signal:r});hc().info("[worktree-delete] git-remove-result",{safe:{worktreeId:o,force:n,success:a.success,code:a.code,outputLimitExceeded:a.outputLimitExceeded!=null},sensitive:{}}),(a.success||n)&&await U8(e,o,t)}finally{s.release()}}async function U8(e,t,n){const r=It(n);let o=!1,s=!1;try{await Ke.rm(e,{recursive:!0,force:!0},n),o=!0}catch(i){hc().warning("Failed to remove worktree directory",{safe:{},sensitive:{error:i}})}try{const i=r.dirname(e);if(i===e)return;(await Ke.readdir(i,n)).length===0&&(await Ke.rm(i,{recursive:!0,force:!0},n),s=!0)}catch(i){hc().warning("Failed to remove worktree parent directory",{safe:{},sensitive:{error:i}})}hc().debug("[worktree-delete] cleanup-finished",{safe:{worktreeId:t},sensitive:{removedWorktreeDir:o,removedParentDir:s}})}function k8(e,t){return[e,t].filter(r=>r.length>0).join(`
`)}function Yt({command:e,stdout:t,stderr:n,fallbackOutput:r=t||n||"An unknown error occurred"}){const o=k8(t,n)||r;return{command:e,output:o}}async function wD(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:o=void 0}={}){const s=we(n),i=s?ce.posix.join(e,"index"):ce.join(e,"index");if(s){const c=`cp ${Nt(t)} ${Nt(i)}`;await(await pr({hostConfig:n,args:[`sh -lc ${Nt(c)}`]})).check()}else await pe.promises.copyFile(t,i);let a=i;return r&&o&&(a=o(i)),a}async function Ed(e,t,n,r){const{success:o,stdout:s}=await oe(e,["rev-parse","--git-path",t],n,{signal:r});if(!o||!s)return null;if(ce.isAbsolute(s))return s;if(s.startsWith(".git/"))return ce.join(e,s);const i=await hd(e,n,r);return i?ce.join(i,s):null}async function RT(e,t){return Ed(e,"index",t)}function ml(e){return e.split(/[/\\]+/).join("/")}function LD(e,t,n){const r=x8(t,n),o=G8(e,r);return o?ml(o):n}function x8(e,t){return ce.isAbsolute(t)?t:ce.resolve(e,t)}function G8(e,t){const n=ce.relative(e,t);return n===""||n.startsWith("..")||ce.isAbsolute(n)?null:n}function V8(e,t){const n=new Set,r=new Set,o=new Set;let s=null;const i=[e,t].filter(Boolean).join(`
`),a=(Y,v)=>{const P=(v??"").trim();if(!P)return;const H=P.charAt(0),J=P.charAt(P.length-1);let se=P;(H==="'"||H==='"')&&J===H&&P.length>=2&&(se=P.slice(1,-1)),se&&Y.add(se)},c=(Y,v)=>{for(const P of v)if(Y[P])return Y[P]},u=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+cleanly\.?)$/i,f=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with conflicts\.?)$/i,d=/^(?:Applying patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with\s+\d+\s+rejects?\.{0,3})$/i,l=/^(?:Checking patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\.\.\.)$/i,_=/^(?:Performing three-way merge|Falling back to three-way merge)\.\.\.$/i,p=/^Failed to perform three-way merge\.\.\.$/i,h=/^Falling back to direct application\.\.\.$/i,E=/^U\s+(?<path>.+)$/,T=/^error:\s+patch failed:\s+(?<path>.+?)(?::\d+)?(?:\s|$)/i,S=/^error:\s+(?<path>.+?):\s+patch does not apply$/i,g=/^(?:error: )?repository lacks the necessary blob to (?:perform|fall back on) 3-?way merge\.?$/i,A=/^error:\s+(?<path>.+?):\s+does not match index\b/i,R=/^error:\s+(?<path>.+?):\s+does not exist in index\b/i,O=/^error:\s+(?<path>.+?)\s+already exists in (?:the )?working directory\b/i,C=/^error:\s+patch failed:\s+(?<path>.+?)\s+File exists/i,I=/^error:\s+path\s+(?<path>.+?)\s+has been renamed\/deleted/i,w=/^error:\s+cannot apply binary patch to\s+['"]?(?<path>.+?)['"]?\s+without full index line$/i,U=/^error:\s+binary patch does not apply to\s+['"]?(?<path>.+?)['"]?$/i,B=/^error:\s+binary patch to\s+['"]?(?<path>.+?)['"]?\s+creates incorrect result\b/i,F=/^error:\s+cannot read the current contents of\s+['"]?(?<path>.+?)['"]?$/i,G=/^Skipped patch\s+['"]?(?<path>.+?)['"]\.$/i,x=/^warning:\s*Cannot merge binary files:\s+(?<path>.+?)\s+\(ours\s+vs\.\s+theirs\)/i;for(const Y of i.split(/\r?\n/)){const v=Y.trim();if(!v)continue;let P;if(P=v.match(u)){const H=c(P.groups??{},["qpath","path"]);a(n,H),s=H??s,o.delete(H??""),r.delete(H??"");continue}if(P=v.match(f)){const H=c(P.groups??{},["qpath","path"]);a(o,H),s=H??s,n.delete(H??""),r.delete(H??"");continue}if(P=v.match(d)){const H=c(P.groups??{},["qpath","path"]);a(o,H),s=H??s,n.delete(H??""),r.delete(H??"");continue}if(P=v.match(E)){a(o,P.groups?.path),s=P.groups?.path??s,n.delete(P.groups?.path??""),r.delete(P.groups?.path??"");continue}if(P=v.match(l)){s=c(P.groups??{},["qpath","path"])??s;continue}if((P=v.match(T))||(P=v.match(S))){a(r,P.groups?.path),s=P.groups?.path??s;continue}if(!(_.test(v)||h.test(v))){if(p.test(v)){s&&(a(r,s),n.delete(s),o.delete(s));continue}if(g.test(v)){s&&(a(r,s),n.delete(s),o.delete(s));continue}if((P=v.match(A))||(P=v.match(R))||(P=v.match(O))||(P=v.match(C))||(P=v.match(I))||(P=v.match(w))||(P=v.match(U))||(P=v.match(B))||(P=v.match(F))||(P=v.match(G))){a(r,P.groups?.path),s=P.groups?.path??s,n.delete(P.groups?.path??""),o.delete(P.groups?.path??"");continue}if(P=v.match(x)){a(o,P.groups?.path),s=P.groups?.path??s,n.delete(P.groups?.path??""),r.delete(P.groups?.path??"");continue}}}for(const Y of o)n.delete(Y),r.delete(Y);for(const Y of n)r.delete(Y);return{appliedPaths:Array.from(n).sort(),skippedPaths:Array.from(r).sort(),conflictedPaths:Array.from(o).sort()}}function DD(e){const t=new Set,n=/^diff --git a\/(.*?) b\/(.*)$/gm;let r;for(;(r=n.exec(e))!=null;){const[o,s,i]=r;s&&s!=="/dev/null"&&t.add(s),i&&i!=="/dev/null"&&t.add(i)}return Array.from(t)}async function UD(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:o,convertWslPathToWindowsPath:s,signal:i}={}){const{cwd:a,env:c,diff:u,revert:f,target:d="unstaged",allowBinary:l}=e,_=_d("applyPatch"),h=(await t.getWorktreeRepository(a,n))?.root;if(!h)throw new Error(`${a} is not a git repository`);if(i?.aborted)return{status:"error",appliedPaths:[],skippedPaths:[],conflictedPaths:[]};const E=await B8({hostConfig:n,signal:i});let T=It(n).join(E,"patch.diff");await H8(T,u,{hostConfig:n,signal:i}),r&&o&&(T=o(T));try{let S=c;if(f&&d==="unstaged"){const U=await RT(h,n);if(!U)_.warning("[applyPatch] Unable to resolve git index path; applying without temp index");else{const B=await wD(E,U,n,{preferWslPaths:r,convertWindowsPathToWslPath:o});S={...c,GIT_INDEX_FILE:B},await $8(h,u,n,{preferWslPaths:r,convertWslPathToWindowsPath:s,env:{...c,GIT_INDEX_FILE:B},signal:i})}}const g=["apply"];f&&g.push("-R"),l&&g.push("--binary"),g.push("--3way"),d==="staged"?g.push("--cached"):d==="staged-and-unstaged"&&g.push("--index"),g.push(T);const{code:A,stdout:R,stderr:O}=await oe(h,g,n,{env:S,signal:i,allowedNonZeroExitCodes:[1]}),{appliedPaths:C,skippedPaths:I,conflictedPaths:w}=V8(R,O);return _.debug("ApplyPatch result metadata",{safe:{revert:f,target:d,code:A,stdoutLength:R.length,stderrLength:O.length,appliedCount:C.length,skippedCount:I.length,conflictedCount:w.length},sensitive:{}}),{status:i?.aborted||A==null?"error":A===0?"success":A===1?"partial-success":"error",appliedPaths:C,skippedPaths:I,conflictedPaths:w,execOutput:Yt({command:g.join(" "),stdout:R,stderr:O})}}finally{await F8(E,{hostConfig:n})}}async function $8(e,t,n,{preferWslPaths:r,convertWslPathToWindowsPath:o,env:s,signal:i}){const a=DD(t);if(a.length===0)return;const c=[],u=It(n);if(await Promise.all(a.map(async f=>{const d=LD(e,e,f);let l=u.join(e,d);r&&o&&(l=o(l)),await Y8(l,{hostConfig:n,signal:i})&&c.push(d)})),c.length!==0){if(i?.aborted)throw new Error("Apply patch canceled");await oe(e,["--no-optional-locks","add","--",...c],n,{env:s,signal:i})}}async function Td(e,t,{input:n,signal:r,timeoutMs:o=1e4}={}){if(!we(e))throw new Error("runSshCommand requires a remote host config");const s=`sh -lc ${Nt(t)}`,[i,...a]=e.terminal_command;if(!i)throw new Error("remote host config missing terminal command");const c=[...a,"-o","BatchMode=yes","-o","ConnectTimeout=10",s],u=Dc.spawn(i,c,{stdio:["pipe","pipe","pipe"]});n!=null&&u.stdin?.write(n),u.stdin?.end();let f=!1;const d=setTimeout(()=>{f=!0,u.kill()},o),l=()=>{u.kill()};r&&r.addEventListener("abort",l);const _=[],p=[];u.stdout?.on("data",S=>_.push(S)),u.stderr?.on("data",S=>p.push(S));const{code:h}=await new Promise(S=>{u.on("close",g=>S({code:g})),u.on("error",()=>S({code:null}))});clearTimeout(d),r&&r.removeEventListener("abort",l);const E=Buffer.concat(_).toString("utf8"),T=Buffer.concat(p).toString("utf8");return f?{code:null,stdout:E,stderr:`${T}ssh command timed out`}:{code:h,stdout:E,stderr:T}}async function B8({hostConfig:e,signal:t}){if(!we(e))return pe.promises.mkdtemp(yP.join(mo.tmpdir(),"codex-apply-"));const{code:n,stdout:r,stderr:o}=await Td(e,'mktemp -d "${TMPDIR:-/tmp}/codex-apply-XXXXXX"',{signal:t});if(n!==0||!r.trim())throw new Error(`failed to create remote temp dir: ${o||r}`.trim());return r.trim()}async function H8(e,t,{hostConfig:n,signal:r}){if(!we(n)){await pe.promises.writeFile(e,t);return}const o=`cat > ${Nt(e)}`,{code:s,stderr:i}=await Td(n,o,{input:t,signal:r});if(s!==0)throw new Error(`failed to write remote file: ${i}`)}async function F8(e,{hostConfig:t}){if(!we(t)){await pe.promises.rm(e,{recursive:!0,force:!0});return}await Td(t,`rm -rf ${Nt(e)}`)}async function Y8(e,{hostConfig:t,signal:n}){if(!we(t))try{return await pe.promises.access(e),!0}catch{return!1}const{code:r}=await Td(t,`test -e ${Nt(e)}`,{signal:n});return r===0}const _I=Ct("git");async function j8(e,t,n,r,o,s=!0,i){try{const a=await q8(e,t,n,r,o,s,i);if(!a.success)try{await so(t,o,!0)}catch(c){_I().warning("Failed to cleanup worktree",{safe:{},sensitive:{error:c}})}return a}catch(a){try{await so(t,o,!0)}catch(c){_I().warning("Failed to cleanup worktree",{safe:{},sensitive:{error:c}})}return{success:!1,error:W8(a)}}}async function q8(e,t,n,r,o,s,i){const a=i?.onLog,c=i?.signal;if(c&&c.aborted)return{success:!1,error:new Error("Operation canceled")};const{startingRef:u,startingDiff:f}=await v8(e,n,r,o,c);if(c&&c.aborted)return{success:!1,error:new Error("Operation canceled")};const l=await oe(e,["worktree","add","--detach",t,u],o,{onStdoutRaw:a?_=>a("stdout",_):void 0,onStderrRaw:a?_=>a("stderr",_):void 0,signal:c});if(!l.success)return{success:!1,error:new Error(`git worktree add failed: ${l.stderr||l.stdout}`)};if(c&&c.aborted)return{success:!1,error:new Error("Operation canceled")};if(s){const _=await bD(t,o);if(!_.success)return _}if(f){a?.("info",Gn.Buffer.from(`[info] Applying working tree diff to new worktree
`,"utf8"));const _=await UD({cwd:t,diff:f,revert:!1},r,o,{signal:c});if(_.status!=="success"){const p=`git apply failed: applied:${_.appliedPaths.length} skipped:${_.skippedPaths.length} conflicted:${_.conflictedPaths.length}`;return a?.("info",Gn.Buffer.from(`${p}
`,"utf8")),{success:!1,error:new Error(p)}}}return{success:!0}}function W8(e){return e instanceof Error?e:new Error(String(e))}function kD(){return ce.join(b6({}),"worktrees")}const pI=Ct("git");async function K8(e,t,n,r,o=kD()){const i=(await t.getWorktreeRepository(n,r))?.root;if(!i)return pI().error("[createWorktreePath] failed to resolve git root for workspace"),{success:!1};let a=ce.join,c=ce.relative,u=o;if(we(r)){const h=await dD(r);if(!h)return pI().error("[createWorktreePath] failed to resolve remote codex home"),{success:!1};a=ce.posix.join,c=ce.posix.relative,u=a(h,"worktrees")}const f=Sc.randomUUID().split("-")[0].slice(0,4),d=ce.basename(e),l=a(u,f,d),_=c(i,n),p=a(l,_);return{success:!0,worktreeGitRoot:l,worktreeWorkspaceRoot:p}}async function xD(e,t,n){const r=await oe(e,["remote"],t,{signal:n});if(!r.success||!r.stdout)return[];const o=r.stdout.split(`
`).map(s=>s.trim()).filter(s=>s.length>0);return o.includes(pc)&&o.length>1?[pc,...o.filter(s=>s!==pc)]:o}async function Ec(e,t,n){const r=await xD(e,t,n);if(r.length===0)return null;for(const o of r){const s=await MD(e,o,t,n);if(s)return{remote:o,branch:s}}return null}async function GD(e,t,n,r){const o=await oe(e,["rev-parse",`${t}^{tree}`],n,{allowedNonZeroExitCodes:[128],signal:r});if(!o.success||!o.stdout)throw new Error(o.stderr||o.stdout||"Failed to resolve tree");return o.stdout}var Zr={exports:{}},Xr={exports:{}},Ip,hI;function z8(){if(hI)return Ip;hI=1,Ip=r,r.sync=o;var e=Rl;function t(s,i){var a=i.pathExt!==void 0?i.pathExt:process.env.PATHEXT;if(!a||(a=a.split(";"),a.indexOf("")!==-1))return!0;for(var c=0;c<a.length;c++){var u=a[c].toLowerCase();if(u&&s.substr(-u.length).toLowerCase()===u)return!0}return!1}function n(s,i,a){return!s.isSymbolicLink()&&!s.isFile()?!1:t(i,a)}function r(s,i,a){e.stat(s,function(c,u){a(c,c?!1:n(u,s,i))})}function o(s,i){return n(e.statSync(s),s,i)}return Ip}var Pp,EI;function Z8(){if(EI)return Pp;EI=1,Pp=t,t.sync=n;var e=Rl;function t(s,i,a){e.stat(s,function(c,u){a(c,c?!1:r(u,i))})}function n(s,i){return r(e.statSync(s),i)}function r(s,i){return s.isFile()&&o(s,i)}function o(s,i){var a=s.mode,c=s.uid,u=s.gid,f=i.uid!==void 0?i.uid:process.getuid&&process.getuid(),d=i.gid!==void 0?i.gid:process.getgid&&process.getgid(),l=parseInt("100",8),_=parseInt("010",8),p=parseInt("001",8),h=l|_,E=a&p||a&_&&u===d||a&l&&c===f||a&h&&f===0;return E}return Pp}var Mp,TI;function X8(){if(TI)return Mp;TI=1;var e;process.platform==="win32"||sn.TESTING_WINDOWS?e=z8():e=Z8(),Mp=t,t.sync=n;function t(r,o,s){if(typeof o=="function"&&(s=o,o={}),!s){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(i,a){t(r,o||{},function(c,u){c?a(c):i(u)})})}e(r,o||{},function(i,a){i&&(i.code==="EACCES"||o&&o.ignoreErrors)&&(i=null,a=!1),s(i,a)})}function n(r,o){try{return e.sync(r,o||{})}catch(s){if(o&&o.ignoreErrors||s.code==="EACCES")return!1;throw s}}return Mp}var vp,SI;function Q8(){if(SI)return vp;SI=1;const e=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",t=bn,n=e?";":":",r=X8(),o=c=>Object.assign(new Error(`not found: ${c}`),{code:"ENOENT"}),s=(c,u)=>{const f=u.colon||n,d=c.match(/\//)||e&&c.match(/\\/)?[""]:[...e?[process.cwd()]:[],...(u.path||process.env.PATH||"").split(f)],l=e?u.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",_=e?l.split(f):[""];return e&&c.indexOf(".")!==-1&&_[0]!==""&&_.unshift(""),{pathEnv:d,pathExt:_,pathExtExe:l}},i=(c,u,f)=>{typeof u=="function"&&(f=u,u={}),u||(u={});const{pathEnv:d,pathExt:l,pathExtExe:_}=s(c,u),p=[],h=T=>new Promise((S,g)=>{if(T===d.length)return u.all&&p.length?S(p):g(o(c));const A=d[T],R=/^".*"$/.test(A)?A.slice(1,-1):A,O=t.join(R,c),C=!R&&/^\.[\\\/]/.test(c)?c.slice(0,2)+O:O;S(E(C,T,0))}),E=(T,S,g)=>new Promise((A,R)=>{if(g===l.length)return A(h(S+1));const O=l[g];r(T+O,{pathExt:_},(C,I)=>{if(!C&&I)if(u.all)p.push(T+O);else return A(T+O);return A(E(T,S,g+1))})});return f?h(0).then(T=>f(null,T),f):h(0)},a=(c,u)=>{u=u||{};const{pathEnv:f,pathExt:d,pathExtExe:l}=s(c,u),_=[];for(let p=0;p<f.length;p++){const h=f[p],E=/^".*"$/.test(h)?h.slice(1,-1):h,T=t.join(E,c),S=!E&&/^\.[\\\/]/.test(c)?c.slice(0,2)+T:T;for(let g=0;g<d.length;g++){const A=S+d[g];try{if(r.sync(A,{pathExt:l}))if(u.all)_.push(A);else return A}catch{}}}if(u.all&&_.length)return _;if(u.nothrow)return null;throw o(c)};return vp=i,i.sync=a,vp}var Eu={exports:{}},mI;function VD(){if(mI)return Eu.exports;mI=1;const e=(t={})=>{const n=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(n).reverse().find(o=>o.toUpperCase()==="PATH")||"Path"};return Eu.exports=e,Eu.exports.default=e,Eu.exports}var wp,gI;function J8(){if(gI)return wp;gI=1;const e=bn,t=Q8(),n=VD();function r(s,i){const a=s.options.env||process.env,c=process.cwd(),u=s.options.cwd!=null,f=u&&process.chdir!==void 0&&!process.chdir.disabled;if(f)try{process.chdir(s.options.cwd)}catch{}let d;try{d=t.sync(s.command,{path:a[n({env:a})],pathExt:i?e.delimiter:void 0})}catch{}finally{f&&process.chdir(c)}return d&&(d=e.resolve(u?s.options.cwd:"",d)),d}function o(s){return r(s)||r(s,!0)}return wp=o,wp}var Tu={},AI;function e7(){if(AI)return Tu;AI=1;const e=/([()\][%!^"`<>&|;, *?])/g;function t(r){return r=r.replace(e,"^$1"),r}function n(r,o){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(e,"^$1"),o&&(r=r.replace(e,"^$1")),r}return Tu.command=t,Tu.argument=n,Tu}var Lp,RI;function t7(){return RI||(RI=1,Lp=/^#!(.*)/),Lp}var Dp,yI;function n7(){if(yI)return Dp;yI=1;const e=t7();return Dp=(t="")=>{const n=t.match(e);if(!n)return null;const[r,o]=n[0].replace(/#! ?/,"").split(" "),s=r.split("/").pop();return s==="env"?o:o?`${s} ${o}`:s},Dp}var Up,NI;function r7(){if(NI)return Up;NI=1;const e=Rl,t=n7();function n(r){const s=Buffer.alloc(150);let i;try{i=e.openSync(r,"r"),e.readSync(i,s,0,150,0),e.closeSync(i)}catch{}return t(s.toString())}return Up=n,Up}var kp,OI;function o7(){if(OI)return kp;OI=1;const e=bn,t=J8(),n=e7(),r=r7(),o=process.platform==="win32",s=/\.(?:com|exe)$/i,i=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function a(f){f.file=t(f);const d=f.file&&r(f.file);return d?(f.args.unshift(f.file),f.command=d,t(f)):f.file}function c(f){if(!o)return f;const d=a(f),l=!s.test(d);if(f.options.forceShell||l){const _=i.test(d);f.command=e.normalize(f.command),f.command=n.command(f.command),f.args=f.args.map(h=>n.argument(h,_));const p=[f.command].concat(f.args).join(" ");f.args=["/d","/s","/c",`"${p}"`],f.command=process.env.comspec||"cmd.exe",f.options.windowsVerbatimArguments=!0}return f}function u(f,d,l){d&&!Array.isArray(d)&&(l=d,d=null),d=d?d.slice(0):[],l=Object.assign({},l);const _={command:f,args:d,options:l,file:void 0,original:{command:f,args:d}};return l.shell?_:c(_)}return kp=u,kp}var xp,bI;function s7(){if(bI)return xp;bI=1;const e=process.platform==="win32";function t(s,i){return Object.assign(new Error(`${i} ${s.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${i} ${s.command}`,path:s.command,spawnargs:s.args})}function n(s,i){if(!e)return;const a=s.emit;s.emit=function(c,u){if(c==="exit"){const f=r(u,i);if(f)return a.call(s,"error",f)}return a.apply(s,arguments)}}function r(s,i){return e&&s===1&&!i.file?t(i.original,"spawn"):null}function o(s,i){return e&&s===1&&!i.file?t(i.original,"spawnSync"):null}return xp={hookChildProcess:n,verifyENOENT:r,verifyENOENTSync:o,notFoundError:t},xp}var CI;function i7(){if(CI)return Xr.exports;CI=1;const e=Lc,t=o7(),n=s7();function r(s,i,a){const c=t(s,i,a),u=e.spawn(c.command,c.args,c.options);return n.hookChildProcess(u,c),u}function o(s,i,a){const c=t(s,i,a),u=e.spawnSync(c.command,c.args,c.options);return u.error=u.error||n.verifyENOENTSync(u.status,c),u}return Xr.exports=r,Xr.exports.spawn=r,Xr.exports.sync=o,Xr.exports._parse=t,Xr.exports._enoent=n,Xr.exports}var Gp,II;function a7(){return II||(II=1,Gp=e=>{const t=typeof e=="string"?`
`:10,n=typeof e=="string"?"\r":13;return e[e.length-1]===t&&(e=e.slice(0,e.length-1)),e[e.length-1]===n&&(e=e.slice(0,e.length-1)),e}),Gp}var Pu={exports:{}};Pu.exports;var PI;function c7(){return PI||(PI=1,(function(e){const t=bn,n=VD(),r=o=>{o={cwd:process.cwd(),path:process.env[n()],execPath:process.execPath,...o};let s,i=t.resolve(o.cwd);const a=[];for(;s!==i;)a.push(t.join(i,"node_modules/.bin")),s=i,i=t.resolve(i,"..");const c=t.resolve(o.cwd,o.execPath,"..");return a.push(c),a.concat(o.path).join(t.delimiter)};e.exports=r,e.exports.default=r,e.exports.env=o=>{o={env:process.env,...o};const s={...o.env},i=n({env:s});return o.path=s[i],s[i]=e.exports(o),s}})(Pu)),Pu.exports}var Ja={exports:{}},Su={exports:{}},MI;function u7(){if(MI)return Su.exports;MI=1;const e=(t,n)=>{for(const r of Reflect.ownKeys(n))Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r));return t};return Su.exports=e,Su.exports.default=e,Su.exports}var vI;function l7(){if(vI)return Ja.exports;vI=1;const e=u7(),t=new WeakMap,n=(r,o={})=>{if(typeof r!="function")throw new TypeError("Expected a function");let s,i=0;const a=r.displayName||r.name||"<anonymous>",c=function(...u){if(t.set(c,++i),i===1)s=r.apply(this,u),r=null;else if(o.throw===!0)throw new Error(`Function \`${a}\` can only be called once`);return s};return e(c,r),t.set(c,i),c};return Ja.exports=n,Ja.exports.default=n,Ja.exports.callCount=r=>{if(!t.has(r))throw new Error(`The given function \`${r.name}\` is not wrapped by the \`onetime\` package`);return t.get(r)},Ja.exports}var Qr={},ec={},tc={},wI;function d7(){if(wI)return tc;wI=1,Object.defineProperty(tc,"__esModule",{value:!0}),tc.SIGNALS=void 0;const e=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];return tc.SIGNALS=e,tc}var Jr={},LI;function $D(){if(LI)return Jr;LI=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.SIGRTMAX=Jr.getRealtimeSignals=void 0;const e=function(){const o=r-n+1;return Array.from({length:o},t)};Jr.getRealtimeSignals=e;const t=function(o,s){return{name:`SIGRT${s+1}`,number:n+s,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},n=34,r=64;return Jr.SIGRTMAX=r,Jr}var DI;function f7(){if(DI)return ec;DI=1,Object.defineProperty(ec,"__esModule",{value:!0}),ec.getSignals=void 0;var e=yl,t=d7(),n=$D();const r=function(){const s=(0,n.getRealtimeSignals)();return[...t.SIGNALS,...s].map(o)};ec.getSignals=r;const o=function({name:s,number:i,description:a,action:c,forced:u=!1,standard:f}){const{signals:{[s]:d}}=e.constants,l=d!==void 0;return{name:s,number:l?d:i,description:a,supported:l,action:c,forced:u,standard:f}};return ec}var UI;function _7(){if(UI)return Qr;UI=1,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.signalsByNumber=Qr.signalsByName=void 0;var e=yl,t=f7(),n=$D();const r=function(){return(0,t.getSignals)().reduce(o,{})},o=function(f,{name:d,number:l,description:_,supported:p,action:h,forced:E,standard:T}){return{...f,[d]:{name:d,number:l,description:_,supported:p,action:h,forced:E,standard:T}}},s=r();Qr.signalsByName=s;const i=function(){const f=(0,t.getSignals)(),d=n.SIGRTMAX+1,l=Array.from({length:d},(_,p)=>a(p,f));return Object.assign({},...l)},a=function(f,d){const l=c(f,d);if(l===void 0)return{};const{name:_,description:p,supported:h,action:E,forced:T,standard:S}=l;return{[f]:{name:_,number:f,description:p,supported:h,action:E,forced:T,standard:S}}},c=function(f,d){const l=d.find(({name:_})=>e.constants.signals[_]===f);return l!==void 0?l:d.find(_=>_.number===f)},u=i();return Qr.signalsByNumber=u,Qr}var Vp,kI;function p7(){if(kI)return Vp;kI=1;const{signalsByName:e}=_7(),t=({timedOut:r,timeout:o,errorCode:s,signal:i,signalDescription:a,exitCode:c,isCanceled:u})=>r?`timed out after ${o} milliseconds`:u?"was canceled":s!==void 0?`failed with ${s}`:i!==void 0?`was killed with ${i} (${a})`:c!==void 0?`failed with exit code ${c}`:"failed";return Vp=({stdout:r,stderr:o,all:s,error:i,signal:a,exitCode:c,command:u,escapedCommand:f,timedOut:d,isCanceled:l,killed:_,parsed:{options:{timeout:p}}})=>{c=c===null?void 0:c,a=a===null?void 0:a;const h=a===void 0?void 0:e[a].description,E=i&&i.code,S=`Command ${t({timedOut:d,timeout:p,errorCode:E,signal:a,signalDescription:h,exitCode:c,isCanceled:l})}: ${u}`,g=Object.prototype.toString.call(i)==="[object Error]",A=g?`${S}
${i.message}`:S,R=[A,o,r].filter(Boolean).join(`
`);return g?(i.originalMessage=i.message,i.message=R):i=new Error(R),i.shortMessage=A,i.command=u,i.escapedCommand=f,i.exitCode=c,i.signal=a,i.signalDescription=h,i.stdout=r,i.stderr=o,s!==void 0&&(i.all=s),"bufferedData"in i&&delete i.bufferedData,i.failed=!0,i.timedOut=!!d,i.isCanceled=l,i.killed=_&&!d,i},Vp}var mu={exports:{}},xI;function h7(){if(xI)return mu.exports;xI=1;const e=["stdin","stdout","stderr"],t=r=>e.some(o=>r[o]!==void 0),n=r=>{if(!r)return;const{stdio:o}=r;if(o===void 0)return e.map(i=>r[i]);if(t(r))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${e.map(i=>`\`${i}\``).join(", ")}`);if(typeof o=="string")return o;if(!Array.isArray(o))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof o}\``);const s=Math.max(o.length,e.length);return Array.from({length:s},(i,a)=>o[a])};return mu.exports=n,mu.exports.node=r=>{const o=n(r);return o==="ipc"?"ipc":o===void 0||typeof o=="string"?[o,o,o,"ipc"]:o.includes("ipc")?o:[...o,"ipc"]},mu.exports}var eo={exports:{}},$p={exports:{}},GI;function E7(){return GI||(GI=1,(function(e){e.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],process.platform!=="win32"&&e.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),process.platform==="linux"&&e.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")})($p)),$p.exports}var VI;function T7(){if(VI)return eo.exports;VI=1;var e=sn.process;const t=function(E){return E&&typeof E=="object"&&typeof E.removeListener=="function"&&typeof E.emit=="function"&&typeof E.reallyExit=="function"&&typeof E.listeners=="function"&&typeof E.kill=="function"&&typeof E.pid=="number"&&typeof E.on=="function"};if(!t(e))eo.exports=function(){return function(){}};else{var n=T0,r=E7(),o=/^win/i.test(e.platform),s=wc;typeof s!="function"&&(s=s.EventEmitter);var i;e.__signal_exit_emitter__?i=e.__signal_exit_emitter__:(i=e.__signal_exit_emitter__=new s,i.count=0,i.emitted={}),i.infinite||(i.setMaxListeners(1/0),i.infinite=!0),eo.exports=function(E,T){if(!t(sn.process))return function(){};n.equal(typeof E,"function","a callback must be provided for exit handler"),f===!1&&d();var S="exit";T&&T.alwaysLast&&(S="afterexit");var g=function(){i.removeListener(S,E),i.listeners("exit").length===0&&i.listeners("afterexit").length===0&&a()};return i.on(S,E),g};var a=function(){!f||!t(sn.process)||(f=!1,r.forEach(function(T){try{e.removeListener(T,u[T])}catch{}}),e.emit=p,e.reallyExit=l,i.count-=1)};eo.exports.unload=a;var c=function(T,S,g){i.emitted[T]||(i.emitted[T]=!0,i.emit(T,S,g))},u={};r.forEach(function(E){u[E]=function(){if(t(sn.process)){var S=e.listeners(E);S.length===i.count&&(a(),c("exit",null,E),c("afterexit",null,E),o&&E==="SIGHUP"&&(E="SIGINT"),e.kill(e.pid,E))}}}),eo.exports.signals=function(){return r};var f=!1,d=function(){f||!t(sn.process)||(f=!0,i.count+=1,r=r.filter(function(T){try{return e.on(T,u[T]),!0}catch{return!1}}),e.emit=h,e.reallyExit=_)};eo.exports.load=d;var l=e.reallyExit,_=function(T){t(sn.process)&&(e.exitCode=T||0,c("exit",e.exitCode,null),c("afterexit",e.exitCode,null),l.call(e,e.exitCode))},p=e.emit,h=function(T,S){if(T==="exit"&&t(sn.process)){S!==void 0&&(e.exitCode=S);var g=p.apply(this,arguments);return c("exit",e.exitCode,null),c("afterexit",e.exitCode,null),g}else return p.apply(this,arguments)}}return eo.exports}var Bp,$I;function S7(){if($I)return Bp;$I=1;const e=yl,t=T7(),n=1e3*5,r=(_,p="SIGTERM",h={})=>{const E=_(p);return o(_,p,h,E),E},o=(_,p,h,E)=>{if(!s(p,h,E))return;const T=a(h),S=setTimeout(()=>{_("SIGKILL")},T);S.unref&&S.unref()},s=(_,{forceKillAfterTimeout:p},h)=>i(_)&&p!==!1&&h,i=_=>_===e.constants.signals.SIGTERM||typeof _=="string"&&_.toUpperCase()==="SIGTERM",a=({forceKillAfterTimeout:_=!0})=>{if(_===!0)return n;if(!Number.isFinite(_)||_<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${_}\` (${typeof _})`);return _},c=(_,p)=>{_.kill()&&(p.isCanceled=!0)},u=(_,p,h)=>{_.kill(p),h(Object.assign(new Error("Timed out"),{timedOut:!0,signal:p}))};return Bp={spawnedKill:r,spawnedCancel:c,setupTimeout:(_,{timeout:p,killSignal:h="SIGTERM"},E)=>{if(p===0||p===void 0)return E;let T;const S=new Promise((A,R)=>{T=setTimeout(()=>{u(_,h,R)},p)}),g=E.finally(()=>{clearTimeout(T)});return Promise.race([S,g])},validateTimeout:({timeout:_})=>{if(_!==void 0&&(!Number.isFinite(_)||_<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${_}\` (${typeof _})`)},setExitHandler:async(_,{cleanup:p,detached:h},E)=>{if(!p||h)return E;const T=t(()=>{_.kill()});return E.finally(()=>{T()})}},Bp}var Hp,BI;function m7(){if(BI)return Hp;BI=1;const e=t=>t!==null&&typeof t=="object"&&typeof t.pipe=="function";return e.writable=t=>e(t)&&t.writable!==!1&&typeof t._write=="function"&&typeof t._writableState=="object",e.readable=t=>e(t)&&t.readable!==!1&&typeof t._read=="function"&&typeof t._readableState=="object",e.duplex=t=>e.writable(t)&&e.readable(t),e.transform=t=>e.duplex(t)&&typeof t._transform=="function",Hp=e,Hp}var Do={exports:{}},Fp,HI;function g7(){if(HI)return Fp;HI=1;const{PassThrough:e}=Yh;return Fp=t=>{t={...t};const{array:n}=t;let{encoding:r}=t;const o=r==="buffer";let s=!1;n?s=!(r||o):r=r||"utf8",o&&(r=null);const i=new e({objectMode:s});r&&i.setEncoding(r);let a=0;const c=[];return i.on("data",u=>{c.push(u),s?a=c.length:a+=u.length}),i.getBufferedValue=()=>n?c:o?Buffer.concat(c,a):c.join(""),i.getBufferedLength=()=>a,i},Fp}var FI;function A7(){if(FI)return Do.exports;FI=1;const{constants:e}=S0,t=Yh,{promisify:n}=ar,r=g7(),o=n(t.pipeline);class s extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}}async function i(a,c){if(!a)throw new Error("Expected a stream");c={maxBuffer:1/0,...c};const{maxBuffer:u}=c,f=r(c);return await new Promise((d,l)=>{const _=p=>{p&&f.getBufferedLength()<=e.MAX_LENGTH&&(p.bufferedData=f.getBufferedValue()),l(p)};(async()=>{try{await o(a,f),d()}catch(p){_(p)}})(),f.on("data",()=>{f.getBufferedLength()>u&&_(new s)})}),f.getBufferedValue()}return Do.exports=i,Do.exports.buffer=(a,c)=>i(a,{...c,encoding:"buffer"}),Do.exports.array=(a,c)=>i(a,{...c,array:!0}),Do.exports.MaxBufferError=s,Do.exports}var Yp,YI;function R7(){if(YI)return Yp;YI=1;const{PassThrough:e}=Yh;return Yp=function(){var t=[],n=new e({objectMode:!0});return n.setMaxListeners(0),n.add=r,n.isEmpty=o,n.on("unpipe",s),Array.prototype.slice.call(arguments).forEach(r),n;function r(i){return Array.isArray(i)?(i.forEach(r),this):(t.push(i),i.once("end",s.bind(null,i)),i.once("error",n.emit.bind(n,"error")),i.pipe(n,{end:!1}),this)}function o(){return t.length==0}function s(i){t=t.filter(function(a){return a!==i}),!t.length&&n.readable&&n.end()}},Yp}var jp,jI;function y7(){if(jI)return jp;jI=1;const e=m7(),t=A7(),n=R7(),r=(u,f)=>{f===void 0||u.stdin===void 0||(e(f)?f.pipe(u.stdin):u.stdin.end(f))},o=(u,{all:f})=>{if(!f||!u.stdout&&!u.stderr)return;const d=n();return u.stdout&&d.add(u.stdout),u.stderr&&d.add(u.stderr),d},s=async(u,f)=>{if(u){u.destroy();try{return await f}catch(d){return d.bufferedData}}},i=(u,{encoding:f,buffer:d,maxBuffer:l})=>{if(!(!u||!d))return f?t(u,{encoding:f,maxBuffer:l}):t.buffer(u,{maxBuffer:l})};return jp={handleInput:r,makeAllStream:o,getSpawnedResult:async({stdout:u,stderr:f,all:d},{encoding:l,buffer:_,maxBuffer:p},h)=>{const E=i(u,{encoding:l,buffer:_,maxBuffer:p}),T=i(f,{encoding:l,buffer:_,maxBuffer:p}),S=i(d,{encoding:l,buffer:_,maxBuffer:p*2});try{return await Promise.all([h,E,T,S])}catch(g){return Promise.all([{error:g,signal:g.signal,timedOut:g.timedOut},s(u,E),s(f,T),s(d,S)])}},validateInputSync:({input:u})=>{if(e(u))throw new TypeError("The `input` option cannot be a stream in sync mode")}},jp}var qp,qI;function N7(){if(qI)return qp;qI=1;const e=(async()=>{})().constructor.prototype,t=["then","catch","finally"].map(o=>[o,Reflect.getOwnPropertyDescriptor(e,o)]);return qp={mergePromise:(o,s)=>{for(const[i,a]of t){const c=typeof s=="function"?(...u)=>Reflect.apply(a.value,s(),u):a.value.bind(s);Reflect.defineProperty(o,i,{...a,value:c})}return o},getSpawnedPromise:o=>new Promise((s,i)=>{o.on("exit",(a,c)=>{s({exitCode:a,signal:c})}),o.on("error",a=>{i(a)}),o.stdin&&o.stdin.on("error",a=>{i(a)})})},qp}var Wp,WI;function O7(){if(WI)return Wp;WI=1;const e=(c,u=[])=>Array.isArray(u)?[c,...u]:[c],t=/^[\w.-]+$/,n=/"/g,r=c=>typeof c!="string"||t.test(c)?c:`"${c.replace(n,'\\"')}"`,o=(c,u)=>e(c,u).join(" "),s=(c,u)=>e(c,u).map(f=>r(f)).join(" "),i=/ +/g;return Wp={joinCommand:o,getEscapedCommand:s,parseCommand:c=>{const u=[];for(const f of c.trim().split(i)){const d=u[u.length-1];d&&d.endsWith("\\")?u[u.length-1]=`${d.slice(0,-1)} ${f}`:u.push(f)}return u}},Wp}var KI;function b7(){if(KI)return Zr.exports;KI=1;const e=bn,t=Lc,n=i7(),r=a7(),o=c7(),s=l7(),i=p7(),a=h7(),{spawnedKill:c,spawnedCancel:u,setupTimeout:f,validateTimeout:d,setExitHandler:l}=S7(),{handleInput:_,getSpawnedResult:p,makeAllStream:h,validateInputSync:E}=y7(),{mergePromise:T,getSpawnedPromise:S}=N7(),{joinCommand:g,parseCommand:A,getEscapedCommand:R}=O7(),O=1e3*1e3*100,C=({env:B,extendEnv:F,preferLocal:G,localDir:x,execPath:Y})=>{const v=F?{...process.env,...B}:B;return G?o.env({env:v,cwd:x,execPath:Y}):v},I=(B,F,G={})=>{const x=n._parse(B,F,G);return B=x.command,F=x.args,G=x.options,G={maxBuffer:O,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:G.cwd||process.cwd(),execPath:process.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...G},G.env=C(G),G.stdio=a(G),process.platform==="win32"&&e.basename(B,".exe")==="cmd"&&F.unshift("/q"),{file:B,args:F,options:G,parsed:x}},w=(B,F,G)=>typeof F!="string"&&!Buffer.isBuffer(F)?G===void 0?void 0:"":B.stripFinalNewline?r(F):F,U=(B,F,G)=>{const x=I(B,F,G),Y=g(B,F),v=R(B,F);d(x.options);let P;try{P=t.spawn(x.file,x.args,x.options)}catch(V){const $=new t.ChildProcess,K=Promise.reject(i({error:V,stdout:"",stderr:"",all:"",command:Y,escapedCommand:v,parsed:x,timedOut:!1,isCanceled:!1,killed:!1}));return T($,K)}const H=S(P),J=f(P,x.options,H),se=l(P,x.options,J),ne={isCanceled:!1};P.kill=c.bind(null,P.kill.bind(P)),P.cancel=u.bind(null,P,ne);const L=s(async()=>{const[{error:V,exitCode:$,signal:K,timedOut:X},D,k,z]=await p(P,x.options,se),q=w(x.options,D),ee=w(x.options,k),re=w(x.options,z);if(V||$!==0||K!==null){const _e=i({error:V,exitCode:$,signal:K,stdout:q,stderr:ee,all:re,command:Y,escapedCommand:v,parsed:x,timedOut:X,isCanceled:ne.isCanceled,killed:P.killed});if(!x.options.reject)return _e;throw _e}return{command:Y,escapedCommand:v,exitCode:0,stdout:q,stderr:ee,all:re,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return _(P,x.options.input),P.all=h(P,x.options),T(P,L)};return Zr.exports=U,Zr.exports.sync=(B,F,G)=>{const x=I(B,F,G),Y=g(B,F),v=R(B,F);E(x.options);let P;try{P=t.spawnSync(x.file,x.args,x.options)}catch(se){throw i({error:se,stdout:"",stderr:"",all:"",command:Y,escapedCommand:v,parsed:x,timedOut:!1,isCanceled:!1,killed:!1})}const H=w(x.options,P.stdout,P.error),J=w(x.options,P.stderr,P.error);if(P.error||P.status!==0||P.signal!==null){const se=i({stdout:H,stderr:J,error:P.error,signal:P.signal,exitCode:P.status,command:Y,escapedCommand:v,parsed:x,timedOut:P.error&&P.error.code==="ETIMEDOUT",isCanceled:!1,killed:P.signal!==null});if(!x.options.reject)return se;throw se}return{command:Y,escapedCommand:v,exitCode:0,stdout:H,stderr:J,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}},Zr.exports.command=(B,F)=>{const[G,...x]=A(B);return U(G,x,F)},Zr.exports.commandSync=(B,F)=>{const[G,...x]=A(B);return U.sync(G,x,F)},Zr.exports.node=(B,F,G={})=>{F&&!Array.isArray(F)&&typeof F=="object"&&(G=F,F=[]);const x=a.node(G),Y=process.execArgv.filter(H=>!H.startsWith("--inspect")),{nodePath:v=process.execPath,nodeOptions:P=Y}=G;return U(v,[...P,B,...Array.isArray(F)?F:[]],{...G,stdin:void 0,stdout:void 0,stderr:void 0,stdio:x,shell:!1})},Zr.exports}var C7=b7();const BD=Ol(C7),$h="_SHELL_ENV_DELIMITER_",I7=`echo -n "${$h}"; command env; echo -n "${$h}"; exit`,HD={DISABLE_AUTO_UPDATE:"true",ZSH_TMUX_AUTOSTARTED:"true",ZSH_TMUX_AUTOSTART:"false"},P7=/(?:\u001B\][\s\S]*?(?:\u0007|\u001B\u005C|\u009C)|[\u001B\u009B][[\]()#;?]*(?:\d{1,4}(?:[;:]\d{0,4})*)?[\dA-PR-TZcf-nq-uy=><~])/g,FD=U7(),M7=["/bin/zsh","/bin/bash"].filter(e=>e!==FD);function v7(e){if(jo.platform==="win32")return Promise.resolve(jo.env);const{shell:t,interactive:n,extraEnv:r}=L7(e),o=D7(n);return BD(t||FD,o,{env:{...HD,...r}}).then(({stdout:s})=>jD(s)).catch(s=>{if(t)throw s;return w7(o,r)})}function w7(e,t){return YD(e,t,0)}async function YD(e,t,n){const r=M7[n];if(r==null)return jo.env;try{const{stdout:o}=await BD(r,e,{env:{...HD,...t}});return jD(o)}catch{}return YD(e,t,n+1)}function jD(e){const t=e.split($h)[1],n={};for(const r of k7(t).split(`
`).filter(Boolean)){const[o,...s]=r.split("=");n[o]=s.join("=")}return n}function L7(e){return typeof e=="string"?{shell:e,interactive:!0,extraEnv:void 0}:{shell:e?.shell,interactive:e?.interactive??!0,extraEnv:e?.extraEnv}}function D7(e){return[e?"-ilc":"-lc",I7]}function U7(){const{env:e}=jo;if(jo.platform==="win32")return e.COMSPEC||"cmd.exe";try{const t=mo.userInfo().shell;if(t)return t}catch{}return jo.platform==="darwin"?e.SHELL||"/bin/zsh":e.SHELL||"/bin/sh"}function k7(e){return e.replace(P7,"")}const qD="CODEX_SHELL",xo=Ct("git");let gu=null;async function x7(e,t,n,r){const o=V7(t.environment.setup,process.platform);if(!o||o.length===0)return null;const s=Date.now();if(r&&r.aborted)return{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:s,finishedAt:Date.now(),error:"Setup script canceled",log:""};let i=null;try{const a=ce.join(e,t.cwdRelativeToGitRoot);i=await pe.promises.mkdtemp(ce.join(mo.tmpdir(),"codex-local-environment-"));const c=ce.join(i,`${Sc.randomUUID()}-setup_script.sh`),u=ce.join(i,`${Sc.randomUUID()}-setup_exit_code.txt`),f=o.replace(/\r\n/g,`
`);await pe.promises.writeFile(c,f,{mode:448});const d=`bash -xeo pipefail ${JSON.stringify(c)}; echo $? > ${JSON.stringify(u)}`,l=await G7(process.platform,process.env),_=Dc.spawn("bash",["-c",d],{stdio:["ignore","pipe","pipe"],cwd:a,env:l}),p=new Array,h=new Km.StringDecoder("utf8"),E=new Km.StringDecoder("utf8");let T="",S="";const g=(w,U,B)=>{n?.(B,w);const Y=((B==="stdout"?T:S)+(B==="stdout"?h:E).write(w)).split(/\r?\n/),v=Y.pop()??"";B==="stdout"?T=v:S=v;for(const P of Y)P&&(p.push(P),U(`[${B}] ${P}`))},A=()=>{const w=(U,B)=>{const x=(U==="stdout"?T:S)+(U==="stdout"?h:E).end();U==="stdout"?T="":S="";for(const Y of x.split(/\r?\n/))Y&&(p.push(Y),B(`[${U}] ${Y}`))};w("stdout",U=>xo().info(U)),w("stderr",U=>xo().error(U))};_.stdout?.on("data",w=>g(w,U=>xo().info(U),"stdout")),_.stderr?.on("data",w=>g(w,U=>xo().error(U),"stderr"));const R=async()=>{try{const w=await pe.promises.readFile(u,"utf8"),U=Number.parseInt(w.trim(),10);return Number.isNaN(U)?null:U}catch{return null}},O=async()=>{i!=null&&await pe.promises.rm(i,{recursive:!0,force:!0})};let C=!1;const I=()=>{C=!0,_.kill()};return r&&r.addEventListener("abort",I),new Promise(w=>{_.once("error",U=>{r&&r.removeEventListener("abort",I),(async()=>(A(),await O(),w({scriptPath:c,cwd:a,status:"failed",startedAt:s,finishedAt:Date.now(),error:U?.message??"Failed to run setup script",log:p.join(`
`)})))()}),_.once("close",U=>{r&&r.removeEventListener("abort",I),(async()=>{const F=await R()??U;A(),await O();let G,x;C?(G="failed",x="Setup script canceled"):F===0?G="succeeded":(G="failed",x=`worktree_init.sh exited with code ${F??"unknown"}`),w({scriptPath:c,cwd:a,status:G,startedAt:s,finishedAt:Date.now(),error:x,log:p.join(`
`)})})()})})}catch(a){return i!=null&&await pe.promises.rm(i,{recursive:!0,force:!0}),xo().warning("[local-environment] setup script failed",{safe:{},sensitive:{error:a}}),{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:s,finishedAt:Date.now(),error:String(a),log:""}}}async function G7(e,t,n=()=>v7({interactive:!0,extraEnv:{[qD]:"1"}})){return e==="win32"?Promise.resolve({...t}):(gu!=null||(gu=(async()=>{try{const r=await n();return zI({...t,...r})}catch(r){return xo().warning("[local-environment] failed to load shell env",{safe:{},sensitive:{error:r}}),zI({...t})}})()),gu)}function zI(e){const{[qD]:t,...n}=e;return n}function V7(e,t){if(t==="darwin"){const n=e.darwin?.script;if(n&&n.length>0)return n}if(t==="linux"){const n=e.linux?.script;if(n&&n.length>0)return n}if(t==="win32"){const n=e.win32?.script;if(n&&n.length>0)return n}return e.script}async function WD(e,t,n,r,o,s){const a=["config",r==="local"?"--local":"--worktree",t,n],c=await oe(e,a,o,{signal:s});return c.success||r!=="worktree"?c.success:!c.stderr.toLowerCase().includes("worktreeconfig")||!(await oe(e,["config","extensions.worktreeConfig","true"],o,{signal:s})).success?!1:(await oe(e,a,o,{signal:s})).success}async function $7(e,t,n,r="worktree",o){return WD(e,OQ,t,r,n,o)}const ZI=Ct("syncedBranchConfig"),KD="codex-synced-branch.json",B7=zn({branch:it(),lastSyncedTreeRef:it()});async function zD(e,t,n){const r=await hd(e,t,n);return r?ce.join(r,KD):null}function H7(e){try{const t=B7.safeParse(JSON.parse(e));return t.success?t.data:(ZI().warning("Invalid synced branch config",{safe:{parseErrorMessage:t.error.message??"unknown error"},sensitive:{}}),null)}catch(t){return ZI().warning("Failed to parse synced branch config",{safe:{},sensitive:{error:t}}),null}}async function yT(e,t,n){const r=await zD(e,t,n);if(!r)return null;try{const o=await Ke.readFile(r,t);return H7(o)}catch(o){return o.code==="ENOENT",null}}async function F7(e,t,n,r){const o=await zD(e,n,r);if(!o)throw new Error("No git repository found for synced branch config");const s=`${JSON.stringify(t,null,2)}
`;await Ke.writeFile(o,s,n)}async function Y7(e,t,n,r,o){await F7(e,{branch:t,lastSyncedTreeRef:n},r,o)}async function j7(e,t,n){return Ed(e,KD,t,n)}function q7(e){return e.startsWith("refs/")?e:`refs/heads/${e}`}async function W7({gitManager:e,workspaceRoot:t,startingState:n,localEnvironmentConfigPath:r,markAsCodexManaged:o=!0,hostConfig:s,signal:i,onLog:a}){if(i?.aborted)return{success:!1,error:new Error("Request canceled")};const u=(await e.getWorktreeRepository(t,s))?.root;if(!u)return{success:!1,error:new Error("Not a git repository")};if(i?.aborted)return{success:!1,error:new Error("Request canceled")};const[f,d]=await Promise.all([K7(u,n,s,i),Ec(u,s,i)]),l=d?.branch??null,_=o&&f!=null&&f!==l,p=await K8(u,e,t,s);if(!p.success)return{success:!1,error:new Error("Failed to compute worktree path")};if(i?.aborted)return{success:!1,error:new Error("Request canceled")};const{worktreeGitRoot:h,worktreeWorkspaceRoot:E}=p,T=await j8(u,h,n,e,s,o,{onLog:a,signal:i});if(!T.success)return{success:!1,error:T.error};if(i?.aborted)return{success:!1,error:new Error("Request canceled")};if(_&&f){const O=q7(f),C=await GD(u,O,s,i);await Y7(h,O,C,s,i)}if(a?.("info",Gn.Buffer.from(`Worktree created at ${E}
`,"utf8")),await $7(E,r??bQ,s,"worktree",i)||a?.("stderr",Gn.Buffer.from(`Failed to store selected environment in git config
`,"utf8")),r==null)return a?.("info",Gn.Buffer.from(`No local environment selected
`,"utf8")),{success:!0,worktreeGitRoot:h,worktreeWorkspaceRoot:E,setupResult:null};const A=await l8(r,s);if(A.type==="error")return a?.("stderr",Gn.Buffer.from(`${A.error.message}
`,"utf8")),{success:!1,error:A.error};a?.("info",Gn.Buffer.from(`Running setup script ${A.configPath}
`,"utf8"));const R=await x7(h,A,(O,C)=>{a?.(O,C)},i);return i?.aborted?{success:!1,error:new Error("Request canceled")}:R?.status==="failed"?(a?.("stderr",Gn.Buffer.from(`${R.error??"Setup script failed"}
`,"utf8")),{success:!1,error:new Error(R.error??"Setup script failed")}):(R?.status==="succeeded"&&a?.("info",Gn.Buffer.from(`Setup script completed
`,"utf8")),{success:!0,worktreeGitRoot:h,worktreeWorkspaceRoot:E,setupResult:R??null})}async function K7(e,t,n,r){return t.type==="branch"?t.branchName==="HEAD"?On(e,n,r):t.branchName:On(e,n,r)}async function z7(e,t,n){if(!we(t)&&!pe.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:o,stderr:s,code:i}=await oe(e,["rev-parse","--git-common-dir"],t,{signal:n});if(r&&o){const a=It(t),c=a.isAbsolute(o)?o:a.resolve(e,o);return c}if(i===128&&s.toLowerCase().includes("not a git repository"))return null;throw new Error(`Failed to resolve git common dir: ${s||o||"Unknown error"}`)}async function ZD(e,t,n){const r=await oe(e,["status","--porcelain=v1","-z"],t,{trim:!1,signal:n});if(!r.success)return{type:"error"};let o=0,s=0,i=0;const a=r.stdout;let c=0;for(;c<a.length&&!(c+1>=a.length);){const u=a[c],f=a[c+1];u==="?"&&f==="?"?i+=1:(u!==" "&&(o+=1),f!==" "&&(s+=1));const d=a.indexOf("\0",c);if(d===-1)break;if(c=d+1,u==="R"||u==="C"||f==="R"||f==="C"){const l=a.indexOf("\0",c);if(l===-1)break;c=l+1}}return{type:"success",stagedCount:o,unstagedCount:s,untrackedCount:i}}async function XD(e,t,n,r){const o=t.trim();if(!o)return null;const s=async E=>(await oe(e,["rev-parse","--verify","--quiet",E],n,{signal:r})).success,i=[],a=new Set,c=async E=>{const T=E?.trim();!T||a.has(T)||await s(T)&&(i.push(T),a.add(T))},u=await oe(e,["for-each-ref","--format=%(upstream:short)",`refs/heads/${o}`],n,{signal:r}),f=u.success?u.stdout.trim():null;await c(f),await c(o);const d=await oe(e,["remote"],n,{signal:r});if(d.success&&d.stdout){const E=d.stdout.split(`
`).map(C=>C.trim()).filter(C=>C.length>0),T=new Set(E),S=o.indexOf("/"),g=S>0?o.slice(0,S):null,A=g!=null&&T.has(g),R=A&&S+1<o.length?o.slice(S+1):null,O=[];for(const C of E){if(A&&C===g){R&&O.push(c(`refs/remotes/${C}/${R}`));continue}O.push(c(`${C}/${o}`),c(`refs/remotes/${C}/${o}`))}await Promise.all(O)}const l=i[0];if(!l)return null;const{success:_,stdout:p}=await oe(e,["merge-base","HEAD",l],n,{signal:r});if(!_||!p)return null;const h=p.trim();return h.length>0?h:null}async function Z7(e,t,n){const r=await jn(e,[],t,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:n});return r.outputLimitExceeded||!r.success?{type:"error",error:Fc(r)}:{type:"success",unifiedDiff:r.stdout,unifiedDiffBytes:r.stdoutBytes}}function QD(e,t,n){const r=ml(ce.relative(e,t));return n.map(o=>{const s=ml(o),a=r.length>0&&(s===r||s.startsWith(`${r}/`))?e:t;return LD(e,a,o)})}async function X7(e,t,n,r,o){const s=await t.getWorktreeRepository(e,n),i=s?.root;if(!i)return{stagedChanges:{type:"error",error:{type:"unknown"}},unstagedChanges:{type:"error",error:{type:"unknown"}}};const a=o==null?null:QD(i,e,o);if(a!=null){if(a.length===0)return{stagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0},unstagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}};const f=await s.getUntrackedPaths(a),d=new Set(f.paths),l=f.success?a.filter(h=>!d.has(h)):a;if(l.length===0)return{stagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0},unstagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}};const[_,p]=await Promise.all([jn(i,["--cached","--",...l],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),jn(i,["--",...l],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r})]);return{stagedChanges:Kp(_),unstagedChanges:Kp(p)}}const[c,u]=await Promise.all([jn(i,["--cached"],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),Z7(i,n,r)]);return{stagedChanges:Kp(c),unstagedChanges:u}}function Kp(e){return e.outputLimitExceeded||!e.success?{type:"error",error:Fc(e)}:{type:"success",unifiedDiff:e.stdout,unifiedDiffBytes:e.stdoutBytes}}async function Q7(e,t,n,r,o){const s=await AT(e,n,r);if(!s)return{untrackedChanges:{type:"error",error:{type:"unknown"}}};const i=o==null?null:QD(s,e,o);return i!=null&&i.length===0?{untrackedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}}:i==null?{untrackedChanges:await Vh(s,t,n)}:{untrackedChanges:await Vh(s,t,n,{includePaths:i})}}async function Sd(e,t,n){const r=await oe(e,["worktree","list","--porcelain"],t,{signal:n});if(!r.success)throw new Error(r.stderr||r.stdout||"Failed to list worktrees for repository");return J7(r.stdout??"")}function J7(e){const t=[];let n=null;const r=e.split(/\r?\n/);for(const o of r){const s=o.trim();if(s.length===0){n&&(t.push(n),n=null);continue}if(s.startsWith("worktree ")){n&&t.push(n);const i=s.slice(9).trim();if(!i){n=null;continue}n={root:i,prunable:!1,locked:!1,headRef:{sha:"",type:"detached"}};continue}if(n){if(s.startsWith("HEAD ")){const i=s.slice(5).trim();n.headRef={sha:i,type:"detached"};continue}if(s.startsWith("branch ")){const i=s.slice(7).trim();i.startsWith("refs/heads/")?n.headRef={sha:n.headRef.sha,type:"branch",string:i.slice(11)}:n.headRef={sha:n.headRef.sha,type:"branch",string:i};continue}if(s==="detached"){n.headRef={sha:n.headRef.sha,type:"detached"};continue}if(s.startsWith("prunable")){n.prunable=!0;continue}s.startsWith("locked")&&(n.locked=!0)}}return n&&t.push(n),t}function eee(e,t){const n=[t,e].filter(Boolean).join(`
`),{conflictedPaths:r,hasConflictHeader:o}=tee(n);return o||r.length>0?{errorType:"blocked-by-working-tree-changes",conflictedPaths:r}:{errorType:"unknown",conflictedPaths:[]}}function tee(e){const t=e.split(/\r?\n/),n=/^(error:\s*)?.*\bwould be overwritten by checkout:\s*$/i,r=new Set;let o=!1,s=!1;for(const i of t){const c=i.replace(/\r$/,"").trim();if(!o){n.test(c)&&(s=!0,o=!0);continue}if(c.length===0)continue;const u=c.toLowerCase();if(u.startsWith("please ")||u.startsWith("error:")||u==="aborting")break;r.add(c)}return{conflictedPaths:Array.from(r),hasConflictHeader:s}}const nee="Stashed Codex worktree changes",ree="refs/stash",XI="No local changes to save";async function Mc({cwd:e,branch:t,stashUncommitted:n=!1},r){const o=e.trim();if(!o)return{status:"error",error:"No workspace available for branch checkout",errorType:"unknown"};const s=t.trim();if(!s)return{status:"error",error:"Branch name is required",errorType:"unknown"};let i=null,a=null;if(n){const u=await oe(o,["stash","push","--include-untracked","-m",nee],r,{trim:!1}),f=u.stdout.includes(XI)||u.stderr.includes(XI);if(!f&&!u.success){const d=u.stderr||u.stdout||"Failed to stash changes";return{status:"error",error:d,errorType:"failed-to-stash-changes",execOutput:Yt({command:u.command,stdout:u.stdout,stderr:u.stderr,fallbackOutput:d})}}if(!f){a="stash@{0}";const d=await oe(o,["rev-parse","--verify",ree],r);if(!d.success||d.stdout.length===0){const l=d.stderr||d.stdout||"Failed to resolve stash reference",_=await QI({cwd:o,stashRollbackRef:a,hostConfig:r}),p=_?`${l}
${_}`:l;return{status:"error",error:p,errorType:"failed-to-stash-changes",execOutput:Yt({command:d.command,stdout:d.stdout,stderr:d.stderr,fallbackOutput:p})}}i=d.stdout}}const c=await oe(o,["checkout",s],r);if(!c.success){const u=await QI({cwd:o,stashRollbackRef:a,hostConfig:r}),f=c.stderr||c.stdout||"Failed to checkout branch",{errorType:d,conflictedPaths:l}=eee(c.stdout,c.stderr),_=u?`${f}
${u}`:f;return{status:"error",error:_,errorType:d,conflictedPaths:l.length>0?l:void 0,execOutput:Yt({command:c.command,stdout:c.stdout,stderr:c.stderr,fallbackOutput:_})}}return{status:"success",branch:s,stashRef:i}}async function QI({cwd:e,stashRollbackRef:t,hostConfig:n}){if(t==null)return null;const r=await oe(e,["stash","pop",t],n);return r.success?null:r.stderr||r.stdout||"Failed to restore stashed changes"}async function oee({cwd:e},t,n){const r=String(e).trim();if(!r)throw new Error("Workspace root is required");const o=await oe(r,["init"],n);if(!o.success)throw new Error(o.stderr||o.stdout||"Failed to run git init");return t.invalidateStableMetadata(),{success:!0}}async function JD(e,t,n,r){const o=await oe(e,["config","--get",...t],n,{signal:r});return o.success&&o.stdout?o.stdout:null}async function see(e,t,n,r,o){const a=await oe(e,["config",n==="local"?"--local":"--worktree","--get",t],r,{signal:o});return a.success&&a.stdout?a.stdout:null}async function JI(e,t,{includePaths:n,signal:r}={}){const o=["ls-files","--others","--exclude-standard","-z"];n&&n.length>0&&o.push("--",...n);const s=await oe(e,o,t,{trim:!1,signal:r});return s.success?{success:!0,paths:s.stdout.split("\0").map(a=>a.trim()).filter(a=>a.length>0)??[],gitRoot:e}:{success:!1,paths:[],gitRoot:e}}class iee{constructor(t,n){this.root=t,this.hostConfig=n}shouldUseSlowUntrackedPathsCache=!1;async getConfigValue(t,n){return JD(this.root,[t],this.hostConfig,n)}async getConfigValueForScope(t,n,r){return see(this.root,t,n,this.hostConfig,r)}async setConfigValueForScope(t,n,r,o){return WD(this.root,t,n,r,this.hostConfig,o)}getUntrackedPaths=Object.assign(async t=>t!=null&&t.length>0?JI(this.root,this.hostConfig,{includePaths:t}):this.shouldUseSlowUntrackedPathsCache?this.getAllUntrackedPathsSlow():this.getAllUntrackedPathsFast(),{clear:()=>{this.shouldUseSlowUntrackedPathsCache=!1,this.getAllUntrackedPathsFast.clear(),this.getAllUntrackedPathsSlow.clear()},delete:t=>{t!=null&&t.length>0||(this.getAllUntrackedPathsFast.delete(),this.getAllUntrackedPathsSlow.delete())}});getUntrackedDiff=Xo(async(t,n)=>{const r=await jn(this.root,["--no-index","--","/dev/null",t],this.hostConfig,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:n});return r.outputLimitExceeded||!r.success?{type:"error",error:Fc(r)}:{type:"success",unifiedDiff:r.stdout,unifiedDiffBytes:r.stdoutBytes}},{promise:!0,maxAge:2e3,length:1});fetchAllUntrackedPaths=async()=>{const t=Date.now(),n=await JI(this.root,this.hostConfig),r=Date.now()-t;return this.shouldUseSlowUntrackedPathsCache=r>=7e3,n};getAllUntrackedPathsFast=Xo(async()=>this.fetchAllUntrackedPaths(),{promise:!0,maxAge:1e4});getAllUntrackedPathsSlow=Xo(async()=>this.fetchAllUntrackedPaths(),{promise:!0,maxAge:2e4})}class aee{constructor(t,n){this.commonDir=t,this.hostConfig=n}worktreesByRoot=new Map;getCommonDir(){return this.commonDir}getRepository(t){const n=this.worktreesByRoot.get(t);if(n)return n;const r=new iee(t,this.hostConfig);return this.worktreesByRoot.set(t,r),r}invalidateUntrackedPathsCache(){for(const t of this.worktreesByRoot.values())t.getUntrackedPaths.clear()}getOriginUrl=Xo(async t=>await JD(this.commonDir,["remote.origin.url"],this.hostConfig,t),{length:0,promise:!0,maxAge:fT})}function zp(e){return e?.id??"local"}class cee{reposByKey=new Map;hasBackgroundedSinceLastForeground=!1;constructor(t){t.subscribe(n=>{this.handleAppEvent(n)})}async getRepoRepository(t,n){const r=await this.getStableMetadata(t,n);return r?this.getOrCreateRepo(r.commonDir,n):null}async getWorktreeRepository(t,n){const[r,o]=await Promise.all([this.getRepoRepository(t,n),this.getStableMetadata(t,n)]);return!r||!o?null:r.getRepository(o.root)}getRepoKey(t,n){return`${zp(n)}|${t}`}getOrCreateRepo(t,n){const r=this.getRepoKey(t,n),o=this.reposByKey.get(r);if(o)return o;const s=new aee(t,n);return this.reposByKey.set(r,s),s}invalidateStableMetadata(){this.getStableMetadata.clear()}invalidateUntrackedPathsCache(t=null,n=null){if(t==null){for(const o of this.reposByKey.values())o.invalidateUntrackedPathsCache();return}const r=zp(n);for(const[o,s]of this.reposByKey)o.startsWith(`${r}|`)&&s.invalidateUntrackedPathsCache()}getStableMetadata=Xo(async(t,n)=>{const r=await AT(t,n);if(!r)return null;const o=await z7(r,n);return o?{root:r,commonDir:o}:null},{promise:!0,maxAge:fT,normalizer:([t,n])=>`${zp(n)}|${t}`});handleAppEvent(t){switch(t.type){case"background":this.hasBackgroundedSinceLastForeground=!0;break;case"foreground":this.hasBackgroundedSinceLastForeground&&this.invalidateUntrackedPathsCache(null),this.hasBackgroundedSinceLastForeground=!1;break;case"turnComplete":this.invalidateUntrackedPathsCache(null);break}}}async function uee(e,t){const n=[];for(const r of e)if(r)try{(await Ke.stat(r,t)).isDirectory()&&n.push(r)}catch{continue}return n}async function Bh(e,t,n,{parentSha:r,message:o="Codex changes",coAuthor:s="Codex",signal:i}={}){const a=["commit-tree",t];r&&a.push("-p",r),a.push("-m",o),s&&a.push("-m",`Co-authored-by: ${s}`);const c=await oe(e,a,n,{signal:i});return!c.success||!c.stdout?{success:!1,error:c}:{success:!0,commitSha:c.stdout}}function ms(e){return/^[0-9a-f]{7,40}$/i.test(e)}const eP=1024;async function e0({gitRoot:e,env:t,signal:n,hostConfig:r,untrackedPathsPromise:o}){if(!o)return oe(e,["add","-A"],r,{env:t,signal:n});const s=await o;if(!s.success)return oe(e,["add","-A"],r,{env:t,signal:n});const i=await oe(e,["add","-u"],r,{env:t,signal:n});if(!i.success||s.paths.length===0)return i;for(const a of lee(s.paths))if(!(await oe(e,["add","--",...a],r,{env:t,signal:n})).success)return oe(e,["add","-A"],r,{env:t,signal:n});return i}function lee(e){const t=[];for(let n=0;n<e.length;n+=eP)t.push(e.slice(n,n+eP));return t}const dee="GIT_INDEX_FILE";async function t0(e,t,n){const r=await fee(n);try{const o=await wD(r,e,n),s={[dee]:o};return await t(s)}finally{await _ee(r,n)}}async function fee(e){if(!we(e))return pe.promises.mkdtemp(ce.join(mo.tmpdir(),"codex-index-"));const t=await pr({hostConfig:e,args:["sh","-lc",'mktemp -d "${TMPDIR:-/tmp}/codex-index-XXXXXX"'],timeoutMs:1e4}),{code:n,stdout:r,stderr:o}=await t.wait();if(n!==0||!r.trim()){const s=n==null?`${o}ssh command timed out`:o||r;throw new Error(`failed to create remote temp dir: ${s}`.trim())}return r.trim()}async function _ee(e,t){if(!we(t)){await pe.promises.rm(e,{recursive:!0,force:!0});return}await(await pr({hostConfig:t,args:["sh","-lc",`rm -rf ${Nt(e)}`],timeoutMs:1e4})).wait()}async function Mu(e,t){const n=t.hostConfig,r=await RT(e,n);if(!r)throw new Error("Failed to resolve git index path");return t0(r,async o=>{const s=await e0({gitRoot:e,env:o,signal:t.signal,hostConfig:n,untrackedPathsPromise:t.untrackedPathsPromise});if(!s.success)throw new Error(s.stderr||s.stdout||"Failed to stage working tree snapshot");const i=await oe(e,["write-tree"],n,{env:o,signal:t.signal}),a=i.success?i.stdout.trim():null;if(a){if(!ms(a))throw new Error(`Unexpected tree SHA: ${a}`)}else throw new Error("Failed to write working tree snapshot");return a},n)}const pee="refs/codex/snapshots",ir=Ct("worktree-snapshot");async function hee(e,t,n,r,o){const s=await e.getStableMetadata(t,n);if(!s)throw ir().warning("[worktree-snapshot] not-a-repository",{safe:{reason:r},sensitive:{}}),new Error(`Not in a git repository: ${t}`);const i=Yc(s.root),a=NT(i);ir().info("[worktree-snapshot] start",{safe:{worktreeId:i,reason:r,hasHostConfig:n!=null},sensitive:{}});const c=await e.getWorktreeRepository(t,n);if(!c)throw new Error("Unable to resolve worktree repository for snapshot.");const u=c.getUntrackedPaths(),f=await Mu(s.root,{hostConfig:n,signal:o,untrackedPathsPromise:u}),d=await oe(s.root,["rev-parse","HEAD"],n,{allowedNonZeroExitCodes:[128],signal:o}),l=d.success&&d.stdout?d.stdout.trim():null;let _=l;if(l){if((await GD(s.root,l,n,o)).trim()!==f){const E=await Bh(s.root,f,n,{parentSha:l,message:tP(r),signal:o});if(!E.success)throw new Error("Failed to create synthetic commit");_=E.commitSha.trim()}}else{const h=await Bh(s.root,f,n,{message:tP(r),signal:o});if(!h.success)throw new Error("Failed to create synthetic commit");_=h.commitSha.trim()}if(!_)throw new Error("Failed to compute snapshot commit");const p=await oe(s.root,["update-ref",a,_],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:o});if(!p.success)throw ir().warning("[worktree-snapshot] update-ref-failed",{safe:{worktreeId:i,reason:r,code:p.code,stderr:p.stderr},sensitive:{}}),new Error("Failed to update ref");return ir().info("[worktree-snapshot] success",{safe:{worktreeId:i,reason:r},sensitive:{snapshotRef:a,commitSha:_}}),{snapshotRef:a,worktreeId:i,repoRoot:s.root,commonDir:s.commonDir,commitSha:_}}async function Eee(e,t,n,r,o){const s=n,i=Yc(s),a=NT(i),c=await uee(t,r);if(c.length===0)throw new Error("No candidate workspace roots exist on disk");const u=(await Promise.all(c.map(async d=>{try{return await e.getStableMetadata(d,r)}catch{return null}}))).filter(d=>!!d);if(u.length===0)throw new Error("No candidate workspace roots are valid git repositories");const f=await Promise.all(u.map(async d=>{const l=await oe(d.root,["show-ref","--verify","--hash",a],r,{allowedNonZeroExitCodes:[128,1],env:{GIT_TERMINAL_PROMPT:"0"},signal:o});return{metadata:d,showRefResult:l}}));for(const{metadata:d,showRefResult:l}of f)if(!(l.code===128||l.code===1)){if(!l.success||!l.stdout)throw new Error(l.stderr||l.stdout||"Failed to resolve snapshot ref");return{snapshotRef:a,worktreeId:i,repoRoot:d.root,commonDir:d.commonDir,exists:!0,commitSha:l.stdout.trim()}}return{snapshotRef:a,worktreeId:i,exists:!1,commitSha:null}}async function Tee(e,t,n,r){const o=Yc(t),s=NT(o);ir().info("[worktree-restore] start",{safe:{worktreeId:o,snapshotRef:s,hasHostConfig:n!=null},sensitive:{}});const i=await oe(e,["worktree","add","--detach",t,s],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:r});if(!i.success)throw ir().warning("[worktree-restore] add-failed",{safe:{worktreeId:o,code:i.code},sensitive:{stderr:i.stderr,stdout:i.stdout}}),new Error(i.stderr||i.stdout||"Failed to restore worktree");const a=await bD(t,n);if(!a.success){ir().warning("[worktree-restore] mark-managed-failed",{safe:{worktreeId:o},sensitive:{error:a.error.message}});try{await so(t,n,!0)}catch{await Ke.rm(t,{recursive:!0,force:!0},n)}throw new Error(a.error.message)}return ir().info("[worktree-restore] success",{safe:{worktreeId:o},sensitive:{snapshotRef:s}}),!0}function NT(e){return`${pee}/${e}`}function tP(e){return`Codex worktree snapshot: ${e}`}const See=zn({state:it().optional(),number:fc().optional(),url:it().optional()});ld(See);Uc.promisify(Dc.execFile);const nP={error:0,warning:1,info:2,debug:3,trace:4};function mee(e,t){return nP[e]<=nP[t]}Uc.promisify(Dc.execFile);zn({title:it(),body:it()});async function gee({root:e,diff:t,gitManager:n,hostConfig:r,signal:o,logger:s}){const i=await RT(e,r);return i?t0(i,a=>rP(e,t,n,r,o,s,a),r):(s&&s.warning("Unable to resolve git index path; applying without temp index"),rP(e,t,n,r,o,s))}async function rP(e,t,n,r,o,s,i){return(await Aee(e,t,r,o,i)).success||s&&s.error("Failed to stage target worktree changes"),UD({cwd:e,diff:t,allowBinary:!0,revert:!1,env:i},n,r,{signal:o})}async function Aee(e,t,n,r,o){const s=DD(t);if(s.length===0)return{success:!0,command:"git add",stdout:"",stderr:""};const i=await Ree(e,s,n);return i.length===0?{success:!0,command:"git add",stdout:"",stderr:""}:oe(e,["add","--",...i],n,{env:o,signal:r})}async function Ree(e,t,n){const r=It(n),o=[];return await Promise.all(t.map(async s=>{const i=r.join(e,s);try{await Ke.stat(i,n),o.push(s)}catch{return}})),o}async function yee({sourceHeadRef:e,sourceTreeRef:t,destinationRoot:n,destinationHeadRef:r,gitManager:o,hostConfig:s,signal:i}){const a=tD("applyChanges"),c=await Nee(n,e,r,s,i);if(!c)return{status:"command-error"};const u=await jn(n,[c,t],s,{binary:!0,trim:!1,allowedNonZeroExitCodes:[0,1],signal:i});if(u.outputLimitExceeded||!u.success)return{status:"command-error",execOutput:Yt(u)};const f=u.stdout;if(!f)return{status:"success"};const d=await gee({root:n,diff:f,gitManager:o,hostConfig:s,signal:i,logger:a});return d.status==="error"?{status:"command-error",execOutput:d.execOutput}:d.status==="partial-success"?{status:"partial-success",appliedPaths:d.appliedPaths,skippedPaths:d.skippedPaths,conflictedPaths:d.conflictedPaths}:{status:"success"}}async function Nee(e,t,n,r,o){const s=await oe(e,["merge-base",t,n],r,{allowedNonZeroExitCodes:[1],signal:o});if(!s.success||!s.stdout)return null;const i=s.stdout.trim();return i?i:null}const Oee="Codex <noreply@openai.com>";function bee(e){const t=Cee(e);return t!==void 0?t:Oee}function Cee(e){if(e==null)return e;const t=e.trim();return t||null}function Iee(e,t){if(!t)return e;const n=Pee(t);if(Mee(e,n))return e;const r=e.trimEnd();if(!r)return n;const o=vee(r)?`
`:`

`;return`${r}${o}${n}`}function Pee(e){return`Co-authored-by: ${e}`}function Mee(e,t){const n=Lee(t);return new RegExp(`^${n}$`,"gim").test(e)}function vee(e){const t=e.split(/\r?\n/);let n=t.length-1,r=!1;for(;n>=0&&t[n]?.trim()!=="";){if(!wee(t[n]))return!1;r=!0,n-=1}return r}function wee(e){return/^[A-Za-z][A-Za-z0-9-]*:\s+\S/.test(e)}function Lee(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Dee(...e){const t=[],n=r=>{const o=r.trim();o.length!==0&&t.push(o)};for(const r of e)for(const o of r)n(o);return t}async function Uee(e,t,n,r,o,s){if(!n||n.trim().length===0)return{type:"error",error:{type:"unknown"}};const i=await jn(t,[n],o,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:s});if(i.outputLimitExceeded||!i.success)return{type:"error",error:Fc(i)};if(!r.success)return{type:"error",error:{type:"unknown"}};const a=await ID(e,r,s);if(!a.success)return{type:"error",error:a.error};const u=Dee([i.stdout],a.sections).join(`
`);return{type:"success",unifiedDiff:u,unifiedDiffBytes:Buffer.byteLength(u,"utf8")}}function OT(e){return e.startsWith("refs/heads/")?e.slice(11):e}async function kee(e,t,n,r){const o=await e.getWorktreeRepository(t,n),s=o?.root;if(!s)return{gitRoot:null,branch:null,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const[i,a]=await Promise.all([On(s,n,r),Ec(s,n,r)]);let c=i;if(!c){const E=await yT(t,n,r);c=E?OT(E.branch):null}if(!a)return{gitRoot:s,branch:c,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const{branch:u,remote:f}=a,d=u,l=d.includes("/")?d:`${f}/${d}`,_=await XD(s,l,n,r);if(!_)return{gitRoot:s,branch:c,baseBranch:d,baseBranchRemote:f,branchChanges:{type:"error",error:{type:"unknown"}}};const p=await o.getUntrackedPaths(),h=await Uee(o.getUntrackedDiff,t,_,p,n,r);return{gitRoot:s,branch:c,baseBranch:d,baseBranchRemote:f,branchChanges:h}}const n0=/^\d{6}-\d{4}-[0-9a-f]{8}$/i,r0=/^[0-9a-f]{4}$/i;async function xee(e=null){return we(e)?Vee(e):Gee()}async function Gee(){const e=kD();let t=[];try{t=await pe.promises.readdir(e,{withFileTypes:!0})}catch{return[]}const n=t.filter(i=>i.isDirectory()),r=await Promise.all(n.map(async i=>{const a=ce.join(e,i.name);try{const c=await pe.promises.readdir(a,{withFileTypes:!0});return{parentName:i.name,parentPath:a,worktreeEntries:c}}catch{return null}})),o=[];for(const i of r){if(!i)continue;const a=r0.test(i.parentName);for(const c of i.worktreeEntries){if(!c.isDirectory()||!a&&!n0.test(c.name))continue;const u=ce.join(i.parentPath,c.name),f=u;f&&o.push(pd(u).then(async d=>await gT(u,d,null)?{dir:f,gitDir:d}:null))}}return(await Promise.all(o)).filter(i=>i!=null)}async function Vee(e){let t;try{t=await dD(e)}catch{return[]}const n=ce.posix.join(t,"worktrees");let r=[];try{r=await Ke.readdir(n,e)}catch{return[]}const o=await Promise.all(r.map(async a=>{const c=ce.posix.join(n,a);try{if(!(await Ke.stat(c,e)).isDirectory())return null;const f=await Ke.readdir(c,e);return{parentName:a,parentPath:c,worktreeEntries:f}}catch{return null}})),s=[];for(const a of o){if(!a)continue;const c=r0.test(a.parentName);for(const u of a.worktreeEntries){if(!c&&!n0.test(u))continue;const f=ce.posix.join(a.parentPath,u);s.push(Ke.stat(f,e).then(async d=>{if(!d.isDirectory())return null;const l=f;if(!l)return null;const _=await pd(f,e);return await gT(f,_,e)?{dir:l,gitDir:_}:null}).catch(()=>null))}}return(await Promise.all(s)).filter(a=>a!=null)}const $ee=Ct("git");async function Bee(e,t,n){const r=await hd(e,t,n);if(!r)return{lastModified:0};const o=ce.join(r,"index");try{return{lastModified:(await pe.promises.stat(o)).mtimeMs}}catch(s){return s.code==="ENOENT"?{lastModified:0}:($ee().error("Failed to read index info",{safe:{indexPath:o},sensitive:{error:s}}),{lastModified:0})}}async function oP(e,t,n,r){const{success:o,stdout:s}=await oe(e,["for-each-ref",`--count=${t}`,"--sort=-committerdate","refs/heads","--format=%(refname:short)"],n,{signal:r});return!o||!s?[]:s.split(`
`).map(i=>i.trim()).filter(i=>i.length>0)}async function Hee(e,t,n){const r=await oe(e,["config","--file",".gitmodules","--get-regexp","path"],t,{allowedNonZeroExitCodes:[1],signal:n});if(!r.success||!r.stdout)return[];const o=r.stdout.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).map(s=>{const i=s.split(/\s+/),a=i[i.length-1]??"";return ml(a)}).filter(s=>s.length>0);return Array.from(new Set(o))}async function Fee(e,t,n){return{trackedChanges:await PD(e,t,n)}}const Yee=new RegExp("(?<=\\n)"),jee=/^0+$/,gl=3e4;async function qee(e,{cwd:t,oid:n,path:r,fallbackToDisk:o},s,i){const a=we(s);try{const c=await e.getStableMetadata(t,s);if(!c)return{type:"error",error:{type:"unknown"}};const u=String(c.root),d=It(s).join(u,r);if(!Wee(n))return o?iP(d,s):{type:"error",error:{type:"not-found"}};const l=await zee(u,n,s,i,a);return l.type==="success"?l:o&&l.error.type==="not-found"?iP(d,s):l}catch(c){return c.code==="ENOENT"?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}}}function o0(e){return e.includes("No such file")||e.includes("cannot open")||e.includes("not found")}function Hh(e){const t=e.split(Yee);return t.length===1&&t[0]===""?[]:(t.at(-1)===""&&t.pop(),t)}function Wee(e){return e?!jee.test(e):!1}function sP(e){return e.code===128?"not-found":"unknown"}async function Kee(e,t){if(we(t)){const{stdout:r,stderr:o,code:s}=await pr({hostConfig:t,args:["wc","-c",e],timeoutMs:gl}).then(c=>c.wait());if(s!==0){if(o0(o)){const c=new Error(`File not found: ${e}`);throw c.code="ENOENT",c}throw new Error(`Failed to stat remote file: ${e}`)}const i=r.trim().split(/\s+/)[0],a=Number.parseInt(i??"",10);if(Number.isNaN(a))throw new Error(`Failed to parse file size for ${e}`);return a}return(await SP.stat(e)).size}async function iP(e,t){if(await Kee(e,t)>Fo)return{type:"error",error:{type:"too-large",limitBytes:Fo}};if(we(t)){const{stdout:o,stderr:s,code:i}=await pr({hostConfig:t,args:["cat",e],timeoutMs:gl}).then(a=>a.wait());return i!==0?o0(s)?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}:{type:"success",lines:Hh(o)}}const r=await SP.readFile(e,"utf8");return{type:"success",lines:Hh(r)}}async function zee(e,t,n,r,o){const s=await oe(e,["cat-file","-s",t],n,{signal:r,timeoutMs:o?gl:void 0});if(!s.success)return{type:"error",error:{type:sP(s)}};const i=Number.parseInt(s.stdout,10);if(!Number.isNaN(i)&&i>Fo)return{type:"error",error:{type:"too-large",limitBytes:Fo}};const a=await oe(e,["cat-file","-p",t],n,{maxOutputBytes:Fo,signal:r,timeoutMs:o?gl:void 0,trim:!1});return a.outputLimitExceeded?{type:"error",error:{type:"too-large",limitBytes:Fo}}:a.success?{type:"success",lines:Hh(a.stdout)}:{type:"error",error:{type:sP(a)}}}async function rr({cwd:e,stashRef:t,mode:n="apply"},r){const o=e.trim();if(!o)return{status:"error",error:"No workspace available for stash apply"};const s=t.trim();if(!s)return{status:"error",error:"Stash reference is required"};const i=await Zee(o,s,r),a=await oe(o,["stash",n,i],r);if(!a.success){const c=a.stderr||a.stdout||"Failed to apply stash";return{status:"error",error:c,execOutput:Yt({command:a.command,stdout:a.stdout,stderr:a.stderr,fallbackOutput:c})}}return{status:"success",stashRef:s,mode:n}}async function Zee(e,t,n){if(!ms(t))return t;const r=await oe(e,["stash","list","--format=%H %gd"],n);return!r.success||r.stdout.length===0?t:r.stdout.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).map(s=>s.split(/\s+/,2)).find(([s])=>s===t)?.[1]??t}async function Sn({cwd:e,branch:t,stashRef:n,restoreBranchError:r,restoreStashError:o,hostConfig:s}){const i=[];return t==null?(i.push(r),i):((await Mc({cwd:e,branch:t,stashUncommitted:!1},s)).status==="error"&&i.push(r),n!=null&&(await rr({cwd:e,stashRef:n,mode:"pop"},s)).status==="error"&&i.push(o),i)}async function Xee(e,{hostConfig:t,signal:n}){const r=[];if(e.sourceBranch.trim().length===0||e.sourceHeadSha.trim().length===0)return ue({status:"error",error:"invalid-params",message:"Missing source branch or source HEAD SHA",rollbackErrors:[],warnings:r});let o=null,s=null,i=!1,a=!1;try{if(await On(e.sourceWorktreeCwd,t,n)==null)return ue({status:"error",error:"source-not-on-branch",message:"Source worktree must be on a branch to move to local",rollbackErrors:[],warnings:r});const u=It(t),f=u.normalize(u.resolve(e.localGitRoot)),d=u.normalize(u.resolve(e.sourceWorktreeRoot));if((await Sd(e.localGitRoot,t,n)).some(T=>{if(T.headRef.type!=="branch"||T.headRef.string!==e.sourceBranch)return!1;const S=u.normalize(u.resolve(T.root));return S!==f&&S!==d}))return ue({status:"error",error:"branch-checked-out-elsewhere",message:"Branch is already checked out in another worktree",rollbackErrors:[],warnings:r});s=await On(e.localGitRoot,t,n);const p=await Mc({cwd:e.sourceWorktreeCwd,branch:e.sourceHeadSha,stashUncommitted:!0},t);if(p.status==="error")return ue({status:"error",error:"source-detach-failed",message:p.error,rollbackErrors:[],warnings:r,execOutput:p.execOutput});o=p.stashRef,i=!0;const h=await ZD(e.localGitRoot,t,n);if(h.type!=="success"){const T=await Sn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:o,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return ue({status:"error",error:"local-status-check-failed",message:"Failed to read destination local status",rollbackErrors:T,warnings:r})}if(h.stagedCount+h.unstagedCount>0){const T=await Sn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:o,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return ue({status:"error",error:"local-destination-has-tracked-changes",message:"You have uncommitted changes. Commit or stash them first.",rollbackErrors:T,warnings:r})}if(s!==e.sourceBranch){const T=await Mc({cwd:e.localGitRoot,branch:e.sourceBranch,stashUncommitted:!1},t);if(T.status==="error"){const S=await Sn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:o,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return ue({status:"error",error:"checkout-local-failed",message:T.error,rollbackErrors:S,warnings:r,execOutput:T.execOutput})}a=!0}if(o!=null){const T=await rr({cwd:e.localGitRoot,stashRef:o,mode:"apply"},t);if(T.status==="error"){let g=[];return g=[...g,...await Sn({cwd:e.localGitRoot,branch:s,stashRef:null,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})],g=[...g,...await Sn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:o,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t})],ue({status:"error",error:"apply-source-stash-failed",message:T.error,rollbackErrors:g,warnings:r,execOutput:T.execOutput})}(await rr({cwd:e.localGitRoot,stashRef:o,mode:"drop"},t)).status==="error"&&r.push("drop-source-stash-failed")}return ue({status:"success",warnings:r})}catch{let c=[];return a&&(c=[...c,...await Sn({cwd:e.localGitRoot,branch:s,stashRef:null,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),i&&(c=[...c,...await Sn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:o,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t})]),ue({status:"error",error:"unexpected-error",message:"Failed to move thread to local",rollbackErrors:c,warnings:r})}}async function Qee(e,{hostConfig:t,signal:n}){const r=[];if(e.sourceBranch.trim().length===0)return ue({status:"error",error:"invalid-params",message:"Missing source branch",rollbackErrors:[],warnings:r});const o=(e.worktreeCheckoutBranch??e.sourceBranch).trim();if(o.length===0)return ue({status:"error",error:"invalid-params",message:"Missing worktree checkout branch",rollbackErrors:[],warnings:r});if(e.defaultBranch!=null&&e.defaultBranch===o)return ue({status:"error",error:"default-branch-blocked",message:"Move to worktree is not available on the default branch",rollbackErrors:[],warnings:r});let s=null,i=null,a=null,c=!1,u=!1,f=!1;try{if(a=await On(e.localCwd,t,n),a==null)return ue({status:"error",error:"local-not-on-branch",message:"Local repository must be on a branch to move to a worktree",rollbackErrors:[],warnings:r});if(a===e.sourceBranch){const l=e.defaultBranch!=null&&e.sourceBranch===e.defaultBranch||o!==e.sourceBranch,_=e.localCheckoutBranch?.trim()??"",p=_.length>0?_:l?e.sourceBranch:null;if(p==null)return ue({status:"error",error:"invalid-params",message:"Missing local checkout branch",rollbackErrors:[],warnings:r});const h=await Mc({cwd:e.localCwd,branch:p,stashUncommitted:!0},t);if(h.status==="error")return ue({status:"error",error:"checkout-local-failed",message:h.error,rollbackErrors:[],warnings:r,execOutput:h.execOutput});s=h.stashRef,c=!0}const d=await Mc({cwd:e.worktreeWorkspaceRoot,branch:o,stashUncommitted:e.stashTargetWorktree},t);if(d.status==="error"){let l=[];if(c&&(l=[...l,...await Sn({cwd:e.localCwd,branch:a,stashRef:s,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),e.createdWorktree)try{await so(e.worktreeGitRoot,t,!0,n)}catch{l.push("cleanup-created-worktree-failed")}return ue({status:"error",error:"checkout-worktree-failed",message:d.error,rollbackErrors:l,warnings:r,execOutput:d.execOutput})}if(i=d.stashRef,u=!0,i!=null&&r.push("stashed-target-worktree-changes"),s!=null){const l=await rr({cwd:e.worktreeWorkspaceRoot,stashRef:s,mode:"apply"},t);if(l.status==="error"){let _=[];if(i!=null&&(await rr({cwd:e.worktreeWorkspaceRoot,stashRef:i,mode:"pop"},t)).status==="error"&&_.push("restore-target-stash-failed"),c&&(_=[..._,...await Sn({cwd:e.localCwd,branch:a,stashRef:s,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),e.createdWorktree)try{await so(e.worktreeGitRoot,t,!0,n)}catch{_.push("cleanup-created-worktree-failed")}return ue({status:"error",error:"apply-source-stash-failed",message:l.error,rollbackErrors:_,warnings:r,execOutput:l.execOutput})}f=!0}return i!=null&&(await rr({cwd:e.worktreeWorkspaceRoot,stashRef:i,mode:"drop"},t)).status==="error"&&r.push("drop-target-stash-failed"),s!=null&&(await rr({cwd:e.localCwd,stashRef:s,mode:"drop"},t)).status==="error"&&r.push("drop-source-stash-failed"),ue({status:"success",warnings:r})}catch{let d=[];if(!f&&i!=null&&(await rr({cwd:e.worktreeWorkspaceRoot,stashRef:i,mode:"pop"},t)).status==="error"&&d.push("restore-target-stash-failed"),c&&(d=[...d,...await Sn({cwd:e.localCwd,branch:a,stashRef:f?null:s,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),u&&!f&&e.createdWorktree)try{await so(e.worktreeGitRoot,t,!0,n)}catch{d.push("cleanup-created-worktree-failed")}return ue({status:"error",error:"unexpected-error",message:"Failed to move thread to worktree",rollbackErrors:d,warnings:r})}}async function bT(e,t,n,r){const o=await oe(e,["rev-parse",t],n,{allowedNonZeroExitCodes:[128],signal:r}),s=o.success?o.stdout.trim():null;if(s&&!ms(s))throw new Error(`Unexpected ${t} SHA: ${s}`);return s?s:null}async function s0(e,t,n){const r=await bT(e,"HEAD",t,n);if(r&&!ms(r))throw new Error(`Unexpected HEAD SHA: ${r}`);return r?r:null}async function Jee(e,t,n,r){const o=await bT(e,`${t}^{tree}`,n,r);if(o&&!ms(o))throw new Error(`Unexpected ${t} SHA: ${o}`);return o?o:null}const aP=1024;async function ete({gitRoot:e,targetRoot:t,branchName:n,headCommitSha:r,treeSha:o,targetCurrentBranch:s,hostConfig:i,signal:a}){const c=tD("syncedBranch.overwrite"),u=t?await s0(t,i,a):null,f=await Jee(e,r,i,a);if(!f)return{status:"command-error"};const l=o&&o!==f&&(!t||!(!s||s===n));let _;if(l){const T=await Bh(e,o,i,{parentSha:r,signal:a});if(!T.success)return{status:"command-error",execOutput:Yt({command:"git commit-tree",stdout:"",stderr:T.error.stderr,fallbackOutput:T.error.stderr||T.error.stdout||"Failed to create synthetic commit"})};_=T.commitSha}else _=r;const[p,h]=await Promise.all([e&&_!==r?await oe(e,["reset","--hard",_],i,{signal:a}):null,t?await oe(t,["update-ref",s?`refs/heads/${s}`:"HEAD",_],i,{signal:a}):e?await oe(e,["branch","-f",n,_],i,{signal:a}):null]),E=h&&!h.success?h:p?.success===!1?p:null;if(E){const T=E.stderr||E.stdout||"Failed to reset branch";return{status:"command-error",execOutput:Yt({command:E.command,stdout:E.stdout,stderr:E.stderr,fallbackOutput:T})}}if(t){const T=await oe(t,["reset","--mixed","HEAD"],i,{signal:a});if(!T.success){const A=T.stderr||T.stdout||"Failed to reset index";return{status:"command-error",execOutput:Yt({command:T.command,stdout:T.stdout,stderr:T.stderr,fallbackOutput:A})}}const S=o?o:f;u&&await nte({gitRoot:t,baseRef:u,treeToRestore:S,hostConfig:i,signal:a,logger:c});const g=await oe(t,["restore","--source",S,"--worktree","--","."],i,{signal:a});if(!g.success){const A=g.stderr||g.stdout||"Failed to restore working tree";return{status:"command-error",execOutput:Yt({command:g.command,stdout:g.stdout,stderr:g.stderr,fallbackOutput:A})}}}return c.info("Synced branch applied to branch checkout"),{status:"success"}}async function tte(e,t,n,r){let o=null;for(const s of rte(t)){const i=await oe(e,["clean","-fd","--",...s],n,{signal:r});if(!i.success){o=i;break}}return o}async function nte({gitRoot:e,baseRef:t,treeToRestore:n,hostConfig:r,signal:o,logger:s}){const i=await oe(e,["diff","--name-only","--diff-filter=D","--no-renames",t,n],r,{allowedNonZeroExitCodes:[1],signal:o});if(!i.success){s.warning("Failed to compute deleted paths before cleaning untracked files.");return}const a=i.stdout.length>0?i.stdout.split(`
`).map(u=>u.trim()).filter(u=>u.length>0):[];if(a.length===0)return;await tte(e,a,r,o)&&s.warning("Failed to clean untracked files for deleted paths before restore.")}function rte(e){const t=[];for(let n=0;n<e.length;n+=aP)t.push(e.slice(n,n+aP));return t}async function ote(e,t,n){const r=await oe(e,["ls-files","-u"],t,{signal:n});return r.success?r.stdout.trim().length>0:!1}async function ste(e,t,n){const r=await yT(e,t,n);if(!r)return{branch:null,base:null,hasConflicts:!1};const o=await ote(e,t,n);return{branch:OT(r.branch),base:r.lastSyncedTreeRef,hasConflicts:o}}const i0={filesChanged:0,linesAdded:0,linesRemoved:0};async function cP(e,t,n,r,o){const s=await jn(e,["--numstat",t,n],r,{allowedNonZeroExitCodes:[0,1],signal:o});return!s.success||!s.stdout?i0:ite(s.stdout)}function ite(e){const t=e.trim();if(!t)return i0;let n=0,r=0,o=0;for(const s of t.split(/\r?\n/)){const i=s.trim();if(!i)continue;const[a,c,...u]=i.split("	");!a||!c||u.length===0||(n+=1,r+=uP(a),o+=uP(c))}return{filesChanged:n,linesAdded:r,linesRemoved:o}}function uP(e){if(e==="-")return 0;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:0}async function ate(e,t,n,r){return(await Sd(e,n,r)).find(s=>s.headRef.type!=="branch"?!1:s.headRef.string===t)?.root??null}async function cte(e,t,n,r){const o=await bT(e,t,n,r);if(o&&!ms(o))throw new Error(`Unexpected ${t} SHA: ${o}`);return o?o:null}const ute=Ct("git");async function lte(e,t,n,r){const o=await t.getWorktreeRepository(e,n);if(!o)throw new Error("Unable to resolve git root for synced branch status.");const s=o.root,i=o.getUntrackedPaths(),a=await yT(e,n,r);if(!a)throw new Error("No synced branch config found for the current worktree.");try{const c=OT(a.branch),u=Mu(s,{hostConfig:n,signal:r,untrackedPathsPromise:i}),[f,d,l,_,p]=await Promise.all([ate(s,c,n,r),s0(s,n,r),u,cte(s,a.branch,n,r),On(s,n,r)]);if(p)throw new Error("Worktree has a branch checked out.");if(d){if(!_)throw new Error("Unable to resolve synced branch head SHA.")}else throw new Error("Unable to resolve worktree head state.");const h=f==null?null:await t.getWorktreeRepository(f,n);let E;if(!f)E=Promise.resolve(null);else if(f===s)E=Mu(f,{hostConfig:n,signal:r,untrackedPathsPromise:i});else if(h)E=Mu(f,{hostConfig:n,signal:r,untrackedPathsPromise:h.getUntrackedPaths()});else throw new Error("Unable to resolve repository for synced branch worktree.");const T=vD(s,_,d,n,r),[S,g]=await Promise.all([T,E]),A=C=>({leftRef:C,rightRef:C,filesChanged:0,linesAdded:0,linesRemoved:0}),R=l?{...await cP(s,d,l,n,r),leftRef:d,rightRef:l}:A(d),O=f&&g?{...await cP(f,_,g,n,r),leftRef:_,rightRef:g}:A(_);return{branch:a.branch,worktreeSnapshot:{root:s,headCommitSha:d,workingTreeRef:l??void 0},branchSnapshot:f?{checkedOut:!0,snapshot:{root:f,headCommitSha:_,workingTreeRef:g??void 0}}:{checkedOut:!1,headCommitSha:_},localCommitsAhead:S?.leftAhead??0,worktreeCommitsAhead:S?.rightAhead??0,localUncommittedDiffStats:O,worktreeUncommittedDiffStats:R}}catch(c){throw ute().warning("failed to collect synced branch status",{safe:{},sensitive:{error:c}}),c}}const Fh=Ct("threadConfig"),dte="codex-thread.json",fte=zn({version:sQ(1),ownerThreadId:it()});async function a0(e,t,n){return Ed(e,dte,t,n)}function _te(e){try{const t=fte.safeParse(JSON.parse(e));return t.success?t.data:(Fh().warning("Invalid thread config}",{safe:{},sensitive:{error:t.error.message}}),null)}catch(t){return Fh().warning("Failed to parse thread config",{safe:{},sensitive:{error:t}}),null}}async function pte(e,t,n){const r=await a0(e,t,n);if(r==null)return null;try{const o=await Ke.readFile(r,t);return _te(o)}catch(o){return o.code==="ENOENT"||Fh().warning("Failed to read thread config",{safe:{},sensitive:{error:o}}),null}}async function hte(e,t,n,r){const o=await a0(e,n,r);if(o==null)throw new Error("No git repository found for thread config");const s=`${JSON.stringify(t,null,2)}
`;await Ke.writeFile(o,s,n)}async function Ete(e,t,n,r){await hte(e,{version:1,ownerThreadId:t},n,r)}async function Tte(e,t,n,r,o){const s=await n.getWorktreeRepository(e,r);if(!s)return ue({worktreeGitRoot:null,worktreeWorkspaceRoot:null,hasUncommittedChanges:!1});const i=await Sd(e,r,o),a=It(r),c=a.relative(s.root,e),u=(await Promise.all(i.map(async _=>{const p=await pd(_.root,r);if(!await gT(_.root,p,r)||(await pte(_.root,r,o))?.ownerThreadId!==t)return null;const T=c.length>0?a.join(_.root,c):_.root;if(T==null)return null;const S=await Ste(_.root,r);return{worktreeGitRoot:_.root,worktreeWorkspaceRoot:T,sortTimestamp:S}}))).filter(_=>_!=null);if(u.length===0)return ue({worktreeGitRoot:null,worktreeWorkspaceRoot:null,hasUncommittedChanges:!1});u.sort((_,p)=>_.sortTimestamp!==p.sortTimestamp?p.sortTimestamp-_.sortTimestamp:p.worktreeGitRoot.localeCompare(_.worktreeGitRoot));const f=u[0],d=await oe(f.worktreeWorkspaceRoot,["status","--porcelain"],r,{signal:o,trim:!1}),l=d.success&&d.stdout.trim().length>0;return ue({worktreeGitRoot:f.worktreeGitRoot,worktreeWorkspaceRoot:f.worktreeWorkspaceRoot,hasUncommittedChanges:l})}async function Ste(e,t){try{const r=await Ke.stat(e,t),o=Number(r.birthtimeMs??0);if(o>0)return o;const s=Number(r.mtimeMs??0);return s>0?s:0}catch{return 0}}class mte{constructor(t){this.emit=t}}async function gte(e,t){return Ed(e,"HEAD",t)}class Ate{constructor(t){this.options=t,this.emitHeadChangedDebounced=bp(()=>{const n={type:"git-repo-changed",changeType:"head",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitRemoteRefsChangedDebounced=bp(()=>{const n={type:"git-repo-changed",changeType:"remote-refs",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitSyncedBranchChangedDebounced=bp(()=>{const n={type:"git-repo-changed",changeType:"synced-branch",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500)}logger=_d("git-repo-watcher");watchers=[];emitHeadChangedDebounced;emitRemoteRefsChangedDebounced;emitSyncedBranchChangedDebounced;async start(){this.logger.info("Starting git repo watcher");const t=await gte(this.options.root,this.options.hostConfig),n=await j7(this.options.root,this.options.hostConfig);await this.tryWatch(t,this.emitHeadChangedDebounced),await this.tryWatch(ce.join(this.options.commonDir,"FETCH_HEAD"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(ce.join(this.options.commonDir,"packed-refs"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(n,this.emitSyncedBranchChangedDebounced)}dispose(){this.watchers.forEach(t=>{t.close()}),this.watchers.length=0}async tryWatch(t,n){if(t)try{const r=ce.dirname(t),o=ce.basename(t);let s=await lP(t);const i=pe.watch(r,(a,c)=>{c&&c!==o||lP(t).then(u=>{a!=="rename"&&u===s||(s=u,n())})});this.watchers.push(i)}catch(r){this.logger.warning("Failed to watch git path",{safe:{},sensitive:{error:r,path:t}})}}}async function lP(e){try{return(await pe.promises.stat(e)).mtimeMs}catch{return null}}const Au=Ct("git");class Rte extends mte{constructor(t,n){super(t),this.gitManager=n}watchesByKey=new Map;inFlightRequests=new Map;canceledRequests=new Set;uncancelableRequestIds=new Set;worktreeDeletePromises=new Map;async handleRequest(t){const n=new AbortController,r=t.params.hostConfig??null,o=t.method!=="delete-worktree"&&t.method!=="invalidate-stable-metadata"&&t.method!=="git-init-repo";if(o){if(this.inFlightRequests.set(t.id,n),this.canceledRequests.has(t.id)){this.canceledRequests.delete(t.id),n.abort(),this.inFlightRequests.delete(t.id);return}}else this.uncancelableRequestIds.add(t.id),this.canceledRequests.delete(t.id);let s;try{switch(t.method){case"stable-metadata":{s=await this.handleResolveStableMetadata(t.params,{hostConfig:r});break}case"current-branch":{const a=await On(t.params.root,r,n.signal);s=ue({branch:a});break}case"upstream-branch":{const a=await this.handleUpstreamBranch(t.params,{hostConfig:r,signal:n.signal});s=ue(a);break}case"branch-ahead-count":{const a=await this.handleBranchAheadCount(t.params,{hostConfig:r,signal:n.signal});s=ue(a);break}case"default-branch":{s=await this.handleDefaultBranch(t.params,{hostConfig:r,signal:n.signal});break}case"base-branch":{s=await this.handleBaseBranch(t.params,{hostConfig:r,signal:n.signal});break}case"recent-branches":{s=await this.handleRecentBranches(t.params,{hostConfig:r,signal:n.signal});break}case"branch-changes":{const a=await kee(this.gitManager,t.params.cwd,r,n.signal);s=ue(a);break}case"status-summary":{const a=await ZD(String(t.params.cwd),r,n.signal);s=ue(a);break}case"staged-and-unstaged-changes":{const a=await X7(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);s=ue(a);break}case"untracked-changes":{const a=await Q7(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);s=ue(a);break}case"synced-branch":{const a=await ste(t.params.cwd,r,n.signal);s=ue(a);break}case"synced-branch-state":{const a=await lte(t.params.cwd,this.gitManager,r,n.signal);s=ue(a);break}case"overwrite-repo":{const a=await ete({...t.params,hostConfig:r,signal:n.signal});s=ue(a);break}case"invalidate-stable-metadata":{this.gitManager.invalidateStableMetadata(),s=ue({success:!0});break}case"git-init-repo":{s=ue(await oee(t.params,this.gitManager,r));break}case"tracked-uncommitted-changes":{const a=await Fee(t.params.cwd,r,n.signal);s=ue(a);break}case"submodule-paths":{const a=await Hee(t.params.root,r,n.signal);s=ue({paths:a});break}case"cat-file":{const a=await qee(this.gitManager,{cwd:t.params.cwd,oid:t.params.oid,path:t.params.path,fallbackToDisk:t.params.fallbackToDisk},r,n.signal);s=ue(a);break}case"index-info":{const a=await Bee(t.params.cwd,r,n.signal);s=ue(a);break}case"config-value":{const a=await this.gitManager.getWorktreeRepository(t.params.root,r),c=a?await a.getConfigValueForScope(t.params.key,t.params.scope,n.signal):null;s=ue({value:c});break}case"set-config-value":{const a=await this.gitManager.getWorktreeRepository(t.params.root,r),c=a?await a.setConfigValueForScope(t.params.key,t.params.value,t.params.scope,n.signal):!1;s=ue({success:c});break}case"create-worktree":{s=await this.handleCreateWorktree(t.params,{hostConfig:r,signal:n.signal});break}case"codex-worktrees":{try{const a=await xee(r);s=ue({worktrees:a})}catch(a){const c=a instanceof Error?a.message:String(a);s=vo(c)}break}case"list-worktrees":{const a=await Sd(t.params.cwd,r,n.signal);s=ue({worktrees:a});break}case"resolve-worktree-for-thread":{s=await Tte(t.params.cwd,t.params.conversationId,this.gitManager,r,n.signal);break}case"worktree-snapshot-ref":{const a=await Eee(this.gitManager,t.params.candidateRoots,t.params.worktreePath,r,n.signal);s=ue(a);break}case"restore-worktree":{const a=await Tee(t.params.repoRoot,t.params.worktreePath,r,n.signal);s=ue({success:a});break}case"delete-worktree":{const a=await this.scheduleWorktreeDelete(t.params);s=ue({success:!0,worktreeId:a});break}case"set-worktree-owner-thread":{try{await Ete(t.params.worktree,t.params.conversationId,r,n.signal),s=ue({success:!0})}catch{s=vo("Failed to set thread worktree owner")}break}case"move-thread-to-local":{s=await Xee(t.params,{hostConfig:r,signal:n.signal});break}case"move-thread-to-worktree":{s=await Qee(t.params,{hostConfig:r,signal:n.signal});break}case"apply-changes":{const a=await yee({...t.params,gitManager:this.gitManager,hostConfig:r,signal:n.signal});s=ue(a);break}case"commit":{const a=await this.gitManager.getWorktreeRepository(t.params.cwd,r);a?.getUntrackedPaths.clear();const c=a?.root,u=c??String(t.params.cwd);if(t.params.includeUnstaged){const _=c?await e0({gitRoot:c,env:process.env,signal:n.signal,hostConfig:r,untrackedPathsPromise:a.getUntrackedPaths()}):await oe(u,["add","-A"],r,{signal:n.signal});if(!_.success){const p=_.stderr||_.stdout||"Failed to stage changes";s=ue({status:"error",error:p,execOutput:Yt({command:_.command,stdout:_.stdout,stderr:_.stderr,fallbackOutput:p})});break}}const f=await oe(u,["commit","-m",Iee(t.params.message,bee(t.params.commitAttribution))],r,{signal:n.signal});if(!f.success){const _=f.stderr||f.stdout||"Failed to commit changes";s=ue({status:"error",error:_,execOutput:Yt({command:f.command,stdout:f.stdout,stderr:f.stderr,fallbackOutput:_})});break}const d=await oe(u,["rev-parse","HEAD"],r,{signal:n.signal}),l=d.success?d.stdout:null;s=ue({status:"success",commitSha:l});break}}}catch(a){s=vo(a)}finally{if(Nte(t.method)){const a=yte(t);this.gitManager.invalidateUntrackedPathsCache(a,r)}o?this.inFlightRequests.delete(t.id):this.uncancelableRequestIds.delete(t.id),this.canceledRequests.delete(t.id)}if(o&&n.signal.aborted)return;const i={id:t.id,method:t.method,result:s};this.emit({type:"worker-response",response:i})}async deleteWorktreeWithLimit(t){const n=Yc(t.worktree);Au().info("[worktree-delete] worker-start",{safe:{worktreeId:n},sensitive:{reason:t.reason,force:t.force??!1,hasHostConfig:t.hostConfig!=null}});try{await hee(this.gitManager,t.worktree,t.hostConfig,t.reason)}catch(r){Au().warning("[worktree-snapshot] failed to snapshot worktree",{safe:{worktreeId:n},sensitive:{error:r}})}try{await so(t.worktree,t.hostConfig,t.force??!1)}catch(r){throw Au().warning("[worktree-delete] worker-failed",{safe:{worktreeId:n},sensitive:{error:r}}),r}return Au().info("[worktree-delete] worker-success",{safe:{worktreeId:n},sensitive:{reason:t.reason,force:t.force??!1}}),n}async scheduleWorktreeDelete(t){const r=`${t.hostConfig?.id??"local"}|${t.worktree}`,o=this.worktreeDeletePromises.get(r);if(o)return o;const s=this.deleteWorktreeWithLimit(t);this.worktreeDeletePromises.set(r,s);try{return await s}finally{this.worktreeDeletePromises.delete(r)}}async handleResolveStableMetadata(t,{hostConfig:n}){const r=await this.gitManager.getStableMetadata(t.cwd,n);if(!r)return vo("Not a git repository");const o={commonDir:r.commonDir,root:r.root};return await this.ensureWatching(o,n),ue(o)}async handleUpstreamBranch(t,{hostConfig:n,signal:r}){const o=await On(t.root,n,r),s=await oe(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),i=s.success&&s.stdout?s.stdout:null;return i?{branch:o,upstream:{branch:i}}:{branch:o,upstream:null}}async handleBranchAheadCount(t,{hostConfig:n,signal:r}){const o=await Ec(t.root,n,r),s=o?.branch??null;let i=o?.remote??null;i||(i=(await xD(t.root,n,r))[0]??null);const a=await oe(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),c=a.success&&a.stdout?a.stdout:null,u=async()=>{if(!c)return 0;const E=await oe(t.root,["rev-list","--count",`${c}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(E.success&&E.stdout){const T=Number.parseInt(E.stdout,10);return Number.isNaN(T)?0:T}return 0},f=async()=>{if(!i)return null;const E=await oe(t.root,["rev-list","--count","HEAD","--not",`--remotes=${i}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(E.success&&E.stdout){const T=Number.parseInt(E.stdout,10);return Number.isNaN(T)?null:T}return null},d=async()=>{if(!s)return 0;const E=s.includes("/")?s:i?`${i}/${s}`:s,T=await XD(t.root,E,n,r);if(T){const S=await oe(t.root,["rev-list","--count",`${T}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(S.success&&S.stdout){const g=Number.parseInt(S.stdout,10);return Number.isNaN(g)?0:g}}return 0},[l,_,p]=await Promise.all([u(),f(),d()]);let h=p;return _!=null?h=_:c!=null&&(h=l),{commitsAhead:h}}async handleDefaultBranch(t,{hostConfig:n,signal:r}){let s=(await Ec(t.root,n,r))?.branch??null;return s||(s=(await oP(t.root,10,n,r)).find(a=>a==="main"||a==="master")??null),ue({branch:s})}async handleBaseBranch(t,{hostConfig:n,signal:r}){const o=await Ec(t.root,n,r);return ue({local:o?.branch??null,remote:o?.remote??null})}async handleRecentBranches(t,{hostConfig:n,signal:r}){const o=Math.max(1,Math.min(t.limit??10,100)),s=await oP(t.root,o,n,r);return ue({branches:s})}async handleCreateWorktree(t,{hostConfig:n,signal:r}){const o=this.emit.bind(this),s=t.streamId;if(!await this.gitManager.getRepoRepository(t.cwd,n))return vo("Not a git repository (not repo repository)");const a=await W7({gitManager:this.gitManager,workspaceRoot:t.cwd,startingState:t.startingState,localEnvironmentConfigPath:t.localEnvironmentConfigPath,markAsCodexManaged:t.markAsCodexManaged??!0,hostConfig:n,signal:r,onLog:(c,u)=>{r.aborted||o({type:"worker-event",event:{type:"create-worktree-stream",streamId:s,stream:c,data:u}})}});return a.success?ue({worktreeGitRoot:a.worktreeGitRoot,worktreeWorkspaceRoot:a.worktreeWorkspaceRoot}):vo(a.error.message)}getWatchKey(t,n){return`${n?.id??"local"}|${t}`}async ensureWatching(t,n){const r=this.getWatchKey(t.root,n);if(this.watchesByKey.get(r))return;const s=new Ate({commonDir:t.commonDir,root:t.root,hostConfig:n,emit:this.emit});this.watchesByKey.set(r,s),await s.start()}handleCancel(t){if(this.uncancelableRequestIds.has(t))return;const n=this.inFlightRequests.get(t);if(!n){this.canceledRequests.add(t);return}this.inFlightRequests.delete(t),n.abort()}}function yte(e){return typeof e.params.cwd=="string"?e.params.cwd:typeof e.params.localCwd=="string"?e.params.localCwd:typeof e.params.sourceWorktreeCwd=="string"?e.params.sourceWorktreeCwd:typeof e.params.worktreeWorkspaceRoot=="string"?e.params.worktreeWorkspaceRoot:typeof e.params.root=="string"?e.params.root:typeof e.params.localGitRoot=="string"?e.params.localGitRoot:typeof e.params.worktreeGitRoot=="string"?e.params.worktreeGitRoot:null}function Nte(e){switch(e){case"overwrite-repo":case"git-init-repo":case"create-worktree":case"restore-worktree":case"delete-worktree":case"apply-changes":case"commit":case"move-thread-to-local":case"move-thread-to-worktree":return!0;case"stable-metadata":case"current-branch":case"upstream-branch":case"branch-ahead-count":case"default-branch":case"base-branch":case"recent-branches":case"branch-changes":case"status-summary":case"staged-and-unstaged-changes":case"untracked-changes":case"tracked-uncommitted-changes":case"submodule-paths":case"cat-file":case"synced-branch":case"synced-branch-state":case"index-info":case"config-value":case"set-config-value":case"set-worktree-owner-thread":case"list-worktrees":case"codex-worktrees":case"resolve-worktree-for-thread":case"worktree-snapshot-ref":case"invalidate-stable-metadata":return!1}}function Ote(e,t,n){switch(e){case"git":return new Rte(n,t)}}function bte(){const e=process.platform,t=process.env,n=mo.homedir();if(e==="darwin")return ce.join(n,"Library","Logs","com.openai.codex");if(e==="win32"){const r=t.LOCALAPPDATA??ce.join(n,"AppData","Local");return ce.join(r,"Codex","Logs")}if(e==="linux"){const r=t.XDG_STATE_HOME??ce.join(n,".local","state");return ce.join(r,"codex","logs")}return ce.join(n,".codex","logs")}const dP=10*1024*1024,fP=5,_P=1e4,Cte=1024*1024,Ite=15;function Tc(e){return e.toString().padStart(2,"0")}function pP(e,t){const n=t.getUTCFullYear().toString(),r=Tc(t.getUTCMonth()+1),o=Tc(t.getUTCDate());return ce.join(e,n,r,o)}function Zp(e,t,n,r){return e>0?e:(n(new Error(`[file-logger] invalid ${r}`),{[r]:e}),t)}function hP(e,t,n,r,o){return`codex-desktop-${e}-${t}-t${n}-i${r}-${Tc(o.getUTCHours())}${Tc(o.getUTCMinutes())}${Tc(o.getUTCSeconds())}`}let EP=0;function Pte(){return EP+=1,EP}function Mte(e,t,n,r){try{const o=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),s=new Date(o);s.setUTCDate(s.getUTCDate()-(n-1));for(const i of pe.readdirSync(e)){if(!/^\d{4}$/.test(i))continue;const a=Number(i);if(!Number.isFinite(a))continue;const c=ce.join(e,i);for(const u of pe.readdirSync(c)){if(!/^\d{2}$/.test(u))continue;const f=Number(u);if(!Number.isFinite(f)||f<1||f>12)continue;const d=ce.join(c,u);for(const l of pe.readdirSync(d)){if(!/^\d{2}$/.test(l))continue;const _=Number(l);if(!Number.isFinite(_)||_<1||_>31)continue;new Date(Date.UTC(a,f-1,_))<s&&pe.rmSync(ce.join(d,l),{recursive:!0,force:!0})}pe.readdirSync(d).length===0&&pe.rmSync(d,{recursive:!0,force:!0})}pe.readdirSync(c).length===0&&pe.rmSync(c,{recursive:!0,force:!0})}}catch(o){r(new Error("[file-logger] failed to prune old logs"),{rootDir:e,retentionDays:n,error:o instanceof Error?o.message:String(o)})}}function vte(e,t={}){const n=(g,A)=>e.nonFatalReporter.reportNonFatal(g,{kind:"file-based-logger",extra:A}),r=e.rootDir??bte(),o=t.processId??process.pid,s=t.threadId??Al.threadId??0,i=t.instanceId??Pte(),a=e.appSessionId,c=t.now??(()=>new Date),u=e.maxSegmentBytes??dP,f=e.maxSegments??fP,d=e.pendingLineLimit??_P,l=e.highWaterMarkBytes??Cte,_=Ite,p=t.createStream??((g,A)=>pe.createWriteStream(g,{flags:"w",highWaterMark:A})),h=Zp(f,fP,n,"maxSegments"),E=Zp(u,dP,n,"maxSegmentBytes"),T=Zp(d,_P,n,"pendingLineLimit"),S={logLine:()=>{}};try{const g=c();let A=pP(r,g);pe.mkdirSync(A,{recursive:!0}),Mte(r,g,_,n);let R=hP(a,o,s,i,g);const O=ne=>ce.join(A,`${R}-${ne}.log`);let C=!1;const I=ne=>{C=!0,n(new Error("[file-logger] stream error"),{error:ne instanceof Error?ne.message:String(ne),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i})},w=ne=>(ne.on("error",M=>{I(M)}),ne);let U=0,B=0,F=w(p(O(U),l)),G=[],x=0,Y=!1,v=0;const P=()=>{const ne=c(),M=pP(r,ne);M!==A&&(A=M,pe.mkdirSync(A,{recursive:!0}),R=hP(a,o,s,i,ne),F.end(),U=0,B=0,v=0,F=w(p(O(U),l)))},H=()=>{F.end(),U=(U+1)%h,B=0,F=w(p(O(U),l))},J=()=>{if(v===0)return;const ne=`[file-logger] dropped ${v} lines due to backpressure
`;G.push({text:ne,bytes:Buffer.byteLength(ne)}),v=0},se=()=>{if(C){G=[],x=0,v=0;return}if(Y)return;Y=!0;let ne=!1;try{for(;!(x>=G.length&&(J(),x>=G.length));){const M=G[x];B+M.bytes>E&&H();const L=F.write(M.text);if(B+=M.bytes,x+=1,!L){ne=!0,F.once("drain",()=>{Y=!1,se()});return}}G=[],x=0}catch(M){n(new Error("[file-logger] write failed"),{error:M instanceof Error?M.message:String(M),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i,maxSegments:h,maxSegmentBytes:E,pendingLineLimit:T}),G=[],x=0}finally{Y&&!ne&&(Y=!1)}};return{logLine:ne=>{if(!C)try{!Y&&G.length===0&&P();const M=`${ne}
`;if(G.length-x>=T){v+=1;return}G.push({text:M,bytes:Buffer.byteLength(M)}),se()}catch(M){n(new Error("[file-logger] logLine threw"),{error:M instanceof Error?M.message:String(M),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i})}}}}catch{return n(new Error("[file-logger] failed to initialize"),{rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i}),S}}function wte(e,t){switch(e){case"error":console.error(t);break;case"warning":console.warn(t);break;case"info":console.info(t);break;case"debug":console.debug(t);break;case"trace":console.log(t);break}}function Lte(e,t,n,r){const o=u=>u??{safe:{},sensitive:{}},s=vte({appSessionId:n,nonFatalReporter:e}),i=u=>{const f=new Date().toISOString();s.logLine(`${f} ${u}`)},a=u=>(f,d)=>{if(!mee(u,r))return;const l=o(d),_={...l.safe,...l.sensitive},p=Object.keys(_).length===0?f:`${f} ${n6(_)}`;wte(u,p),i(`${u} ${p}`),t.log(u,f,l.safe)},c={trace:a("trace"),debug:a("debug"),info:a("info"),warning:a("warning"),error:a("error")};Q5({trace:c.trace,debug:c.debug,info:c.info,warning:c.warning,error:c.error,log:(u,f,d)=>{c[u](f,d)},dispose:()=>{}}),a6(()=>!1)}const Dte="app:///";function Ute(e,t){kte(e,t)}function kte(e,t){const n=xQ(e.buildFlavor),r=UQ(e.appVersion);fZ({dsn:LQ,environment:e.buildFlavor,release:r,dist:e.buildNumber??void 0,tracesSampleRate:n,integrations:o=>[...o,P$({root:t,prefix:Dte})]}),VG("codex_app_session_id",e.codexAppSessionId),s6({startSpan:(o,s)=>fs(o,s)})}function xte(e,t){if(e==null){oR(null);return}oR({id:t??void 0,auth_method:e})}const{workerId:vc,sentryInitOptions:Yo,sentryRewriteFramesRoot:Gte,maxLogLevel:Vte}=Al.workerData;Ute(Yo,Gte);const c0=u8((e,t,n)=>{Ve(e,{level:t==="fatal"?"fatal":"error",tags:n.tags,extra:n.extra})}),u0=new a8({source:"codex-desktop",env:Yo.buildFlavor,codexAppSessionId:Yo.codexAppSessionId,buildInfo:{version:Yo.appVersion,buildNumber:Yo.buildNumber},reportFailure:e=>{c0.reportNonFatal("Datadog log sink failure",{kind:"datadog-log-sink-failure",tags:{failureType:e.type,reason:e.reason,workerId:vc},extra:{failure:e}})}});Lte(c0,u0,Yo.codexAppSessionId,Vte);const CT=Al.parentPort;if(!CT)throw new Error("worker-entry must be run in a worker thread");const l0=new P6,$te=new cee(l0),TP=Ote(vc,$te,e=>{const t={...e,workerId:vc};CT.postMessage(t)});CT.on("message",e=>{if(e.type==="worker-sentry-user-update"){xte(e.authMethod,e.userId);const t=e.authMethod==null?null:{id:e.userId??void 0,authMethod:e.authMethod};u0.setUserInfo(t);return}else if(e.type==="worker-app-event"){l0.emit(e.event.type,e.event.at);return}else if(e.workerId!==vc)return;switch(e.type){case"worker-request":{dT({op:"codex.worker.request",name:`${vc}.${e.request.method}`},()=>TP.handleRequest(e.request));return}case"worker-request-cancel":{TP.handleCancel(e.id);return}}});
//# sourceMappingURL=worker.js.map
